function b64_sha1(e){return binb2b64(core_sha1(str2binb(e),8*e.length))}function str_sha1(e){return binb2str(core_sha1(str2binb(e),8*e.length))}function b64_hmac_sha1(e,t){return binb2b64(core_hmac_sha1(e,t))}function str_hmac_sha1(e,t){return binb2str(core_hmac_sha1(e,t))}function core_sha1(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;var n,i,r,s,o,a,l,c,u=new Array(80),d=1732584193,p=-271733879,h=-1732584194,f=271733878,m=-1009589776;for(n=0;n<e.length;n+=16){for(s=d,o=p,a=h,l=f,c=m,i=0;i<80;i++)i<16?u[i]=e[n+i]:u[i]=rol(u[i-3]^u[i-8]^u[i-14]^u[i-16],1),r=safe_add(safe_add(rol(d,5),sha1_ft(i,p,h,f)),safe_add(safe_add(m,u[i]),sha1_kt(i))),m=f,f=h,h=rol(p,30),p=d,d=r;d=safe_add(d,s),p=safe_add(p,o),h=safe_add(h,a),f=safe_add(f,l),m=safe_add(m,c)}return[d,p,h,f,m]}function sha1_ft(e,t,n,i){return e<20?t&n|~t&i:e<40?t^n^i:e<60?t&n|t&i|n&i:t^n^i}function sha1_kt(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function core_hmac_sha1(e,t){var n=str2binb(e);n.length>16&&(n=core_sha1(n,8*e.length));for(var i=new Array(16),r=new Array(16),s=0;s<16;s++)i[s]=909522486^n[s],r[s]=1549556828^n[s];var o=core_sha1(i.concat(str2binb(t)),512+8*t.length);return core_sha1(r.concat(o),672)}function safe_add(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}function rol(e,t){return e<<t|e>>>32-t}function str2binb(e){for(var t=[],n=255,i=0;i<8*e.length;i+=8)t[i>>5]|=(e.charCodeAt(i/8)&n)<<24-i%32;return t}function binb2str(e){for(var t="",n=255,i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>24-i%32&n);return t}function binb2b64(e){for(var t,n,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",s=0;s<4*e.length;s+=3)for(t=(e[s>>2]>>8*(3-s%4)&255)<<16|(e[s+1>>2]>>8*(3-(s+1)%4)&255)<<8|e[s+2>>2]>>8*(3-(s+2)%4)&255,n=0;n<4;n++)r+=8*s+6*n>32*e.length?"=":i.charAt(t>>6*(3-n)&63);return r}if(function(e,t){if("function"==typeof define&&define.amd)define(["exports","module"],t);else if("undefined"!=typeof exports&&"undefined"!=typeof module)t(exports,module);else{var n={exports:{}};t(n.exports,n),e.autosize=n.exports}}(this,function(e,t){"use strict";function n(e){function t(){var t=window.getComputedStyle(e,null);"vertical"===t.resize?e.style.resize="none":"both"===t.resize&&(e.style.resize="horizontal"),l="content-box"===t.boxSizing?-(parseFloat(t.paddingTop)+parseFloat(t.paddingBottom)):parseFloat(t.borderTopWidth)+parseFloat(t.borderBottomWidth),isNaN(l)&&(l=0),a()}function n(t){var n=e.style.width;e.style.width="0px",e.offsetWidth,e.style.width=n,e.style.overflowY=t}function i(e){for(var t=[];e&&e.parentNode&&e.parentNode instanceof Element;)e.parentNode.scrollTop&&t.push({node:e.parentNode,scrollTop:e.parentNode.scrollTop}),e=e.parentNode;return t}function r(){var t=e.style.height,n=(i(e),document.documentElement&&document.documentElement.scrollTop);e.style.height="";var r=e.scrollHeight+l;return 0===e.scrollHeight?void(e.style.height=t):(e.style.height=r+"px",c=e.clientWidth,void(n&&(document.documentElement.scrollTop=n)))}function a(){r();var t=Math.round(parseFloat(e.style.height)),i=window.getComputedStyle(e,null),s="content-box"===i.boxSizing?Math.round(parseFloat(i.height)):e.offsetHeight;if(s!==t?"hidden"===i.overflowY&&(n("scroll"),r(),s="content-box"===i.boxSizing?Math.round(parseFloat(window.getComputedStyle(e,null).height)):e.offsetHeight):"hidden"!==i.overflowY&&(n("hidden"),r(),s="content-box"===i.boxSizing?Math.round(parseFloat(window.getComputedStyle(e,null).height)):e.offsetHeight),u!==s){u=s;var a=o("autosize:resized");try{e.dispatchEvent(a)}catch(l){}}}if(e&&e.nodeName&&"TEXTAREA"===e.nodeName&&!s.has(e)){var l=null,c=e.clientWidth,u=null,d=function(){e.clientWidth!==c&&a()},p=function(t){window.removeEventListener("resize",d,!1),e.removeEventListener("input",a,!1),e.removeEventListener("keyup",a,!1),e.removeEventListener("autosize:destroy",p,!1),e.removeEventListener("autosize:update",a,!1),Object.keys(t).forEach(function(n){e.style[n]=t[n]}),s["delete"](e)}.bind(e,{height:e.style.height,resize:e.style.resize,overflowY:e.style.overflowY,overflowX:e.style.overflowX,wordWrap:e.style.wordWrap});e.addEventListener("autosize:destroy",p,!1),"onpropertychange"in e&&"oninput"in e&&e.addEventListener("keyup",a,!1),window.addEventListener("resize",d,!1),e.addEventListener("input",a,!1),e.addEventListener("autosize:update",a,!1),e.style.overflowX="hidden",e.style.wordWrap="break-word",s.set(e,{destroy:p,update:a}),t()}}function i(e){var t=s.get(e);t&&t.destroy()}function r(e){var t=s.get(e);t&&t.update()}var s="function"==typeof Map?new Map:function(){var e=[],t=[];return{has:function(t){return e.indexOf(t)>-1},get:function(n){return t[e.indexOf(n)]},set:function(n,i){e.indexOf(n)===-1&&(e.push(n),t.push(i))},"delete":function(n){var i=e.indexOf(n);i>-1&&(e.splice(i,1),t.splice(i,1))}}}(),o=function(e){return new Event(e,{bubbles:!0})};try{new Event("test")}catch(a){o=function(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!1),t}}var l=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?(l=function(e){return e},l.destroy=function(e){return e},l.update=function(e){return e}):(l=function(e,t){return e&&Array.prototype.forEach.call(e.length?e:[e],function(e){return n(e,t)}),e},l.destroy=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],i),e},l.update=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],r),e}),t.exports=l}),function(e,t){function n(e){var t=e.length,n=le.type(e);return!le.isWindow(e)&&(!(1!==e.nodeType||!t)||("array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)))}function i(e){var t=Te[e]={};return le.each(e.match(ue)||[],function(e,n){t[n]=!0}),t}function r(e,n,i,r){if(le.acceptData(e)){var s,o,a=le.expando,l="string"==typeof n,c=e.nodeType,u=c?le.cache:e,d=c?e[a]:e[a]&&a;if(d&&u[d]&&(r||u[d].data)||!l||i!==t)return d||(c?e[a]=d=Z.pop()||le.guid++:d=a),u[d]||(u[d]={},c||(u[d].toJSON=le.noop)),("object"==typeof n||"function"==typeof n)&&(r?u[d]=le.extend(u[d],n):u[d].data=le.extend(u[d].data,n)),s=u[d],r||(s.data||(s.data={}),s=s.data),i!==t&&(s[le.camelCase(n)]=i),l?(o=s[n],null==o&&(o=s[le.camelCase(n)])):o=s,o}}function s(e,t,n){if(le.acceptData(e)){var i,r,s,o=e.nodeType,l=o?le.cache:e,c=o?e[le.expando]:le.expando;if(l[c]){if(t&&(s=n?l[c]:l[c].data)){le.isArray(t)?t=t.concat(le.map(t,le.camelCase)):t in s?t=[t]:(t=le.camelCase(t),t=t in s?[t]:t.split(" "));for(i=0,r=t.length;r>i;i++)delete s[t[i]];if(!(n?a:le.isEmptyObject)(s))return}(n||(delete l[c].data,a(l[c])))&&(o?le.cleanData([e],!0):le.support.deleteExpando||l!=l.window?delete l[c]:l[c]=null)}}}function o(e,n,i){if(i===t&&1===e.nodeType){var r="data-"+n.replace(Se,"-$1").toLowerCase();if(i=e.getAttribute(r),"string"==typeof i){try{i="true"===i||"false"!==i&&("null"===i?null:+i+""===i?+i:ke.test(i)?le.parseJSON(i):i)}catch(s){}le.data(e,n,i)}else i=t}return i}function a(e){var t;for(t in e)if(("data"!==t||!le.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function l(){return!0}function c(){return!1}function u(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function d(e,t,n){if(t=t||0,le.isFunction(t))return le.grep(e,function(e,i){var r=!!t.call(e,i,e);return r===n});if(t.nodeType)return le.grep(e,function(e){return e===t===n});if("string"==typeof t){var i=le.grep(e,function(e){return 1===e.nodeType});if(Be.test(t))return le.filter(t,i,!n);t=le.filter(t,i)}return le.grep(e,function(e){return le.inArray(e,t)>=0===n})}function p(e){var t=Ve.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}function h(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function f(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function m(e){var t=rt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function g(e,t){for(var n,i=0;null!=(n=e[i]);i++)le._data(n,"globalEval",!t||le._data(t[i],"globalEval"))}function v(e,t){if(1===t.nodeType&&le.hasData(e)){var n,i,r,s=le._data(e),o=le._data(t,s),a=s.events;if(a){delete o.handle,o.events={};for(n in a)for(i=0,r=a[n].length;r>i;i++)le.event.add(t,n,a[n][i])}o.data&&(o.data=le.extend({},o.data))}}function b(e,t){var n,i,r;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!le.support.noCloneEvent&&t[le.expando]){r=le._data(t);for(i in r.events)le.removeEvent(t,i,r.handle);t.removeAttribute(le.expando)}"script"===n&&t.text!==e.text?(f(t).text=e.text,m(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),le.support.html5Clone&&e.innerHTML&&!le.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&tt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function y(e,n){var i,r,s=0,o=typeof e.getElementsByTagName!==X?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==X?e.querySelectorAll(n||"*"):t;if(!o)for(o=[],i=e.childNodes||e;null!=(r=i[s]);s++)!n||le.nodeName(r,n)?o.push(r):le.merge(o,y(r,n));return n===t||n&&le.nodeName(e,n)?le.merge([e],o):o}function _(e){tt.test(e.type)&&(e.defaultChecked=e.checked)}function x(e,t){if(t in e)return t;for(var n=t.charAt(0).toUpperCase()+t.slice(1),i=t,r=kt.length;r--;)if(t=kt[r]+n,t in e)return t;return i}function w(e,t){return e=t||e,"none"===le.css(e,"display")||!le.contains(e.ownerDocument,e)}function T(e,t){for(var n,i,r,s=[],o=0,a=e.length;a>o;o++)i=e[o],i.style&&(s[o]=le._data(i,"olddisplay"),n=i.style.display,t?(s[o]||"none"!==n||(i.style.display=""),""===i.style.display&&w(i)&&(s[o]=le._data(i,"olddisplay",E(i.nodeName)))):s[o]||(r=w(i),(n&&"none"!==n||!r)&&le._data(i,"olddisplay",r?n:le.css(i,"display"))));for(o=0;a>o;o++)i=e[o],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?s[o]||"":"none"));return e}function k(e,t,n){var i=vt.exec(t);return i?Math.max(0,i[1]-(n||0))+(i[2]||"px"):t}function S(e,t,n,i,r){for(var s=n===(i?"border":"content")?4:"width"===t?1:0,o=0;4>s;s+=2)"margin"===n&&(o+=le.css(e,n+Tt[s],!0,r)),i?("content"===n&&(o-=le.css(e,"padding"+Tt[s],!0,r)),"margin"!==n&&(o-=le.css(e,"border"+Tt[s]+"Width",!0,r))):(o+=le.css(e,"padding"+Tt[s],!0,r),"padding"!==n&&(o+=le.css(e,"border"+Tt[s]+"Width",!0,r)));return o}function C(e,t,n){var i=!0,r="width"===t?e.offsetWidth:e.offsetHeight,s=ut(e),o=le.support.boxSizing&&"border-box"===le.css(e,"boxSizing",!1,s);if(0>=r||null==r){if(r=dt(e,t,s),(0>r||null==r)&&(r=e.style[t]),bt.test(r))return r;i=o&&(le.support.boxSizingReliable||r===e.style[t]),r=parseFloat(r)||0}return r+S(e,t,n||(o?"border":"content"),i,s)+"px"}function E(e){var t=Q,n=_t[e];return n||(n=A(e,t),"none"!==n&&n||(ct=(ct||le("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(ct[0].contentWindow||ct[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=A(e,t),ct.detach()),_t[e]=n),n}function A(e,t){var n=le(t.createElement(e)).appendTo(t.body),i=le.css(n[0],"display");return n.remove(),i}function I(e,t,n,i){var r;if(le.isArray(t))le.each(t,function(t,r){n||Ct.test(e)?i(e,r):I(e+"["+("object"==typeof r?t:"")+"]",r,n,i)});else if(n||"object"!==le.type(t))i(e,t);else for(r in t)I(e+"["+r+"]",t[r],n,i)}function D(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var i,r=0,s=t.toLowerCase().match(ue)||[];if(le.isFunction(n))for(;i=s[r++];)"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(n)):(e[i]=e[i]||[]).push(n)}}function N(e,n,i,r){function s(l){var c;return o[l]=!0,le.each(e[l]||[],function(e,l){var u=l(n,i,r);return"string"!=typeof u||a||o[u]?a?!(c=u):t:(n.dataTypes.unshift(u),s(u),!1)}),c}var o={},a=e===Bt;return s(n.dataTypes[0])||!o["*"]&&s("*")}function L(e,n){var i,r,s=le.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((s[r]?e:i||(i={}))[r]=n[r]);return i&&le.extend(!0,e,i),e}function j(e,n,i){var r,s,o,a,l=e.contents,c=e.dataTypes,u=e.responseFields;for(a in u)a in i&&(n[u[a]]=i[a]);for(;"*"===c[0];)c.shift(),s===t&&(s=e.mimeType||n.getResponseHeader("Content-Type"));if(s)for(a in l)if(l[a]&&l[a].test(s)){c.unshift(a);break}if(c[0]in i)o=c[0];else{for(a in i){if(!c[0]||e.converters[a+" "+c[0]]){o=a;break}r||(r=a)}o=o||r}return o?(o!==c[0]&&c.unshift(o),i[o]):t}function $(e,t){var n,i,r,s,o={},a=0,l=e.dataTypes.slice(),c=l[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l[1])for(r in e.converters)o[r.toLowerCase()]=e.converters[r];for(;i=l[++a];)if("*"!==i){if("*"!==c&&c!==i){if(r=o[c+" "+i]||o["* "+i],!r)for(n in o)if(s=n.split(" "),s[1]===i&&(r=o[c+" "+s[0]]||o["* "+s[0]])){r===!0?r=o[n]:o[n]!==!0&&(i=s[0],l.splice(a--,0,i));break}if(r!==!0)if(r&&e["throws"])t=r(t);else try{t=r(t)}catch(u){return{state:"parsererror",error:r?u:"No conversion from "+c+" to "+i}}}c=i}return{state:"success",data:t}}function R(){try{return new e.XMLHttpRequest}catch(t){}}function M(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function F(){return setTimeout(function(){Yt=t}),Yt=le.now()}function O(e,t){le.each(t,function(t,n){for(var i=(sn[t]||[]).concat(sn["*"]),r=0,s=i.length;s>r;r++)if(i[r].call(e,t,n))return})}function q(e,t,n){var i,r,s=0,o=rn.length,a=le.Deferred().always(function(){delete l.elem}),l=function(){if(r)return!1;for(var t=Yt||F(),n=Math.max(0,c.startTime+c.duration-t),i=n/c.duration||0,s=1-i,o=0,l=c.tweens.length;l>o;o++)c.tweens[o].run(s);return a.notifyWith(e,[c,s,n]),1>s&&l?n:(a.resolveWith(e,[c]),!1)},c=a.promise({elem:e,props:le.extend({},t),opts:le.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Yt||F(),duration:n.duration,tweens:[],createTween:function(t,n){var i=le.Tween(e,c.opts,t,n,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(i),i},stop:function(t){var n=0,i=t?c.tweens.length:0;if(r)return this;for(r=!0;i>n;n++)c.tweens[n].run(1);return t?a.resolveWith(e,[c,t]):a.rejectWith(e,[c,t]),this}}),u=c.props;for(H(u,c.opts.specialEasing);o>s;s++)if(i=rn[s].call(c,e,u,c.opts))return i;return O(c,u),le.isFunction(c.opts.start)&&c.opts.start.call(e,c),le.fx.timer(le.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function H(e,t){var n,i,r,s,o;for(r in e)if(i=le.camelCase(r),s=t[i],n=e[r],le.isArray(n)&&(s=n[1],n=e[r]=n[0]),r!==i&&(e[i]=n,delete e[r]),o=le.cssHooks[i],o&&"expand"in o){n=o.expand(n),delete e[i];for(r in n)r in e||(e[r]=n[r],t[r]=s)}else t[i]=s}function P(e,t,n){var i,r,s,o,a,l,c,u,d,p=this,h=e.style,f={},m=[],g=e.nodeType&&w(e);n.queue||(u=le._queueHooks(e,"fx"),null==u.unqueued&&(u.unqueued=0,d=u.empty.fire,u.empty.fire=function(){u.unqueued||d()}),u.unqueued++,p.always(function(){p.always(function(){u.unqueued--,le.queue(e,"fx").length||u.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],"inline"===le.css(e,"display")&&"none"===le.css(e,"float")&&(le.support.inlineBlockNeedsLayout&&"inline"!==E(e.nodeName)?h.zoom=1:h.display="inline-block")),n.overflow&&(h.overflow="hidden",le.support.shrinkWrapBlocks||p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]}));for(r in t)if(o=t[r],en.exec(o)){if(delete t[r],l=l||"toggle"===o,o===(g?"hide":"show"))continue;m.push(r)}if(s=m.length){a=le._data(e,"fxshow")||le._data(e,"fxshow",{}),"hidden"in a&&(g=a.hidden),l&&(a.hidden=!g),g?le(e).show():p.done(function(){le(e).hide()}),p.done(function(){var t;le._removeData(e,"fxshow");for(t in f)le.style(e,t,f[t])});for(r=0;s>r;r++)i=m[r],c=p.createTween(i,g?a[i]:0),f[i]=a[i]||le.style(e,i),i in a||(a[i]=c.start,g&&(c.end=c.start,c.start="width"===i||"height"===i?1:0))}}function U(e,t,n,i,r){return new U.prototype.init(e,t,n,i,r)}function B(e,t){var n,i={height:e},r=0;for(t=t?1:0;4>r;r+=2-t)n=Tt[r],i["margin"+n]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function z(e){return le.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}var W,V,X=typeof t,Q=e.document,J=e.location,G=e.jQuery,K=e.$,Y={},Z=[],ee="1.9.1",te=Z.concat,ne=Z.push,ie=Z.slice,re=Z.indexOf,se=Y.toString,oe=Y.hasOwnProperty,ae=ee.trim,le=function(e,t){return new le.fn.init(e,t,V)},ce=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ue=/\S+/g,de=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,pe=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,he=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,fe=/^[\],:{}\s]*$/,me=/(?:^|:|,)(?:\s*\[)+/g,ge=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,ve=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,be=/^-ms-/,ye=/-([\da-z])/gi,_e=function(e,t){return t.toUpperCase()},xe=function(e){(Q.addEventListener||"load"===e.type||"complete"===Q.readyState)&&(we(),le.ready())},we=function(){Q.addEventListener?(Q.removeEventListener("DOMContentLoaded",xe,!1),e.removeEventListener("load",xe,!1)):(Q.detachEvent("onreadystatechange",xe),e.detachEvent("onload",xe))};le.fn=le.prototype={jquery:ee,constructor:le,init:function(e,n,i){var r,s;if(!e)return this;if("string"==typeof e){if(r="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:pe.exec(e),!r||!r[1]&&n)return!n||n.jquery?(n||i).find(e):this.constructor(n).find(e);if(r[1]){if(n=n instanceof le?n[0]:n,le.merge(this,le.parseHTML(r[1],n&&n.nodeType?n.ownerDocument||n:Q,!0)),he.test(r[1])&&le.isPlainObject(n))for(r in n)le.isFunction(this[r])?this[r](n[r]):this.attr(r,n[r]);return this}if(s=Q.getElementById(r[2]),s&&s.parentNode){if(s.id!==r[2])return i.find(e);this.length=1,this[0]=s}return this.context=Q,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):le.isFunction(e)?i.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),le.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return ie.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=le.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return le.each(this,e,t)},ready:function(e){return le.ready.promise().done(e),this},slice:function(){return this.pushStack(ie.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(le.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:ne,sort:[].sort,splice:[].splice},le.fn.init.prototype=le.fn,le.extend=le.fn.extend=function(){var e,n,i,r,s,o,a=arguments[0]||{},l=1,c=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[1]||{},l=2),"object"==typeof a||le.isFunction(a)||(a={}),c===l&&(a=this,--l);c>l;l++)if(null!=(s=arguments[l]))for(r in s)e=a[r],i=s[r],a!==i&&(u&&i&&(le.isPlainObject(i)||(n=le.isArray(i)))?(n?(n=!1,o=e&&le.isArray(e)?e:[]):o=e&&le.isPlainObject(e)?e:{},a[r]=le.extend(u,o,i)):i!==t&&(a[r]=i));return a},le.extend({noConflict:function(t){return e.$===le&&(e.$=K),t&&e.jQuery===le&&(e.jQuery=G),le},isReady:!1,readyWait:1,holdReady:function(e){e?le.readyWait++:le.ready(!0)},ready:function(e){if(e===!0?!--le.readyWait:!le.isReady){if(!Q.body)return setTimeout(le.ready);le.isReady=!0,e!==!0&&--le.readyWait>0||(W.resolveWith(Q,[le]),le.fn.trigger&&le(Q).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===le.type(e)},isArray:Array.isArray||function(e){return"array"===le.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?Y[se.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==le.type(e)||e.nodeType||le.isWindow(e))return!1;try{if(e.constructor&&!oe.call(e,"constructor")&&!oe.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var i;for(i in e);return i===t||oe.call(e,i)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||Q;var i=he.exec(e),r=!n&&[];return i?[t.createElement(i[1])]:(i=le.buildFragment([e],t,r),r&&le(r).remove(),le.merge([],i.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=le.trim(n),n&&fe.test(n.replace(ge,"@").replace(ve,"]").replace(me,"")))?Function("return "+n)():(le.error("Invalid JSON: "+n),t)},parseXML:function(n){var i,r;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(r=new DOMParser,i=r.parseFromString(n,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(n))}catch(s){i=t}return i&&i.documentElement&&!i.getElementsByTagName("parsererror").length||le.error("Invalid XML: "+n),i},noop:function(){},globalEval:function(t){t&&le.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(be,"ms-").replace(ye,_e)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,i){var r,s=0,o=e.length,a=n(e);if(i){if(a)for(;o>s&&(r=t.apply(e[s],i),r!==!1);s++);else for(s in e)if(r=t.apply(e[s],i),r===!1)break}else if(a)for(;o>s&&(r=t.call(e[s],s,e[s]),r!==!1);s++);else for(s in e)if(r=t.call(e[s],s,e[s]),r===!1)break;return e},trim:ae&&!ae.call("\ufeff ")?function(e){return null==e?"":ae.call(e)}:function(e){return null==e?"":(e+"").replace(de,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(n(Object(e))?le.merge(i,"string"==typeof e?[e]:e):ne.call(i,e)),i},inArray:function(e,t,n){var i;if(t){if(re)return re.call(t,e,n);for(i=t.length,n=n?0>n?Math.max(0,i+n):n:0;i>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var i=n.length,r=e.length,s=0;if("number"==typeof i)for(;i>s;s++)e[r++]=n[s];else for(;n[s]!==t;)e[r++]=n[s++];return e.length=r,e},grep:function(e,t,n){var i,r=[],s=0,o=e.length;for(n=!!n;o>s;s++)i=!!t(e[s],s),n!==i&&r.push(e[s]);return r},map:function(e,t,i){var r,s=0,o=e.length,a=n(e),l=[];if(a)for(;o>s;s++)r=t(e[s],s,i),null!=r&&(l[l.length]=r);else for(s in e)r=t(e[s],s,i),null!=r&&(l[l.length]=r);return te.apply([],l)},guid:1,proxy:function(e,n){var i,r,s;return"string"==typeof n&&(s=e[n],n=e,e=s),le.isFunction(e)?(i=ie.call(arguments,2),r=function(){return e.apply(n||this,i.concat(ie.call(arguments)))},r.guid=e.guid=e.guid||le.guid++,r):t},access:function(e,n,i,r,s,o,a){var l=0,c=e.length,u=null==i;if("object"===le.type(i)){s=!0;for(l in i)le.access(e,n,l,i[l],!0,o,a)}else if(r!==t&&(s=!0,le.isFunction(r)||(a=!0),u&&(a?(n.call(e,r),n=null):(u=n,n=function(e,t,n){return u.call(le(e),n)})),n))for(;c>l;l++)n(e[l],i,a?r:r.call(e[l],l,n(e[l],i)));return s?e:u?n.call(e):c?n(e[0],i):o},now:function(){return(new Date).getTime()}}),le.ready.promise=function(t){if(!W)if(W=le.Deferred(),"complete"===Q.readyState)setTimeout(le.ready);else if(Q.addEventListener)Q.addEventListener("DOMContentLoaded",xe,!1),e.addEventListener("load",xe,!1);else{Q.attachEvent("onreadystatechange",xe),e.attachEvent("onload",xe);var n=!1;try{n=null==e.frameElement&&Q.documentElement}catch(i){}n&&n.doScroll&&function r(){if(!le.isReady){try{n.doScroll("left")}catch(e){return setTimeout(r,50)}we(),le.ready()}}()}return W.promise(t)},le.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){Y["[object "+t+"]"]=t.toLowerCase()}),V=le(Q);var Te={};le.Callbacks=function(e){e="string"==typeof e?Te[e]||i(e):le.extend({},e);var n,r,s,o,a,l,c=[],u=!e.once&&[],d=function(t){for(r=e.memory&&t,s=!0,a=l||0,l=0,o=c.length,n=!0;c&&o>a;a++)if(c[a].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,c&&(u?u.length&&d(u.shift()):r?c=[]:p.disable())},p={add:function(){if(c){var t=c.length;!function i(t){le.each(t,function(t,n){var r=le.type(n);"function"===r?e.unique&&p.has(n)||c.push(n):n&&n.length&&"string"!==r&&i(n)})}(arguments),n?o=c.length:r&&(l=t,d(r))}return this},remove:function(){return c&&le.each(arguments,function(e,t){for(var i;(i=le.inArray(t,c,i))>-1;)c.splice(i,1),n&&(o>=i&&o--,a>=i&&a--)}),this},has:function(e){return e?le.inArray(e,c)>-1:!(!c||!c.length)},empty:function(){return c=[],this},disable:function(){return c=u=r=t,this},disabled:function(){return!c},lock:function(){return u=t,r||p.disable(),this},locked:function(){return!u},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!c||s&&!u||(n?u.push(t):d(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!s}};return p},le.extend({Deferred:function(e){var t=[["resolve","done",le.Callbacks("once memory"),"resolved"],["reject","fail",le.Callbacks("once memory"),"rejected"],["notify","progress",le.Callbacks("memory")]],n="pending",i={state:function(){return n},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var e=arguments;return le.Deferred(function(n){le.each(t,function(t,s){var o=s[0],a=le.isFunction(e[t])&&e[t];r[s[1]](function(){var e=a&&a.apply(this,arguments);e&&le.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===i?n.promise():this,a?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?le.extend(e,i):i}},r={};return i.pipe=i.then,le.each(t,function(e,s){var o=s[2],a=s[3];i[s[1]]=o.add,a&&o.add(function(){n=a},t[1^e][2].disable,t[2][2].lock),r[s[0]]=function(){return r[s[0]+"With"](this===r?i:this,arguments),this},r[s[0]+"With"]=o.fireWith}),i.promise(r),e&&e.call(r,r),r},when:function(e){var t,n,i,r=0,s=ie.call(arguments),o=s.length,a=1!==o||e&&le.isFunction(e.promise)?o:0,l=1===a?e:le.Deferred(),c=function(e,n,i){return function(r){n[e]=this,i[e]=arguments.length>1?ie.call(arguments):r,i===t?l.notifyWith(n,i):--a||l.resolveWith(n,i)}};if(o>1)for(t=Array(o),n=Array(o),i=Array(o);o>r;r++)s[r]&&le.isFunction(s[r].promise)?s[r].promise().done(c(r,i,s)).fail(l.reject).progress(c(r,n,t)):--a;return a||l.resolveWith(i,s),l.promise()}}),le.support=function(){var t,n,i,r,s,o,a,l,c,u,d=Q.createElement("div");if(d.setAttribute("className","t"),d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*"),i=d.getElementsByTagName("a")[0],!n||!i||!n.length)return{};s=Q.createElement("select"),a=s.appendChild(Q.createElement("option")),r=d.getElementsByTagName("input")[0],i.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==d.className,leadingWhitespace:3===d.firstChild.nodeType,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/top/.test(i.getAttribute("style")),hrefNormalized:"/a"===i.getAttribute("href"),opacity:/^0.5/.test(i.style.opacity),cssFloat:!!i.style.cssFloat,checkOn:!!r.value,optSelected:a.selected,enctype:!!Q.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==Q.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===Q.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},r.checked=!0,t.noCloneChecked=r.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!a.disabled;try{delete d.test}catch(p){t.deleteExpando=!1}r=Q.createElement("input"),r.setAttribute("value",""),t.input=""===r.getAttribute("value"),r.value="t",r.setAttribute("type","radio"),t.radioValue="t"===r.value,r.setAttribute("checked","t"),r.setAttribute("name","t"),o=Q.createDocumentFragment(),o.appendChild(r),t.appendChecked=r.checked,t.checkClone=o.cloneNode(!0).cloneNode(!0).lastChild.checked,d.attachEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).click());for(u in{submit:!0,change:!0,focusin:!0})d.setAttribute(l="on"+u,"t"),t[u+"Bubbles"]=l in e||d.attributes[l].expando===!1;return d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===d.style.backgroundClip,le(function(){var n,i,r,s="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",o=Q.getElementsByTagName("body")[0];o&&(n=Q.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",o.appendChild(n).appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",r=d.getElementsByTagName("td"),r[0].style.cssText="padding:0;margin:0;border:0;display:none",c=0===r[0].offsetHeight,r[0].style.display="",r[1].style.display="none",t.reliableHiddenOffsets=c&&0===r[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===d.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==o.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(d,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(d,null)||{width:"4px"}).width,i=d.appendChild(Q.createElement("div")),i.style.cssText=d.style.cssText=s,i.style.marginRight=i.style.width="0",d.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(i,null)||{}).marginRight)),typeof d.style.zoom!==X&&(d.innerHTML="",d.style.cssText=s+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.innerHTML="<div></div>",d.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==d.offsetWidth,t.inlineBlockNeedsLayout&&(o.style.zoom=1)),o.removeChild(n),n=d=r=i=null)}),n=s=o=a=i=r=null,t}();var ke=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,Se=/([A-Z])/g;le.extend({cache:{},expando:"jQuery"+(ee+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?le.cache[e[le.expando]]:e[le.expando],!!e&&!a(e)},data:function(e,t,n){return r(e,t,n)},removeData:function(e,t){return s(e,t)},_data:function(e,t,n){return r(e,t,n,!0)},_removeData:function(e,t){return s(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&le.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),le.fn.extend({data:function(e,n){var i,r,s=this[0],a=0,l=null;if(e===t){if(this.length&&(l=le.data(s),1===s.nodeType&&!le._data(s,"parsedAttrs"))){for(i=s.attributes;i.length>a;a++)r=i[a].name,r.indexOf("data-")||(r=le.camelCase(r.slice(5)),o(s,r,l[r]));le._data(s,"parsedAttrs",!0)}return l}return"object"==typeof e?this.each(function(){le.data(this,e)}):le.access(this,function(n){return n===t?s?o(s,e,le.data(s,e)):null:(this.each(function(){le.data(this,e,n)}),t)},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){le.removeData(this,e)})}}),le.extend({queue:function(e,n,i){var r;return e?(n=(n||"fx")+"queue",r=le._data(e,n),i&&(!r||le.isArray(i)?r=le._data(e,n,le.makeArray(i)):r.push(i)),r||[]):t},dequeue:function(e,t){t=t||"fx";var n=le.queue(e,t),i=n.length,r=n.shift(),s=le._queueHooks(e,t),o=function(){le.dequeue(e,t)};"inprogress"===r&&(r=n.shift(),i--),s.cur=r,r&&("fx"===t&&n.unshift("inprogress"),delete s.stop,r.call(e,o,s)),!i&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return le._data(e,n)||le._data(e,n,{empty:le.Callbacks("once memory").add(function(){le._removeData(e,t+"queue"),le._removeData(e,n)})})}}),le.fn.extend({queue:function(e,n){var i=2;return"string"!=typeof e&&(n=e,e="fx",i--),i>arguments.length?le.queue(this[0],e):n===t?this:this.each(function(){var t=le.queue(this,e,n);le._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&le.dequeue(this,e)})},dequeue:function(e){return this.each(function(){le.dequeue(this,e)})},delay:function(e,t){return e=le.fx?le.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){
var i=setTimeout(t,e);n.stop=function(){clearTimeout(i)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var i,r=1,s=le.Deferred(),o=this,a=this.length,l=function(){--r||s.resolveWith(o,[o])};for("string"!=typeof e&&(n=e,e=t),e=e||"fx";a--;)i=le._data(o[a],e+"queueHooks"),i&&i.empty&&(r++,i.empty.add(l));return l(),s.promise(n)}});var Ce,Ee,Ae=/[\t\r\n]/g,Ie=/\r/g,De=/^(?:input|select|textarea|button|object)$/i,Ne=/^(?:a|area)$/i,Le=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,je=/^(?:checked|selected)$/i,$e=le.support.getSetAttribute,Re=le.support.input;le.fn.extend({attr:function(e,t){return le.access(this,le.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){le.removeAttr(this,e)})},prop:function(e,t){return le.access(this,le.prop,e,t,arguments.length>1)},removeProp:function(e){return e=le.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,i,r,s,o=0,a=this.length,l="string"==typeof e&&e;if(le.isFunction(e))return this.each(function(t){le(this).addClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(ue)||[];a>o;o++)if(n=this[o],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Ae," "):" ")){for(s=0;r=t[s++];)0>i.indexOf(" "+r+" ")&&(i+=r+" ");n.className=le.trim(i)}return this},removeClass:function(e){var t,n,i,r,s,o=0,a=this.length,l=0===arguments.length||"string"==typeof e&&e;if(le.isFunction(e))return this.each(function(t){le(this).removeClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(ue)||[];a>o;o++)if(n=this[o],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Ae," "):"")){for(s=0;r=t[s++];)for(;i.indexOf(" "+r+" ")>=0;)i=i.replace(" "+r+" "," ");n.className=e?le.trim(i):""}return this},toggleClass:function(e,t){var n=typeof e,i="boolean"==typeof t;return le.isFunction(e)?this.each(function(n){le(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n)for(var r,s=0,o=le(this),a=t,l=e.match(ue)||[];r=l[s++];)a=i?a:!o.hasClass(r),o[a?"addClass":"removeClass"](r);else(n===X||"boolean"===n)&&(this.className&&le._data(this,"__className__",this.className),this.className=this.className||e===!1?"":le._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,i=this.length;i>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(Ae," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,i,r,s=this[0];return arguments.length?(r=le.isFunction(e),this.each(function(n){var s,o=le(this);1===this.nodeType&&(s=r?e.call(this,n,o.val()):e,null==s?s="":"number"==typeof s?s+="":le.isArray(s)&&(s=le.map(s,function(e){return null==e?"":e+""})),i=le.valHooks[this.type]||le.valHooks[this.nodeName.toLowerCase()],i&&"set"in i&&i.set(this,s,"value")!==t||(this.value=s))})):s?(i=le.valHooks[s.type]||le.valHooks[s.nodeName.toLowerCase()],i&&"get"in i&&(n=i.get(s,"value"))!==t?n:(n=s.value,"string"==typeof n?n.replace(Ie,""):null==n?"":n)):void 0}}),le.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){for(var t,n,i=e.options,r=e.selectedIndex,s="select-one"===e.type||0>r,o=s?null:[],a=s?r+1:i.length,l=0>r?a:s?r:0;a>l;l++)if(n=i[l],!(!n.selected&&l!==r||(le.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&le.nodeName(n.parentNode,"optgroup"))){if(t=le(n).val(),s)return t;o.push(t)}return o},set:function(e,t){var n=le.makeArray(t);return le(e).find("option").each(function(){this.selected=le.inArray(le(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,i){var r,s,o,a=e.nodeType;if(e&&3!==a&&8!==a&&2!==a)return typeof e.getAttribute===X?le.prop(e,n,i):(s=1!==a||!le.isXMLDoc(e),s&&(n=n.toLowerCase(),r=le.attrHooks[n]||(Le.test(n)?Ee:Ce)),i===t?r&&s&&"get"in r&&null!==(o=r.get(e,n))?o:(typeof e.getAttribute!==X&&(o=e.getAttribute(n)),null==o?t:o):null!==i?r&&s&&"set"in r&&(o=r.set(e,i,n))!==t?o:(e.setAttribute(n,i+""),i):(le.removeAttr(e,n),t))},removeAttr:function(e,t){var n,i,r=0,s=t&&t.match(ue);if(s&&1===e.nodeType)for(;n=s[r++];)i=le.propFix[n]||n,Le.test(n)?!$e&&je.test(n)?e[le.camelCase("default-"+n)]=e[i]=!1:e[i]=!1:le.attr(e,n,""),e.removeAttribute($e?n:i)},attrHooks:{type:{set:function(e,t){if(!le.support.radioValue&&"radio"===t&&le.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,i){var r,s,o,a=e.nodeType;if(e&&3!==a&&8!==a&&2!==a)return o=1!==a||!le.isXMLDoc(e),o&&(n=le.propFix[n]||n,s=le.propHooks[n]),i!==t?s&&"set"in s&&(r=s.set(e,i,n))!==t?r:e[n]=i:s&&"get"in s&&null!==(r=s.get(e,n))?r:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):De.test(e.nodeName)||Ne.test(e.nodeName)&&e.href?0:t}}}}),Ee={get:function(e,n){var i=le.prop(e,n),r="boolean"==typeof i&&e.getAttribute(n),s="boolean"==typeof i?Re&&$e?null!=r:je.test(n)?e[le.camelCase("default-"+n)]:!!r:e.getAttributeNode(n);return s&&s.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?le.removeAttr(e,n):Re&&$e||!je.test(n)?e.setAttribute(!$e&&le.propFix[n]||n,n):e[le.camelCase("default-"+n)]=e[n]=!0,n}},Re&&$e||(le.attrHooks.value={get:function(e,n){var i=e.getAttributeNode(n);return le.nodeName(e,"input")?e.defaultValue:i&&i.specified?i.value:t},set:function(e,n,i){return le.nodeName(e,"input")?(e.defaultValue=n,t):Ce&&Ce.set(e,n,i)}}),$e||(Ce=le.valHooks.button={get:function(e,n){var i=e.getAttributeNode(n);return i&&("id"===n||"name"===n||"coords"===n?""!==i.value:i.specified)?i.value:t},set:function(e,n,i){var r=e.getAttributeNode(i);return r||e.setAttributeNode(r=e.ownerDocument.createAttribute(i)),r.value=n+="","value"===i||n===e.getAttribute(i)?n:t}},le.attrHooks.contenteditable={get:Ce.get,set:function(e,t,n){Ce.set(e,""!==t&&t,n)}},le.each(["width","height"],function(e,n){le.attrHooks[n]=le.extend(le.attrHooks[n],{set:function(e,i){return""===i?(e.setAttribute(n,"auto"),i):t}})})),le.support.hrefNormalized||(le.each(["href","src","width","height"],function(e,n){le.attrHooks[n]=le.extend(le.attrHooks[n],{get:function(e){var i=e.getAttribute(n,2);return null==i?t:i}})}),le.each(["href","src"],function(e,t){le.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),le.support.style||(le.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),le.support.optSelected||(le.propHooks.selected=le.extend(le.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),le.support.enctype||(le.propFix.enctype="encoding"),le.support.checkOn||le.each(["radio","checkbox"],function(){le.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),le.each(["radio","checkbox"],function(){le.valHooks[this]=le.extend(le.valHooks[this],{set:function(e,n){return le.isArray(n)?e.checked=le.inArray(le(e).val(),n)>=0:t}})});var Me=/^(?:input|select|textarea)$/i,Fe=/^key/,Oe=/^(?:mouse|contextmenu)|click/,qe=/^(?:focusinfocus|focusoutblur)$/,He=/^([^.]*)(?:\.(.+)|)$/;le.event={global:{},add:function(e,n,i,r,s){var o,a,l,c,u,d,p,h,f,m,g,v=le._data(e);if(v){for(i.handler&&(c=i,i=c.handler,s=c.selector),i.guid||(i.guid=le.guid++),(a=v.events)||(a=v.events={}),(d=v.handle)||(d=v.handle=function(e){return typeof le===X||e&&le.event.triggered===e.type?t:le.event.dispatch.apply(d.elem,arguments)},d.elem=e),n=(n||"").match(ue)||[""],l=n.length;l--;)o=He.exec(n[l])||[],f=g=o[1],m=(o[2]||"").split(".").sort(),u=le.event.special[f]||{},f=(s?u.delegateType:u.bindType)||f,u=le.event.special[f]||{},p=le.extend({type:f,origType:g,data:r,handler:i,guid:i.guid,selector:s,needsContext:s&&le.expr.match.needsContext.test(s),namespace:m.join(".")},c),(h=a[f])||(h=a[f]=[],h.delegateCount=0,u.setup&&u.setup.call(e,r,m,d)!==!1||(e.addEventListener?e.addEventListener(f,d,!1):e.attachEvent&&e.attachEvent("on"+f,d))),u.add&&(u.add.call(e,p),p.handler.guid||(p.handler.guid=i.guid)),s?h.splice(h.delegateCount++,0,p):h.push(p),le.event.global[f]=!0;e=null}},remove:function(e,t,n,i,r){var s,o,a,l,c,u,d,p,h,f,m,g=le.hasData(e)&&le._data(e);if(g&&(u=g.events)){for(t=(t||"").match(ue)||[""],c=t.length;c--;)if(a=He.exec(t[c])||[],h=m=a[1],f=(a[2]||"").split(".").sort(),h){for(d=le.event.special[h]||{},h=(i?d.delegateType:d.bindType)||h,p=u[h]||[],a=a[2]&&RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=s=p.length;s--;)o=p[s],!r&&m!==o.origType||n&&n.guid!==o.guid||a&&!a.test(o.namespace)||i&&i!==o.selector&&("**"!==i||!o.selector)||(p.splice(s,1),o.selector&&p.delegateCount--,d.remove&&d.remove.call(e,o));l&&!p.length&&(d.teardown&&d.teardown.call(e,f,g.handle)!==!1||le.removeEvent(e,h,g.handle),delete u[h])}else for(h in u)le.event.remove(e,h+t[c],n,i,!0);le.isEmptyObject(u)&&(delete g.handle,le._removeData(e,"events"))}},trigger:function(n,i,r,s){var o,a,l,c,u,d,p,h=[r||Q],f=oe.call(n,"type")?n.type:n,m=oe.call(n,"namespace")?n.namespace.split("."):[];if(l=d=r=r||Q,3!==r.nodeType&&8!==r.nodeType&&!qe.test(f+le.event.triggered)&&(f.indexOf(".")>=0&&(m=f.split("."),f=m.shift(),m.sort()),a=0>f.indexOf(":")&&"on"+f,n=n[le.expando]?n:new le.Event(f,"object"==typeof n&&n),n.isTrigger=!0,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=r),i=null==i?[n]:le.makeArray(i,[n]),u=le.event.special[f]||{},s||!u.trigger||u.trigger.apply(r,i)!==!1)){if(!s&&!u.noBubble&&!le.isWindow(r)){for(c=u.delegateType||f,qe.test(c+f)||(l=l.parentNode);l;l=l.parentNode)h.push(l),d=l;d===(r.ownerDocument||Q)&&h.push(d.defaultView||d.parentWindow||e)}for(p=0;(l=h[p++])&&!n.isPropagationStopped();)n.type=p>1?c:u.bindType||f,o=(le._data(l,"events")||{})[n.type]&&le._data(l,"handle"),o&&o.apply(l,i),o=a&&l[a],o&&le.acceptData(l)&&o.apply&&o.apply(l,i)===!1&&n.preventDefault();if(n.type=f,!(s||n.isDefaultPrevented()||u._default&&u._default.apply(r.ownerDocument,i)!==!1||"click"===f&&le.nodeName(r,"a")||!le.acceptData(r)||!a||!r[f]||le.isWindow(r))){d=r[a],d&&(r[a]=null),le.event.triggered=f;try{r[f]()}catch(g){}le.event.triggered=t,d&&(r[a]=d)}return n.result}},dispatch:function(e){e=le.event.fix(e);var n,i,r,s,o,a=[],l=ie.call(arguments),c=(le._data(this,"events")||{})[e.type]||[],u=le.event.special[e.type]||{};if(l[0]=e,e.delegateTarget=this,!u.preDispatch||u.preDispatch.call(this,e)!==!1){for(a=le.event.handlers.call(this,e,c),n=0;(s=a[n++])&&!e.isPropagationStopped();)for(e.currentTarget=s.elem,o=0;(r=s.handlers[o++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(r.namespace))&&(e.handleObj=r,e.data=r.data,i=((le.event.special[r.origType]||{}).handle||r.handler).apply(s.elem,l),i!==t&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,e),e.result}},handlers:function(e,n){var i,r,s,o,a=[],l=n.delegateCount,c=e.target;if(l&&c.nodeType&&(!e.button||"click"!==e.type))for(;c!=this;c=c.parentNode||this)if(1===c.nodeType&&(c.disabled!==!0||"click"!==e.type)){for(s=[],o=0;l>o;o++)r=n[o],i=r.selector+" ",s[i]===t&&(s[i]=r.needsContext?le(i,this).index(c)>=0:le.find(i,this,null,[c]).length),s[i]&&s.push(r);s.length&&a.push({elem:c,handlers:s})}return n.length>l&&a.push({elem:this,handlers:n.slice(l)}),a},fix:function(e){if(e[le.expando])return e;var t,n,i,r=e.type,s=e,o=this.fixHooks[r];for(o||(this.fixHooks[r]=o=Oe.test(r)?this.mouseHooks:Fe.test(r)?this.keyHooks:{}),i=o.props?this.props.concat(o.props):this.props,e=new le.Event(s),t=i.length;t--;)n=i[t],e[n]=s[n];return e.target||(e.target=s.srcElement||Q),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,o.filter?o.filter(e,s):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var i,r,s,o=n.button,a=n.fromElement;return null==e.pageX&&null!=n.clientX&&(r=e.target.ownerDocument||Q,s=r.documentElement,i=r.body,e.pageX=n.clientX+(s&&s.scrollLeft||i&&i.scrollLeft||0)-(s&&s.clientLeft||i&&i.clientLeft||0),e.pageY=n.clientY+(s&&s.scrollTop||i&&i.scrollTop||0)-(s&&s.clientTop||i&&i.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),e.which||o===t||(e.which=1&o?1:2&o?3:4&o?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return le.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==Q.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===Q.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,i){var r=le.extend(new le.Event,n,{type:e,isSimulated:!0,originalEvent:{}});i?le.event.trigger(r,null,t):le.event.dispatch.call(t,r),r.isDefaultPrevented()&&n.preventDefault()}},le.removeEvent=Q.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var i="on"+t;e.detachEvent&&(typeof e[i]===X&&(e[i]=null),e.detachEvent(i,n))},le.Event=function(e,n){return this instanceof le.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?l:c):this.type=e,n&&le.extend(this,n),this.timeStamp=e&&e.timeStamp||le.now(),this[le.expando]=!0,t):new le.Event(e,n)},le.Event.prototype={isDefaultPrevented:c,isPropagationStopped:c,isImmediatePropagationStopped:c,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=l,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=l,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=l,this.stopPropagation()}},le.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){le.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=this,r=e.relatedTarget,s=e.handleObj;return(!r||r!==i&&!le.contains(i,r))&&(e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t),n}}}),le.support.submitBubbles||(le.event.special.submit={setup:function(){return!le.nodeName(this,"form")&&(le.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,i=le.nodeName(n,"input")||le.nodeName(n,"button")?n.form:t;i&&!le._data(i,"submitBubbles")&&(le.event.add(i,"submit._submit",function(e){e._submit_bubble=!0}),le._data(i,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&le.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return!le.nodeName(this,"form")&&(le.event.remove(this,"._submit"),t)}}),le.support.changeBubbles||(le.event.special.change={setup:function(){return Me.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(le.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),le.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),le.event.simulate("change",this,e,!0)})),!1):(le.event.add(this,"beforeactivate._change",function(e){var t=e.target;Me.test(t.nodeName)&&!le._data(t,"changeBubbles")&&(le.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||le.event.simulate("change",this.parentNode,e,!0)}),le._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return le.event.remove(this,"._change"),!Me.test(this.nodeName)}}),le.support.focusinBubbles||le.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,i=function(e){le.event.simulate(t,e.target,le.event.fix(e),!0)};le.event.special[t]={setup:function(){0===n++&&Q.addEventListener(e,i,!0)},teardown:function(){0===--n&&Q.removeEventListener(e,i,!0)}}}),le.fn.extend({on:function(e,n,i,r,s){var o,a;if("object"==typeof e){"string"!=typeof n&&(i=i||n,n=t);for(o in e)this.on(o,n,i,e[o],s);return this}if(null==i&&null==r?(r=n,i=n=t):null==r&&("string"==typeof n?(r=i,i=t):(r=i,i=n,n=t)),r===!1)r=c;else if(!r)return this;return 1===s&&(a=r,r=function(e){return le().off(e),a.apply(this,arguments)},r.guid=a.guid||(a.guid=le.guid++)),this.each(function(){le.event.add(this,e,r,i,n)})},one:function(e,t,n,i){return this.on(e,t,n,i,1)},off:function(e,n,i){var r,s;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,le(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(s in e)this.off(s,n,e[s]);return this}return(n===!1||"function"==typeof n)&&(i=n,n=t),i===!1&&(i=c),this.each(function(){le.event.remove(this,e,i,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){le.event.trigger(e,t,this)})},triggerHandler:function(e,n){var i=this[0];return i?le.event.trigger(e,n,i,!0):t}}),function(e,t){function n(e){return fe.test(e+"")}function i(){var e,t=[];return e=function(n,i){return t.push(n+=" ")>k.cacheLength&&delete e[t.shift()],e[n]=i}}function r(e){return e[q]=!0,e}function s(e){var t=N.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}}function o(e,t,n,i){var r,s,o,a,l,c,u,h,f,m;if((t?t.ownerDocument||t:H)!==N&&D(t),t=t||N,n=n||[],!e||"string"!=typeof e)return n;if(1!==(a=t.nodeType)&&9!==a)return[];if(!j&&!i){if(r=me.exec(e))if(o=r[1]){if(9===a){if(s=t.getElementById(o),!s||!s.parentNode)return n;if(s.id===o)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(o))&&F(t,s)&&s.id===o)return n.push(s),n}else{if(r[2])return K.apply(n,Y.call(t.getElementsByTagName(e),0)),n;if((o=r[3])&&P.getByClassName&&t.getElementsByClassName)return K.apply(n,Y.call(t.getElementsByClassName(o),0)),n}if(P.qsa&&!$.test(e)){if(u=!0,h=q,f=t,m=9===a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){for(c=d(e),(u=t.getAttribute("id"))?h=u.replace(be,"\\$&"):t.setAttribute("id",h),h="[id='"+h+"'] ",l=c.length;l--;)c[l]=h+p(c[l]);f=he.test(e)&&t.parentNode||t,m=c.join(",")}if(m)try{return K.apply(n,Y.call(f.querySelectorAll(m),0)),n}catch(g){}finally{u||t.removeAttribute("id")}}}return _(e.replace(oe,"$1"),t,n,i)}function a(e,t){var n=t&&e,i=n&&(~t.sourceIndex||Q)-(~e.sourceIndex||Q);if(i)return i;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function l(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function c(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function u(e){return r(function(t){return t=+t,r(function(n,i){for(var r,s=e([],n.length,t),o=s.length;o--;)n[r=s[o]]&&(n[r]=!(i[r]=n[r]))})})}function d(e,t){var n,i,r,s,a,l,c,u=W[e+" "];if(u)return t?0:u.slice(0);for(a=e,l=[],c=k.preFilter;a;){(!n||(i=ae.exec(a)))&&(i&&(a=a.slice(i[0].length)||a),l.push(r=[])),n=!1,(i=ce.exec(a))&&(n=i.shift(),r.push({value:n,type:i[0].replace(oe," ")}),a=a.slice(n.length));for(s in k.filter)!(i=pe[s].exec(a))||c[s]&&!(i=c[s](i))||(n=i.shift(),r.push({value:n,type:s,matches:i}),a=a.slice(n.length));if(!n)break}return t?a.length:a?o.error(e):W(e,l).slice(0)}function p(e){for(var t=0,n=e.length,i="";n>t;t++)i+=e[t].value;return i}function h(e,t,n){var i=t.dir,r=n&&"parentNode"===i,s=B++;return t.first?function(t,n,s){for(;t=t[i];)if(1===t.nodeType||r)return e(t,n,s)}:function(t,n,o){var a,l,c,u=U+" "+s;if(o){for(;t=t[i];)if((1===t.nodeType||r)&&e(t,n,o))return!0}else for(;t=t[i];)if(1===t.nodeType||r)if(c=t[q]||(t[q]={}),(l=c[i])&&l[0]===u){if((a=l[1])===!0||a===T)return a===!0}else if(l=c[i]=[u],l[1]=e(t,n,o)||T,l[1]===!0)return!0}}function f(e){return e.length>1?function(t,n,i){for(var r=e.length;r--;)if(!e[r](t,n,i))return!1;return!0}:e[0]}function m(e,t,n,i,r){for(var s,o=[],a=0,l=e.length,c=null!=t;l>a;a++)(s=e[a])&&(!n||n(s,i,r))&&(o.push(s),c&&t.push(a));return o}function g(e,t,n,i,s,o){return i&&!i[q]&&(i=g(i)),s&&!s[q]&&(s=g(s,o)),r(function(r,o,a,l){var c,u,d,p=[],h=[],f=o.length,g=r||y(t||"*",a.nodeType?[a]:a,[]),v=!e||!r&&t?g:m(g,p,e,a,l),b=n?s||(r?e:f||i)?[]:o:v;if(n&&n(v,b,a,l),i)for(c=m(b,h),i(c,[],a,l),u=c.length;u--;)(d=c[u])&&(b[h[u]]=!(v[h[u]]=d));if(r){if(s||e){if(s){for(c=[],u=b.length;u--;)(d=b[u])&&c.push(v[u]=d);s(null,b=[],c,l)}for(u=b.length;u--;)(d=b[u])&&(c=s?Z.call(r,d):p[u])>-1&&(r[c]=!(o[c]=d))}}else b=m(b===o?b.splice(f,b.length):b),s?s(null,o,b,l):K.apply(o,b)})}function v(e){for(var t,n,i,r=e.length,s=k.relative[e[0].type],o=s||k.relative[" "],a=s?1:0,l=h(function(e){return e===t},o,!0),c=h(function(e){return Z.call(t,e)>-1},o,!0),u=[function(e,n,i){return!s&&(i||n!==I)||((t=n).nodeType?l(e,n,i):c(e,n,i))}];r>a;a++)if(n=k.relative[e[a].type])u=[h(f(u),n)];else{if(n=k.filter[e[a].type].apply(null,e[a].matches),n[q]){for(i=++a;r>i&&!k.relative[e[i].type];i++);return g(a>1&&f(u),a>1&&p(e.slice(0,a-1)).replace(oe,"$1"),n,i>a&&v(e.slice(a,i)),r>i&&v(e=e.slice(i)),r>i&&p(e))}u.push(n)}return f(u)}function b(e,t){var n=0,i=t.length>0,s=e.length>0,a=function(r,a,l,c,u){var d,p,h,f=[],g=0,v="0",b=r&&[],y=null!=u,_=I,x=r||s&&k.find.TAG("*",u&&a.parentNode||a),w=U+=null==_?1:Math.random()||.1;for(y&&(I=a!==N&&a,T=n);null!=(d=x[v]);v++){if(s&&d){for(p=0;h=e[p++];)if(h(d,a,l)){c.push(d);break}y&&(U=w,T=++n)}i&&((d=!h&&d)&&g--,r&&b.push(d))}if(g+=v,i&&v!==g){for(p=0;h=t[p++];)h(b,f,a,l);if(r){if(g>0)for(;v--;)b[v]||f[v]||(f[v]=G.call(c));f=m(f)}K.apply(c,f),y&&!r&&f.length>0&&g+t.length>1&&o.uniqueSort(c)}return y&&(U=w,I=_),b};return i?r(a):a}function y(e,t,n){for(var i=0,r=t.length;r>i;i++)o(e,t[i],n);return n}function _(e,t,n,i){var r,s,o,a,l,c=d(e);if(!i&&1===c.length){if(s=c[0]=c[0].slice(0),s.length>2&&"ID"===(o=s[0]).type&&9===t.nodeType&&!j&&k.relative[s[1].type]){if(t=k.find.ID(o.matches[0].replace(_e,xe),t)[0],!t)return n;e=e.slice(s.shift().value.length)}for(r=pe.needsContext.test(e)?0:s.length;r--&&(o=s[r],!k.relative[a=o.type]);)if((l=k.find[a])&&(i=l(o.matches[0].replace(_e,xe),he.test(s[0].type)&&t.parentNode||t))){if(s.splice(r,1),e=i.length&&p(s),!e)return K.apply(n,Y.call(i,0)),n;break}}return E(e,c)(i,t,j,n,he.test(e)),n}function x(){}var w,T,k,S,C,E,A,I,D,N,L,j,$,R,M,F,O,q="sizzle"+-new Date,H=e.document,P={},U=0,B=0,z=i(),W=i(),V=i(),X=typeof t,Q=1<<31,J=[],G=J.pop,K=J.push,Y=J.slice,Z=J.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},ee="[\\x20\\t\\r\\n\\f]",te="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ne=te.replace("w","w#"),ie="([*^$|!~]?=)",re="\\["+ee+"*("+te+")"+ee+"*(?:"+ie+ee+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+ne+")|)|)"+ee+"*\\]",se=":("+te+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+re.replace(3,8)+")*)|.*)\\)|)",oe=RegExp("^"+ee+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ee+"+$","g"),ae=RegExp("^"+ee+"*,"+ee+"*"),ce=RegExp("^"+ee+"*([\\x20\\t\\r\\n\\f>+~])"+ee+"*"),ue=RegExp(se),de=RegExp("^"+ne+"$"),pe={ID:RegExp("^#("+te+")"),CLASS:RegExp("^\\.("+te+")"),NAME:RegExp("^\\[name=['\"]?("+te+")['\"]?\\]"),TAG:RegExp("^("+te.replace("w","w*")+")"),ATTR:RegExp("^"+re),PSEUDO:RegExp("^"+se),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ee+"*(even|odd|(([+-]|)(\\d*)n|)"+ee+"*(?:([+-]|)"+ee+"*(\\d+)|))"+ee+"*\\)|)","i"),needsContext:RegExp("^"+ee+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ee+"*((?:-\\d)?\\d*)"+ee+"*\\)|)(?=[^-]|$)","i")},he=/[\x20\t\r\n\f]*[+~]/,fe=/^[^{]+\{\s*\[native code/,me=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ge=/^(?:input|select|textarea|button)$/i,ve=/^h\d$/i,be=/'|\\/g,ye=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,_e=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,xe=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{Y.call(H.documentElement.childNodes,0)[0].nodeType}catch(we){Y=function(e){for(var t,n=[];t=this[e++];)n.push(t);return n}}C=o.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},D=o.setDocument=function(e){var i=e?e.ownerDocument||e:H;return i!==N&&9===i.nodeType&&i.documentElement?(N=i,L=i.documentElement,j=C(i),P.tagNameNoComments=s(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),P.attributes=s(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),P.getByClassName=s(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!(!e.getElementsByClassName||!e.getElementsByClassName("e").length)&&(e.lastChild.className="e",2===e.getElementsByClassName("e").length)}),P.getByName=s(function(e){e.id=q+0,e.innerHTML="<a name='"+q+"'></a><div name='"+q+"'></div>",L.insertBefore(e,L.firstChild);var t=i.getElementsByName&&i.getElementsByName(q).length===2+i.getElementsByName(q+0).length;return P.getIdNotName=!i.getElementById(q),L.removeChild(e),t}),k.attrHandle=s(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==X&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},P.getIdNotName?(k.find.ID=function(e,t){if(typeof t.getElementById!==X&&!j){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},k.filter.ID=function(e){var t=e.replace(_e,xe);return function(e){return e.getAttribute("id")===t}}):(k.find.ID=function(e,n){if(typeof n.getElementById!==X&&!j){var i=n.getElementById(e);return i?i.id===e||typeof i.getAttributeNode!==X&&i.getAttributeNode("id").value===e?[i]:t:[]}},k.filter.ID=function(e){var t=e.replace(_e,xe);return function(e){var n=typeof e.getAttributeNode!==X&&e.getAttributeNode("id");return n&&n.value===t}}),k.find.TAG=P.tagNameNoComments?function(e,n){return typeof n.getElementsByTagName!==X?n.getElementsByTagName(e):t}:function(e,t){var n,i=[],r=0,s=t.getElementsByTagName(e);if("*"===e){for(;n=s[r++];)1===n.nodeType&&i.push(n);return i}return s},k.find.NAME=P.getByName&&function(e,n){return typeof n.getElementsByName!==X?n.getElementsByName(name):t},k.find.CLASS=P.getByClassName&&function(e,n){return typeof n.getElementsByClassName===X||j?t:n.getElementsByClassName(e)},R=[],$=[":focus"],(P.qsa=n(i.querySelectorAll))&&(s(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||$.push("\\["+ee+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||$.push(":checked")}),s(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&$.push("[*^$]="+ee+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||$.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),$.push(",.*:")})),(P.matchesSelector=n(M=L.matchesSelector||L.mozMatchesSelector||L.webkitMatchesSelector||L.oMatchesSelector||L.msMatchesSelector))&&s(function(e){P.disconnectedMatch=M.call(e,"div"),M.call(e,"[s!='']:x"),R.push("!=",se)}),$=RegExp($.join("|")),R=RegExp(R.join("|")),F=n(L.contains)||L.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},O=L.compareDocumentPosition?function(e,t){var n;return e===t?(A=!0,0):(n=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&n||e.parentNode&&11===e.parentNode.nodeType?e===i||F(H,e)?-1:t===i||F(H,t)?1:0:4&n?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var n,r=0,s=e.parentNode,o=t.parentNode,l=[e],c=[t];if(e===t)return A=!0,0;if(!s||!o)return e===i?-1:t===i?1:s?-1:o?1:0;if(s===o)return a(e,t);for(n=e;n=n.parentNode;)l.unshift(n);for(n=t;n=n.parentNode;)c.unshift(n);for(;l[r]===c[r];)r++;return r?a(l[r],c[r]):l[r]===H?-1:c[r]===H?1:0},A=!1,[0,0].sort(O),P.detectDuplicates=A,N):N},o.matches=function(e,t){return o(e,null,null,t)},o.matchesSelector=function(e,t){if((e.ownerDocument||e)!==N&&D(e),t=t.replace(ye,"='$1']"),!(!P.matchesSelector||j||R&&R.test(t)||$.test(t)))try{var n=M.call(e,t);if(n||P.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(i){}return o(t,N,null,[e]).length>0},o.contains=function(e,t){return(e.ownerDocument||e)!==N&&D(e),F(e,t)},o.attr=function(e,t){var n;return(e.ownerDocument||e)!==N&&D(e),j||(t=t.toLowerCase()),(n=k.attrHandle[t])?n(e):j||P.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},o.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},o.uniqueSort=function(e){var t,n=[],i=1,r=0;if(A=!P.detectDuplicates,e.sort(O),A){for(;t=e[i];i++)t===e[i-1]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return e},S=o.getText=function(e){var t,n="",i=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=S(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[i];i++)n+=S(t);return n},k=o.selectors={cacheLength:50,createPseudo:r,match:pe,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(_e,xe),e[3]=(e[4]||e[5]||"").replace(_e,xe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||o.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&o.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return pe.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&ue.test(n)&&(t=d(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(_e,xe).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=z[e+" "];return t||(t=RegExp("(^|"+ee+")"+e+"("+ee+"|$)"))&&z(e,function(e){return t.test(e.className||typeof e.getAttribute!==X&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(i){var r=o.attr(i,e);return null==r?"!="===t:!t||(r+="","="===t?r===n:"!="===t?r!==n:"^="===t?n&&0===r.indexOf(n):"*="===t?n&&r.indexOf(n)>-1:"$="===t?n&&r.slice(-n.length)===n:"~="===t?(" "+r+" ").indexOf(n)>-1:"|="===t&&(r===n||r.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,i,r){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===i&&0===r?function(e){return!!e.parentNode}:function(t,n,l){var c,u,d,p,h,f,m=s!==o?"nextSibling":"previousSibling",g=t.parentNode,v=a&&t.nodeName.toLowerCase(),b=!l&&!a;if(g){if(s){for(;m;){
for(d=t;d=d[m];)if(a?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;f=m="only"===e&&!f&&"nextSibling"}return!0}if(f=[o?g.firstChild:g.lastChild],o&&b){for(u=g[q]||(g[q]={}),c=u[e]||[],h=c[0]===U&&c[1],p=c[0]===U&&c[2],d=h&&g.childNodes[h];d=++h&&d&&d[m]||(p=h=0)||f.pop();)if(1===d.nodeType&&++p&&d===t){u[e]=[U,h,p];break}}else if(b&&(c=(t[q]||(t[q]={}))[e])&&c[0]===U)p=c[1];else for(;(d=++h&&d&&d[m]||(p=h=0)||f.pop())&&((a?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++p||(b&&((d[q]||(d[q]={}))[e]=[U,p]),d!==t)););return p-=r,p===i||0===p%i&&p/i>=0}}},PSEUDO:function(e,t){var n,i=k.pseudos[e]||k.setFilters[e.toLowerCase()]||o.error("unsupported pseudo: "+e);return i[q]?i(t):i.length>1?(n=[e,e,"",t],k.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,n){for(var r,s=i(e,t),o=s.length;o--;)r=Z.call(e,s[o]),e[r]=!(n[r]=s[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:r(function(e){var t=[],n=[],i=E(e.replace(oe,"$1"));return i[q]?r(function(e,t,n,r){for(var s,o=i(e,null,r,[]),a=e.length;a--;)(s=o[a])&&(e[a]=!(t[a]=s))}):function(e,r,s){return t[0]=e,i(t,null,s,n),!n.pop()}}),has:r(function(e){return function(t){return o(e,t).length>0}}),contains:r(function(e){return function(t){return(t.textContent||t.innerText||S(t)).indexOf(e)>-1}}),lang:r(function(e){return de.test(e||"")||o.error("unsupported lang: "+e),e=e.replace(_e,xe).toLowerCase(),function(t){var n;do if(n=j?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===L},focus:function(e){return e===N.activeElement&&(!N.hasFocus||N.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!k.pseudos.empty(e)},header:function(e){return ve.test(e.nodeName)},input:function(e){return ge.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:u(function(){return[0]}),last:u(function(e,t){return[t-1]}),eq:u(function(e,t,n){return[0>n?n+t:n]}),even:u(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:u(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:u(function(e,t,n){for(var i=0>n?n+t:n;--i>=0;)e.push(i);return e}),gt:u(function(e,t,n){for(var i=0>n?n+t:n;t>++i;)e.push(i);return e})}};for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})k.pseudos[w]=l(w);for(w in{submit:!0,reset:!0})k.pseudos[w]=c(w);E=o.compile=function(e,t){var n,i=[],r=[],s=V[e+" "];if(!s){for(t||(t=d(e)),n=t.length;n--;)s=v(t[n]),s[q]?i.push(s):r.push(s);s=V(e,b(r,i))}return s},k.pseudos.nth=k.pseudos.eq,k.filters=x.prototype=k.pseudos,k.setFilters=new x,D(),o.attr=le.attr,le.find=o,le.expr=o.selectors,le.expr[":"]=le.expr.pseudos,le.unique=o.uniqueSort,le.text=o.getText,le.isXMLDoc=o.isXML,le.contains=o.contains}(e);var Pe=/Until$/,Ue=/^(?:parents|prev(?:Until|All))/,Be=/^.[^:#\[\.,]*$/,ze=le.expr.match.needsContext,We={children:!0,contents:!0,next:!0,prev:!0};le.fn.extend({find:function(e){var t,n,i,r=this.length;if("string"!=typeof e)return i=this,this.pushStack(le(e).filter(function(){for(t=0;r>t;t++)if(le.contains(i[t],this))return!0}));for(n=[],t=0;r>t;t++)le.find(e,this[t],n);return n=this.pushStack(r>1?le.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=le(e,this),i=n.length;return this.filter(function(){for(t=0;i>t;t++)if(le.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(d(this,e,!1))},filter:function(e){return this.pushStack(d(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?ze.test(e)?le(e,this.context).index(this[0])>=0:le.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){for(var n,i=0,r=this.length,s=[],o=ze.test(e)||"string"!=typeof e?le(e,t||this.context):0;r>i;i++)for(n=this[i];n&&n.ownerDocument&&n!==t&&11!==n.nodeType;){if(o?o.index(n)>-1:le.find.matchesSelector(n,e)){s.push(n);break}n=n.parentNode}return this.pushStack(s.length>1?le.unique(s):s)},index:function(e){return e?"string"==typeof e?le.inArray(this[0],le(e)):le.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?le(e,t):le.makeArray(e&&e.nodeType?[e]:e),i=le.merge(this.get(),n);return this.pushStack(le.unique(i))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),le.fn.andSelf=le.fn.addBack,le.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return le.dir(e,"parentNode")},parentsUntil:function(e,t,n){return le.dir(e,"parentNode",n)},next:function(e){return u(e,"nextSibling")},prev:function(e){return u(e,"previousSibling")},nextAll:function(e){return le.dir(e,"nextSibling")},prevAll:function(e){return le.dir(e,"previousSibling")},nextUntil:function(e,t,n){return le.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return le.dir(e,"previousSibling",n)},siblings:function(e){return le.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return le.sibling(e.firstChild)},contents:function(e){return le.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:le.merge([],e.childNodes)}},function(e,t){le.fn[e]=function(n,i){var r=le.map(this,t,n);return Pe.test(e)||(i=n),i&&"string"==typeof i&&(r=le.filter(i,r)),r=this.length>1&&!We[e]?le.unique(r):r,this.length>1&&Ue.test(e)&&(r=r.reverse()),this.pushStack(r)}}),le.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?le.find.matchesSelector(t[0],e)?[t[0]]:[]:le.find.matches(e,t)},dir:function(e,n,i){for(var r=[],s=e[n];s&&9!==s.nodeType&&(i===t||1!==s.nodeType||!le(s).is(i));)1===s.nodeType&&r.push(s),s=s[n];return r},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var Ve="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Xe=/ jQuery\d+="(?:null|\d+)"/g,Qe=RegExp("<(?:"+Ve+")[\\s/>]","i"),Je=/^\s+/,Ge=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ke=/<([\w:]+)/,Ye=/<tbody/i,Ze=/<|&#?\w+;/,et=/<(?:script|style|link)/i,tt=/^(?:checkbox|radio)$/i,nt=/checked\s*(?:[^=]|=\s*.checked.)/i,it=/^$|\/(?:java|ecma)script/i,rt=/^true\/(.*)/,st=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ot={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:le.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},at=p(Q),lt=at.appendChild(Q.createElement("div"));ot.optgroup=ot.option,ot.tbody=ot.tfoot=ot.colgroup=ot.caption=ot.thead,ot.th=ot.td,le.fn.extend({text:function(e){return le.access(this,function(e){return e===t?le.text(this):this.empty().append((this[0]&&this[0].ownerDocument||Q).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(le.isFunction(e))return this.each(function(t){le(this).wrapAll(e.call(this,t))});if(this[0]){var t=le(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return le.isFunction(e)?this.each(function(t){le(this).wrapInner(e.call(this,t))}):this.each(function(){var t=le(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=le.isFunction(e);return this.each(function(n){le(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){le.nodeName(this,"body")||le(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,i=0;null!=(n=this[i]);i++)(!e||le.filter(e,[n]).length>0)&&(t||1!==n.nodeType||le.cleanData(y(n)),n.parentNode&&(t&&le.contains(n.ownerDocument,n)&&g(y(n,"script")),n.parentNode.removeChild(n)));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&le.cleanData(y(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&le.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return le.clone(this,e,t)})},html:function(e){return le.access(this,function(e){var n=this[0]||{},i=0,r=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(Xe,""):t;if(!("string"!=typeof e||et.test(e)||!le.support.htmlSerialize&&Qe.test(e)||!le.support.leadingWhitespace&&Je.test(e)||ot[(Ke.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(Ge,"<$1></$2>");try{for(;r>i;i++)n=this[i]||{},1===n.nodeType&&(le.cleanData(y(n,!1)),n.innerHTML=e);n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=le.isFunction(e);return t||"string"==typeof e||(e=le(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(le(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,i){e=te.apply([],e);var r,s,o,a,l,c,u=0,d=this.length,p=this,g=d-1,v=e[0],b=le.isFunction(v);if(b||!(1>=d||"string"!=typeof v||le.support.checkClone)&&nt.test(v))return this.each(function(r){var s=p.eq(r);b&&(e[0]=v.call(this,r,n?s.html():t)),s.domManip(e,n,i)});if(d&&(c=le.buildFragment(e,this[0].ownerDocument,!1,this),r=c.firstChild,1===c.childNodes.length&&(c=r),r)){for(n=n&&le.nodeName(r,"tr"),a=le.map(y(c,"script"),f),o=a.length;d>u;u++)s=c,u!==g&&(s=le.clone(s,!0,!0),o&&le.merge(a,y(s,"script"))),i.call(n&&le.nodeName(this[u],"table")?h(this[u],"tbody"):this[u],s,u);if(o)for(l=a[a.length-1].ownerDocument,le.map(a,m),u=0;o>u;u++)s=a[u],it.test(s.type||"")&&!le._data(s,"globalEval")&&le.contains(l,s)&&(s.src?le.ajax({url:s.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):le.globalEval((s.text||s.textContent||s.innerHTML||"").replace(st,"")));c=r=null}return this}}),le.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){le.fn[e]=function(e){for(var n,i=0,r=[],s=le(e),o=s.length-1;o>=i;i++)n=i===o?this:this.clone(!0),le(s[i])[t](n),ne.apply(r,n.get());return this.pushStack(r)}}),le.extend({clone:function(e,t,n){var i,r,s,o,a,l=le.contains(e.ownerDocument,e);if(le.support.html5Clone||le.isXMLDoc(e)||!Qe.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(lt.innerHTML=e.outerHTML,lt.removeChild(s=lt.firstChild)),!(le.support.noCloneEvent&&le.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||le.isXMLDoc(e)))for(i=y(s),a=y(e),o=0;null!=(r=a[o]);++o)i[o]&&b(r,i[o]);if(t)if(n)for(a=a||y(e),i=i||y(s),o=0;null!=(r=a[o]);o++)v(r,i[o]);else v(e,s);return i=y(s,"script"),i.length>0&&g(i,!l&&y(e,"script")),i=a=r=null,s},buildFragment:function(e,t,n,i){for(var r,s,o,a,l,c,u,d=e.length,h=p(t),f=[],m=0;d>m;m++)if(s=e[m],s||0===s)if("object"===le.type(s))le.merge(f,s.nodeType?[s]:s);else if(Ze.test(s)){for(a=a||h.appendChild(t.createElement("div")),l=(Ke.exec(s)||["",""])[1].toLowerCase(),u=ot[l]||ot._default,a.innerHTML=u[1]+s.replace(Ge,"<$1></$2>")+u[2],r=u[0];r--;)a=a.lastChild;if(!le.support.leadingWhitespace&&Je.test(s)&&f.push(t.createTextNode(Je.exec(s)[0])),!le.support.tbody)for(s="table"!==l||Ye.test(s)?"<table>"!==u[1]||Ye.test(s)?0:a:a.firstChild,r=s&&s.childNodes.length;r--;)le.nodeName(c=s.childNodes[r],"tbody")&&!c.childNodes.length&&s.removeChild(c);for(le.merge(f,a.childNodes),a.textContent="";a.firstChild;)a.removeChild(a.firstChild);a=h.lastChild}else f.push(t.createTextNode(s));for(a&&h.removeChild(a),le.support.appendChecked||le.grep(y(f,"input"),_),m=0;s=f[m++];)if((!i||-1===le.inArray(s,i))&&(o=le.contains(s.ownerDocument,s),a=y(h.appendChild(s),"script"),o&&g(a),n))for(r=0;s=a[r++];)it.test(s.type||"")&&n.push(s);return a=null,h},cleanData:function(e,t){for(var n,i,r,s,o=0,a=le.expando,l=le.cache,c=le.support.deleteExpando,u=le.event.special;null!=(n=e[o]);o++)if((t||le.acceptData(n))&&(r=n[a],s=r&&l[r])){if(s.events)for(i in s.events)u[i]?le.event.remove(n,i):le.removeEvent(n,i,s.handle);l[r]&&(delete l[r],c?delete n[a]:typeof n.removeAttribute!==X?n.removeAttribute(a):n[a]=null,Z.push(r))}}});var ct,ut,dt,pt=/alpha\([^)]*\)/i,ht=/opacity\s*=\s*([^)]*)/,ft=/^(top|right|bottom|left)$/,mt=/^(none|table(?!-c[ea]).+)/,gt=/^margin/,vt=RegExp("^("+ce+")(.*)$","i"),bt=RegExp("^("+ce+")(?!px)[a-z%]+$","i"),yt=RegExp("^([+-])=("+ce+")","i"),_t={BODY:"block"},xt={position:"absolute",visibility:"hidden",display:"block"},wt={letterSpacing:0,fontWeight:400},Tt=["Top","Right","Bottom","Left"],kt=["Webkit","O","Moz","ms"];le.fn.extend({css:function(e,n){return le.access(this,function(e,n,i){var r,s,o={},a=0;if(le.isArray(n)){for(s=ut(e),r=n.length;r>a;a++)o[n[a]]=le.css(e,n[a],!1,s);return o}return i!==t?le.style(e,n,i):le.css(e,n)},e,n,arguments.length>1)},show:function(){return T(this,!0)},hide:function(){return T(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:w(this))?le(this).show():le(this).hide()})}}),le.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=dt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":le.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,i,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,o,a,l=le.camelCase(n),c=e.style;if(n=le.cssProps[l]||(le.cssProps[l]=x(c,l)),a=le.cssHooks[n]||le.cssHooks[l],i===t)return a&&"get"in a&&(s=a.get(e,!1,r))!==t?s:c[n];if(o=typeof i,"string"===o&&(s=yt.exec(i))&&(i=(s[1]+1)*s[2]+parseFloat(le.css(e,n)),o="number"),!(null==i||"number"===o&&isNaN(i)||("number"!==o||le.cssNumber[l]||(i+="px"),le.support.clearCloneStyle||""!==i||0!==n.indexOf("background")||(c[n]="inherit"),a&&"set"in a&&(i=a.set(e,i,r))===t)))try{c[n]=i}catch(u){}}},css:function(e,n,i,r){var s,o,a,l=le.camelCase(n);return n=le.cssProps[l]||(le.cssProps[l]=x(e.style,l)),a=le.cssHooks[n]||le.cssHooks[l],a&&"get"in a&&(o=a.get(e,!0,i)),o===t&&(o=dt(e,n,r)),"normal"===o&&n in wt&&(o=wt[n]),""===i||i?(s=parseFloat(o),i===!0||le.isNumeric(s)?s||0:o):o},swap:function(e,t,n,i){var r,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];r=n.apply(e,i||[]);for(s in t)e.style[s]=o[s];return r}}),e.getComputedStyle?(ut=function(t){return e.getComputedStyle(t,null)},dt=function(e,n,i){var r,s,o,a=i||ut(e),l=a?a.getPropertyValue(n)||a[n]:t,c=e.style;return a&&(""!==l||le.contains(e.ownerDocument,e)||(l=le.style(e,n)),bt.test(l)&&gt.test(n)&&(r=c.width,s=c.minWidth,o=c.maxWidth,c.minWidth=c.maxWidth=c.width=l,l=a.width,c.width=r,c.minWidth=s,c.maxWidth=o)),l}):Q.documentElement.currentStyle&&(ut=function(e){return e.currentStyle},dt=function(e,n,i){var r,s,o,a=i||ut(e),l=a?a[n]:t,c=e.style;return null==l&&c&&c[n]&&(l=c[n]),bt.test(l)&&!ft.test(n)&&(r=c.left,s=e.runtimeStyle,o=s&&s.left,o&&(s.left=e.currentStyle.left),c.left="fontSize"===n?"1em":l,l=c.pixelLeft+"px",c.left=r,o&&(s.left=o)),""===l?"auto":l}),le.each(["height","width"],function(e,n){le.cssHooks[n]={get:function(e,i,r){return i?0===e.offsetWidth&&mt.test(le.css(e,"display"))?le.swap(e,xt,function(){return C(e,n,r)}):C(e,n,r):t},set:function(e,t,i){var r=i&&ut(e);return k(e,t,i?S(e,n,i,le.support.boxSizing&&"border-box"===le.css(e,"boxSizing",!1,r),r):0)}}}),le.support.opacity||(le.cssHooks.opacity={get:function(e,t){return ht.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,i=e.currentStyle,r=le.isNumeric(t)?"alpha(opacity="+100*t+")":"",s=i&&i.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===le.trim(s.replace(pt,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||i&&!i.filter)||(n.filter=pt.test(s)?s.replace(pt,r):s+" "+r)}}),le(function(){le.support.reliableMarginRight||(le.cssHooks.marginRight={get:function(e,n){return n?le.swap(e,{display:"inline-block"},dt,[e,"marginRight"]):t}}),!le.support.pixelPosition&&le.fn.position&&le.each(["top","left"],function(e,n){le.cssHooks[n]={get:function(e,i){return i?(i=dt(e,n),bt.test(i)?le(e).position()[n]+"px":i):t}}})}),le.expr&&le.expr.filters&&(le.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!le.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||le.css(e,"display"))},le.expr.filters.visible=function(e){return!le.expr.filters.hidden(e)}),le.each({margin:"",padding:"",border:"Width"},function(e,t){le.cssHooks[e+t]={expand:function(n){for(var i=0,r={},s="string"==typeof n?n.split(" "):[n];4>i;i++)r[e+Tt[i]+t]=s[i]||s[i-2]||s[0];return r}},gt.test(e)||(le.cssHooks[e+t].set=k)});var St=/%20/g,Ct=/\[\]$/,Et=/\r?\n/g,At=/^(?:submit|button|image|reset|file)$/i,It=/^(?:input|select|textarea|keygen)/i;le.fn.extend({serialize:function(){return le.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=le.prop(this,"elements");return e?le.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!le(this).is(":disabled")&&It.test(this.nodeName)&&!At.test(e)&&(this.checked||!tt.test(e))}).map(function(e,t){var n=le(this).val();return null==n?null:le.isArray(n)?le.map(n,function(e){return{name:t.name,value:e.replace(Et,"\r\n")}}):{name:t.name,value:n.replace(Et,"\r\n")}}).get()}}),le.param=function(e,n){var i,r=[],s=function(e,t){t=le.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=le.ajaxSettings&&le.ajaxSettings.traditional),le.isArray(e)||e.jquery&&!le.isPlainObject(e))le.each(e,function(){s(this.name,this.value)});else for(i in e)I(i,e[i],n,s);return r.join("&").replace(St,"+")},le.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){le.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),le.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var Dt,Nt,Lt=le.now(),jt=/\?/,$t=/#.*$/,Rt=/([?&])_=[^&]*/,Mt=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Ft=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Ot=/^(?:GET|HEAD)$/,qt=/^\/\//,Ht=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Pt=le.fn.load,Ut={},Bt={},zt="*/".concat("*");try{Nt=J.href}catch(Wt){Nt=Q.createElement("a"),Nt.href="",Nt=Nt.href}Dt=Ht.exec(Nt.toLowerCase())||[],le.fn.load=function(e,n,i){if("string"!=typeof e&&Pt)return Pt.apply(this,arguments);var r,s,o,a=this,l=e.indexOf(" ");return l>=0&&(r=e.slice(l,e.length),e=e.slice(0,l)),le.isFunction(n)?(i=n,n=t):n&&"object"==typeof n&&(o="POST"),a.length>0&&le.ajax({url:e,type:o,dataType:"html",data:n}).done(function(e){s=arguments,a.html(r?le("<div>").append(le.parseHTML(e)).find(r):e)}).complete(i&&function(e,t){a.each(i,s||[e.responseText,t,e])}),this},le.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){le.fn[t]=function(e){return this.on(t,e)}}),le.each(["get","post"],function(e,n){le[n]=function(e,i,r,s){return le.isFunction(i)&&(s=s||r,r=i,i=t),le.ajax({url:e,type:n,dataType:s,data:i,success:r})}}),le.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Nt,type:"GET",isLocal:Ft.test(Dt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":zt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":le.parseJSON,"text xml":le.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?L(L(e,le.ajaxSettings),t):L(le.ajaxSettings,e)},ajaxPrefilter:D(Ut),ajaxTransport:D(Bt),ajax:function(e,n){function i(e,n,i,r){var s,d,b,y,x,T=n;2!==_&&(_=2,l&&clearTimeout(l),u=t,a=r||"",w.readyState=e>0?4:0,i&&(y=j(p,w,i)),e>=200&&300>e||304===e?(p.ifModified&&(x=w.getResponseHeader("Last-Modified"),x&&(le.lastModified[o]=x),x=w.getResponseHeader("etag"),x&&(le.etag[o]=x)),204===e?(s=!0,T="nocontent"):304===e?(s=!0,T="notmodified"):(s=$(p,y),T=s.state,d=s.data,b=s.error,s=!b)):(b=T,(e||!T)&&(T="error",0>e&&(e=0))),w.status=e,w.statusText=(n||T)+"",s?m.resolveWith(h,[d,T,w]):m.rejectWith(h,[w,T,b]),w.statusCode(v),v=t,c&&f.trigger(s?"ajaxSuccess":"ajaxError",[w,p,s?d:b]),g.fireWith(h,[w,T]),c&&(f.trigger("ajaxComplete",[w,p]),--le.active||le.event.trigger("ajaxStop")))}"object"==typeof e&&(n=e,e=t),n=n||{};var r,s,o,a,l,c,u,d,p=le.ajaxSetup({},n),h=p.context||p,f=p.context&&(h.nodeType||h.jquery)?le(h):le.event,m=le.Deferred(),g=le.Callbacks("once memory"),v=p.statusCode||{},b={},y={},_=0,x="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(2===_){if(!d)for(d={};t=Mt.exec(a);)d[t[1].toLowerCase()]=t[2];t=d[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===_?a:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return _||(e=y[n]=y[n]||e,b[e]=t),this},overrideMimeType:function(e){return _||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>_)for(t in e)v[t]=[v[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||x;return u&&u.abort(t),i(0,t),this}};if(m.promise(w).complete=g.add,w.success=w.done,w.error=w.fail,p.url=((e||p.url||Nt)+"").replace($t,"").replace(qt,Dt[1]+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=le.trim(p.dataType||"*").toLowerCase().match(ue)||[""],null==p.crossDomain&&(r=Ht.exec(p.url.toLowerCase()),p.crossDomain=!(!r||r[1]===Dt[1]&&r[2]===Dt[2]&&(r[3]||("http:"===r[1]?80:443))==(Dt[3]||("http:"===Dt[1]?80:443)))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=le.param(p.data,p.traditional)),N(Ut,p,n,w),2===_)return w;c=p.global,c&&0===le.active++&&le.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Ot.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(jt.test(o)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=Rt.test(o)?o.replace(Rt,"$1_="+Lt++):o+(jt.test(o)?"&":"?")+"_="+Lt++)),p.ifModified&&(le.lastModified[o]&&w.setRequestHeader("If-Modified-Since",le.lastModified[o]),le.etag[o]&&w.setRequestHeader("If-None-Match",le.etag[o])),(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&w.setRequestHeader("Content-Type",p.contentType),w.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+zt+"; q=0.01":""):p.accepts["*"]);for(s in p.headers)w.setRequestHeader(s,p.headers[s]);if(p.beforeSend&&(p.beforeSend.call(h,w,p)===!1||2===_))return w.abort();x="abort";for(s in{success:1,error:1,complete:1})w[s](p[s]);if(u=N(Bt,p,n,w)){w.readyState=1,c&&f.trigger("ajaxSend",[w,p]),p.async&&p.timeout>0&&(l=setTimeout(function(){w.abort("timeout")},p.timeout));try{_=1,u.send(b,i)}catch(T){if(!(2>_))throw T;i(-1,T)}}else i(-1,"No Transport");return w},getScript:function(e,n){return le.get(e,t,n,"script")},getJSON:function(e,t,n){return le.get(e,t,n,"json")}}),le.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return le.globalEval(e),e}}}),le.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),le.ajaxTransport("script",function(e){if(e.crossDomain){var n,i=Q.head||le("head")[0]||Q.documentElement;return{send:function(t,r){n=Q.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||r(200,"success"))},i.insertBefore(n,i.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var Vt=[],Xt=/(=)\?(?=&|$)|\?\?/;le.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Vt.pop()||le.expando+"_"+Lt++;return this[e]=!0,e}}),le.ajaxPrefilter("json jsonp",function(n,i,r){var s,o,a,l=n.jsonp!==!1&&(Xt.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Xt.test(n.data)&&"data");return l||"jsonp"===n.dataTypes[0]?(s=n.jsonpCallback=le.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,l?n[l]=n[l].replace(Xt,"$1"+s):n.jsonp!==!1&&(n.url+=(jt.test(n.url)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return a||le.error(s+" was not called"),a[0]},n.dataTypes[0]="json",o=e[s],e[s]=function(){a=arguments},r.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=i.jsonpCallback,Vt.push(s)),a&&le.isFunction(o)&&o(a[0]),a=o=t}),"script"):t});var Qt,Jt,Gt=0,Kt=e.ActiveXObject&&function(){var e;for(e in Qt)Qt[e](t,!0)};le.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&R()||M()}:R,Jt=le.ajaxSettings.xhr(),le.support.cors=!!Jt&&"withCredentials"in Jt,Jt=le.support.ajax=!!Jt,Jt&&le.ajaxTransport(function(n){if(!n.crossDomain||le.support.cors){var i;return{send:function(r,s){var o,a,l=n.xhr();if(n.username?l.open(n.type,n.url,n.async,n.username,n.password):l.open(n.type,n.url,n.async),n.xhrFields)for(a in n.xhrFields)l[a]=n.xhrFields[a];n.mimeType&&l.overrideMimeType&&l.overrideMimeType(n.mimeType),n.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest");try{for(a in r)l.setRequestHeader(a,r[a])}catch(c){}l.send(n.hasContent&&n.data||null),i=function(e,r){var a,c,u,d;try{if(i&&(r||4===l.readyState))if(i=t,o&&(l.onreadystatechange=le.noop,Kt&&delete Qt[o]),r)4!==l.readyState&&l.abort();else{d={},a=l.status,c=l.getAllResponseHeaders(),"string"==typeof l.responseText&&(d.text=l.responseText);try{u=l.statusText}catch(p){u=""}a||!n.isLocal||n.crossDomain?1223===a&&(a=204):a=d.text?200:404}}catch(h){r||s(-1,h)}d&&s(a,u,d,c)},n.async?4===l.readyState?setTimeout(i):(o=++Gt,Kt&&(Qt||(Qt={},le(e).unload(Kt)),Qt[o]=i),l.onreadystatechange=i):i()},abort:function(){i&&i(t,!0)}}}});var Yt,Zt,en=/^(?:toggle|show|hide)$/,tn=RegExp("^(?:([+-])=|)("+ce+")([a-z%]*)$","i"),nn=/queueHooks$/,rn=[P],sn={"*":[function(e,t){var n,i,r=this.createTween(e,t),s=tn.exec(t),o=r.cur(),a=+o||0,l=1,c=20;if(s){if(n=+s[2],i=s[3]||(le.cssNumber[e]?"":"px"),"px"!==i&&a){a=le.css(r.elem,e,!0)||n||1;do l=l||".5",a/=l,le.style(r.elem,e,a+i);while(l!==(l=r.cur()/o)&&1!==l&&--c)}r.unit=i,r.start=a,r.end=s[1]?a+(s[1]+1)*n:n}return r}]};le.Animation=le.extend(q,{tweener:function(e,t){le.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,i=0,r=e.length;r>i;i++)n=e[i],sn[n]=sn[n]||[],sn[n].unshift(t)},prefilter:function(e,t){t?rn.unshift(e):rn.push(e)}}),le.Tween=U,U.prototype={constructor:U,init:function(e,t,n,i,r,s){this.elem=e,this.prop=n,this.easing=r||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=s||(le.cssNumber[n]?"":"px")},cur:function(){var e=U.propHooks[this.prop];return e&&e.get?e.get(this):U.propHooks._default.get(this)},run:function(e){var t,n=U.propHooks[this.prop];return this.pos=t=this.options.duration?le.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):U.propHooks._default.set(this),this}},U.prototype.init.prototype=U.prototype,U.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=le.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){le.fx.step[e.prop]?le.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[le.cssProps[e.prop]]||le.cssHooks[e.prop])?le.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},U.propHooks.scrollTop=U.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},le.each(["toggle","show","hide"],function(e,t){var n=le.fn[t];le.fn[t]=function(e,i,r){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(B(t,!0),e,i,r)}}),le.fn.extend({fadeTo:function(e,t,n,i){return this.filter(w).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var r=le.isEmptyObject(e),s=le.speed(t,n,i),o=function(){var t=q(this,le.extend({},e),s);o.finish=function(){t.stop(!0)},(r||le._data(this,"finish"))&&t.stop(!0)};return o.finish=o,r||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,i){var r=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",s=le.timers,o=le._data(this);if(n)o[n]&&o[n].stop&&r(o[n]);else for(n in o)o[n]&&o[n].stop&&nn.test(n)&&r(o[n]);for(n=s.length;n--;)s[n].elem!==this||null!=e&&s[n].queue!==e||(s[n].anim.stop(i),t=!1,s.splice(n,1));(t||!i)&&le.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=le._data(this),i=n[e+"queue"],r=n[e+"queueHooks"],s=le.timers,o=i?i.length:0;for(n.finish=!0,le.queue(this,e,[]),r&&r.cur&&r.cur.finish&&r.cur.finish.call(this),t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;o>t;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete n.finish})}}),le.each({slideDown:B("show"),slideUp:B("hide"),slideToggle:B("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){le.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}}),le.speed=function(e,t,n){var i=e&&"object"==typeof e?le.extend({},e):{complete:n||!n&&t||le.isFunction(e)&&e,duration:e,easing:n&&t||t&&!le.isFunction(t)&&t};return i.duration=le.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in le.fx.speeds?le.fx.speeds[i.duration]:le.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){le.isFunction(i.old)&&i.old.call(this),i.queue&&le.dequeue(this,i.queue)},i},le.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},le.timers=[],le.fx=U.prototype.init,le.fx.tick=function(){var e,n=le.timers,i=0;for(Yt=le.now();n.length>i;i++)e=n[i],e()||n[i]!==e||n.splice(i--,1);n.length||le.fx.stop(),Yt=t},le.fx.timer=function(e){e()&&le.timers.push(e)&&le.fx.start()},le.fx.interval=13,le.fx.start=function(){Zt||(Zt=setInterval(le.fx.tick,le.fx.interval))},le.fx.stop=function(){clearInterval(Zt),Zt=null},le.fx.speeds={slow:600,fast:200,_default:400},le.fx.step={},le.expr&&le.expr.filters&&(le.expr.filters.animated=function(e){return le.grep(le.timers,function(t){
return e===t.elem}).length}),le.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){le.offset.setOffset(this,e,t)});var n,i,r={top:0,left:0},s=this[0],o=s&&s.ownerDocument;return o?(n=o.documentElement,le.contains(n,s)?(typeof s.getBoundingClientRect!==X&&(r=s.getBoundingClientRect()),i=z(o),{top:r.top+(i.pageYOffset||n.scrollTop)-(n.clientTop||0),left:r.left+(i.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):r):void 0},le.offset={setOffset:function(e,t,n){var i=le.css(e,"position");"static"===i&&(e.style.position="relative");var r,s,o=le(e),a=o.offset(),l=le.css(e,"top"),c=le.css(e,"left"),u=("absolute"===i||"fixed"===i)&&le.inArray("auto",[l,c])>-1,d={},p={};u?(p=o.position(),r=p.top,s=p.left):(r=parseFloat(l)||0,s=parseFloat(c)||0),le.isFunction(t)&&(t=t.call(e,n,a)),null!=t.top&&(d.top=t.top-a.top+r),null!=t.left&&(d.left=t.left-a.left+s),"using"in t?t.using.call(e,d):o.css(d)}},le.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},i=this[0];return"fixed"===le.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),le.nodeName(e[0],"html")||(n=e.offset()),n.top+=le.css(e[0],"borderTopWidth",!0),n.left+=le.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-le.css(i,"marginTop",!0),left:t.left-n.left-le.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||Q.documentElement;e&&!le.nodeName(e,"html")&&"static"===le.css(e,"position");)e=e.offsetParent;return e||Q.documentElement})}}),le.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var i=/Y/.test(n);le.fn[e]=function(r){return le.access(this,function(e,r,s){var o=z(e);return s===t?o?n in o?o[n]:o.document.documentElement[r]:e[r]:(o?o.scrollTo(i?le(o).scrollLeft():s,i?s:le(o).scrollTop()):e[r]=s,t)},e,r,arguments.length,null)}}),le.each({Height:"height",Width:"width"},function(e,n){le.each({padding:"inner"+e,content:n,"":"outer"+e},function(i,r){le.fn[r]=function(r,s){var o=arguments.length&&(i||"boolean"!=typeof r),a=i||(r===!0||s===!0?"margin":"border");return le.access(this,function(n,i,r){var s;return le.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):r===t?le.css(n,i,a):le.style(n,i,r,a)},n,o?r:t,o,null)}})}),e.jQuery=e.$=le,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return le})}(window),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(e){"use strict";var t=e.fn.jquery.split(" ")[0].split(".");if(t[0]<2&&t[1]<9||1==t[0]&&9==t[1]&&t[2]<1||t[0]>2)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 3")}(jQuery),+function(e){"use strict";function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(void 0!==e.style[n])return{end:t[n]};return!1}e.fn.emulateTransitionEnd=function(t){var n=!1,i=this;e(this).one("bsTransitionEnd",function(){n=!0});var r=function(){n||e(i).trigger(e.support.transition.end)};return setTimeout(r,t),this},e(function(){e.support.transition=t(),e.support.transition&&(e.event.special.bsTransitionEnd={bindType:e.support.transition.end,delegateType:e.support.transition.end,handle:function(t){return e(t.target).is(this)?t.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var n=e(this),r=n.data("bs.alert");r||n.data("bs.alert",r=new i(this)),"string"==typeof t&&r[t].call(n)})}var n='[data-dismiss="alert"]',i=function(t){e(t).on("click",n,this.close)};i.VERSION="3.3.6",i.TRANSITION_DURATION=150,i.prototype.close=function(t){function n(){o.detach().trigger("closed.bs.alert").remove()}var r=e(this),s=r.attr("data-target");s||(s=r.attr("href"),s=s&&s.replace(/.*(?=#[^\s]*$)/,""));var o=e(s);t&&t.preventDefault(),o.length||(o=r.closest(".alert")),o.trigger(t=e.Event("close.bs.alert")),t.isDefaultPrevented()||(o.removeClass("in"),e.support.transition&&o.hasClass("fade")?o.one("bsTransitionEnd",n).emulateTransitionEnd(i.TRANSITION_DURATION):n())};var r=e.fn.alert;e.fn.alert=t,e.fn.alert.Constructor=i,e.fn.alert.noConflict=function(){return e.fn.alert=r,this},e(document).on("click.bs.alert.data-api",n,i.prototype.close)}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var i=e(this),r=i.data("bs.button"),s="object"==typeof t&&t;r||i.data("bs.button",r=new n(this,s)),"toggle"==t?r.toggle():t&&r.setState(t)})}var n=function(t,i){this.$element=e(t),this.options=e.extend({},n.DEFAULTS,i),this.isLoading=!1};n.VERSION="3.3.6",n.DEFAULTS={loadingText:"loading..."},n.prototype.setState=function(t){var n="disabled",i=this.$element,r=i.is("input")?"val":"html",s=i.data();t+="Text",null==s.resetText&&i.data("resetText",i[r]()),setTimeout(e.proxy(function(){i[r](null==s[t]?this.options[t]:s[t]),"loadingText"==t?(this.isLoading=!0,i.addClass(n).attr(n,n)):this.isLoading&&(this.isLoading=!1,i.removeClass(n).removeAttr(n))},this),0)},n.prototype.toggle=function(){var e=!0,t=this.$element.closest('[data-toggle="buttons"]');if(t.length){var n=this.$element.find("input");"radio"==n.prop("type")?(n.prop("checked")&&(e=!1),t.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==n.prop("type")&&(n.prop("checked")!==this.$element.hasClass("active")&&(e=!1),this.$element.toggleClass("active")),n.prop("checked",this.$element.hasClass("active")),e&&n.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var i=e.fn.button;e.fn.button=t,e.fn.button.Constructor=n,e.fn.button.noConflict=function(){return e.fn.button=i,this},e(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(n){var i=e(n.target);i.hasClass("btn")||(i=i.closest(".btn")),t.call(i,"toggle"),e(n.target).is('input[type="radio"]')||e(n.target).is('input[type="checkbox"]')||n.preventDefault()}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(t){e(t.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(t.type))})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var i=e(this),r=i.data("bs.carousel"),s=e.extend({},n.DEFAULTS,i.data(),"object"==typeof t&&t),o="string"==typeof t?t:s.slide;r||i.data("bs.carousel",r=new n(this,s)),"number"==typeof t?r.to(t):o?r[o]():s.interval&&r.pause().cycle()})}var n=function(t,n){this.$element=e(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",e.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",e.proxy(this.pause,this)).on("mouseleave.bs.carousel",e.proxy(this.cycle,this))};n.VERSION="3.3.6",n.TRANSITION_DURATION=600,n.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},n.prototype.keydown=function(e){if(!/input|textarea/i.test(e.target.tagName)){switch(e.which){case 37:this.prev();break;case 39:this.next();break;default:return}e.preventDefault()}},n.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},n.prototype.getItemIndex=function(e){return this.$items=e.parent().children(".item"),this.$items.index(e||this.$active)},n.prototype.getItemForDirection=function(e,t){var n=this.getItemIndex(t),i="prev"==e&&0===n||"next"==e&&n==this.$items.length-1;if(i&&!this.options.wrap)return t;var r="prev"==e?-1:1,s=(n+r)%this.$items.length;return this.$items.eq(s)},n.prototype.to=function(e){var t=this,n=this.getItemIndex(this.$active=this.$element.find(".item.active"));return e>this.$items.length-1||0>e?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){t.to(e)}):n==e?this.pause().cycle():this.slide(e>n?"next":"prev",this.$items.eq(e))},n.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},n.prototype.next=function(){return this.sliding?void 0:this.slide("next")},n.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},n.prototype.slide=function(t,i){var r=this.$element.find(".item.active"),s=i||this.getItemForDirection(t,r),o=this.interval,a="next"==t?"left":"right",l=this;if(s.hasClass("active"))return this.sliding=!1;var c=s[0],u=e.Event("slide.bs.carousel",{relatedTarget:c,direction:a});if(this.$element.trigger(u),!u.isDefaultPrevented()){if(this.sliding=!0,o&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var d=e(this.$indicators.children()[this.getItemIndex(s)]);d&&d.addClass("active")}var p=e.Event("slid.bs.carousel",{relatedTarget:c,direction:a});return e.support.transition&&this.$element.hasClass("slide")?(s.addClass(t),s[0].offsetWidth,r.addClass(a),s.addClass(a),r.one("bsTransitionEnd",function(){s.removeClass([t,a].join(" ")).addClass("active"),r.removeClass(["active",a].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger(p)},0)}).emulateTransitionEnd(n.TRANSITION_DURATION)):(r.removeClass("active"),s.addClass("active"),this.sliding=!1,this.$element.trigger(p)),o&&this.cycle(),this}};var i=e.fn.carousel;e.fn.carousel=t,e.fn.carousel.Constructor=n,e.fn.carousel.noConflict=function(){return e.fn.carousel=i,this};var r=function(n){var i,r=e(this),s=e(r.attr("data-target")||(i=r.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,""));if(s.hasClass("carousel")){var o=e.extend({},s.data(),r.data()),a=r.attr("data-slide-to");a&&(o.interval=!1),t.call(s,o),a&&s.data("bs.carousel").to(a),n.preventDefault()}};e(document).on("click.bs.carousel.data-api","[data-slide]",r).on("click.bs.carousel.data-api","[data-slide-to]",r),e(window).on("load",function(){e('[data-ride="carousel"]').each(function(){var n=e(this);t.call(n,n.data())})})}(jQuery),+function(e){"use strict";function t(t){var n,i=t.attr("data-target")||(n=t.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,"");return e(i)}function n(t){return this.each(function(){var n=e(this),r=n.data("bs.collapse"),s=e.extend({},i.DEFAULTS,n.data(),"object"==typeof t&&t);!r&&s.toggle&&/show|hide/.test(t)&&(s.toggle=!1),r||n.data("bs.collapse",r=new i(this,s)),"string"==typeof t&&r[t]()})}var i=function(t,n){this.$element=e(t),this.options=e.extend({},i.DEFAULTS,n),this.$trigger=e('[data-toggle="collapse"][href="#'+t.id+'"],[data-toggle="collapse"][data-target="#'+t.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};i.VERSION="3.3.6",i.TRANSITION_DURATION=350,i.DEFAULTS={toggle:!0},i.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"},i.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var t,r=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(r&&r.length&&(t=r.data("bs.collapse"),t&&t.transitioning))){var s=e.Event("show.bs.collapse");if(this.$element.trigger(s),!s.isDefaultPrevented()){r&&r.length&&(n.call(r,"hide"),t||r.data("bs.collapse",null));var o=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[o](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var a=function(){this.$element.removeClass("collapsing").addClass("collapse in")[o](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return a.call(this);var l=e.camelCase(["scroll",o].join("-"));this.$element.one("bsTransitionEnd",e.proxy(a,this)).emulateTransitionEnd(i.TRANSITION_DURATION)[o](this.$element[0][l])}}}},i.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var t=e.Event("hide.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var r=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return e.support.transition?void this.$element[n](0).one("bsTransitionEnd",e.proxy(r,this)).emulateTransitionEnd(i.TRANSITION_DURATION):r.call(this)}}},i.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},i.prototype.getParent=function(){return e(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(e.proxy(function(n,i){var r=e(i);this.addAriaAndCollapsedClass(t(r),r)},this)).end()},i.prototype.addAriaAndCollapsedClass=function(e,t){var n=e.hasClass("in");e.attr("aria-expanded",n),t.toggleClass("collapsed",!n).attr("aria-expanded",n)};var r=e.fn.collapse;e.fn.collapse=n,e.fn.collapse.Constructor=i,e.fn.collapse.noConflict=function(){return e.fn.collapse=r,this},e(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(i){var r=e(this);r.attr("data-target")||i.preventDefault();var s=t(r),o=s.data("bs.collapse"),a=o?"toggle":r.data();n.call(s,a)})}(jQuery),+function(e){"use strict";function t(t){var n=t.attr("data-target");n||(n=t.attr("href"),n=n&&/#[A-Za-z]/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var i=n&&e(n);return i&&i.length?i:t.parent()}function n(n){n&&3===n.which||(e(r).remove(),e(s).each(function(){var i=e(this),r=t(i),s={relatedTarget:this};r.hasClass("open")&&(n&&"click"==n.type&&/input|textarea/i.test(n.target.tagName)&&e.contains(r[0],n.target)||(r.trigger(n=e.Event("hide.bs.dropdown",s)),n.isDefaultPrevented()||(i.attr("aria-expanded","false"),r.removeClass("open").trigger(e.Event("hidden.bs.dropdown",s)))))}))}function i(t){return this.each(function(){var n=e(this),i=n.data("bs.dropdown");i||n.data("bs.dropdown",i=new o(this)),"string"==typeof t&&i[t].call(n)})}var r=".dropdown-backdrop",s='[data-toggle="dropdown"]',o=function(t){e(t).on("click.bs.dropdown",this.toggle)};o.VERSION="3.3.6",o.prototype.toggle=function(i){var r=e(this);if(!r.is(".disabled, :disabled")){var s=t(r),o=s.hasClass("open");if(n(),!o){"ontouchstart"in document.documentElement&&!s.closest(".navbar-nav").length&&e(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(e(this)).on("click",n);var a={relatedTarget:this};if(s.trigger(i=e.Event("show.bs.dropdown",a)),i.isDefaultPrevented())return;r.trigger("focus").attr("aria-expanded","true"),s.toggleClass("open").trigger(e.Event("shown.bs.dropdown",a))}return!1}},o.prototype.keydown=function(n){if(/(38|40|27|32)/.test(n.which)&&!/input|textarea/i.test(n.target.tagName)){var i=e(this);if(n.preventDefault(),n.stopPropagation(),!i.is(".disabled, :disabled")){var r=t(i),o=r.hasClass("open");if(!o&&27!=n.which||o&&27==n.which)return 27==n.which&&r.find(s).trigger("focus"),i.trigger("click");var a=" li:not(.disabled):visible a",l=r.find(".dropdown-menu"+a);if(l.length){var c=l.index(n.target);38==n.which&&c>0&&c--,40==n.which&&c<l.length-1&&c++,~c||(c=0),l.eq(c).trigger("focus")}}}};var a=e.fn.dropdown;e.fn.dropdown=i,e.fn.dropdown.Constructor=o,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=a,this},e(document).on("click.bs.dropdown.data-api",n).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",s,o.prototype.toggle).on("keydown.bs.dropdown.data-api",s,o.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",o.prototype.keydown)}(jQuery),+function(e){"use strict";function t(t,i){return this.each(function(){var r=e(this),s=r.data("bs.modal"),o=e.extend({},n.DEFAULTS,r.data(),"object"==typeof t&&t);s||r.data("bs.modal",s=new n(this,o)),"string"==typeof t?s[t](i):o.show&&s.show(i)})}var n=function(t,n){this.options=n,this.$body=e(document.body),this.$element=e(t),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,e.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};n.VERSION="3.3.6",n.TRANSITION_DURATION=300,n.BACKDROP_TRANSITION_DURATION=150,n.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},n.prototype.toggle=function(e){return this.isShown?this.hide():this.show(e)},n.prototype.show=function(t){var i=this,r=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(r),this.isShown||r.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){i.$element.one("mouseup.dismiss.bs.modal",function(t){e(t.target).is(i.$element)&&(i.ignoreBackdropClick=!0)})}),this.backdrop(function(){var r=e.support.transition&&i.$element.hasClass("fade");i.$element.parent().length||i.$element.appendTo(i.$body),i.$element.show().scrollTop(0),i.adjustDialog(),r&&i.$element[0].offsetWidth,i.$element.addClass("in"),i.enforceFocus();var s=e.Event("shown.bs.modal",{relatedTarget:t});r?i.$dialog.one("bsTransitionEnd",function(){i.$element.trigger("focus").trigger(s)}).emulateTransitionEnd(n.TRANSITION_DURATION):i.$element.trigger("focus").trigger(s)}))},n.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",e.proxy(this.hideModal,this)).emulateTransitionEnd(n.TRANSITION_DURATION):this.hideModal())},n.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.trigger("focus")},this))},n.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",e.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},n.prototype.resize=function(){this.isShown?e(window).on("resize.bs.modal",e.proxy(this.handleUpdate,this)):e(window).off("resize.bs.modal")},n.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.$body.removeClass("modal-open"),e.resetAdjustments(),e.resetScrollbar(),e.$element.trigger("hidden.bs.modal")})},n.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},n.prototype.backdrop=function(t){var i=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var s=e.support.transition&&r;if(this.$backdrop=e(document.createElement("div")).addClass("modal-backdrop "+r).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",e.proxy(function(e){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),s&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;s?this.$backdrop.one("bsTransitionEnd",t).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var o=function(){i.removeBackdrop(),t&&t()};e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",o).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):o()}else t&&t()},n.prototype.handleUpdate=function(){this.adjustDialog()},n.prototype.adjustDialog=function(){var e=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&e?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!e?this.scrollbarWidth:""})},n.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},n.prototype.checkScrollbar=function(){var e=window.innerWidth;if(!e){var t=document.documentElement.getBoundingClientRect();e=t.right-Math.abs(t.left)}this.bodyIsOverflowing=document.body.clientWidth<e,this.scrollbarWidth=this.measureScrollbar()},n.prototype.setScrollbar=function(){var e=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",e+this.scrollbarWidth)},n.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},n.prototype.measureScrollbar=function(){var e=document.createElement("div");e.className="modal-scrollbar-measure",this.$body.append(e);var t=e.offsetWidth-e.clientWidth;return this.$body[0].removeChild(e),t};var i=e.fn.modal;e.fn.modal=t,e.fn.modal.Constructor=n,e.fn.modal.noConflict=function(){return e.fn.modal=i,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(n){var i=e(this),r=i.attr("href"),s=e(i.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),o=s.data("bs.modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},s.data(),i.data());i.is("a")&&n.preventDefault(),s.one("show.bs.modal",function(e){e.isDefaultPrevented()||s.one("hidden.bs.modal",function(){i.is(":visible")&&i.trigger("focus")})}),t.call(s,o,this)})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var i=e(this),r=i.data("bs.tooltip"),s="object"==typeof t&&t;(r||!/destroy|hide/.test(t))&&(r||i.data("bs.tooltip",r=new n(this,s)),"string"==typeof t&&r[t]())})}var n=function(e,t){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",e,t)};n.VERSION="3.3.6",n.TRANSITION_DURATION=150,n.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},n.prototype.init=function(t,n,i){if(this.enabled=!0,this.type=t,this.$element=e(n),this.options=this.getOptions(i),this.$viewport=this.options.viewport&&e(e.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var r=this.options.trigger.split(" "),s=r.length;s--;){var o=r[s];if("click"==o)this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if("manual"!=o){var a="hover"==o?"mouseenter":"focusin",l="hover"==o?"mouseleave":"focusout";this.$element.on(a+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.getOptions=function(t){return t=e.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},n.prototype.getDelegateOptions=function(){var t={},n=this.getDefaults();return this._options&&e.each(this._options,function(e,i){n[e]!=i&&(t[e]=i)}),t},n.prototype.enter=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);return n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),t instanceof e.Event&&(n.inState["focusin"==t.type?"focus":"hover"]=!0),n.tip().hasClass("in")||"in"==n.hoverState?void(n.hoverState="in"):(clearTimeout(n.timeout),n.hoverState="in",n.options.delay&&n.options.delay.show?void(n.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show)):n.show())},n.prototype.isInStateTrue=function(){for(var e in this.inState)if(this.inState[e])return!0;return!1},n.prototype.leave=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);return n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),t instanceof e.Event&&(n.inState["focusout"==t.type?"focus":"hover"]=!1),n.isInStateTrue()?void 0:(clearTimeout(n.timeout),n.hoverState="out",n.options.delay&&n.options.delay.hide?void(n.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide)):n.hide())},n.prototype.show=function(){var t=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(t);var i=e.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(t.isDefaultPrevented()||!i)return;var r=this,s=this.tip(),o=this.getUID(this.type);this.setContent(),s.attr("id",o),this.$element.attr("aria-describedby",o),this.options.animation&&s.addClass("fade");var a="function"==typeof this.options.placement?this.options.placement.call(this,s[0],this.$element[0]):this.options.placement,l=/\s?auto?\s?/i,c=l.test(a);c&&(a=a.replace(l,"")||"top"),s.detach().css({top:0,left:0,display:"block"}).addClass(a).data("bs."+this.type,this),this.options.container?s.appendTo(this.options.container):s.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var u=this.getPosition(),d=s[0].offsetWidth,p=s[0].offsetHeight;if(c){var h=a,f=this.getPosition(this.$viewport);a="bottom"==a&&u.bottom+p>f.bottom?"top":"top"==a&&u.top-p<f.top?"bottom":"right"==a&&u.right+d>f.width?"left":"left"==a&&u.left-d<f.left?"right":a,s.removeClass(h).addClass(a)}var m=this.getCalculatedOffset(a,u,d,p);this.applyPlacement(m,a);var g=function(){var e=r.hoverState;r.$element.trigger("shown.bs."+r.type),r.hoverState=null,"out"==e&&r.leave(r)};e.support.transition&&this.$tip.hasClass("fade")?s.one("bsTransitionEnd",g).emulateTransitionEnd(n.TRANSITION_DURATION):g()}},n.prototype.applyPlacement=function(t,n){var i=this.tip(),r=i[0].offsetWidth,s=i[0].offsetHeight,o=parseInt(i.css("margin-top"),10),a=parseInt(i.css("margin-left"),10);isNaN(o)&&(o=0),isNaN(a)&&(a=0),t.top+=o,t.left+=a,e.offset.setOffset(i[0],e.extend({using:function(e){i.css({top:Math.round(e.top),left:Math.round(e.left)})}},t),0),i.addClass("in");var l=i[0].offsetWidth,c=i[0].offsetHeight;"top"==n&&c!=s&&(t.top=t.top+s-c);var u=this.getViewportAdjustedDelta(n,t,l,c);u.left?t.left+=u.left:t.top+=u.top;var d=/top|bottom/.test(n),p=d?2*u.left-r+l:2*u.top-s+c,h=d?"offsetWidth":"offsetHeight";i.offset(t),this.replaceArrow(p,i[0][h],d)},n.prototype.replaceArrow=function(e,t,n){this.arrow().css(n?"left":"top",50*(1-e/t)+"%").css(n?"top":"left","")},n.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},n.prototype.hide=function(t){function i(){"in"!=r.hoverState&&s.detach(),r.$element.removeAttr("aria-describedby").trigger("hidden.bs."+r.type),t&&t()}var r=this,s=e(this.$tip),o=e.Event("hide.bs."+this.type);return this.$element.trigger(o),o.isDefaultPrevented()?void 0:(s.removeClass("in"),e.support.transition&&s.hasClass("fade")?s.one("bsTransitionEnd",i).emulateTransitionEnd(n.TRANSITION_DURATION):i(),this.hoverState=null,this)},n.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},n.prototype.hasContent=function(){return this.getTitle()},n.prototype.getPosition=function(t){t=t||this.$element;var n=t[0],i="BODY"==n.tagName,r=n.getBoundingClientRect();null==r.width&&(r=e.extend({},r,{width:r.right-r.left,height:r.bottom-r.top}));var s=i?{top:0,left:0}:t.offset(),o={scroll:i?document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop()},a=i?{width:e(window).width(),height:e(window).height()}:null;return e.extend({},r,o,a,s)},n.prototype.getCalculatedOffset=function(e,t,n,i){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-n/2}:"top"==e?{top:t.top-i,left:t.left+t.width/2-n/2}:"left"==e?{top:t.top+t.height/2-i/2,left:t.left-n}:{top:t.top+t.height/2-i/2,left:t.left+t.width}},n.prototype.getViewportAdjustedDelta=function(e,t,n,i){var r={top:0,left:0};if(!this.$viewport)return r;var s=this.options.viewport&&this.options.viewport.padding||0,o=this.getPosition(this.$viewport);if(/right|left/.test(e)){var a=t.top-s-o.scroll,l=t.top+s-o.scroll+i;a<o.top?r.top=o.top-a:l>o.top+o.height&&(r.top=o.top+o.height-l)}else{var c=t.left-s,u=t.left+s+n;c<o.left?r.left=o.left-c:u>o.right&&(r.left=o.left+o.width-u)}return r},n.prototype.getTitle=function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||("function"==typeof n.title?n.title.call(t[0]):n.title)},n.prototype.getUID=function(e){do e+=~~(1e6*Math.random());while(document.getElementById(e));return e},n.prototype.tip=function(){if(!this.$tip&&(this.$tip=e(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},n.prototype.enable=function(){this.enabled=!0},n.prototype.disable=function(){this.enabled=!1},n.prototype.toggleEnabled=function(){this.enabled=!this.enabled},n.prototype.toggle=function(t){var n=this;t&&(n=e(t.currentTarget).data("bs."+this.type),n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n))),t?(n.inState.click=!n.inState.click,n.isInStateTrue()?n.enter(n):n.leave(n)):n.tip().hasClass("in")?n.leave(n):n.enter(n)},n.prototype.destroy=function(){var e=this;clearTimeout(this.timeout),this.hide(function(){e.$element.off("."+e.type).removeData("bs."+e.type),e.$tip&&e.$tip.detach(),e.$tip=null,e.$arrow=null,e.$viewport=null})};var i=e.fn.tooltip;e.fn.tooltip=t,e.fn.tooltip.Constructor=n,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=i,this}}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var i=e(this),r=i.data("bs.popover"),s="object"==typeof t&&t;(r||!/destroy|hide/.test(t))&&(r||i.data("bs.popover",r=new n(this,s)),"string"==typeof t&&r[t]())})}var n=function(e,t){this.init("popover",e,t)};if(!e.fn.tooltip)throw new Error("Popover requires tooltip.js");n.VERSION="3.3.6",n.DEFAULTS=e.extend({},e.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),n.prototype=e.extend({},e.fn.tooltip.Constructor.prototype),n.prototype.constructor=n,n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof n?"html":"append":"text"](n),
e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},n.prototype.hasContent=function(){return this.getTitle()||this.getContent()},n.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||("function"==typeof t.content?t.content.call(e[0]):t.content)},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var i=e.fn.popover;e.fn.popover=t,e.fn.popover.Constructor=n,e.fn.popover.noConflict=function(){return e.fn.popover=i,this}}(jQuery),+function(e){"use strict";function t(n,i){this.$body=e(document.body),this.$scrollElement=e(e(n).is(document.body)?window:n),this.options=e.extend({},t.DEFAULTS,i),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",e.proxy(this.process,this)),this.refresh(),this.process()}function n(n){return this.each(function(){var i=e(this),r=i.data("bs.scrollspy"),s="object"==typeof n&&n;r||i.data("bs.scrollspy",r=new t(this,s)),"string"==typeof n&&r[n]()})}t.VERSION="3.3.6",t.DEFAULTS={offset:10},t.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},t.prototype.refresh=function(){var t=this,n="offset",i=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),e.isWindow(this.$scrollElement[0])||(n="position",i=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var t=e(this),r=t.data("target")||t.attr("href"),s=/^#./.test(r)&&e(r);return s&&s.length&&s.is(":visible")&&[[s[n]().top+i,r]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){t.offsets.push(this[0]),t.targets.push(this[1])})},t.prototype.process=function(){var e,t=this.$scrollElement.scrollTop()+this.options.offset,n=this.getScrollHeight(),i=this.options.offset+n-this.$scrollElement.height(),r=this.offsets,s=this.targets,o=this.activeTarget;if(this.scrollHeight!=n&&this.refresh(),t>=i)return o!=(e=s[s.length-1])&&this.activate(e);if(o&&t<r[0])return this.activeTarget=null,this.clear();for(e=r.length;e--;)o!=s[e]&&t>=r[e]&&(void 0===r[e+1]||t<r[e+1])&&this.activate(s[e])},t.prototype.activate=function(t){this.activeTarget=t,this.clear();var n=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',i=e(n).parents("li").addClass("active");i.parent(".dropdown-menu").length&&(i=i.closest("li.dropdown").addClass("active")),i.trigger("activate.bs.scrollspy")},t.prototype.clear=function(){e(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var i=e.fn.scrollspy;e.fn.scrollspy=n,e.fn.scrollspy.Constructor=t,e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=i,this},e(window).on("load.bs.scrollspy.data-api",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);n.call(t,t.data())})})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var i=e(this),r=i.data("bs.tab");r||i.data("bs.tab",r=new n(this)),"string"==typeof t&&r[t]()})}var n=function(t){this.element=e(t)};n.VERSION="3.3.6",n.TRANSITION_DURATION=150,n.prototype.show=function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),i=t.data("target");if(i||(i=t.attr("href"),i=i&&i.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var r=n.find(".active:last a"),s=e.Event("hide.bs.tab",{relatedTarget:t[0]}),o=e.Event("show.bs.tab",{relatedTarget:r[0]});if(r.trigger(s),t.trigger(o),!o.isDefaultPrevented()&&!s.isDefaultPrevented()){var a=e(i);this.activate(t.closest("li"),n),this.activate(a,a.parent(),function(){r.trigger({type:"hidden.bs.tab",relatedTarget:t[0]}),t.trigger({type:"shown.bs.tab",relatedTarget:r[0]})})}}},n.prototype.activate=function(t,i,r){function s(){o.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),t.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),a?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu").length&&t.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),r&&r()}var o=i.find("> .active"),a=r&&e.support.transition&&(o.length&&o.hasClass("fade")||!!i.find("> .fade").length);o.length&&a?o.one("bsTransitionEnd",s).emulateTransitionEnd(n.TRANSITION_DURATION):s(),o.removeClass("in")};var i=e.fn.tab;e.fn.tab=t,e.fn.tab.Constructor=n,e.fn.tab.noConflict=function(){return e.fn.tab=i,this};var r=function(n){n.preventDefault(),t.call(e(this),"show")};e(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',r).on("click.bs.tab.data-api",'[data-toggle="pill"]',r)}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var i=e(this),r=i.data("bs.affix"),s="object"==typeof t&&t;r||i.data("bs.affix",r=new n(this,s)),"string"==typeof t&&r[t]()})}var n=function(t,i){this.options=e.extend({},n.DEFAULTS,i),this.$target=e(this.options.target).on("scroll.bs.affix.data-api",e.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",e.proxy(this.checkPositionWithEventLoop,this)),this.$element=e(t),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};n.VERSION="3.3.6",n.RESET="affix affix-top affix-bottom",n.DEFAULTS={offset:0,target:window},n.prototype.getState=function(e,t,n,i){var r=this.$target.scrollTop(),s=this.$element.offset(),o=this.$target.height();if(null!=n&&"top"==this.affixed)return n>r&&"top";if("bottom"==this.affixed)return null!=n?!(r+this.unpin<=s.top)&&"bottom":!(e-i>=r+o)&&"bottom";var a=null==this.affixed,l=a?r:s.top,c=a?o:t;return null!=n&&n>=r?"top":null!=i&&l+c>=e-i&&"bottom"},n.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(n.RESET).addClass("affix");var e=this.$target.scrollTop(),t=this.$element.offset();return this.pinnedOffset=t.top-e},n.prototype.checkPositionWithEventLoop=function(){setTimeout(e.proxy(this.checkPosition,this),1)},n.prototype.checkPosition=function(){if(this.$element.is(":visible")){var t=this.$element.height(),i=this.options.offset,r=i.top,s=i.bottom,o=Math.max(e(document).height(),e(document.body).height());"object"!=typeof i&&(s=r=i),"function"==typeof r&&(r=i.top(this.$element)),"function"==typeof s&&(s=i.bottom(this.$element));var a=this.getState(o,t,r,s);if(this.affixed!=a){null!=this.unpin&&this.$element.css("top","");var l="affix"+(a?"-"+a:""),c=e.Event(l+".bs.affix");if(this.$element.trigger(c),c.isDefaultPrevented())return;this.affixed=a,this.unpin="bottom"==a?this.getPinnedOffset():null,this.$element.removeClass(n.RESET).addClass(l).trigger(l.replace("affix","affixed")+".bs.affix")}"bottom"==a&&this.$element.offset({top:o-t-s})}};var i=e.fn.affix;e.fn.affix=t,e.fn.affix.Constructor=n,e.fn.affix.noConflict=function(){return e.fn.affix=i,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var n=e(this),i=n.data();i.offset=i.offset||{},null!=i.offsetBottom&&(i.offset.bottom=i.offsetBottom),null!=i.offsetTop&&(i.offset.top=i.offsetTop),t.call(n,i)})})}(jQuery),function(e,t,n){var i=function(){for(var e=/audio(.min)?.js.*/,t=document.getElementsByTagName("script"),n=0,i=t.length;n<i;n++){var r=t[n].getAttribute("src");if(e.test(r))return r.replace(e,"")}}();n[e]={instanceCount:0,instances:{},flashSource:'      <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="$1" width="1" height="1" name="$1" style="position: absolute; left: -1px;">         <param name="movie" value="$2?playerInstance='+e+'.instances[\'$1\']&datetime=$3">         <param name="allowscriptaccess" value="always">         <embed name="$1" src="$2?playerInstance='+e+'.instances[\'$1\']&datetime=$3" width="1" height="1" allowscriptaccess="always">       </object>',settings:{autoplay:!1,loop:!1,preload:!0,imageLocation:i+"player-graphics.gif",swfLocation:i+"audiojs.swf",useFlash:function(){var e=document.createElement("audio");return!(e.canPlayType&&e.canPlayType("audio/mpeg;").replace(/no/,""))}(),hasFlash:function(){if(navigator.plugins&&navigator.plugins.length&&navigator.plugins["Shockwave Flash"])return!0;if(navigator.mimeTypes&&navigator.mimeTypes.length){var e=navigator.mimeTypes["application/x-shockwave-flash"];return e&&e.enabledPlugin}try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),!0}catch(t){}return!1}(),createPlayer:{markup:'          <div class="play-pause">             <p class="play"></p>             <p class="pause"></p>             <p class="loading"></p>             <p class="error"></p>           </div>           <div class="scrubber">             <div class="progress"></div>             <div class="loaded"></div>           </div>           <div class="time">             <em class="played">00:00</em>/<strong class="duration">00:00</strong>           </div>           <div class="error-message"></div>',playPauseClass:"play-pause",scrubberClass:"scrubber",progressClass:"progress",loaderClass:"loaded",timeClass:"time",durationClass:"duration",playedClass:"played",errorMessageClass:"error-message",playingClass:"playing",loadingClass:"loading",errorClass:"error"},css:'        .audiojs audio { position: absolute; left: -1px; }         .audiojs { width: 460px; height: 36px; background: #404040; overflow: hidden; font-family: monospace; font-size: 12px;           background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #444), color-stop(0.5, #555), color-stop(0.51, #444), color-stop(1, #444));           background-image: -moz-linear-gradient(center top, #444 0%, #555 50%, #444 51%, #444 100%);           -webkit-box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3); -moz-box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3);           -o-box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3); box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3); }         .audiojs .play-pause { width: 25px; height: 40px; padding: 4px 6px; margin: 0px; float: left; overflow: hidden; border-right: 1px solid #000; }         .audiojs p { display: none; width: 25px; height: 40px; margin: 0px; cursor: pointer; }         .audiojs .play { display: block; }         .audiojs .scrubber { position: relative; float: left; width: 280px; background: #5a5a5a; height: 14px; margin: 10px; border-top: 1px solid #3f3f3f; border-left: 0px; border-bottom: 0px; overflow: hidden; }         .audiojs .progress { position: absolute; top: 0px; left: 0px; height: 14px; width: 0px; background: #ccc; z-index: 1;           background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #ccc), color-stop(0.5, #ddd), color-stop(0.51, #ccc), color-stop(1, #ccc));           background-image: -moz-linear-gradient(center top, #ccc 0%, #ddd 50%, #ccc 51%, #ccc 100%); }         .audiojs .loaded { position: absolute; top: 0px; left: 0px; height: 14px; width: 0px; background: #000;           background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #222), color-stop(0.5, #333), color-stop(0.51, #222), color-stop(1, #222));           background-image: -moz-linear-gradient(center top, #222 0%, #333 50%, #222 51%, #222 100%); }         .audiojs .time { float: left; height: 36px; line-height: 36px; margin: 0px 0px 0px 6px; padding: 0px 6px 0px 12px; border-left: 1px solid #000; color: #ddd; text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.5); }         .audiojs .time em { padding: 0px 2px 0px 0px; color: #f9f9f9; font-style: normal; }         .audiojs .time strong { padding: 0px 0px 0px 2px; font-weight: normal; }         .audiojs .error-message { float: left; display: none; margin: 0px 10px; height: 36px; width: 400px; overflow: hidden; line-height: 36px; white-space: nowrap; color: #fff;           text-overflow: ellipsis; -o-text-overflow: ellipsis; -icab-text-overflow: ellipsis; -khtml-text-overflow: ellipsis; -moz-text-overflow: ellipsis; -webkit-text-overflow: ellipsis; }         .audiojs .error-message a { color: #eee; text-decoration: none; padding-bottom: 1px; border-bottom: 1px solid #999; white-space: wrap; }                 .audiojs .play { background: url("$1") -2px -1px no-repeat; }         .audiojs .loading { background: url("$1") -2px -31px no-repeat; }         .audiojs .error { background: url("$1") -2px -61px no-repeat; }         .audiojs .pause { background: url("$1") -2px -91px no-repeat; }                 .playing .play, .playing .loading, .playing .error { display: none; }         .playing .pause { display: block; }                 .loading .play, .loading .pause, .loading .error { display: none; }         .loading .loading { display: block; }                 .error .time, .error .play, .error .pause, .error .scrubber, .error .loading { display: none; }         .error .error { display: block; }         .error .play-pause p { cursor: auto; }         .error .error-message { display: block; }',trackEnded:function(){},flashError:function(){var t=this.settings.createPlayer,i=r(t.errorMessageClass,this.wrapper),s='Missing <a href="http://get.adobe.com/flashplayer/">flash player</a> plugin.';this.mp3&&(s+=' <a href="'+this.mp3+'">Download audio file</a>.'),n[e].helpers.removeClass(this.wrapper,t.loadingClass),n[e].helpers.addClass(this.wrapper,t.errorClass),i.innerHTML=s},loadError:function(){var t=this.settings.createPlayer,i=r(t.errorMessageClass,this.wrapper);n[e].helpers.removeClass(this.wrapper,t.loadingClass),n[e].helpers.addClass(this.wrapper,t.errorClass),i.innerHTML='Error loading: "'+this.mp3+'"'},init:function(){n[e].helpers.addClass(this.wrapper,this.settings.createPlayer.loadingClass)},loadStarted:function(){var t=this.settings.createPlayer,i=r(t.durationClass,this.wrapper),s=Math.floor(this.duration/60),o=Math.floor(this.duration%60);n[e].helpers.removeClass(this.wrapper,t.loadingClass),i.innerHTML=(s<10?"0":"")+s+":"+(o<10?"0":"")+o},loadProgress:function(e){var t=this.settings.createPlayer,n=r(t.scrubberClass,this.wrapper);r(t.loaderClass,this.wrapper).style.width=n.offsetWidth*e+"px"},playPause:function(){this.playing?this.settings.play():this.settings.pause()},play:function(){n[e].helpers.addClass(this.wrapper,this.settings.createPlayer.playingClass)},pause:function(){n[e].helpers.removeClass(this.wrapper,this.settings.createPlayer.playingClass)},updatePlayhead:function(e){var t=this.settings.createPlayer,n=r(t.scrubberClass,this.wrapper);r(t.progressClass,this.wrapper).style.width=n.offsetWidth*e+"px",t=r(t.playedClass,this.wrapper),n=this.duration*e,e=Math.floor(n/60),n=Math.floor(n%60),t.innerHTML=(e<10?"0":"")+e+":"+(n<10?"0":"")+n}},create:function(e,t){return t=t||{},e.length?this.createAll(t,e):this.newInstance(e,t)},createAll:function(e,t){var n=t||document.getElementsByTagName("audio"),i=[];e=e||{};for(var r=0,s=n.length;r<s;r++)i.push(this.newInstance(n[r],e));return i},newInstance:function(e,i){var r=this.helpers.clone(this.settings),s="audiojs"+this.instanceCount,o="audiojs_wrapper"+this.instanceCount;return this.instanceCount++,null!=e.getAttribute("autoplay")&&(r.autoplay=!0),null!=e.getAttribute("loop")&&(r.loop=!0),"none"==e.getAttribute("preload")&&(r.preload=!1),i&&this.helpers.merge(r,i),r.createPlayer.markup?e=this.createPlayer(e,r.createPlayer,o):e.parentNode.setAttribute("id",o),o=new n[t](e,r),r.css&&this.helpers.injectCss(o,r.css),r.useFlash&&r.hasFlash?(this.injectFlash(o,s),this.attachFlashEvents(o.wrapper,o)):r.useFlash&&!r.hasFlash&&this.settings.flashError.apply(o),(!r.useFlash||r.useFlash&&r.hasFlash)&&this.attachEvents(o.wrapper,o),this.instances[s]=o},createPlayer:function(e,t,n){var i=document.createElement("div"),r=e.cloneNode(!0);return i.setAttribute("class","audiojs"),i.setAttribute("className","audiojs"),i.setAttribute("id",n),r.outerHTML&&!document.createElement("audio").canPlayType?(r=this.helpers.cloneHtml5Node(e),i.innerHTML=t.markup,i.appendChild(r),e.outerHTML=i.outerHTML,i=document.getElementById(n)):(i.appendChild(r),i.innerHTML+=t.markup,e.parentNode.replaceChild(i,e)),i.getElementsByTagName("audio")[0]},attachEvents:function(t,i){if(i.settings.createPlayer){var s=i.settings.createPlayer,o=r(s.playPauseClass,t),a=r(s.scrubberClass,t);n[e].events.addListener(o,"click",function(){i.playPause.apply(i)}),n[e].events.addListener(a,"click",function(e){e=e.clientX;var t=this,n=0;if(t.offsetParent)do n+=t.offsetLeft;while(t=t.offsetParent);i.skipTo((e-n)/a.offsetWidth)}),i.settings.useFlash||(n[e].events.trackLoadProgress(i),n[e].events.addListener(i.element,"timeupdate",function(){i.updatePlayhead.apply(i)}),n[e].events.addListener(i.element,"ended",function(){i.trackEnded.apply(i)}),n[e].events.addListener(i.source,"error",function(){clearInterval(i.readyTimer),clearInterval(i.loadTimer),i.settings.loadError.apply(i)}))}},attachFlashEvents:function(e,t){t.swfReady=!1,t.load=function(e){t.mp3=e,t.swfReady&&t.element.load(e)},t.loadProgress=function(e,n){t.loadedPercent=e,t.duration=n,t.settings.loadStarted.apply(t),t.settings.loadProgress.apply(t,[e])},t.skipTo=function(e){e>t.loadedPercent||(t.updatePlayhead.call(t,[e]),t.element.skipTo(e))},t.updatePlayhead=function(e){t.settings.updatePlayhead.apply(t,[e])},t.play=function(){t.settings.preload||(t.settings.preload=!0,t.element.init(t.mp3)),t.playing=!0,t.element.pplay(),t.settings.play.apply(t)},t.pause=function(){t.playing=!1,t.element.ppause(),t.settings.pause.apply(t)},t.setVolume=function(e){t.element.setVolume(e)},t.loadStarted=function(){t.swfReady=!0,t.settings.preload&&t.element.init(t.mp3),t.settings.autoplay&&t.play.apply(t)}},injectFlash:function(e,t){var n=this.flashSource.replace(/\$1/g,t);n=n.replace(/\$2/g,e.settings.swfLocation),n=n.replace(/\$3/g,+new Date+Math.random());var i=e.wrapper.innerHTML,r=document.createElement("div");r.innerHTML=n+i,e.wrapper.innerHTML=r.innerHTML,e.element=this.helpers.getSwf(t)},helpers:{merge:function(e,t){for(attr in t)(e.hasOwnProperty(attr)||t.hasOwnProperty(attr))&&(e[attr]=t[attr])},clone:function(e){if(null==e||"object"!=typeof e)return e;var t,n=new e.constructor;for(t in e)n[t]=arguments.callee(e[t]);return n},addClass:function(e,t){RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)||(e.className+=" "+t)},removeClass:function(e,t){e.className=e.className.replace(RegExp("(\\s|^)"+t+"(\\s|$)")," ")},injectCss:function(e,t){for(var n="",i=document.getElementsByTagName("style"),r=t.replace(/\$1/g,e.settings.imageLocation),s=0,o=i.length;s<o;s++){var a=i[s].getAttribute("title");if(a&&~a.indexOf("audiojs")){if(o=i[s],o.innerHTML===r)return;n=o.innerHTML;break}}i=document.getElementsByTagName("head")[0],s=i.firstChild,o=document.createElement("style"),i&&(o.setAttribute("type","text/css"),o.setAttribute("title","audiojs"),o.styleSheet?o.styleSheet.cssText=n+r:o.appendChild(document.createTextNode(n+r)),s?i.insertBefore(o,s):i.appendChild(styleElement))},cloneHtml5Node:function(e){var t=document.createDocumentFragment(),n=t.createElement?t:document;return n.createElement("audio"),n=n.createElement("div"),t.appendChild(n),n.innerHTML=e.outerHTML,n.firstChild},getSwf:function(e){return e=document[e]||window[e],e.length>1?e[e.length-1]:e}},events:{memoryLeaking:!1,listeners:[],addListener:function(t,i,r){t.addEventListener?t.addEventListener(i,r,!1):t.attachEvent&&(this.listeners.push(t),this.memoryLeaking||(window.attachEvent("onunload",function(){if(this.listeners)for(var t=0,i=this.listeners.length;t<i;t++)n[e].events.purge(this.listeners[t])}),this.memoryLeaking=!0),t.attachEvent("on"+i,function(){r.call(t,window.event)}))},trackLoadProgress:function(e){if(e.settings.preload){var t,n;e=e;var i=/(ipod|iphone|ipad)/i.test(navigator.userAgent);t=setInterval(function(){e.element.readyState>-1&&(i||e.init.apply(e)),e.element.readyState>1&&(e.settings.autoplay&&e.play.apply(e),clearInterval(t),n=setInterval(function(){e.loadProgress.apply(e),e.loadedPercent>=1&&clearInterval(n)}))},10),e.readyTimer=t,e.loadTimer=n}},purge:function(e){var t,n=e.attributes;if(n)for(t=0;t<n.length;t+=1)"function"==typeof e[n[t].name]&&(e[n[t].name]=null);if(n=e.childNodes)for(t=0;t<n.length;t+=1)purge(e.childNodes[t])},ready:function(){return function(e){var t=window,n=!1,i=!0,r=t.document,s=r.documentElement,o=r.addEventListener?"addEventListener":"attachEvent",a=r.addEventListener?"removeEventListener":"detachEvent",l=r.addEventListener?"":"on",c=function(i){"readystatechange"==i.type&&"complete"!=r.readyState||(("load"==i.type?t:r)[a](l+i.type,c,!1),!n&&(n=!0)&&e.call(t,i.type||i))},u=function(){try{s.doScroll("left")}catch(e){return void setTimeout(u,50)}c("poll")};if("complete"==r.readyState)e.call(t,"lazy");else{if(r.createEventObject&&s.doScroll){try{i=!t.frameElement}catch(d){}i&&u()}r[o](l+"DOMContentLoaded",c,!1),r[o](l+"readystatechange",c,!1),t[o](l+"load",c,!1)}}}()}},n[t]=function(e,t){this.element=e,this.wrapper=e.parentNode,this.source=e.getElementsByTagName("source")[0]||e,this.mp3=function(e){var t=e.getElementsByTagName("source")[0];return e.getAttribute("src")||(t?t.getAttribute("src"):null)}(e),this.settings=t,this.loadStartedCalled=!1,this.loadedPercent=0,this.duration=1,this.playing=!1},n[t].prototype={updatePlayhead:function(){this.settings.updatePlayhead.apply(this,[this.element.currentTime/this.duration])},skipTo:function(e){e>this.loadedPercent||(this.element.currentTime=this.duration*e,this.updatePlayhead())},load:function(t){this.loadStartedCalled=!1,this.source.setAttribute("src",t),this.element.load(),this.mp3=t,n[e].events.trackLoadProgress(this)},loadError:function(){this.settings.loadError.apply(this)},init:function(){this.settings.init.apply(this)},loadStarted:function(){return!!this.element.duration&&(this.duration=this.element.duration,this.updatePlayhead(),void this.settings.loadStarted.apply(this))},loadProgress:function(){null!=this.element.buffered&&this.element.buffered.length&&(this.loadStartedCalled||(this.loadStartedCalled=this.loadStarted()),this.loadedPercent=this.element.buffered.end(this.element.buffered.length-1)/this.duration,this.settings.loadProgress.apply(this,[this.loadedPercent]))},playPause:function(){this.playing?this.pause():this.play()},play:function(){/(ipod|iphone|ipad)/i.test(navigator.userAgent)&&0==this.element.readyState&&this.init.apply(this),this.settings.preload||(this.settings.preload=!0,this.element.setAttribute("preload","auto"),n[e].events.trackLoadProgress(this)),this.playing=!0,this.element.play(),this.settings.play.apply(this)},pause:function(){this.playing=!1,this.element.pause(),this.settings.pause.apply(this)},setVolume:function(e){this.element.volume=e},trackEnded:function(){this.skipTo.apply(this,[0]),this.settings.loop||this.pause.apply(this),this.settings.trackEnded.apply(this)}};var r=function(e,t){var n=[];if(t=t||document,t.getElementsByClassName)n=t.getElementsByClassName(e);else{var i,r,s=t.getElementsByTagName("*"),o=RegExp("(^|\\s)"+e+"(\\s|$)");for(i=0,r=s.length;i<r;i++)o.test(s[i].className)&&n.push(s[i])}return n.length>1?n:n[0]}}("audiojs","audiojsInstance",this),function(){var e=jQuery,t=function(){function e(){this.alwaysShowNavOnTouchDevices=!1,this.fadeDuration=500,this.fitImagesInViewport=!0,this.positionFromTop=50,this.resizeDuration=700,this.showImageNumberLabel=!0,this.wrapAround=!1}return e.prototype.albumLabel=function(e,t){return"Image "+e+" of "+t},e}(),n=function(){function t(e){this.options=e,this.album=[],this.currentImageIndex=void 0,this.init()}return t.prototype.init=function(){this.enable(),this.build()},t.prototype.enable=function(){var t=this;e("body").on("click","a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]",function(n){return t.start(e(n.currentTarget)),!1})},t.prototype.build=function(){var t=this;e('<div id="lightboxOverlay" class="lightboxOverlay"></div><div id="lightbox" class="lightbox"><div class="lb-outerContainer"><div class="lb-container"><img class="lb-image" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" /><div class="lb-nav"><a class="lb-prev" href="" ></a><a class="lb-next" href="" ></a></div><div class="lb-loader"><a class="lb-cancel"></a></div></div></div><div class="lb-dataContainer"><div class="lb-data"><div class="lb-details"><span class="lb-caption"></span><span class="lb-number"></span></div><div class="lb-closeContainer"><a class="lb-close"></a></div></div></div></div>').appendTo(e("body")),this.$lightbox=e("#lightbox"),this.$overlay=e("#lightboxOverlay"),this.$outerContainer=this.$lightbox.find(".lb-outerContainer"),this.$container=this.$lightbox.find(".lb-container"),this.containerTopPadding=parseInt(this.$container.css("padding-top"),10),this.containerRightPadding=parseInt(this.$container.css("padding-right"),10),this.containerBottomPadding=parseInt(this.$container.css("padding-bottom"),10),this.containerLeftPadding=parseInt(this.$container.css("padding-left"),10),this.$overlay.hide().on("click",function(){return t.end(),!1}),this.$lightbox.hide().on("click",function(n){return"lightbox"===e(n.target).attr("id")&&t.end(),!1}),this.$outerContainer.on("click",function(n){return"lightbox"===e(n.target).attr("id")&&t.end(),!1}),this.$lightbox.find(".lb-prev").on("click",function(){return 0===t.currentImageIndex?t.changeImage(t.album.length-1):t.changeImage(t.currentImageIndex-1),!1}),this.$lightbox.find(".lb-next").on("click",function(){return t.currentImageIndex===t.album.length-1?t.changeImage(0):t.changeImage(t.currentImageIndex+1),!1}),this.$lightbox.find(".lb-loader, .lb-close").on("click",function(){return t.end(),!1})},t.prototype.start=function(t){function n(e){i.album.push({link:e.attr("href"),title:e.attr("data-title")||e.attr("title")})}var i=this,r=e(window);r.on("resize",e.proxy(this.sizeOverlay,this)),e("select, object, embed").css({visibility:"hidden"}),this.sizeOverlay(),this.album=[];var s,o=0,a=t.attr("data-lightbox");if(a){s=e(t.prop("tagName")+'[data-lightbox="'+a+'"]');for(var l=0;l<s.length;l=++l)n(e(s[l])),s[l]===t[0]&&(o=l)}else if("lightbox"===t.attr("rel"))n(t);else{s=e(t.prop("tagName")+'[rel="'+t.attr("rel")+'"]');for(var c=0;c<s.length;c=++c)n(e(s[c])),s[c]===t[0]&&(o=c)}var u=r.scrollTop()+this.options.positionFromTop,d=r.scrollLeft();this.$lightbox.css({top:u+"px",left:d+"px"}).fadeIn(this.options.fadeDuration),this.changeImage(o)},t.prototype.changeImage=function(t){var n=this;this.disableKeyboardNav();var i=this.$lightbox.find(".lb-image");this.$overlay.fadeIn(this.options.fadeDuration),e(".lb-loader").fadeIn("slow"),this.$lightbox.find(".lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption").hide(),this.$outerContainer.addClass("animating");var r=new Image;r.onload=function(){var s,o,a,l,c,u,d;i.attr("src",n.album[t].link),s=e(r),i.width(r.width),i.height(r.height),n.options.fitImagesInViewport&&(d=e(window).width(),u=e(window).height(),c=d-n.containerLeftPadding-n.containerRightPadding-20,l=u-n.containerTopPadding-n.containerBottomPadding-120,n.options.maxWidth&&n.options.maxWidth<c&&(c=n.options.maxWidth),n.options.maxHeight&&n.options.maxHeight<c&&(l=n.options.maxHeight),(r.width>c||r.height>l)&&(r.width/c>r.height/l?(a=c,o=parseInt(r.height/(r.width/a),10),i.width(a),i.height(o)):(o=l,a=parseInt(r.width/(r.height/o),10),i.width(a),i.height(o)))),n.sizeContainer(i.width(),i.height())},r.src=this.album[t].link,this.currentImageIndex=t},t.prototype.sizeOverlay=function(){this.$overlay.width(e(window).width()).height(e(document).height())},t.prototype.sizeContainer=function(e,t){function n(){i.$lightbox.find(".lb-dataContainer").width(o),i.$lightbox.find(".lb-prevLink").height(a),i.$lightbox.find(".lb-nextLink").height(a),i.showImage()}var i=this,r=this.$outerContainer.outerWidth(),s=this.$outerContainer.outerHeight(),o=e+this.containerLeftPadding+this.containerRightPadding,a=t+this.containerTopPadding+this.containerBottomPadding;r!==o||s!==a?this.$outerContainer.animate({width:o,height:a},this.options.resizeDuration,"swing",function(){n()}):n()},t.prototype.showImage=function(){this.$lightbox.find(".lb-loader").stop(!0).hide(),this.$lightbox.find(".lb-image").fadeIn("slow"),this.updateNav(),this.updateDetails(),this.preloadNeighboringImages(),this.enableKeyboardNav()},t.prototype.updateNav=function(){var e=!1;try{document.createEvent("TouchEvent"),e=!!this.options.alwaysShowNavOnTouchDevices}catch(t){}this.$lightbox.find(".lb-nav").show(),this.album.length>1&&(this.options.wrapAround?(e&&this.$lightbox.find(".lb-prev, .lb-next").css("opacity","1"),this.$lightbox.find(".lb-prev, .lb-next").show()):(this.currentImageIndex>0&&(this.$lightbox.find(".lb-prev").show(),e&&this.$lightbox.find(".lb-prev").css("opacity","1")),this.currentImageIndex<this.album.length-1&&(this.$lightbox.find(".lb-next").show(),e&&this.$lightbox.find(".lb-next").css("opacity","1"))))},t.prototype.updateDetails=function(){var t=this;if("undefined"!=typeof this.album[this.currentImageIndex].title&&""!==this.album[this.currentImageIndex].title&&this.$lightbox.find(".lb-caption").html(this.album[this.currentImageIndex].title).fadeIn("fast").find("a").on("click",function(t){void 0!==e(this).attr("target")?window.open(e(this).attr("href"),e(this).attr("target")):location.href=e(this).attr("href")}),this.album.length>1&&this.options.showImageNumberLabel){var n=this.options.albumLabel(this.currentImageIndex+1,this.album.length);this.$lightbox.find(".lb-number").text(n).fadeIn("fast")}else this.$lightbox.find(".lb-number").hide();this.$outerContainer.removeClass("animating"),this.$lightbox.find(".lb-dataContainer").fadeIn(this.options.resizeDuration,function(){return t.sizeOverlay()})},t.prototype.preloadNeighboringImages=function(){if(this.album.length>this.currentImageIndex+1){var e=new Image;e.src=this.album[this.currentImageIndex+1].link}if(this.currentImageIndex>0){var t=new Image;t.src=this.album[this.currentImageIndex-1].link}},t.prototype.enableKeyboardNav=function(){e(document).on("keyup.keyboard",e.proxy(this.keyboardAction,this))},t.prototype.disableKeyboardNav=function(){e(document).off(".keyboard")},t.prototype.keyboardAction=function(e){var t=27,n=37,i=39,r=e.keyCode,s=String.fromCharCode(r).toLowerCase();r===t||s.match(/x|o|c/)?this.end():"p"===s||r===n?0!==this.currentImageIndex?this.changeImage(this.currentImageIndex-1):this.options.wrapAround&&this.album.length>1&&this.changeImage(this.album.length-1):("n"===s||r===i)&&(this.currentImageIndex!==this.album.length-1?this.changeImage(this.currentImageIndex+1):this.options.wrapAround&&this.album.length>1&&this.changeImage(0))},t.prototype.end=function(){this.disableKeyboardNav(),e(window).off("resize",this.sizeOverlay),this.$lightbox.fadeOut(this.options.fadeDuration),this.$overlay.fadeOut(this.options.fadeDuration),e("select, object, embed").css({visibility:"visible"})},t}();e(function(){var e=new t;new n(e)})}.call(this),!function(e,t){var n,i={},r=function(e,t){var n,i,r;if("string"==typeof e)return a(e);for(n=[],i=e.length,r=0;i>r;r++)n.push(a(e[r]));return t.apply(null,n)},s=function(e,t,n){2===arguments.length&&(n=t,t=null),r(t||[],function(){o(e,n,arguments)})},o=function(e,t,n){var s,o={exports:t};"function"==typeof t&&(n.length||(n=[r,o.exports,o]),s=t.apply(null,n),void 0!==s&&(o.exports=s)),i[e]=o.exports},a=function(t){var n=i[t]||e[t];if(!n)throw new Error("`"+t+"` is undefined");return n},l=function(e){var t,n,r,s,o,a;a=function(e){return e&&e.charAt(0).toUpperCase()+e.substr(1)};for(t in i)if(n=e,i.hasOwnProperty(t)){for(r=t.split("/"),o=a(r.pop());s=a(r.shift());)n[s]=n[s]||{},n=n[s];n[o]=i[t]}return e},c=function(n){return e.__dollar=n,l(t(e,s,r))};"object"==typeof module&&"object"==typeof module.exports?module.exports=c():"function"==typeof define&&define.amd?define(["jquery"],c):(n=e.WebUploader,e.WebUploader=c(),e.WebUploader.noConflict=function(){e.WebUploader=n})}(window,function(e,t,n){return t("dollar-third",[],function(){var t=e.__dollar||e.jQuery||e.Zepto;if(!t)throw new Error("jQuery or Zepto not found!");return t}),t("dollar",["dollar-third"],function(e){
return e}),t("promise-third",["dollar"],function(e){return{Deferred:e.Deferred,when:e.when,isPromise:function(e){return e&&"function"==typeof e.then}}}),t("promise",["promise-third"],function(e){return e}),t("base",["dollar","promise"],function(t,n){function i(e){return function(){return a.apply(e,arguments)}}function r(e,t){return function(){return e.apply(t,arguments)}}function s(e){var t;return Object.create?Object.create(e):(t=function(){},t.prototype=e,new t)}var o=function(){},a=Function.call;return{version:"0.1.5",$:t,Deferred:n.Deferred,isPromise:n.isPromise,when:n.when,browser:function(e){var t={},n=e.match(/WebKit\/([\d.]+)/),i=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),r=e.match(/MSIE\s([\d\.]+)/)||e.match(/(?:trident)(?:.*rv:([\w.]+))?/i),s=e.match(/Firefox\/([\d.]+)/),o=e.match(/Safari\/([\d.]+)/),a=e.match(/OPR\/([\d.]+)/);return n&&(t.webkit=parseFloat(n[1])),i&&(t.chrome=parseFloat(i[1])),r&&(t.ie=parseFloat(r[1])),s&&(t.firefox=parseFloat(s[1])),o&&(t.safari=parseFloat(o[1])),a&&(t.opera=parseFloat(a[1])),t}(navigator.userAgent),os:function(e){var t={},n=e.match(/(?:Android);?[\s\/]+([\d.]+)?/),i=e.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);return n&&(t.android=parseFloat(n[1])),i&&(t.ios=parseFloat(i[1].replace(/_/g,"."))),t}(navigator.userAgent),inherits:function(e,n,i){var r;return"function"==typeof n?(r=n,n=null):r=n&&n.hasOwnProperty("constructor")?n.constructor:function(){return e.apply(this,arguments)},t.extend(!0,r,e,i||{}),r.__super__=e.prototype,r.prototype=s(e.prototype),n&&t.extend(!0,r.prototype,n),r},noop:o,bindFn:r,log:function(){return e.console?r(console.log,console):o}(),nextTick:function(){return function(e){setTimeout(e,1)}}(),slice:i([].slice),guid:function(){var e=0;return function(t){for(var n=(+new Date).toString(32),i=0;5>i;i++)n+=Math.floor(65535*Math.random()).toString(32);return(t||"wu_")+n+(e++).toString(32)}}(),formatSize:function(e,t,n){var i;for(n=n||["B","K","M","G","TB"];(i=n.shift())&&e>1024;)e/=1024;return("B"===i?e:e.toFixed(t||2))+i}}}),t("mediator",["base"],function(e){function t(e,t,n,i){return s.grep(e,function(e){return!(!e||t&&e.e!==t||n&&e.cb!==n&&e.cb._cb!==n||i&&e.ctx!==i)})}function n(e,t,n){s.each((e||"").split(a),function(e,i){n(i,t)})}function i(e,t){for(var n,i=!1,r=-1,s=e.length;++r<s;)if(n=e[r],n.cb.apply(n.ctx2,t)===!1){i=!0;break}return!i}var r,s=e.$,o=[].slice,a=/\s+/;return r={on:function(e,t,i){var r,s=this;return t?(r=this._events||(this._events=[]),n(e,t,function(e,t){var n={e:e};n.cb=t,n.ctx=i,n.ctx2=i||s,n.id=r.length,r.push(n)}),this):this},once:function(e,t,i){var r=this;return t?(n(e,t,function(e,t){var n=function(){return r.off(e,n),t.apply(i||r,arguments)};n._cb=t,r.on(e,n,i)}),r):r},off:function(e,i,r){var o=this._events;return o?e||i||r?(n(e,i,function(e,n){s.each(t(o,e,n,r),function(){delete o[this.id]})}),this):(this._events=[],this):this},trigger:function(e){var n,r,s;return this._events&&e?(n=o.call(arguments,1),r=t(this._events,e),s=t(this._events,"all"),i(r,n)&&i(s,arguments)):this}},s.extend({installTo:function(e){return s.extend(e,r)}},r)}),t("uploader",["base","mediator"],function(e,t){function n(e){this.options=i.extend(!0,{},n.options,e),this._init(this.options)}var i=e.$;return n.options={},t.installTo(n.prototype),i.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",cancelFile:"cancel-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",md5File:"md5-file",getDimension:"get-dimension",addButton:"add-btn",predictRuntimeType:"predict-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(e,t){n.prototype[e]=function(){return this.request(t,arguments)}}),i.extend(n.prototype,{state:"pending",_init:function(e){var t=this;t.request("init",e,function(){t.state="ready",t.trigger("ready")})},option:function(e,t){var n=this.options;return arguments.length>1?void(i.isPlainObject(t)&&i.isPlainObject(n[e])?i.extend(n[e],t):n[e]=t):e?n[e]:n},getStats:function(){var e=this.request("get-stats");return e?{successNum:e.numOfSuccess,progressNum:e.numOfProgress,cancelNum:e.numOfCancel,invalidNum:e.numOfInvalid,uploadFailNum:e.numOfUploadFailed,queueNum:e.numOfQueue,interruptNum:e.numofInterrupt}:{}},trigger:function(e){var n=[].slice.call(arguments,1),r=this.options,s="on"+e.substring(0,1).toUpperCase()+e.substring(1);return!(t.trigger.apply(this,arguments)===!1||i.isFunction(r[s])&&r[s].apply(this,n)===!1||i.isFunction(this[s])&&this[s].apply(this,n)===!1||t.trigger.apply(t,[this,e].concat(n))===!1)},destroy:function(){this.request("destroy",arguments),this.off()},request:e.noop}),e.create=n.create=function(e){return new n(e)},e.Uploader=n,n}),t("runtime/runtime",["base","mediator"],function(e,t){function n(t){this.options=i.extend({container:document.body},t),this.uid=e.guid("rt_")}var i=e.$,r={},s=function(e){for(var t in e)if(e.hasOwnProperty(t))return t;return null};return i.extend(n.prototype,{getContainer:function(){var e,t,n=this.options;return this._container?this._container:(e=i(n.container||document.body),t=i(document.createElement("div")),t.attr("id","rt_"+this.uid),t.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),e.append(t),e.addClass("webuploader-container"),this._container=t,this._parent=e,t)},init:e.noop,exec:e.noop,destroy:function(){this._container&&this._container.remove(),this._parent&&this._parent.removeClass("webuploader-container"),this.off()}}),n.orders="html5,flash",n.addRuntime=function(e,t){r[e]=t},n.hasRuntime=function(e){return!!(e?r[e]:s(r))},n.create=function(e,t){var o,a;if(t=t||n.orders,i.each(t.split(/\s*,\s*/g),function(){return r[this]?(o=this,!1):void 0}),o=o||s(r),!o)throw new Error("Runtime Error");return a=new r[o](e)},t.installTo(n.prototype),n}),t("runtime/client",["base","mediator","runtime/runtime"],function(e,t,n){function i(t,i){var s,o=e.Deferred();this.uid=e.guid("client_"),this.runtimeReady=function(e){return o.done(e)},this.connectRuntime=function(t,a){if(s)throw new Error("already connected!");return o.done(a),"string"==typeof t&&r.get(t)&&(s=r.get(t)),s=s||r.get(null,i),s?(e.$.extend(s.options,t),s.__promise.then(o.resolve),s.__client++):(s=n.create(t,t.runtimeOrder),s.__promise=o.promise(),s.once("ready",o.resolve),s.init(),r.add(s),s.__client=1),i&&(s.__standalone=i),s},this.getRuntime=function(){return s},this.disconnectRuntime=function(){s&&(s.__client--,s.__client<=0&&(r.remove(s),delete s.__promise,s.destroy()),s=null)},this.exec=function(){if(s){var n=e.slice(arguments);return t&&n.unshift(t),s.exec.apply(this,n)}},this.getRuid=function(){return s&&s.uid},this.destroy=function(e){return function(){e&&e.apply(this,arguments),this.trigger("destroy"),this.off(),this.exec("destroy"),this.disconnectRuntime()}}(this.destroy)}var r;return r=function(){var e={};return{add:function(t){e[t.uid]=t},get:function(t,n){var i;if(t)return e[t];for(i in e)if(!n||!e[i].__standalone)return e[i];return null},remove:function(t){delete e[t.uid]}}}(),t.installTo(i.prototype),i}),t("lib/dnd",["base","mediator","runtime/client"],function(e,t,n){function i(e){e=this.options=r.extend({},i.options,e),e.container=r(e.container),e.container.length&&n.call(this,"DragAndDrop")}var r=e.$;return i.options={accept:null,disableGlobalDnd:!1},e.inherits(n,{constructor:i,init:function(){var e=this;e.connectRuntime(e.options,function(){e.exec("init"),e.trigger("ready")})}}),t.installTo(i.prototype),i}),t("widgets/widget",["base","uploader"],function(e,t){function n(e){if(!e)return!1;var t=e.length,n=r.type(e);return!(1!==e.nodeType||!t)||("array"===n||"function"!==n&&"string"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e))}function i(e){this.owner=e,this.options=e.options}var r=e.$,s=t.prototype._init,o=t.prototype.destroy,a={},l=[];return r.extend(i.prototype,{init:e.noop,invoke:function(e,t){var n=this.responseMap;return n&&e in n&&n[e]in this&&r.isFunction(this[n[e]])?this[n[e]].apply(this,t):a},request:function(){return this.owner.request.apply(this.owner,arguments)}}),r.extend(t.prototype,{_init:function(){var e=this,t=e._widgets=[],n=e.options.disableWidgets||"";return r.each(l,function(i,r){(!n||!~n.indexOf(r._name))&&t.push(new r(e))}),s.apply(e,arguments)},request:function(t,i,r){var s,o,l,c,u=0,d=this._widgets,p=d&&d.length,h=[],f=[];for(i=n(i)?i:[i];p>u;u++)s=d[u],o=s.invoke(t,i),o!==a&&(e.isPromise(o)?f.push(o):h.push(o));return r||f.length?(l=e.when.apply(e,f),c=l.pipe?"pipe":"then",l[c](function(){var t=e.Deferred(),n=arguments;return 1===n.length&&(n=n[0]),setTimeout(function(){t.resolve(n)},1),t.promise()})[r?c:"done"](r||e.noop)):h[0]},destroy:function(){o.apply(this,arguments),this._widgets=null}}),t.register=i.register=function(t,n){var s,o={init:"init",destroy:"destroy",name:"anonymous"};return 1===arguments.length?(n=t,r.each(n,function(e){return"_"===e[0]||"name"===e?void("name"===e&&(o.name=n.name)):void(o[e.replace(/[A-Z]/g,"-$&").toLowerCase()]=e)})):o=r.extend(o,t),n.responseMap=o,s=e.inherits(i,n),s._name=o.name,l.push(s),s},t.unRegister=i.unRegister=function(e){if(e&&"anonymous"!==e)for(var t=l.length;t--;)l[t]._name===e&&l.splice(t,1)},i}),t("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(e,t,n){var i=e.$;return t.options.dnd="",t.register({name:"dnd",init:function(t){if(t.dnd&&"html5"===this.request("predict-runtime-type")){var r,s=this,o=e.Deferred(),a=i.extend({},{disableGlobalDnd:t.disableGlobalDnd,container:t.dnd,accept:t.accept});return this.dnd=r=new n(a),r.once("ready",o.resolve),r.on("drop",function(e){s.request("add-file",[e])}),r.on("accept",function(e){return s.owner.trigger("dndAccept",e)}),r.init(),o.promise()}},destroy:function(){this.dnd&&this.dnd.destroy()}})}),t("lib/filepaste",["base","mediator","runtime/client"],function(e,t,n){function i(e){e=this.options=r.extend({},e),e.container=r(e.container||document.body),n.call(this,"FilePaste")}var r=e.$;return e.inherits(n,{constructor:i,init:function(){var e=this;e.connectRuntime(e.options,function(){e.exec("init"),e.trigger("ready")})}}),t.installTo(i.prototype),i}),t("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(e,t,n){var i=e.$;return t.register({name:"paste",init:function(t){if(t.paste&&"html5"===this.request("predict-runtime-type")){var r,s=this,o=e.Deferred(),a=i.extend({},{container:t.paste,accept:t.accept});return this.paste=r=new n(a),r.once("ready",o.resolve),r.on("paste",function(e){s.owner.request("add-file",[e])}),r.init(),o.promise()}},destroy:function(){this.paste&&this.paste.destroy()}})}),t("lib/blob",["base","runtime/client"],function(e,t){function n(e,n){var i=this;i.source=n,i.ruid=e,this.size=n.size||0,this.type=!n.type&&this.ext&&~"jpg,jpeg,png,gif,bmp".indexOf(this.ext)?"image/"+("jpg"===this.ext?"jpeg":this.ext):n.type||"application/octet-stream",t.call(i,"Blob"),this.uid=n.uid||this.uid,e&&i.connectRuntime(e)}return e.inherits(t,{constructor:n,slice:function(e,t){return this.exec("slice",e,t)},getSource:function(){return this.source}}),n}),t("lib/file",["base","lib/blob"],function(e,t){function n(e,n){var s;this.name=n.name||"untitled"+i++,s=r.exec(n.name)?RegExp.$1.toLowerCase():"",!s&&n.type&&(s=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(n.type)?RegExp.$1.toLowerCase():"",this.name+="."+s),this.ext=s,this.lastModifiedDate=n.lastModifiedDate||(new Date).toLocaleString(),t.apply(this,arguments)}var i=1,r=/\.([^.]+)$/;return e.inherits(t,n)}),t("lib/filepicker",["base","runtime/client","lib/file"],function(t,n,i){function r(e){if(e=this.options=s.extend({},r.options,e),e.container=s(e.id),!e.container.length)throw new Error("按钮指定错误");e.innerHTML=e.innerHTML||e.label||e.container.html()||"",e.button=s(e.button||document.createElement("div")),e.button.html(e.innerHTML),e.container.html(e.button),n.call(this,"FilePicker",!0)}var s=t.$;return r.options={button:null,container:null,label:null,innerHTML:null,multiple:!0,accept:null,name:"file"},t.inherits(n,{constructor:r,init:function(){var n=this,r=n.options,o=r.button;o.addClass("webuploader-pick"),n.on("all",function(e){var t;switch(e){case"mouseenter":o.addClass("webuploader-pick-hover");break;case"mouseleave":o.removeClass("webuploader-pick-hover");break;case"change":t=n.exec("getFiles"),n.trigger("select",s.map(t,function(e){return e=new i(n.getRuid(),e),e._refer=r.container,e}),r.container)}}),n.connectRuntime(r,function(){n.refresh(),n.exec("init",r),n.trigger("ready")}),this._resizeHandler=t.bindFn(this.refresh,this),s(e).on("resize",this._resizeHandler)},refresh:function(){var e=this.getRuntime().getContainer(),t=this.options.button,n=t.outerWidth?t.outerWidth():t.width(),i=t.outerHeight?t.outerHeight():t.height(),r=t.offset();n&&i&&e.css({bottom:"auto",right:"auto",width:n+"px",height:i+"px"}).offset(r)},enable:function(){var e=this.options.button;e.removeClass("webuploader-pick-disable"),this.refresh()},disable:function(){var e=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"}),e.addClass("webuploader-pick-disable")},destroy:function(){var t=this.options.button;s(e).off("resize",this._resizeHandler),t.removeClass("webuploader-pick-disable webuploader-pick-hover webuploader-pick")}}),r}),t("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(e,t,n){var i=e.$;return i.extend(t.options,{pick:null,accept:null}),t.register({name:"picker",init:function(e){return this.pickers=[],e.pick&&this.addBtn(e.pick)},refresh:function(){i.each(this.pickers,function(){this.refresh()})},addBtn:function(t){var r=this,s=r.options,o=s.accept,a=[];if(t)return i.isPlainObject(t)||(t={id:t}),i(t.id).each(function(){var l,c,u;u=e.Deferred(),l=i.extend({},t,{accept:i.isPlainObject(o)?[o]:o,swf:s.swf,runtimeOrder:s.runtimeOrder,id:this}),c=new n(l),c.once("ready",u.resolve),c.on("select",function(e){r.owner.request("add-file",[e])}),c.init(),r.pickers.push(c),a.push(u.promise())}),e.when.apply(e,a)},disable:function(){i.each(this.pickers,function(){this.disable()})},enable:function(){i.each(this.pickers,function(){this.enable()})},destroy:function(){i.each(this.pickers,function(){this.destroy()}),this.pickers=null}})}),t("lib/image",["base","runtime/client","lib/blob"],function(e,t,n){function i(e){this.options=r.extend({},i.options,e),t.call(this,"Image"),this.on("load",function(){this._info=this.exec("info"),this._meta=this.exec("meta")})}var r=e.$;return i.options={quality:90,crop:!1,preserveHeaders:!1,allowMagnify:!1},e.inherits(t,{constructor:i,info:function(e){return e?(this._info=e,this):this._info},meta:function(e){return e?(this._meta=e,this):this._meta},loadFromBlob:function(e){var t=this,n=e.getRuid();this.connectRuntime(n,function(){t.exec("init",t.options),t.exec("loadFromBlob",e)})},resize:function(){var t=e.slice(arguments);return this.exec.apply(this,["resize"].concat(t))},crop:function(){var t=e.slice(arguments);return this.exec.apply(this,["crop"].concat(t))},getAsDataUrl:function(e){return this.exec("getAsDataUrl",e)},getAsBlob:function(e){var t=this.exec("getAsBlob",e);return new n(this.getRuid(),t)}}),i}),t("widgets/image",["base","uploader","lib/image","widgets/widget"],function(e,t,n){var i,r=e.$;return i=function(e){var t=0,n=[],i=function(){for(var i;n.length&&e>t;)i=n.shift(),t+=i[0],i[1]()};return function(e,r,s){n.push([r,s]),e.once("destroy",function(){t-=r,setTimeout(i,1)}),setTimeout(i,1)}}(5242880),r.extend(t.options,{thumb:{width:110,height:110,quality:70,allowMagnify:!0,crop:!0,preserveHeaders:!1,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0}}),t.register({name:"image",makeThumb:function(e,t,s,o){var a,l;return e=this.request("get-file",e),e.type.match(/^image/)?(a=r.extend({},this.options.thumb),r.isPlainObject(s)&&(a=r.extend(a,s),s=null),s=s||a.width,o=o||a.height,l=new n(a),l.once("load",function(){e._info=e._info||l.info(),e._meta=e._meta||l.meta(),1>=s&&s>0&&(s=e._info.width*s),1>=o&&o>0&&(o=e._info.height*o),l.resize(s,o)}),l.once("complete",function(){t(!1,l.getAsDataUrl(a.type)),l.destroy()}),l.once("error",function(e){t(e||!0),l.destroy()}),void i(l,e.source.size,function(){e._info&&l.info(e._info),e._meta&&l.meta(e._meta),l.loadFromBlob(e.source)})):void t(!0)},beforeSendFile:function(t){var i,s,o=this.options.compress||this.options.resize,a=o&&o.compressSize||0,l=o&&o.noCompressIfLarger||!1;return t=this.request("get-file",t),!o||!~"image/jpeg,image/jpg".indexOf(t.type)||t.size<a||t._compressed?void 0:(o=r.extend({},o),s=e.Deferred(),i=new n(o),s.always(function(){i.destroy(),i=null}),i.once("error",s.reject),i.once("load",function(){var e=o.width,n=o.height;t._info=t._info||i.info(),t._meta=t._meta||i.meta(),1>=e&&e>0&&(e=t._info.width*e),1>=n&&n>0&&(n=t._info.height*n),i.resize(e,n)}),i.once("complete",function(){var e,n;try{e=i.getAsBlob(o.type),n=t.size,(!l||e.size<n)&&(t.source=e,t.size=e.size,t.trigger("resize",e.size,n)),t._compressed=!0,s.resolve()}catch(r){s.resolve()}}),t._info&&i.info(t._info),t._meta&&i.meta(t._meta),i.loadFromBlob(t.source),s.promise())}})}),t("file",["base","mediator"],function(e,t){function n(){return s+o++}function i(e){this.name=e.name||"Untitled",this.size=e.size||0,this.type=e.type||"application/octet-stream",this.lastModifiedDate=e.lastModifiedDate||1*new Date,this.id=n(),this.ext=a.exec(this.name)?RegExp.$1:"",this.statusText="",l[this.id]=i.Status.INITED,this.source=e,this.loaded=0,this.on("error",function(e){this.setStatus(i.Status.ERROR,e)})}var r=e.$,s="WU_FILE_",o=0,a=/\.([^.]+)$/,l={};return r.extend(i.prototype,{setStatus:function(e,t){var n=l[this.id];"undefined"!=typeof t&&(this.statusText=t),e!==n&&(l[this.id]=e,this.trigger("statuschange",e,n))},getStatus:function(){return l[this.id]},getSource:function(){return this.source},destroy:function(){this.off(),delete l[this.id]}}),t.installTo(i.prototype),i.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"},i}),t("queue",["base","mediator","file"],function(e,t,n){function i(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0,numofDeleted:0,numofInterrupt:0},this._queue=[],this._map={}}var r=e.$,s=n.Status;return r.extend(i.prototype,{append:function(e){return this._queue.push(e),this._fileAdded(e),this},prepend:function(e){return this._queue.unshift(e),this._fileAdded(e),this},getFile:function(e){return"string"!=typeof e?e:this._map[e]},fetch:function(e){var t,n,i=this._queue.length;for(e=e||s.QUEUED,t=0;i>t;t++)if(n=this._queue[t],e===n.getStatus())return n;return null},sort:function(e){"function"==typeof e&&this._queue.sort(e)},getFiles:function(){for(var e,t=[].slice.call(arguments,0),n=[],i=0,s=this._queue.length;s>i;i++)e=this._queue[i],(!t.length||~r.inArray(e.getStatus(),t))&&n.push(e);return n},removeFile:function(e){var t=this._map[e.id];t&&(delete this._map[e.id],e.destroy(),this.stats.numofDeleted++)},_fileAdded:function(e){var t=this,n=this._map[e.id];n||(this._map[e.id]=e,e.on("statuschange",function(e,n){t._onFileStatusChange(e,n)}))},_onFileStatusChange:function(e,t){var n=this.stats;switch(t){case s.PROGRESS:n.numOfProgress--;break;case s.QUEUED:n.numOfQueue--;break;case s.ERROR:n.numOfUploadFailed--;break;case s.INVALID:n.numOfInvalid--;break;case s.INTERRUPT:n.numofInterrupt--}switch(e){case s.QUEUED:n.numOfQueue++;break;case s.PROGRESS:n.numOfProgress++;break;case s.ERROR:n.numOfUploadFailed++;break;case s.COMPLETE:n.numOfSuccess++;break;case s.CANCELLED:n.numOfCancel++;break;case s.INVALID:n.numOfInvalid++;break;case s.INTERRUPT:n.numofInterrupt++}}}),t.installTo(i.prototype),i}),t("widgets/queue",["base","uploader","queue","file","lib/file","runtime/client","widgets/widget"],function(e,t,n,i,r,s){var o=e.$,a=/\.\w+$/,l=i.Status;return t.register({name:"queue",init:function(t){var i,r,a,l,c,u,d,p=this;if(o.isPlainObject(t.accept)&&(t.accept=[t.accept]),t.accept){for(c=[],a=0,r=t.accept.length;r>a;a++)l=t.accept[a].extensions,l&&c.push(l);c.length&&(u="\\."+c.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"),p.accept=new RegExp(u,"i")}return p.queue=new n,p.stats=p.queue.stats,"html5"===this.request("predict-runtime-type")?(i=e.Deferred(),this.placeholder=d=new s("Placeholder"),d.connectRuntime({runtimeOrder:"html5"},function(){p._ruid=d.getRuid(),i.resolve()}),i.promise()):void 0},_wrapFile:function(e){if(!(e instanceof i)){if(!(e instanceof r)){if(!this._ruid)throw new Error("Can't add external files.");e=new r(this._ruid,e)}e=new i(e)}return e},acceptFile:function(e){var t=!e||!e.size||this.accept&&a.exec(e.name)&&!this.accept.test(e.name);return!t},_addFile:function(e){var t=this;return e=t._wrapFile(e),t.owner.trigger("beforeFileQueued",e)?t.acceptFile(e)?(t.queue.append(e),t.owner.trigger("fileQueued",e),e):void t.owner.trigger("error","Q_TYPE_DENIED",e):void 0},getFile:function(e){return this.queue.getFile(e)},addFile:function(e){var t=this;e.length||(e=[e]),e=o.map(e,function(e){return t._addFile(e)}),t.owner.trigger("filesQueued",e),t.options.auto&&setTimeout(function(){t.request("start-upload")},20)},getStats:function(){return this.stats},removeFile:function(e,t){var n=this;e=e.id?e:n.queue.getFile(e),this.request("cancel-file",e),t&&this.queue.removeFile(e)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(e,t){var n,i,r,s=this;if(e)return e=e.id?e:s.queue.getFile(e),e.setStatus(l.QUEUED),void(t||s.request("start-upload"));for(n=s.queue.getFiles(l.ERROR),i=0,r=n.length;r>i;i++)e=n[i],e.setStatus(l.QUEUED);s.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.owner.trigger("reset"),this.queue=new n,this.stats=this.queue.stats},destroy:function(){this.reset(),this.placeholder&&this.placeholder.destroy()}})}),t("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(e,t){return e.support=function(){return t.hasRuntime.apply(t,arguments)},e.register({name:"runtime",init:function(){if(!this.predictRuntimeType())throw Error("Runtime Error")},predictRuntimeType:function(){var e,n,i=this.options.runtimeOrder||t.orders,r=this.type;if(!r)for(i=i.split(/\s*,\s*/g),e=0,n=i.length;n>e;e++)if(t.hasRuntime(i[e])){this.type=r=i[e];break}return r}})}),t("lib/transport",["base","runtime/client","mediator"],function(e,t,n){function i(e){var n=this;e=n.options=r.extend(!0,{},i.options,e||{}),t.call(this,"Transport"),this._blob=null,this._formData=e.formData||{},this._headers=e.headers||{},this.on("progress",this._timeout),this.on("load error",function(){n.trigger("progress",1),clearTimeout(n._timer)})}var r=e.$;return i.options={server:"",method:"POST",withCredentials:!1,fileVal:"file",timeout:12e4,formData:{},headers:{},sendAsBinary:!1},r.extend(i.prototype,{appendBlob:function(e,t,n){var i=this,r=i.options;i.getRuid()&&i.disconnectRuntime(),i.connectRuntime(t.ruid,function(){i.exec("init")}),i._blob=t,r.fileVal=e||r.fileVal,r.filename=n||r.filename},append:function(e,t){"object"==typeof e?r.extend(this._formData,e):this._formData[e]=t},setRequestHeader:function(e,t){"object"==typeof e?r.extend(this._headers,e):this._headers[e]=t},send:function(e){this.exec("send",e),this._timeout()},abort:function(){return clearTimeout(this._timer),this.exec("abort")},destroy:function(){this.trigger("destroy"),this.off(),this.exec("destroy"),this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var e=this,t=e.options.timeout;t&&(clearTimeout(e._timer),e._timer=setTimeout(function(){e.abort(),e.trigger("error","timeout")},t))}}),n.installTo(i.prototype),i}),t("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(e,t,n,i){function r(e,t){var n,i,r=[],s=e.source,o=s.size,a=t?Math.ceil(o/t):1,l=0,c=0;for(i={file:e,has:function(){return!!r.length},shift:function(){return r.shift()},unshift:function(e){r.unshift(e)}};a>c;)n=Math.min(t,o-l),r.push({file:e,start:l,end:t?l+n:o,total:o,chunks:a,chunk:c++,cuted:i}),l+=n;return e.blocks=r.concat(),e.remaning=r.length,i}var s=e.$,o=e.isPromise,a=n.Status;s.extend(t.options,{prepareNextFile:!1,chunked:!1,chunkSize:5242880,chunkRetry:2,threads:3,formData:{}}),t.register({name:"upload",init:function(){var t=this.owner,n=this;this.runing=!1,this.progress=!1,t.on("startUpload",function(){n.progress=!0}).on("uploadFinished",function(){n.progress=!1}),this.pool=[],this.stack=[],this.pending=[],this.remaning=0,this.__tick=e.bindFn(this._tick,this),t.on("uploadComplete",function(e){e.blocks&&s.each(e.blocks,function(e,t){t.transport&&(t.transport.abort(),t.transport.destroy()),delete t.transport}),delete e.blocks,delete e.remaning})},reset:function(){this.request("stop-upload",!0),this.runing=!1,this.pool=[],this.stack=[],this.pending=[],this.remaning=0,this._trigged=!1,this._promise=null},startUpload:function(t){var n=this;if(s.each(n.request("get-files",a.INVALID),function(){n.request("remove-file",this)}),t)if(t=t.id?t:n.request("get-file",t),t.getStatus()===a.INTERRUPT)s.each(n.pool,function(e,n){n.file===t&&n.transport&&n.transport.send()}),t.setStatus(a.QUEUED);else{if(t.getStatus()===a.PROGRESS)return;t.setStatus(a.QUEUED)}else s.each(n.request("get-files",[a.INITED]),function(){this.setStatus(a.QUEUED)});if(!n.runing){n.runing=!0;var i=[];s.each(n.pool,function(e,t){var r=t.file;r.getStatus()===a.INTERRUPT&&(i.push(r),n._trigged=!1,t.transport&&t.transport.send())});for(var t;t=i.shift();)t.setStatus(a.PROGRESS);t||s.each(n.request("get-files",a.INTERRUPT),function(){this.setStatus(a.PROGRESS)}),n._trigged=!1,e.nextTick(n.__tick),n.owner.trigger("startUpload")}},stopUpload:function(t,n){var i=this;if(t===!0&&(n=t,t=null),i.runing!==!1){if(t){if(t=t.id?t:i.request("get-file",t),t.getStatus()!==a.PROGRESS&&t.getStatus()!==a.QUEUED)return;return t.setStatus(a.INTERRUPT),s.each(i.pool,function(e,n){n.file===t&&(n.transport&&n.transport.abort(),i._putback(n),i._popBlock(n))}),e.nextTick(i.__tick)}i.runing=!1,this._promise&&this._promise.file&&this._promise.file.setStatus(a.INTERRUPT),n&&s.each(i.pool,function(e,t){t.transport&&t.transport.abort(),t.file.setStatus(a.INTERRUPT)}),i.owner.trigger("stopUpload")}},cancelFile:function(e){e=e.id?e:this.request("get-file",e),e.blocks&&s.each(e.blocks,function(e,t){var n=t.transport;n&&(n.abort(),n.destroy(),delete t.transport)}),e.setStatus(a.CANCELLED),this.owner.trigger("fileDequeued",e)},isInProgress:function(){return!!this.progress},_getStats:function(){return this.request("get-stats")},skipFile:function(e,t){e=e.id?e:this.request("get-file",e),e.setStatus(t||a.COMPLETE),e.skipped=!0,e.blocks&&s.each(e.blocks,function(e,t){var n=t.transport;n&&(n.abort(),n.destroy(),delete t.transport)}),this.owner.trigger("uploadSkip",e)},_tick:function(){var t,n,i=this,r=i.options;return i._promise?i._promise.always(i.__tick):void(i.pool.length<r.threads&&(n=i._nextBlock())?(i._trigged=!1,t=function(t){i._promise=null,t&&t.file&&i._startSend(t),e.nextTick(i.__tick)},i._promise=o(n)?n.always(t):t(n)):i.remaning||i._getStats().numOfQueue||i._getStats().numofInterrupt||(i.runing=!1,i._trigged||e.nextTick(function(){i.owner.trigger("uploadFinished")}),i._trigged=!0))},_putback:function(e){var t;e.cuted.unshift(e),t=this.stack.indexOf(e.cuted),~t||this.stack.unshift(e.cuted)},_getStack:function(){for(var e,t=0;e=this.stack[t++];){if(e.has()&&e.file.getStatus()===a.PROGRESS)return e;(!e.has()||e.file.getStatus()!==a.PROGRESS&&e.file.getStatus()!==a.INTERRUPT)&&this.stack.splice(--t,1)}return null},_nextBlock:function(){var e,t,n,i,s=this,a=s.options;return(e=this._getStack())?(a.prepareNextFile&&!s.pending.length&&s._prepareNextFile(),e.shift()):s.runing?(!s.pending.length&&s._getStats().numOfQueue&&s._prepareNextFile(),t=s.pending.shift(),n=function(t){return t?(e=r(t,a.chunked?a.chunkSize:0),s.stack.push(e),e.shift()):null},o(t)?(i=t.file,t=t[t.pipe?"pipe":"then"](n),t.file=i,t):n(t)):void 0},_prepareNextFile:function(){var e,t=this,n=t.request("fetch-file"),i=t.pending;n&&(e=t.request("before-send-file",n,function(){return n.getStatus()===a.PROGRESS||n.getStatus()===a.INTERRUPT?n:t._finishFile(n)}),t.owner.trigger("uploadStart",n),n.setStatus(a.PROGRESS),e.file=n,e.done(function(){var t=s.inArray(e,i);~t&&i.splice(t,1,n)}),e.fail(function(e){n.setStatus(a.ERROR,e),t.owner.trigger("uploadError",n,e),t.owner.trigger("uploadComplete",n)}),i.push(e))},_popBlock:function(e){var t=s.inArray(e,this.pool);this.pool.splice(t,1),e.file.remaning--,this.remaning--},_startSend:function(t){var n,i=this,r=t.file;return r.getStatus()!==a.PROGRESS?void(r.getStatus()===a.INTERRUPT&&i._putback(t)):(i.pool.push(t),i.remaning++,t.blob=1===t.chunks?r.source:r.source.slice(t.start,t.end),n=i.request("before-send",t,function(){r.getStatus()===a.PROGRESS?i._doSend(t):(i._popBlock(t),e.nextTick(i.__tick))}),void n.fail(function(){1===r.remaning?i._finishFile(r).always(function(){t.percentage=1,i._popBlock(t),i.owner.trigger("uploadComplete",r),e.nextTick(i.__tick)}):(t.percentage=1,i.updateFileProgress(r),i._popBlock(t),e.nextTick(i.__tick))}))},_doSend:function(t){var n,r,o=this,l=o.owner,c=o.options,u=t.file,d=new i(c),p=s.extend({},c.formData),h=s.extend({},c.headers);t.transport=d,d.on("destroy",function(){delete t.transport,o._popBlock(t),e.nextTick(o.__tick)}),d.on("progress",function(e){t.percentage=e,o.updateFileProgress(u)}),n=function(e){var n;return r=d.getResponseAsJson()||{},r._raw=d.getResponse(),n=function(t){e=t},l.trigger("uploadAccept",t,r,n)||(e=e||"server"),e},d.on("error",function(e,i){t.retried=t.retried||0,t.chunks>1&&~"http,abort".indexOf(e)&&t.retried<c.chunkRetry?(t.retried++,d.send()):(i||"server"!==e||(e=n(e)),u.setStatus(a.ERROR,e),l.trigger("uploadError",u,e),l.trigger("uploadComplete",u))}),d.on("load",function(){var e;return(e=n())?void d.trigger("error",e,!0):void(1===u.remaning?o._finishFile(u,r):d.destroy())}),p=s.extend(p,{id:u.id,name:u.name,type:u.type,lastModifiedDate:u.lastModifiedDate,size:u.size}),t.chunks>1&&s.extend(p,{chunks:t.chunks,chunk:t.chunk}),l.trigger("uploadBeforeSend",t,p,h),d.appendBlob(c.fileVal,t.blob,u.name),d.append(p),d.setRequestHeader(h),d.send()},_finishFile:function(e,t,n){var i=this.owner;return i.request("after-send-file",arguments,function(){e.setStatus(a.COMPLETE),i.trigger("uploadSuccess",e,t,n)}).fail(function(t){e.getStatus()===a.PROGRESS&&e.setStatus(a.ERROR,t),i.trigger("uploadError",e,t)}).always(function(){i.trigger("uploadComplete",e)})},updateFileProgress:function(e){var t=0,n=0;e.blocks&&(s.each(e.blocks,function(e,t){n+=(t.percentage||0)*(t.end-t.start)}),t=n/e.size,this.owner.trigger("uploadProgress",e,t||0))}})}),t("widgets/validator",["base","uploader","file","widgets/widget"],function(e,t,n){var i,r=e.$,s={};return i={addValidator:function(e,t){s[e]=t},removeValidator:function(e){delete s[e]}},t.register({name:"validator",init:function(){var t=this;e.nextTick(function(){r.each(s,function(){this.call(t.owner)})})}}),i.addValidator("fileNumLimit",function(){var e=this,t=e.options,n=0,i=parseInt(t.fileNumLimit,10),r=!0;i&&(e.on("beforeFileQueued",function(e){return n>=i&&r&&(r=!1,this.trigger("error","Q_EXCEED_NUM_LIMIT",i,e),setTimeout(function(){r=!0},1)),!(n>=i)}),e.on("fileQueued",function(){n++}),e.on("fileDequeued",function(){n--}),e.on("reset",function(){n=0}))}),i.addValidator("fileSizeLimit",function(){var e=this,t=e.options,n=0,i=parseInt(t.fileSizeLimit,10),r=!0;i&&(e.on("beforeFileQueued",function(e){var t=n+e.size>i;return t&&r&&(r=!1,this.trigger("error","Q_EXCEED_SIZE_LIMIT",i,e),setTimeout(function(){r=!0;
},1)),!t}),e.on("fileQueued",function(e){n+=e.size}),e.on("fileDequeued",function(e){n-=e.size}),e.on("reset",function(){n=0}))}),i.addValidator("fileSingleSizeLimit",function(){var e=this,t=e.options,i=t.fileSingleSizeLimit;i&&e.on("beforeFileQueued",function(e){return e.size>i?(e.setStatus(n.Status.INVALID,"exceed_size"),this.trigger("error","F_EXCEED_SIZE",i,e),!1):void 0})}),i.addValidator("duplicate",function(){function e(e){for(var t,n=0,i=0,r=e.length;r>i;i++)t=e.charCodeAt(i),n=t+(n<<6)+(n<<16)-n;return n}var t=this,n=t.options,i={};n.duplicate||(t.on("beforeFileQueued",function(t){var n=t.__hash||(t.__hash=e(t.name+t.size+t.lastModifiedDate));return i[n]?(this.trigger("error","F_DUPLICATE",t),!1):void 0}),t.on("fileQueued",function(e){var t=e.__hash;t&&(i[t]=!0)}),t.on("fileDequeued",function(e){var t=e.__hash;t&&delete i[t]}),t.on("reset",function(){i={}}))}),i}),t("lib/md5",["runtime/client","mediator"],function(e,t){function n(){e.call(this,"Md5")}return t.installTo(n.prototype),n.prototype.loadFromBlob=function(e){var t=this;t.getRuid()&&t.disconnectRuntime(),t.connectRuntime(e.ruid,function(){t.exec("init"),t.exec("loadFromBlob",e)})},n.prototype.getResult=function(){return this.exec("getResult")},n}),t("widgets/md5",["base","uploader","lib/md5","lib/blob","widgets/widget"],function(e,t,n,i){return t.register({name:"md5",md5File:function(t,r,s){var o=new n,a=e.Deferred(),l=t instanceof i?t:this.request("get-file",t).source;return o.on("progress load",function(e){e=e||{},a.notify(e.total?e.loaded/e.total:1)}),o.on("complete",function(){a.resolve(o.getResult())}),o.on("error",function(e){a.reject(e)}),arguments.length>1&&(r=r||0,s=s||0,0>r&&(r=l.size+r),0>s&&(s=l.size+s),s=Math.min(s,l.size),l=l.slice(r,s)),o.loadFromBlob(l),a.promise()}})}),t("runtime/compbase",[],function(){function e(e,t){this.owner=e,this.options=e.options,this.getRuntime=function(){return t},this.getRuid=function(){return t.uid},this.trigger=function(){return e.trigger.apply(e,arguments)}}return e}),t("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(t,n,i){function r(){var e={},i=this,r=this.destroy;n.apply(i,arguments),i.type=s,i.exec=function(n,r){var s,a=this,l=a.uid,c=t.slice(arguments,2);return o[n]&&(s=e[l]=e[l]||new o[n](a,i),s[r])?s[r].apply(s,c):void 0},i.destroy=function(){return r&&r.apply(this,arguments)}}var s="html5",o={};return t.inherits(n,{constructor:r,init:function(){var e=this;setTimeout(function(){e.trigger("ready")},1)}}),r.register=function(e,n){var r=o[e]=t.inherits(i,n);return r},e.Blob&&e.FileReader&&e.DataView&&n.addRuntime(s,r),r}),t("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(e,t){return e.register("Blob",{slice:function(e,n){var i=this.owner.source,r=i.slice||i.webkitSlice||i.mozSlice;return i=r.call(i,e,n),new t(this.getRuid(),i)}})}),t("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(e,t,n){var i=e.$,r="webuploader-dnd-";return t.register("DragAndDrop",{init:function(){var t=this.elem=this.options.container;this.dragEnterHandler=e.bindFn(this._dragEnterHandler,this),this.dragOverHandler=e.bindFn(this._dragOverHandler,this),this.dragLeaveHandler=e.bindFn(this._dragLeaveHandler,this),this.dropHandler=e.bindFn(this._dropHandler,this),this.dndOver=!1,t.on("dragenter",this.dragEnterHandler),t.on("dragover",this.dragOverHandler),t.on("dragleave",this.dragLeaveHandler),t.on("drop",this.dropHandler),this.options.disableGlobalDnd&&(i(document).on("dragover",this.dragOverHandler),i(document).on("drop",this.dropHandler))},_dragEnterHandler:function(e){var t,n=this,i=n._denied||!1;return e=e.originalEvent||e,n.dndOver||(n.dndOver=!0,t=e.dataTransfer.items,t&&t.length&&(n._denied=i=!n.trigger("accept",t)),n.elem.addClass(r+"over"),n.elem[i?"addClass":"removeClass"](r+"denied")),e.dataTransfer.dropEffect=i?"none":"copy",!1},_dragOverHandler:function(e){var t=this.elem.parent().get(0);return!(t&&!i.contains(t,e.currentTarget))&&(clearTimeout(this._leaveTimer),this._dragEnterHandler.call(this,e),!1)},_dragLeaveHandler:function(){var e,t=this;return e=function(){t.dndOver=!1,t.elem.removeClass(r+"over "+r+"denied")},clearTimeout(t._leaveTimer),t._leaveTimer=setTimeout(e,100),!1},_dropHandler:function(e){var t,s,o=this,a=o.getRuid(),l=o.elem.parent().get(0);if(l&&!i.contains(l,e.currentTarget))return!1;e=e.originalEvent||e,t=e.dataTransfer;try{s=t.getData("text/html")}catch(c){}return s?void 0:(o._getTansferFiles(t,function(e){o.trigger("drop",i.map(e,function(e){return new n(a,e)}))}),o.dndOver=!1,o.elem.removeClass(r+"over"),!1)},_getTansferFiles:function(t,n){var i,r,s,o,a,l,c,u=[],d=[];for(i=t.items,r=t.files,c=!(!i||!i[0].webkitGetAsEntry),a=0,l=r.length;l>a;a++)s=r[a],o=i&&i[a],c&&o.webkitGetAsEntry().isDirectory?d.push(this._traverseDirectoryTree(o.webkitGetAsEntry(),u)):u.push(s);e.when.apply(e,d).done(function(){u.length&&n(u)})},_traverseDirectoryTree:function(t,n){var i=e.Deferred(),r=this;return t.isFile?t.file(function(e){n.push(e),i.resolve()}):t.isDirectory&&t.createReader().readEntries(function(t){var s,o=t.length,a=[],l=[];for(s=0;o>s;s++)a.push(r._traverseDirectoryTree(t[s],l));e.when.apply(e,a).then(function(){n.push.apply(n,l),i.resolve()},i.reject)}),i.promise()},destroy:function(){var e=this.elem;e&&(e.off("dragenter",this.dragEnterHandler),e.off("dragover",this.dragOverHandler),e.off("dragleave",this.dragLeaveHandler),e.off("drop",this.dropHandler),this.options.disableGlobalDnd&&(i(document).off("dragover",this.dragOverHandler),i(document).off("drop",this.dropHandler)))}})}),t("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(e,t,n){return t.register("FilePaste",{init:function(){var t,n,i,r,s=this.options,o=this.elem=s.container,a=".*";if(s.accept){for(t=[],n=0,i=s.accept.length;i>n;n++)r=s.accept[n].mimeTypes,r&&t.push(r);t.length&&(a=t.join(","),a=a.replace(/,/g,"|").replace(/\*/g,".*"))}this.accept=a=new RegExp(a,"i"),this.hander=e.bindFn(this._pasteHander,this),o.on("paste",this.hander)},_pasteHander:function(e){var t,i,r,s,o,a=[],l=this.getRuid();for(e=e.originalEvent||e,t=e.clipboardData.items,s=0,o=t.length;o>s;s++)i=t[s],"file"===i.kind&&(r=i.getAsFile())&&a.push(new n(l,r));a.length&&(e.preventDefault(),e.stopPropagation(),this.trigger("paste",a))},destroy:function(){this.elem.off("paste",this.hander)}})}),t("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(e,t){var n=e.$;return t.register("FilePicker",{init:function(){var e,t,i,r,s=this.getRuntime().getContainer(),o=this,a=o.owner,l=o.options,c=this.label=n(document.createElement("label")),u=this.input=n(document.createElement("input"));if(u.attr("type","file"),u.attr("name",l.name),u.addClass("webuploader-element-invisible"),c.on("click",function(){u.trigger("click")}),c.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"}),l.multiple&&u.attr("multiple","multiple"),l.accept&&l.accept.length>0){for(e=[],t=0,i=l.accept.length;i>t;t++)e.push(l.accept[t].mimeTypes);u.attr("accept",e.join(","))}s.append(u),s.append(c),r=function(e){a.trigger(e.type)},u.on("change",function(e){var t,i=arguments.callee;o.files=e.target.files,t=this.cloneNode(!0),t.value=null,this.parentNode.replaceChild(t,this),u.off(),u=n(t).on("change",i).on("mouseenter mouseleave",r),a.trigger("change")}),c.on("mouseenter mouseleave",r)},getFiles:function(){return this.files},destroy:function(){this.input.off(),this.label.off()}})}),t("runtime/html5/util",["base"],function(t){var n=e.createObjectURL&&e||e.URL&&URL.revokeObjectURL&&URL||e.webkitURL,i=t.noop,r=i;return n&&(i=function(){return n.createObjectURL.apply(n,arguments)},r=function(){return n.revokeObjectURL.apply(n,arguments)}),{createObjectURL:i,revokeObjectURL:r,dataURL2Blob:function(e){var t,n,i,r,s,o;for(o=e.split(","),t=~o[0].indexOf("base64")?atob(o[1]):decodeURIComponent(o[1]),i=new ArrayBuffer(t.length),n=new Uint8Array(i),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return s=o[0].split(":")[1].split(";")[0],this.arrayBufferToBlob(i,s)},dataURL2ArrayBuffer:function(e){var t,n,i,r;for(r=e.split(","),t=~r[0].indexOf("base64")?atob(r[1]):decodeURIComponent(r[1]),n=new Uint8Array(t.length),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n.buffer},arrayBufferToBlob:function(t,n){var i,r=e.BlobBuilder||e.WebKitBlobBuilder;return r?(i=new r,i.append(t),i.getBlob(n)):new Blob([t],n?{type:n}:{})},canvasToDataUrl:function(e,t,n){return e.toDataURL(t,n/100)},parseMeta:function(e,t){t(!1,{})},updateImageHead:function(e){return e}}}),t("runtime/html5/imagemeta",["runtime/html5/util"],function(e){var t;return t={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(e,t){var n=this,i=new FileReader;i.onload=function(){t(!1,n._parse(this.result)),i=i.onload=i.onerror=null},i.onerror=function(e){t(e.message),i=i.onload=i.onerror=null},e=e.slice(0,n.maxMetaDataSize),i.readAsArrayBuffer(e.getSource())},_parse:function(e,n){if(!(e.byteLength<6)){var i,r,s,o,a=new DataView(e),l=2,c=a.byteLength-4,u=l,d={};if(65496===a.getUint16(0)){for(;c>l&&(i=a.getUint16(l),i>=65504&&65519>=i||65534===i)&&(r=a.getUint16(l+2)+2,!(l+r>a.byteLength));){if(s=t.parsers[i],!n&&s)for(o=0;o<s.length;o+=1)s[o].call(t,a,l,r,d);l+=r,u=l}u>6&&(d.imageHead=e.slice?e.slice(2,u):new Uint8Array(e).subarray(2,u))}return d}},updateImageHead:function(e,t){var n,i,r,s=this._parse(e,!0);return r=2,s.imageHead&&(r=2+s.imageHead.byteLength),i=e.slice?e.slice(r):new Uint8Array(e).subarray(r),n=new Uint8Array(t.byteLength+2+i.byteLength),n[0]=255,n[1]=216,n.set(new Uint8Array(t),2),n.set(new Uint8Array(i),t.byteLength+2),n.buffer}},e.parseMeta=function(){return t.parse.apply(t,arguments)},e.updateImageHead=function(){return t.updateImageHead.apply(t,arguments)},t}),t("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(e,t){var n={};return n.ExifMap=function(){return this},n.ExifMap.prototype.map={Orientation:274},n.ExifMap.prototype.get=function(e){return this[e]||this[this.map[e]]},n.exifTagTypes={1:{getValue:function(e,t){return e.getUint8(t)},size:1},2:{getValue:function(e,t){return String.fromCharCode(e.getUint8(t))},size:1,ascii:!0},3:{getValue:function(e,t,n){return e.getUint16(t,n)},size:2},4:{getValue:function(e,t,n){return e.getUint32(t,n)},size:4},5:{getValue:function(e,t,n){return e.getUint32(t,n)/e.getUint32(t+4,n)},size:8},9:{getValue:function(e,t,n){return e.getInt32(t,n)},size:4},10:{getValue:function(e,t,n){return e.getInt32(t,n)/e.getInt32(t+4,n)},size:8}},n.exifTagTypes[7]=n.exifTagTypes[1],n.getExifValue=function(t,i,r,s,o,a){var l,c,u,d,p,h,f=n.exifTagTypes[s];if(!f)return void e.log("Invalid Exif data: Invalid tag type.");if(l=f.size*o,c=l>4?i+t.getUint32(r+8,a):r+8,c+l>t.byteLength)return void e.log("Invalid Exif data: Invalid data offset.");if(1===o)return f.getValue(t,c,a);for(u=[],d=0;o>d;d+=1)u[d]=f.getValue(t,c+d*f.size,a);if(f.ascii){for(p="",d=0;d<u.length&&(h=u[d],"\0"!==h);d+=1)p+=h;return p}return u},n.parseExifTag=function(e,t,i,r,s){var o=e.getUint16(i,r);s.exif[o]=n.getExifValue(e,t,i,e.getUint16(i+2,r),e.getUint32(i+4,r),r)},n.parseExifTags=function(t,n,i,r,s){var o,a,l;if(i+6>t.byteLength)return void e.log("Invalid Exif data: Invalid directory offset.");if(o=t.getUint16(i,r),a=i+2+12*o,a+4>t.byteLength)return void e.log("Invalid Exif data: Invalid directory size.");for(l=0;o>l;l+=1)this.parseExifTag(t,n,i+2+12*l,r,s);return t.getUint32(a,r)},n.parseExifData=function(t,i,r,s){var o,a,l=i+10;if(1165519206===t.getUint32(i+4)){if(l+8>t.byteLength)return void e.log("Invalid Exif data: Invalid segment size.");if(0!==t.getUint16(i+8))return void e.log("Invalid Exif data: Missing byte alignment offset.");switch(t.getUint16(l)){case 18761:o=!0;break;case 19789:o=!1;break;default:return void e.log("Invalid Exif data: Invalid byte alignment marker.")}if(42!==t.getUint16(l+2,o))return void e.log("Invalid Exif data: Missing TIFF marker.");a=t.getUint32(l+4,o),s.exif=new n.ExifMap,a=n.parseExifTags(t,l,l+a,o,s)}},t.parsers[65505].push(n.parseExifData),n}),t("runtime/html5/jpegencoder",[],function(){function e(e){function t(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],n=0;64>n;n++){var i=k((t[n]*e+50)/100);1>i?i=1:i>255&&(i=255),S[P[n]]=i}for(var r=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],s=0;64>s;s++){var o=k((r[s]*e+50)/100);1>o?o=1:o>255&&(o=255),C[P[s]]=o}for(var a=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],l=0,c=0;8>c;c++)for(var u=0;8>u;u++)E[l]=1/(S[P[l]]*a[c]*a[u]*8),A[l]=1/(C[P[l]]*a[c]*a[u]*8),l++}function n(e,t){for(var n=0,i=0,r=new Array,s=1;16>=s;s++){for(var o=1;o<=e[s];o++)r[t[i]]=[],r[t[i]][0]=n,r[t[i]][1]=s,i++,n++;n*=2}return r}function i(){y=n(U,B),_=n(V,X),x=n(z,W),w=n(Q,J)}function r(){for(var e=1,t=2,n=1;15>=n;n++){for(var i=e;t>i;i++)D[32767+i]=n,I[32767+i]=[],I[32767+i][1]=n,I[32767+i][0]=i;for(var r=-(t-1);-e>=r;r++)D[32767+r]=n,I[32767+r]=[],I[32767+r][1]=n,I[32767+r][0]=t-1+r;e<<=1,t<<=1}}function s(){for(var e=0;256>e;e++)H[e]=19595*e,H[e+256>>0]=38470*e,H[e+512>>0]=7471*e+32768,H[e+768>>0]=-11059*e,H[e+1024>>0]=-21709*e,H[e+1280>>0]=32768*e+8421375,H[e+1536>>0]=-27439*e,H[e+1792>>0]=-5329*e}function o(e){for(var t=e[0],n=e[1]-1;n>=0;)t&1<<n&&($|=1<<R),n--,R--,0>R&&(255==$?(a(255),a(0)):a($),R=7,$=0)}function a(e){j.push(q[e])}function l(e){a(e>>8&255),a(255&e)}function c(e,t){var n,i,r,s,o,a,l,c,u,d=0,p=8,h=64;for(u=0;p>u;++u){n=e[d],i=e[d+1],r=e[d+2],s=e[d+3],o=e[d+4],a=e[d+5],l=e[d+6],c=e[d+7];var f=n+c,m=n-c,g=i+l,v=i-l,b=r+a,y=r-a,_=s+o,x=s-o,w=f+_,T=f-_,k=g+b,S=g-b;e[d]=w+k,e[d+4]=w-k;var C=.707106781*(S+T);e[d+2]=T+C,e[d+6]=T-C,w=x+y,k=y+v,S=v+m;var E=.382683433*(w-S),A=.5411961*w+E,I=1.306562965*S+E,D=.707106781*k,L=m+D,j=m-D;e[d+5]=j+A,e[d+3]=j-A,e[d+1]=L+I,e[d+7]=L-I,d+=8}for(d=0,u=0;p>u;++u){n=e[d],i=e[d+8],r=e[d+16],s=e[d+24],o=e[d+32],a=e[d+40],l=e[d+48],c=e[d+56];var $=n+c,R=n-c,M=i+l,F=i-l,O=r+a,q=r-a,H=s+o,P=s-o,U=$+H,B=$-H,z=M+O,W=M-O;e[d]=U+z,e[d+32]=U-z;var V=.707106781*(W+B);e[d+16]=B+V,e[d+48]=B-V,U=P+q,z=q+F,W=F+R;var X=.382683433*(U-W),Q=.5411961*U+X,J=1.306562965*W+X,G=.707106781*z,K=R+G,Y=R-G;e[d+40]=Y+Q,e[d+24]=Y-Q,e[d+8]=K+J,e[d+56]=K-J,d++}var Z;for(u=0;h>u;++u)Z=e[u]*t[u],N[u]=Z>0?Z+.5|0:Z-.5|0;return N}function u(){l(65504),l(16),a(74),a(70),a(73),a(70),a(0),a(1),a(1),a(0),l(1),l(1),a(0),a(0)}function d(e,t){l(65472),l(17),a(8),l(t),l(e),a(3),a(1),a(17),a(0),a(2),a(17),a(1),a(3),a(17),a(1)}function p(){l(65499),l(132),a(0);for(var e=0;64>e;e++)a(S[e]);a(1);for(var t=0;64>t;t++)a(C[t])}function h(){l(65476),l(418),a(0);for(var e=0;16>e;e++)a(U[e+1]);for(var t=0;11>=t;t++)a(B[t]);a(16);for(var n=0;16>n;n++)a(z[n+1]);for(var i=0;161>=i;i++)a(W[i]);a(1);for(var r=0;16>r;r++)a(V[r+1]);for(var s=0;11>=s;s++)a(X[s]);a(17);for(var o=0;16>o;o++)a(Q[o+1]);for(var c=0;161>=c;c++)a(J[c])}function f(){l(65498),l(12),a(3),a(1),a(0),a(2),a(17),a(3),a(17),a(0),a(63),a(0)}function m(e,t,n,i,r){for(var s,a=r[0],l=r[240],u=16,d=63,p=64,h=c(e,t),f=0;p>f;++f)L[P[f]]=h[f];var m=L[0]-n;n=L[0],0==m?o(i[0]):(s=32767+m,o(i[D[s]]),o(I[s]));for(var g=63;g>0&&0==L[g];g--);if(0==g)return o(a),n;for(var v,b=1;g>=b;){for(var y=b;0==L[b]&&g>=b;++b);var _=b-y;if(_>=u){v=_>>4;for(var x=1;v>=x;++x)o(l);_=15&_}s=32767+L[b],o(r[(_<<4)+D[s]]),o(I[s]),b++}return g!=d&&o(a),n}function g(){for(var e=String.fromCharCode,t=0;256>t;t++)q[t]=e(t)}function v(e){if(0>=e&&(e=1),e>100&&(e=100),T!=e){var n=0;n=Math.floor(50>e?5e3/e:200-2*e),t(n),T=e}}function b(){e||(e=50),g(),i(),r(),s(),v(e)}var y,_,x,w,T,k=(Math.round,Math.floor),S=new Array(64),C=new Array(64),E=new Array(64),A=new Array(64),I=new Array(65535),D=new Array(65535),N=new Array(64),L=new Array(64),j=[],$=0,R=7,M=new Array(64),F=new Array(64),O=new Array(64),q=new Array(256),H=new Array(2048),P=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],U=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],B=[0,1,2,3,4,5,6,7,8,9,10,11],z=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],W=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],V=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],X=[0,1,2,3,4,5,6,7,8,9,10,11],Q=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],J=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(e,t){t&&v(t),j=new Array,$=0,R=7,l(65496),u(),p(),d(e.width,e.height),h(),f();var n=0,i=0,r=0;$=0,R=7,this.encode.displayName="_encode_";for(var s,a,c,g,b,T,k,S,C,I=e.data,D=e.width,N=e.height,L=4*D,q=0;N>q;){for(s=0;L>s;){for(b=L*q+s,T=b,k=-1,S=0,C=0;64>C;C++)S=C>>3,k=4*(7&C),T=b+S*L+k,q+S>=N&&(T-=L*(q+1+S-N)),s+k>=L&&(T-=s+k-L+4),a=I[T++],c=I[T++],g=I[T++],M[C]=(H[a]+H[c+256>>0]+H[g+512>>0]>>16)-128,F[C]=(H[a+768>>0]+H[c+1024>>0]+H[g+1280>>0]>>16)-128,O[C]=(H[a+1280>>0]+H[c+1536>>0]+H[g+1792>>0]>>16)-128;n=m(M,E,n,y,x),i=m(F,A,i,_,w),r=m(O,A,r,_,w),s+=32}q+=8}if(R>=0){var P=[];P[1]=R+1,P[0]=(1<<R+1)-1,o(P)}l(65497);var U="data:image/jpeg;base64,"+btoa(j.join(""));return j=[],U},b()}return e.encode=function(t,n){var i=new e(n);return i.encode(t)},e}),t("runtime/html5/androidpatch",["runtime/html5/util","runtime/html5/jpegencoder","base"],function(e,t,n){var i,r=e.canvasToDataUrl;e.canvasToDataUrl=function(e,s,o){var a,l,c,u,d;return n.os.android?("image/jpeg"===s&&"undefined"==typeof i&&(u=r.apply(null,arguments),d=u.split(","),u=~d[0].indexOf("base64")?atob(d[1]):decodeURIComponent(d[1]),u=u.substring(0,2),i=255===u.charCodeAt(0)&&216===u.charCodeAt(1)),"image/jpeg"!==s||i?r.apply(null,arguments):(l=e.width,c=e.height,a=e.getContext("2d"),t.encode(a.getImageData(0,0,l,c),o))):r.apply(null,arguments)}}),t("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(e,t,n){var i="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";return t.register("Image",{modified:!1,init:function(){var e=this,t=new Image;t.onload=function(){e._info={type:e.type,width:this.width,height:this.height},e._metas||"image/jpeg"!==e.type?e.owner.trigger("load"):n.parseMeta(e._blob,function(t,n){e._metas=n,e.owner.trigger("load")})},t.onerror=function(){e.owner.trigger("error")},e._img=t},loadFromBlob:function(e){var t=this,i=t._img;t._blob=e,t.type=e.type,i.src=n.createObjectURL(e.getSource()),t.owner.once("load",function(){n.revokeObjectURL(i.src)})},resize:function(e,t){var n=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,n,e,t),this._blob=null,this.modified=!0,this.owner.trigger("complete","resize")},crop:function(e,t,n,i,r){var s=this._canvas||(this._canvas=document.createElement("canvas")),o=this.options,a=this._img,l=a.naturalWidth,c=a.naturalHeight,u=this.getOrientation();r=r||1,s.width=n,s.height=i,o.preserveHeaders||this._rotate2Orientaion(s,u),this._renderImageToCanvas(s,a,-e,-t,l*r,c*r),this._blob=null,this.modified=!0,this.owner.trigger("complete","crop")},getAsBlob:function(e){var t,i=this._blob,r=this.options;if(e=e||this.type,this.modified||this.type!==e){if(t=this._canvas,"image/jpeg"===e){if(i=n.canvasToDataUrl(t,e,r.quality),r.preserveHeaders&&this._metas&&this._metas.imageHead)return i=n.dataURL2ArrayBuffer(i),i=n.updateImageHead(i,this._metas.imageHead),i=n.arrayBufferToBlob(i,e)}else i=n.canvasToDataUrl(t,e);i=n.dataURL2Blob(i)}return i},getAsDataUrl:function(e){var t=this.options;return e=e||this.type,"image/jpeg"===e?n.canvasToDataUrl(this._canvas,e,t.quality):this._canvas.toDataURL(e)},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(e){return e?(this._info=e,this):this._info},meta:function(e){return e?(this._meta=e,this):this._meta},destroy:function(){var e=this._canvas;this._img.onload=null,e&&(e.getContext("2d").clearRect(0,0,e.width,e.height),e.width=e.height=0,this._canvas=null),this._img.src=i,this._img=this._blob=null},_resize:function(e,t,n,i){var r,s,o,a,l,c=this.options,u=e.width,d=e.height,p=this.getOrientation();~[5,6,7,8].indexOf(p)&&(n^=i,i^=n,n^=i),r=Math[c.crop?"max":"min"](n/u,i/d),c.allowMagnify||(r=Math.min(1,r)),s=u*r,o=d*r,c.crop?(t.width=n,t.height=i):(t.width=s,t.height=o),a=(t.width-s)/2,l=(t.height-o)/2,c.preserveHeaders||this._rotate2Orientaion(t,p),this._renderImageToCanvas(t,e,a,l,s,o)},_rotate2Orientaion:function(e,t){var n=e.width,i=e.height,r=e.getContext("2d");switch(t){case 5:case 6:case 7:case 8:e.width=i,e.height=n}switch(t){case 2:r.translate(n,0),r.scale(-1,1);break;case 3:r.translate(n,i),r.rotate(Math.PI);break;case 4:r.translate(0,i),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-i);break;case 7:r.rotate(.5*Math.PI),r.translate(n,-i),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-n,0)}},_renderImageToCanvas:function(){function t(e,t,n){var i,r,s,o=document.createElement("canvas"),a=o.getContext("2d"),l=0,c=n,u=n;for(o.width=1,o.height=n,a.drawImage(e,0,0),i=a.getImageData(0,0,1,n).data;u>l;)r=i[4*(u-1)+3],0===r?c=u:l=u,u=c+l>>1;return s=u/n,0===s?1:s}function n(e){var t,n,i=e.naturalWidth,r=e.naturalHeight;return i*r>1048576&&(t=document.createElement("canvas"),t.width=t.height=1,n=t.getContext("2d"),n.drawImage(e,-i+1,0),0===n.getImageData(0,0,1,1).data[3])}return e.os.ios?e.os.ios>=7?function(e,n,i,r,s,o){var a=n.naturalWidth,l=n.naturalHeight,c=t(n,a,l);return e.getContext("2d").drawImage(n,0,0,a*c,l*c,i,r,s,o)}:function(e,i,r,s,o,a){var l,c,u,d,p,h,f,m=i.naturalWidth,g=i.naturalHeight,v=e.getContext("2d"),b=n(i),y="image/jpeg"===this.type,_=1024,x=0,w=0;for(b&&(m/=2,g/=2),v.save(),l=document.createElement("canvas"),l.width=l.height=_,c=l.getContext("2d"),u=y?t(i,m,g):1,d=Math.ceil(_*o/m),p=Math.ceil(_*a/g/u);g>x;){for(h=0,f=0;m>h;)c.clearRect(0,0,_,_),c.drawImage(i,-h,-x),v.drawImage(l,0,0,_,_,r+f,s+w,d,p),h+=_,f+=d;x+=_,w+=p}v.restore(),l=c=null}:function(t){var n=e.slice(arguments,1),i=t.getContext("2d");i.drawImage.apply(i,n)}}()})}),t("runtime/html5/transport",["base","runtime/html5/runtime"],function(e,t){var n=e.noop,i=e.$;return t.register("Transport",{init:function(){this._status=0,this._response=null},send:function(){var t,n,r,s=this.owner,o=this.options,a=this._initAjax(),l=s._blob,c=o.server;o.sendAsBinary?(c+=(/\?/.test(c)?"&":"?")+i.param(s._formData),n=l.getSource()):(t=new FormData,i.each(s._formData,function(e,n){t.append(e,n)}),t.append(o.fileVal,l.getSource(),o.filename||s._formData.name||"")),o.withCredentials&&"withCredentials"in a?(a.open(o.method,c,!0),a.withCredentials=!0):a.open(o.method,c),this._setRequestHeader(a,o.headers),n?(a.overrideMimeType&&a.overrideMimeType("application/octet-stream"),e.os.android?(r=new FileReader,r.onload=function(){a.send(this.result),r=r.onload=null},r.readAsArrayBuffer(n)):a.send(n)):a.send(t)},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var e=this._xhr;e&&(e.upload.onprogress=n,e.onreadystatechange=n,e.abort(),this._xhr=e=null)},destroy:function(){this.abort()},_initAjax:function(){var e=this,t=new XMLHttpRequest,i=this.options;return!i.withCredentials||"withCredentials"in t||"undefined"==typeof XDomainRequest||(t=new XDomainRequest),t.upload.onprogress=function(t){var n=0;return t.lengthComputable&&(n=t.loaded/t.total),e.trigger("progress",n)},t.onreadystatechange=function(){return 4===t.readyState?(t.upload.onprogress=n,t.onreadystatechange=n,e._xhr=null,e._status=t.status,t.status>=200&&t.status<300?(e._response=t.responseText,e.trigger("load")):t.status>=500&&t.status<600?(e._response=t.responseText,e.trigger("error","server")):e.trigger("error",e._status?"http":"abort")):void 0},e._xhr=t,t},_setRequestHeader:function(e,t){i.each(t,function(t,n){e.setRequestHeader(t,n)})},_parseJson:function(e){var t;try{t=JSON.parse(e)}catch(n){t={}}return t}})}),t("runtime/html5/md5",["runtime/html5/runtime"],function(e){var t=function(e,t){return e+t&4294967295},n=function(e,n,i,r,s,o){return n=t(t(n,e),t(r,o)),t(n<<s|n>>>32-s,i)},i=function(e,t,i,r,s,o,a){return n(t&i|~t&r,e,t,s,o,a)},r=function(e,t,i,r,s,o,a){return n(t&r|i&~r,e,t,s,o,a)},s=function(e,t,i,r,s,o,a){return n(t^i^r,e,t,s,o,a)},o=function(e,t,i,r,s,o,a){return n(i^(t|~r),e,t,s,o,a)},a=function(e,n){var a=e[0],l=e[1],c=e[2],u=e[3];a=i(a,l,c,u,n[0],7,-680876936),u=i(u,a,l,c,n[1],12,-389564586),c=i(c,u,a,l,n[2],17,606105819),l=i(l,c,u,a,n[3],22,-1044525330),a=i(a,l,c,u,n[4],7,-176418897),u=i(u,a,l,c,n[5],12,1200080426),c=i(c,u,a,l,n[6],17,-1473231341),l=i(l,c,u,a,n[7],22,-45705983),a=i(a,l,c,u,n[8],7,1770035416),u=i(u,a,l,c,n[9],12,-1958414417),c=i(c,u,a,l,n[10],17,-42063),l=i(l,c,u,a,n[11],22,-1990404162),a=i(a,l,c,u,n[12],7,1804603682),u=i(u,a,l,c,n[13],12,-40341101),c=i(c,u,a,l,n[14],17,-1502002290),l=i(l,c,u,a,n[15],22,1236535329),a=r(a,l,c,u,n[1],5,-165796510),u=r(u,a,l,c,n[6],9,-1069501632),c=r(c,u,a,l,n[11],14,643717713),l=r(l,c,u,a,n[0],20,-373897302),a=r(a,l,c,u,n[5],5,-701558691),u=r(u,a,l,c,n[10],9,38016083),c=r(c,u,a,l,n[15],14,-660478335),l=r(l,c,u,a,n[4],20,-405537848),a=r(a,l,c,u,n[9],5,568446438),u=r(u,a,l,c,n[14],9,-1019803690),c=r(c,u,a,l,n[3],14,-187363961),l=r(l,c,u,a,n[8],20,1163531501),a=r(a,l,c,u,n[13],5,-1444681467),u=r(u,a,l,c,n[2],9,-51403784),c=r(c,u,a,l,n[7],14,1735328473),l=r(l,c,u,a,n[12],20,-1926607734),a=s(a,l,c,u,n[5],4,-378558),u=s(u,a,l,c,n[8],11,-2022574463),c=s(c,u,a,l,n[11],16,1839030562),l=s(l,c,u,a,n[14],23,-35309556),a=s(a,l,c,u,n[1],4,-1530992060),u=s(u,a,l,c,n[4],11,1272893353),c=s(c,u,a,l,n[7],16,-155497632),l=s(l,c,u,a,n[10],23,-1094730640),a=s(a,l,c,u,n[13],4,681279174),u=s(u,a,l,c,n[0],11,-358537222),c=s(c,u,a,l,n[3],16,-722521979),l=s(l,c,u,a,n[6],23,76029189),a=s(a,l,c,u,n[9],4,-640364487),u=s(u,a,l,c,n[12],11,-421815835),c=s(c,u,a,l,n[15],16,530742520),l=s(l,c,u,a,n[2],23,-995338651),a=o(a,l,c,u,n[0],6,-198630844),u=o(u,a,l,c,n[7],10,1126891415),c=o(c,u,a,l,n[14],15,-1416354905),l=o(l,c,u,a,n[5],21,-57434055),a=o(a,l,c,u,n[12],6,1700485571),u=o(u,a,l,c,n[3],10,-1894986606),c=o(c,u,a,l,n[10],15,-1051523),l=o(l,c,u,a,n[1],21,-2054922799),a=o(a,l,c,u,n[8],6,1873313359),u=o(u,a,l,c,n[15],10,-30611744),c=o(c,u,a,l,n[6],15,-1560198380),l=o(l,c,u,a,n[13],21,1309151649),a=o(a,l,c,u,n[4],6,-145523070),u=o(u,a,l,c,n[11],10,-1120210379),c=o(c,u,a,l,n[2],15,718787259),l=o(l,c,u,a,n[9],21,-343485551),e[0]=t(a,e[0]),e[1]=t(l,e[1]),e[2]=t(c,e[2]),e[3]=t(u,e[3])},l=function(e){var t,n=[];for(t=0;64>t;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n},c=function(e){var t,n=[];for(t=0;64>t;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n},u=function(e){var t,n,i,r,s,o,c=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;c>=t;t+=64)a(u,l(e.substring(t-64,t)));for(e=e.substring(t-64),n=e.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;n>t;t+=1)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(a(u,i),t=0;16>t;t+=1)i[t]=0;return r=8*c,r=r.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(r[2],16),o=parseInt(r[1],16)||0,i[14]=s,i[15]=o,a(u,i),u},d=function(e){var t,n,i,r,s,o,l=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;l>=t;t+=64)a(u,c(e.subarray(t-64,t)));for(e=l>t-64?e.subarray(t-64):new Uint8Array(0),n=e.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;n>t;t+=1)i[t>>2]|=e[t]<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(a(u,i),t=0;16>t;t+=1)i[t]=0;return r=8*l,r=r.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(r[2],16),o=parseInt(r[1],16)||0,i[14]=s,i[15]=o,a(u,i),u},p=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],h=function(e){var t,n="";for(t=0;4>t;t+=1)n+=p[e>>8*t+4&15]+p[e>>8*t&15];return n},f=function(e){var t;for(t=0;t<e.length;t+=1)e[t]=h(e[t]);return e.join("")},m=function(e){return f(u(e))},g=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==m("hello")&&(t=function(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}),g.prototype.append=function(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),this.appendBinary(e),this},g.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,n=this._buff.length;for(t=64;n>=t;t+=64)a(this._state,l(this._buff.substring(t-64,t)));return this._buff=this._buff.substr(t-64),this},g.prototype.end=function(e){var t,n,i=this._buff,r=i.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;r>t;t+=1)s[t>>2]|=i.charCodeAt(t)<<(t%4<<3);return this._finish(s,r),n=e?this._state:f(this._state),this.reset(),n},g.prototype._finish=function(e,t){var n,i,r,s=t;if(e[s>>2]|=128<<(s%4<<3),s>55)for(a(this._state,e),s=0;16>s;s+=1)e[s]=0;n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),r=parseInt(n[1],16)||0,e[14]=i,e[15]=r,a(this._state,e)},g.prototype.reset=function(){return this._buff="",this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},g.prototype.destroy=function(){delete this._state,delete this._buff,delete this._length},g.hash=function(e,t){/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e)));var n=u(e);return t?n:f(n)},g.hashBinary=function(e,t){var n=u(e);return t?n:f(n)},g.ArrayBuffer=function(){this.reset()},g.ArrayBuffer.prototype.append=function(e){var t,n=this._concatArrayBuffer(this._buff,e),i=n.length;for(this._length+=e.byteLength,t=64;i>=t;t+=64)a(this._state,c(n.subarray(t-64,t)));return this._buff=i>t-64?n.subarray(t-64):new Uint8Array(0),this},g.ArrayBuffer.prototype.end=function(e){var t,n,i=this._buff,r=i.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;r>t;t+=1)s[t>>2]|=i[t]<<(t%4<<3);return this._finish(s,r),n=e?this._state:f(this._state),this.reset(),n},g.ArrayBuffer.prototype._finish=g.prototype._finish,g.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},g.ArrayBuffer.prototype.destroy=g.prototype.destroy,g.ArrayBuffer.prototype._concatArrayBuffer=function(e,t){var n=e.length,i=new Uint8Array(n+t.byteLength);return i.set(e),i.set(new Uint8Array(t),n),i},g.ArrayBuffer.hash=function(e,t){var n=d(new Uint8Array(e));return t?n:f(n)},e.register("Md5",{init:function(){},loadFromBlob:function(e){var t,n,i=e.getSource(),r=2097152,s=Math.ceil(i.size/r),o=0,a=this.owner,l=new g.ArrayBuffer,c=this,u=i.mozSlice||i.webkitSlice||i.slice;n=new FileReader,(t=function(){var d,p;d=o*r,p=Math.min(d+r,i.size),n.onload=function(t){l.append(t.target.result),a.trigger("progress",{total:e.size,loaded:p})},n.onloadend=function(){n.onloadend=n.onload=null,++o<s?setTimeout(t,1):setTimeout(function(){a.trigger("load"),c.result=l.end(),
t=e=i=l=null,a.trigger("complete")},50)},n.readAsArrayBuffer(u.call(i,d,p))})()},getResult:function(){return this.result}})}),t("runtime/flash/runtime",["base","runtime/runtime","runtime/compbase"],function(t,n,i){function r(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(n){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1],10)}function s(){function i(e,t){var n,i,r=e.type||e;n=r.split("::"),i=n[0],r=n[1],"Ready"===r&&i===c.uid?c.trigger("ready"):s[i]&&s[i].trigger(r.toLowerCase(),e,t)}var r={},s={},o=this.destroy,c=this,u=t.guid("webuploader_");n.apply(c,arguments),c.type=a,c.exec=function(e,n){var i,o=this,a=o.uid,u=t.slice(arguments,2);return s[a]=o,l[e]&&(r[a]||(r[a]=new l[e](o,c)),i=r[a],i[n])?i[n].apply(i,u):c.flashExec.apply(o,arguments)},e[u]=function(){var e=arguments;setTimeout(function(){i.apply(null,e)},1)},this.jsreciver=u,this.destroy=function(){return o&&o.apply(this,arguments)},this.flashExec=function(e,n){var i=c.getFlash(),r=t.slice(arguments,2);return i.exec(this.uid,e,n,r)}}var o=t.$,a="flash",l={};return t.inherits(n,{constructor:s,init:function(){var e,n=this.getContainer(),i=this.options;n.css({position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),e='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+i.swf+'" ',t.browser.ie&&(e+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),e+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+i.swf+'" /><param name="flashvars" value="uid='+this.uid+"&jsreciver="+this.jsreciver+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',n.html(e)},getFlash:function(){return this._flash?this._flash:(this._flash=o("#"+this.uid).get(0),this._flash)}}),s.register=function(e,n){return n=l[e]=t.inherits(i,o.extend({flashExec:function(){var e=this.owner,t=this.getRuntime();return t.flashExec.apply(e,arguments)}},n))},r()>=11.4&&n.addRuntime(a,s),s}),t("runtime/flash/filepicker",["base","runtime/flash/runtime"],function(e,t){var n=e.$;return t.register("FilePicker",{init:function(e){var t,i,r=n.extend({},e);for(t=r.accept&&r.accept.length,i=0;t>i;i++)r.accept[i].title||(r.accept[i].title="Files");delete r.button,delete r.id,delete r.container,this.flashExec("FilePicker","init",r)},destroy:function(){this.flashExec("FilePicker","destroy")}})}),t("runtime/flash/image",["runtime/flash/runtime"],function(e){return e.register("Image",{loadFromBlob:function(e){var t=this.owner;t.info()&&this.flashExec("Image","info",t.info()),t.meta()&&this.flashExec("Image","meta",t.meta()),this.flashExec("Image","loadFromBlob",e.uid)}})}),t("runtime/flash/transport",["base","runtime/flash/runtime","runtime/client"],function(t,n,i){var r=t.$;return n.register("Transport",{init:function(){this._status=0,this._response=null,this._responseJson=null},send:function(){var e,t=this.owner,n=this.options,i=this._initAjax(),s=t._blob,o=n.server;i.connectRuntime(s.ruid),n.sendAsBinary?(o+=(/\?/.test(o)?"&":"?")+r.param(t._formData),e=s.uid):(r.each(t._formData,function(e,t){i.exec("append",e,t)}),i.exec("appendBlob",n.fileVal,s.uid,n.filename||t._formData.name||"")),this._setRequestHeader(i,n.headers),i.exec("send",{method:n.method,url:o,forceURLStream:n.forceURLStream,mimeType:"application/octet-stream"},e)},getStatus:function(){return this._status},getResponse:function(){return this._response||""},getResponseAsJson:function(){return this._responseJson},abort:function(){var e=this._xhr;e&&(e.exec("abort"),e.destroy(),this._xhr=e=null)},destroy:function(){this.abort()},_initAjax:function(){var t=this,n=new i("XMLHttpRequest");return n.on("uploadprogress progress",function(e){var n=e.loaded/e.total;return n=Math.min(1,Math.max(0,n)),t.trigger("progress",n)}),n.on("load",function(){var i,r=n.exec("getStatus"),s=!1,o="";return n.off(),t._xhr=null,r>=200&&300>r?s=!0:r>=500&&600>r?(s=!0,o="server"):o="http",s&&(t._response=n.exec("getResponse"),t._response=decodeURIComponent(t._response),i=e.JSON&&e.JSON.parse||function(e){try{return new Function("return "+e).call()}catch(t){return{}}},t._responseJson=t._response?i(t._response):{}),n.destroy(),n=null,o?t.trigger("error",o):t.trigger("load")}),n.on("error",function(){n.off(),t._xhr=null,t.trigger("error","http")}),t._xhr=n,n},_setRequestHeader:function(e,t){r.each(t,function(t,n){e.exec("setRequestHeader",t,n)})}})}),t("runtime/flash/blob",["runtime/flash/runtime","lib/blob"],function(e,t){return e.register("Blob",{slice:function(e,n){var i=this.flashExec("Blob","slice",e,n);return new t(i.uid,i)}})}),t("runtime/flash/md5",["runtime/flash/runtime"],function(e){return e.register("Md5",{init:function(){},loadFromBlob:function(e){return this.flashExec("Md5","loadFromBlob",e.uid)}})}),t("preset/all",["base","widgets/filednd","widgets/filepaste","widgets/filepicker","widgets/image","widgets/queue","widgets/runtime","widgets/upload","widgets/validator","widgets/md5","runtime/html5/blob","runtime/html5/dnd","runtime/html5/filepaste","runtime/html5/filepicker","runtime/html5/imagemeta/exif","runtime/html5/androidpatch","runtime/html5/image","runtime/html5/transport","runtime/html5/md5","runtime/flash/filepicker","runtime/flash/image","runtime/flash/transport","runtime/flash/blob","runtime/flash/md5"],function(e){return e}),t("widgets/log",["base","uploader","widgets/widget"],function(e,t){function n(e){var t=r.extend({},i,e),n=s.replace(/^(.*)\?/,"$1"+r.param(t)),o=new Image;o.src=n}var i,r=e.$,s=" http://static.tieba.baidu.com/tb/pms/img/st.gif??",o=(location.hostname||location.host||"protected").toLowerCase(),a=o&&/baidu/i.exec(o);if(a)return i={dv:3,master:"webuploader",online:/test/.exec(o)?0:1,module:"",product:o,type:0},t.register({name:"log",init:function(){var e=this.owner,t=0,i=0;e.on("error",function(e){n({type:2,c_error_code:e})}).on("uploadError",function(e,t){n({type:2,c_error_code:"UPLOAD_ERROR",c_reason:""+t})}).on("uploadComplete",function(e){t++,i+=e.size}).on("uploadFinished",function(){n({c_count:t,c_size:i}),t=i=0}),n({c_usage:1})}})}),t("webuploader",["preset/all","widgets/log"],function(e){return e}),n("webuploader")}),function(e,t,n){function i(){e(this).find(c).each(s)}function r(e){for(var e=e.attributes,t={},n=/^jQuery\d+/,i=0;i<e.length;i++)e[i].specified&&!n.test(e[i].name)&&(t[e[i].name]=e[i].value);return t}function s(){var t,n=e(this);n.is(":password")||(n.data("password")?(t=n.next().show().focus(),e("label[for="+n.attr("id")+"]").attr("for",t.attr("id")),n.remove()):n.realVal()==n.attr("placeholder")&&(n.val(""),n.removeClass("placeholder")))}function o(){var t,n,i=e(this);placeholder=i.attr("placeholder"),e.trim(i.val()).length>0||(i.is(":password")?(n=i.attr("id")+"-clone",t=e("<input/>").attr(e.extend(r(this),{type:"text",value:placeholder,"data-password":1,id:n})).addClass("placeholder"),i.before(t).hide(),e("label[for="+i.attr("id")+"]").attr("for",n)):(i.val(placeholder),i.addClass("placeholder")))}var a="placeholder"in t.createElement("input"),l="placeholder"in t.createElement("textarea"),c=":input[placeholder]";e.placeholder={input:a,textarea:l},!n&&a&&l?e.fn.placeholder=function(){}:(!n&&a&&!l&&(c="textarea[placeholder]"),e.fn.realVal=e.fn.val,e.fn.val=function(){var t,n=e(this);return arguments.length>0?n.realVal.apply(this,arguments):(t=n.realVal(),n=n.attr("placeholder"),t==n?"":t)},e.fn.placeholder=function(){return this.filter(c).each(o),this},e(function(e){var n=e(t);n.on("submit","form",i),n.on("focus",c,s),n.on("blur",c,o),e(c).placeholder()}))}(jQuery,document,window.debug),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery||window.Zepto||window.$)}(function(e){e.cxSelect=function(){var t={dom:{},api:{}};return t.init=function(){for(var t,n=this,i=function(e){return!(!e||"function"!=typeof HTMLElement&&"object"!=typeof HTMLElement||!(e instanceof HTMLElement))||!(!e||!e.nodeType||1!==e.nodeType)},r=function(e){return!!(e&&e.length&&("function"==typeof jQuery||"object"==typeof jQuery)&&e instanceof jQuery)},s=0,o=arguments.length;s<o;s++)r(arguments[s])?n.dom.box=arguments[s]:i(arguments[s])?n.dom.box=e(arguments[s]):"object"==typeof arguments[s]&&(t=arguments[s]);if(n.dom.box.length){n.settings=e.extend({},e.cxSelect.defaults,t,{url:n.dom.box.data("url"),nodata:n.dom.box.data("nodata"),required:n.dom.box.data("required"),firstTitle:n.dom.box.data("firstTitle"),firstValue:n.dom.box.data("firstValue"),jsonSpace:n.dom.box.data("jsonSpace"),jsonName:n.dom.box.data("jsonName"),jsonValue:n.dom.box.data("jsonValue"),jsonSub:n.dom.box.data("jsonSub")});var a=n.dom.box.data("selects");if("string"==typeof a&&a.length&&(n.settings.selects=a.split(",")),e.isArray(n.settings.selects)&&n.settings.selects.length){n.selectArray=[];for(var l,s=0,o=n.settings.selects.length;s<o&&(l=n.dom.box.find("select."+n.settings.selects[s]),l);s++)"string"==typeof l.val()&&l.val().length&&l.attr("data-value",l.val()),n.selectArray.push(l);n.selectArray.length&&(n.dom.box.on("change","select",function(){n.selectChange(this.className)}),n.settings.url?"string"==typeof n.settings.url&&n.settings.url.length?e.getJSON(n.settings.url,function(e){n.start(e)}):"object"==typeof n.settings.url&&n.start(n.settings.url):n.start())}}},t.getIndex=function(e){return this.settings.required?e:e-1},t.start=function(e){var t=this,n=t.settings.jsonSpace;if(t.dataJson=void 0,e&&"object"==typeof e&&(t.dataJson=e,"string"==typeof n&&n.length))for(var i=n.split("."),r=0,s=i.length;r<s;r++)t.dataJson=t.dataJson[i[r]];t.dataJson||"string"==typeof t.selectArray[0].data("url")&&t.selectArray[0].data("url").length?t.getOptionData(0):t.selectArray[0].prop("disabled",!1).css({display:"",visibility:""})},t.selectChange=function(e){if("string"==typeof e&&e.length){e=e.replace(/\s+/g,","),e=","+e+",";for(var t,n=0,i=this.selectArray.length;n<i;n++)e.indexOf(","+this.settings.selects[n]+",")>-1&&(t=n);"number"==typeof t&&(t+=1,this.getOptionData(t))}},t.getOptionData=function(t,n){var i=this;if(!("number"!=typeof t||isNaN(t)||t<0||t>=i.selectArray.length)){for(var r,s,o,a,l,c=t-1,u=i.selectArray[t],d={},p=u.data("url"),h="undefined"==typeof u.data("jsonSpace")?i.settings.jsonSpace:u.data("jsonSpace"),f=0,m=i.selectArray.length;f<m;f++)f>=t&&(i.selectArray[f].empty().prop("disabled",!0),"none"===i.settings.nodata?i.selectArray[f].css("display","none"):"hidden"===i.settings.nodata&&i.selectArray[f].css("visibility","hidden"));if("string"==typeof p&&p.length){if(c>=0){if(!i.selectArray[c].val().length)return;a=u.data("queryName"),l=i.selectArray[c].attr("name"),"string"==typeof a&&a.length?d[a]=i.selectArray[c].val():"string"==typeof l&&l.length&&(d[l]=i.selectArray[c].val())}e.getJSON(p,d,function(e){if(s=e,"string"==typeof h&&h.length)for(var t=h.split("."),n=0,r=t.length;n<r;n++)s=s[t[n]];i.buildOption(u,s)})}else if(i.dataJson&&"object"==typeof i.dataJson){s=i.dataJson;for(var f=0,m=i.selectArray.length;f<m;f++)f<t&&(o=i.getIndex(i.selectArray[f][0].selectedIndex),"object"==typeof s[o]&&e.isArray(s[o][i.settings.jsonSub])&&s[o][i.settings.jsonSub].length&&(r=f,s=s[o][i.settings.jsonSub]));(c<0||c===r)&&i.buildOption(u,s)}}},t.buildOption=function(t,n){var i=this,r="undefined"==typeof t.data("firstTitle")?i.settings.firstTitle:String(t.data("firstTitle")),s="undefined"==typeof t.data("firstValue")?i.settings.firstValue:String(t.data("firstValue")),o="undefined"==typeof t.data("jsonName")?i.settings.jsonName:String(t.data("jsonName")),a="undefined"==typeof t.data("jsonValue")?i.settings.jsonValue:String(t.data("jsonValue"));if(e.isArray(n)){var l=i.settings.required?"":'<option value="'+s+'">'+r+"</option>";if(o.length){a.length||(a=o);for(var c=0,u=n.length;c<u;c++)l+='<option value="'+String(n[c][a])+'">'+String(n[c][o])+"</option>"}else for(var c=0,u=n.length;c<u;c++)l+='<option value="'+String(n[c])+'">'+String(n[c])+"</option>";t.html(l).prop("disabled",!1).css({display:"",visibility:""}),"undefined"!=typeof t.data("value")&&t.val(String(t.data("value"))).removeAttr("data-value"),t.trigger("change")}},t.init.apply(t,arguments),this},e.cxSelect.defaults={selects:[],url:null,nodata:null,required:!1,firstTitle:"请选择",firstValue:"",jsonSpace:"",jsonName:"n",jsonValue:"",jsonSub:"s"},e.fn.cxSelect=function(t,n){return this.each(function(i){e.cxSelect(this,t,n)}),this}}),function(e){var t=navigator.userAgent.toLowerCase(),n=e.jQuery||e.zepto||n,i=0,r="UDESK_",s="/im_client/",o=s+"js/",a=s+"css/",l=[],c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","'":"&#39;",'"':"&quot;","\n":"<br/>"},u={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'","&#x60;":"`","&#39;":"'","&quot;":'"',"<br/>":"\n"},d=e.udesk={$:n,rootPath:s,jsRootPath:o,cssRootPath:a,id:function(){return r+ ++i},guid:function(e,t){return d.id()+"_"+(e||"")+ +new Date+(t?"*"+t:"")},ns:function(e,t){if(e){t=t||d;for(var n=e.split("."),i=0,r=n.length;i<r;i++)t=t[n[i]]=t[n[i]]||{}}},extend:function(){var e=this;n.each(arguments,function(){n.extend.call(e,this)})},replaceTpl:function(e,t,n){if(!e)return"";if(!t)return e;n=n||{};var i,r=n.xss,s=n.omitXss,o=e;for(var a in t)i=t[a]||"",r?("*"===r||this.hasStr(r,a))&&(i=this.xss(i)):s&&(this.hasStr(s,a)||(i=this.xss(i))),o=o.replace(new RegExp("{"+a+"}","gm"),i);return o},hasStr:function(e,t){return(","+e+",").indexOf(","+t+",")>-1},ifIE:function(e,t){var n=document.createElement("b");return n.innerHTML="<!--[if "+(t||"")+" IE "+(e||"")+"]><i></i><![endif]-->",1===n.getElementsByTagName("i").length},isIE11:function(){return t.indexOf("trident")>-1&&t.indexOf("rv")>-1},isEmptyObj:function(e){if(!e)return!1;for(var t in e)return!1;return!0},toArray:function(e){return Array.prototype.slice.call(e)||[]},platform:function(e){if(e){for(var n,i,r,s=new RegExp("(android|iphone|ipod|ios|ipad|webkit|windows phone|micromessenger|qq/|mqq|qqbrowser/|weibo|msie)","g");null!=(i=s.exec(t));)n=!0,r=i[1],e[r]&&e[r](r),e.ios&&/iphone|ipod|ipad/.test(r)&&e.ios(r),e.wp&&/windows phone/.test(r)&&e.wp(r),e.weixin&&/micromessenger/.test(r)&&e.weixin(r),e.mqq&&/mqq|qq\//.test(r)&&e.mqq(r),e.qq&&/qq\/|mqq|qqbrowser\//.test(r)&&e.qq(r),e.weibo&&/weibo/.test(r)&&e.weibo(r);!n&&e.others&&e.others()}},isTestENV:function(){var e=location.host;return/(ud|tiyanudesk|(udesk(.+)?)).com$/i.test(e)||/^localhost/.test(e)},isPC:function(){var e=!0;return this.platform({android:function(){e=!1},ios:function(){e=!1},wp:function(){e=!1}}),e},isMob:function(){return!this.isPC()},isIos:function(){var e=!0;return this.platform({ios:function(){e=!0}}),e}};d.extend({notification:function(e,t,n){if(e=e||"系统通知",n=n||{},window.Notification){if("granted"!=Notification.permission)return Notification.requestPermission();Notification.requestPermission(function(e){});var i=new Notification(e,{body:t,icon:n.img||"/im_client/images/notification24.png"});if(n.url&&window.open(n.url),i.onclick=function(e){n.click&&n.click(e),i.close()},l.push(i),l.length>3){var r=l.shift();r.close()}}},closeWindow:function(){var n=/qqbrowser/i,i="undefined"!=typeof WeixinJSBridge,r=function(e){try{e.opener=null,e.close()}catch(t){}};return i?WeixinJSBridge.call("closeWindow"):(r(e.top),void(n.test(t)||this.isMob()||(e.top.location.href="about:blank")))},urlParams:function(e){e=e||location.search;var t={},n=e.match(new RegExp("[?&][^?&]+=[^?&]+","g"));if(n)for(var i=0,r=n.length;i<r;i++){var s,o,a;try{s=n[i].substring(1).split("="),o=decodeURIComponent(s[0]),a=decodeURIComponent(s[1]),t[o]=a}catch(l){s&&s[0]&&(t[s[0]]=s[1]||"")}}return t},addNetworkListener:function(e){if(e){var t=[],n=2,i="images/emoji.png",r=0,s=function(){var s,o,a=new Date,l=document.createElement("img");l.src=i+"?"+a.getTime(),l.onload=function(){r=0,s=new Date,o=Math.round(1e3*n/(s-a)),t.push(o),e.success&&e.success(o,t)},l.onerror=function(){e.error&&e.error(++r)}};setInterval(s,e.interval||3e3)}},xss:function(e){if(e)for(var t in c)e=(e+"").replace(new RegExp(t,"g"),c[t]);return e||""},xssNotEnter:function(e){var t=n.extend({},c);if(delete t["\n"],e)for(var i in t)e=(e+"").replace(new RegExp(i,"g"),t[i]);return e||""},xssNotSymbol:function(e,t){var i=n.extend({},c);if(delete i[t],e)for(var r in i)e=(e+"").replace(new RegExp(r,"g"),i[r]);return e||""},unXssNotEnter:function(e){var t=n.extend({},u);if(delete t["<br/>"],e)for(var i in t)e=e.replace(new RegExp(i,"g"),t[i]);return e||""},unXss:function(e){if(e)for(var t in u)e=e.replace(new RegExp(t,"g"),u[t]);return e||""}}),d.extend({loader:{_cache:{},_toArr:function(e){return e?n.isArray(e)?e:[e]:[]},_js:function(e,t){var i=this;return t&&this._cache[e]?n.Deferred(function(e){n(e.resolve)}):n.getScript(e).then(function(t){return i._cache[e]=!0,t})},_css:function(e,t){if(!t||!this._cache[e]){var i=n("<link>");i.attr({rel:"stylesheet",type:"text/css",href:e}),n("head").append(i),this._cache[e]=!0}},js:function(e,t){var i,r=this;return t=n.extend({dir:o,cache:!0},t),i=n.map(this._toArr(e),function(e){return r._js((t.dir||"")+e,t.cache)}),n.when.apply(n,i)},css:function(e,t){var i=this;t=n.extend({dir:a,cache:!0},t),n.each(this._toArr(e),function(e,n){i._css((t.dir||"")+n,t.cache)})},files:function(e,t){var i=[],r=[];if(n.each(this._toArr(e),function(e,t){/\.css$/.test(t)?r.push(t):i.push(t)}),r.length&&this.css(r,t),i.length)return this.js(i,t)}}}),d.extend({context:{els:{},config:{}},emptyFn:function(){},clone:function(e){return n.extend({},e)},map:function(e,t){var i=[];return n.isArray(e)&&n.each(e,function(e,n){t&&i.push(t(e,n))}),i},parseJSON:function(e){return e&&"string"===n.type(e)?JSON.parse(e):e},joinStr:function(){var e=[];return n.each(arguments,function(t,i){i&&(n.isArray(i)?e=e.concat(i):e.push(n.trim(i)))}),e.join("")},createHtml:function(e,t){var i=n("<"+(e||"div")+">"),r={},s=n.extend({},t),o=[];return n.each(["tagName","class","className","css","act","iconName","text","html","tip"],function(e,t){s[t]&&(r[t]=s[t],delete s[t])}),r.act&&(s["data-act"]=r.act),r.tip&&(s["data-tip"]=r.tip),r["class"]&&o.push(r["class"]),r.className&&o.push(r.className),r.iconName&&o.push("icon icon-"+r.iconName),r["class"]=o.join(" "),r.css&&i.css(r.css),r.text&&i.text(r.text),r.html&&i.html(r.html),i.addClass(r["class"]),i.attr(s),n("<div>").append(i).html()},setContext:function(e){return e=this.clone(e),e.els=n.extend({},this.context.els,e.els),e.config=n.extend({},this.context.config,e.config),n.extend(this.context,e)}})}(this),function(e,t){function n(e){return e?_[e]:_}function i(e){return e=b.extend({},e),e.appBar&&e.appBar.onClick&&(y.appBarClickHandlers=y.appBarClickHandlers||[],y.appBarClickHandlers.push(e.appBar.onClick),delete e.appBar.onClick),e.appBar=b.extend({},_.appBar,e.appBar),e.editor=b.extend({},_.editor,e.editor),b.extend(_,e)}function r(t){t=t||{};var n=b(t.container||"body"),i=b(e.replaceTpl(x,t));return t.css&&i.css(t.css),n.find(".mask").remove(),n.append(i),i}function s(t){if(t){t=b.extend({},_,t);var n=t.needMask!==!1,i=t.needClose!==!1,s=t.container||b("body"),o=s.find(".im-pop"),a=b(e.replaceTpl(w,t)),l=n&&r(b.extend({container:s},t.mask)),c=function(){l&&l.show(),a.addClass("show"),t.show&&t.show(),_.show&&_.show(a,t)},u=function(){l&&l.hide(),a.removeClass("show"),t.hide&&t.hide(),_.hide&&_.hide(a,t)},d=function(){l&&l.remove(),a.remove(),t.hide&&t.hide(),t.remove&&t.remove(),_.hide&&_.hide(a,t)};o.remove(),t.title&&a.addClass("has-title"),y.isMob&&a.addClass("mob"),t.cssAttrs&&a.css(t.cssAttrs),s.append(a),c();var p=a.find(".btn-x");return i?p.click(u):p.remove(),y.isMob||t.isInner?a.css({width:"100%",minWidth:"100%"}):!t._isPop&&a.css({width:"364px",margin:"-"+a.height()/2+"px 0 0 -182px"}),{el:a,show:c,hide:u,close:d,toggle:function(){"none"==a.css("display")?c():u()}}}}function o(e){var t=_.isInner,n=s(b.extend(e,{clz:"im-modal "+(e.clz||""),mask:b.extend({clz:e.clz||""},e.mask)}));return!y.isMob&&!t&&n.el.css({left:"50%",top:"50%"}),n}function a(e){return o(b.extend({needClose:!1},e,{clz:"tiny-modal "+(e.clz||"")}))}function l(e){e=e||{};var t=b(e.target),n=t.offset(),i=e.offset||{},r=e.cssAttrs||{};r=b.extend({top:n.top+(i.top||0)+"px",left:n.left+(i.left||0)+"px"},r);var o=s(b.extend({_isPop:!0,needMask:!1,needClose:!1,cssAttrs:r},e));return o}function c(t,n){if(t){n=b.extend({type:"success",autoClose:!0},_.tip,n);var i="tip",r=e.id(),s=["ui-"+i,"bg-"+n.type,"clearfix"],o=b(n.container||document.body),a=b(e.joinStr('<div id="'+r+'" class="'+s.join(" ")+'">',t,'   <a data-act="close" class="icon icon-guanbi"></a>',"</div>"));return n.css&&a.css(n.css),a.on("click","[data-act]",function(e){var t=b(this).data("act");"close"===t&&a.fadeOut(),n.onClick&&n.onClick(t,n)}),o.find("."+s[0]).remove(),o.append(a),a.fadeIn(),n.autoClose&&setTimeout(function(){a.fadeOut()},n.time||3e3),a}}function u(e,t){y.isMob||(e=b(e),t=b.extend({delay:{show:300,hide:100}},t),e.find("[data-toggle='tooltip']").tooltip(t))}function d(t){t=t||{},t.noDefault||(t=b.extend({},_.appBar,t));var n,i,r="appbar",s=["ui-"+r,"clearfix"],o=e.createHtml,a=b(t.container),l=t.getButtons?t.getButtons(t):t.buttons,c=[];return t.btnBack&&s.push("has-back"),!t.avatar&&!t.desc&&c.push("margin-top: 10px"),t.title&&(n=e.joinStr('<div class="title" title='+(t.title||"")+' style="'+c.join(";")+'">'+t.title,"  <span>"+(t.inputting||"")+"</span>","</div>")),i=b(e.joinStr('<div class="'+s.join(" ")+'">','  <div class="pull-left">',t.btnBack&&o("a",{act:"back",iconName:"arrow-left"}),t.avatar&&'<img src="'+t.avatar+'" />','    <div class="title-box">',n,t.desc&&'<div class="desc" title="'+t.desc+'">'+t.desc+"</div>","    </div>","  </div>",'  <div class="pull-right">',e.map(l,function(e,t){return o("a",t)}),"  </div>","</div>")),i.on("click","[data-act]",function(e){var n=b(this),i=n.data("act");t.onClick&&t.onClick(i,{el:n}),b.each(y.appBarClickHandlers,function(e,t){t(i,{el:n})})}),a.empty(),a.append(i),t.onReady&&t.onReady(i,t),i}function p(t){t=b.extend({},_.editor,t);var n="editor",i=["ui-"+n,"clearfix"],r=e.createHtml,s=b(t.container),o=t.textarea||{},a=t.getButtons?t.getButtons(t):t.buttons,l=b.extend({"class":"btn-send"},t.btnSend,{"data-act":"send"}),c=b(e.joinStr('<div class="'+i.join(" ")+'">','    <div class="tipbar"></div>','    <div class="textbox">',r("textarea",o),r("a",l),"   </div>",'   <div class="more-box"></div>','   <div class="toolbar clearfix">',e.map(a,function(e,t){return r("a",t)}),"    </div>","</div>"));return!o.value&&c.find("textarea").val(""),c.on("click","[data-act]",function(e){var n=b(this).data("act");"send"===n?t.onSend&&t.onSend():t.onClick&&t.onClick(n)}).on("keydown","textarea",function(e){if(13==e.keyCode){if(e.shiftKey)return;return t.onSend&&t.onSend(),e.preventDefault()}}).on("input propertychange","textarea",function(e){t.onInput&&t.onInput()}),s.empty(),s.append(c),t.onReady&&t.onReady(c,t),c}function h(t){t=t||{},t=b.extend({type:"bar",percentage:0,color:_.themeColor,size:"circle"===t.type?32:2},_.progress,t);var n,i="progress",r=["ui-"+i,i+"-"+t.type].concat(t.clz||[]),s=b(t.container);return n=s.find("."+r[0]),n.size()||(n=b(e.joinStr('<div class="'+r.join(" ")+'">',"   <div></div>","</div>")),n.height(t.height),s.append(n)),"bar"===t.type&&n.find(">div").css({width:t.percentage+"%",backgroundColor:t.color}),n}function f(t){t=b.extend({type:"page"},_.form,t);var n="form",i=["ui-"+n,"clearfix"],r=e.createHtml,s=b(t.container),o=t.getButtons?t.getButtons(t):t.buttons,a=b(e.joinStr('<div class="'+i.join(" ")+'">','    <div class="form-body">',t.desc&&'<div class="desc">'+t.desc+"</div>",T.isStr(t.body)&&t.body,"    </div>",'    <div class="toolbar clearfix">',e.map(o,function(e,t){return r(t.tagName,t)}),"    </div>","</div>")),l=a.find(">.form-body");a.find(">.toolbar");return T.isEl(t.body)&&l.append(t.body),a.on("click","[data-act]",function(e){var n=b(this),i=n.data("act");t.onClick&&t.onClick(i,{el:n})}),s.html(a),a}function m(t){t=b.extend({},t),_.board=_.board||{},t.header!==!1&&(t.header=b.extend({},_.board.header,t.header)),t=b.extend({type:"html",open:!0,container:document.body},_.board,t);var n,i,r,s,o="board",a=o+"-header",l=o+"-body",c=["ui-"+o,"box-shadow","clearfix"],u=b(t.container);if(s="iframe"===t.type,t.id&&(n=u.find("#"+t.id),_.board.id=t.id,_.board.ids=_.board.ids||[],_.board.ids.push(t.id)),n&&t.replace&&(n.remove(),n=null),e.platform({iphone:function(){u.width(document.documentElement.clientWidth||document.body.clientWidth)}}),!n||!n.size()){if(n=b(e.joinStr('<div class="'+c.join(" ")+'">','   <div class="'+a+'">',"   </div>",'   <div class="'+l+'">',s?'<iframe frameborder="0"></iframe>':T.isStr(t.body)?t.body:"","   </div>","</div>")),t.id&&n.attr("id",t.id),i=n.find(">."+a),r=n.find(">."+l),t.header?(i.addClass("header"),i.css({backgroundColor:t.themeColor}),d(b.extend({noDefault:!0,title:t.title,container:i,titleWidth:u.width()},t.header))):r.css("top",0),s){var p={src:t.body},h=r.find("iframe");h.attr(p)}else T.isEl(t.body)&&r.append(t.body);n.on("click","[data-act]",function(e){var i=b(this).data("act");t.onClick&&t.onClick(i,{el:n})}),u.append(n)}return t.open&&((y.isMob||_.isInner)&&(t.noAnimate||((!y.lastBoardOpenTime||new Date-y.lastBoardOpenTime>1e3)&&n.addClass("animate").css("left","110%"),y.lastBoardOpenTime=new Date)),T.delayFn(function(){y.boardZIndex=y.boardZIndex||99998,n.css("zIndex",++y.boardZIndex).addClass("open"),setTimeout(function(){n.css("left",0)},50),t.onDelayShow&&t.onDelayShow({el:n})})),t.onReady&&t.onReady(n,t),n}function g(t){t=b.extend({},_.dialog,t);var n,i="dialog",s=["ui-"+i].concat(t.clz||[]),o=[t.title?i+"-header":""],a=[i+"-body"],l=[t.buttons?i+"-footer":""],c=e.createHtml,u=b(t.container||"body"),d=t.mask||{},p=r(b.extend({container:u,css:b.extend({top:0},d.css)},d)),h=p.css("z-index")+1;return u.find("."+s[0]).remove(),n=b(e.joinStr('<div class="'+s.join(" ")+'">','   <div class="'+o.join(" ")+'">'+(t.title||""),t.needClose&&'<a data-act="close" class="icon icon-guanbi"></a>',"   </div>",'   <div class="'+a.join(" ")+'">',T.isStr(t.body)&&t.body,"   </div>",'   <div class="'+l.join(" ")+'">',e.map(t.buttons,function(e,t){return c(t.tagName,t)}),"   </div>","</div>")),u.append(n),T.autoCenter(n,{zIndex:h}),n.on("click","[data-act]",function(e){var n=b(this),i=n.data("act");t.onClick&&t.onClick(i,{el:n})}),n}function v(e){e=b.extend({},_.imgPreview,e);var t="img-preview",n=_.themeColor,i=b(e.container||"body"),r=g(b.extend({needClose:!0,body:"<img />",buttons:e.sendText&&[{"class":"btn",act:"send",text:e.sendText||"",css:{color:"#fff",backgroundColor:n}}]},e,{onClick:function(t){"close"!==t&&"send"!==t||(s.remove(),r.remove()),e.onClick&&e.onClick(t,{el:r})}})),s=i.find(">.mask"),o=r.find("img");return r.addClass("ui-"+t),e.src&&o.attr("src",e.src),o[0].onload=function(){T.autoCenter(r)},r}var b=e.$,y={isMob:e.isMob()},_={},x='<div class="mask {clz}"></div>',w=['<dl class="im-pop {clz}">',"  <dt>{title}</dt>",'  <dd class="{contentClz}">{content}<a class="btn-x icon icon-guanbi"></a></dd>',"</dl>"].join(""),T={isEl:function(e){return!!e&&(1===e.nodeType||e instanceof b)},isStr:function(e){return"string"===b.type(e)},isObj:function(e){return"object"===b.type(e)},delayFn:function(e,t){return setTimeout(function(){e&&e()},t||50)},autoCenter:function(e,t){e&&e.css(b.extend({position:"absolute",top:"50%",left:"50%",margin:"-"+e.height()/2+"px 0 0 -"+e.width()/2+"px"},t))}};b(function(){var e=document.body;b(e).click(function(){b(".im-pop").not(".im-modal").hide();var e=b("#footer"),t=e.find(".toolbar"),n=e.find(".more-box"),i=t.find("a").filter(function(){var e=b(this);return"none"!==e.css("display")});b.each(i,function(e,t){b(t).attr("clickshow")&&b(t).hide()}),n.hide()}).on("click",".im-pop,.mask",function(e){e.stopPropagation()})}),e.ui={util:T,mask:r,modal:o,tinyModal:a,pop:l,tip:c,tooltip:u,form:f,appBar:d,editor:p,progress:h,board:m,dialog:g,imgPreview:v,config:function(e){return e?i(e):n()}}}(this.udesk,this),function(e,t){var n,i,r=[],s=28,o=56,a=e.isMob(),l='<a data-value="{value}"><i class="emoji emoji{num}"></i></a>',c=function(e){return e>99?e:e>9?"0"+e:"00"+e},u=function(t){var n="";if(t.isSdk)for(var i=1;i<=s;i++){var a=c(i),u="[emoji"+a+"]";r.push(u),n+=e.replaceTpl(l,{num:a,value:u})}else for(var i=29;i<=o;i++){var a=c(i),u="[emoji"+a+"]";r.push(u),n+=e.replaceTpl(l,{num:a,value:u})}return n='<div class="emoji-panel">'+n+"</div>"},d=function(t){if(t){i=t;var r=$(t.target);return r.off("click").click(function(){if(n&&n.el.is(":visible"))return void n.hide();var i=t.isCopyRight?30:0,r=$("#footer"),s={bottom:a?i:r.outerHeight()+i+"px"};(a||t.isInner)&&(s.left=0,s.width="100%"),n=e.ui.pop($.extend({needClose:!1,content:u(t),cssAttrs:s,clz:"im-emotion"},t)),(a||t.isInner)&&n.el.find(".emoji-panel").css({paddingLeft:"15px"}),n.el.on("click","dd a",t.click)}),{show:function(){n&&n.show()},hide:function(){n&&n.hide()}}}},p=function(e){return e?e.replace(/\[emoji([^\].]+)\]/g,'<span class="emoji emoji$1"></span>'):""};$(window).resize(function(){if(n){var t=!1;e.platform({ios:function(){t=!0}}),!t&&n.hide()}}),$(document).on("click",function(){n&&n.hide()}),e.ui=e.ui||{},e.ui.emotion=d,e.ui.emotionToHtml=p}(this.udesk,this),function(e,t,n){e.log=n(e,t)}(this.udesk,this,function(e,t){function n(e,t){if(e&&t)for(var n=0,i=e.length;n<i;n++)if(t.indexOf(e[n])>-1)return!0;return!1}function i(e,t){for(var n=0,i=e.length;n<i;n++)if(t(e[n]))return e[n]}function r(e,t,r){if(t){e=e||"info",r=r||{};var s=r.path||"",o=r.statusText||"";if(delete r.path,delete r.statusText,(s||c.allow_path_empty)&&(!c.allow_paths.length||n(c.allow_paths,s))){var a=i(u,function(e){return e&&e.path===s}),l=a&&a.params&&a.params.date,d=new Date;!l&&(l=d),r.date=d,r.type=e,u.push({duration:d-l,path:s,content:t,status:o,params:r})}}}function s(){u.length=0}function o(){if(u.length){var e,t=c.user,n={log_type:c.log_type,logs:[]};l.each(u,function(t,i){"ajaxSend"!==i.content&&n.logs.push(i),!e&&(e="error"===i.params.type)}),e&&(t&&(n.role=t.role,n.logs.unshift({content:"userData",params:t})),n.logs=JSON.stringify(n.logs),l.post(c.api,n),s())}}var a,l=e.$,c={api:"/spa1/im/im_logs/im_client_logs",log_type:"im-client-logs",allow_path_empty:!0,allow_paths:[]},u=[],d=6e4,p=1e4;return setTimeout(o,p),a=setInterval(o,d),{config:function(e){if(e){var t=c.user;l.extend(c,e),t&&e.user&&l.extend(c.user,t)}},stop:function(){clearInterval(a)},info:function(e,t){r("info",e,t)},warn:function(e,t){r("warn",e,t)},error:function(e,t){r("error",e,t)}}});var Base64=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t={encode:function(t){var n,i,r,s,o,a,l,c="",u=0;do n=t.charCodeAt(u++),i=t.charCodeAt(u++),r=t.charCodeAt(u++),s=n>>2,o=(3&n)<<4|i>>4,a=(15&i)<<2|r>>6,l=63&r,isNaN(i)?a=l=64:isNaN(r)&&(l=64),c=c+e.charAt(s)+e.charAt(o)+e.charAt(a)+e.charAt(l);while(u<t.length);return c},decode:function(t){var n,i,r,s,o,a,l,c="",u=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do s=e.indexOf(t.charAt(u++)),o=e.indexOf(t.charAt(u++)),a=e.indexOf(t.charAt(u++)),l=e.indexOf(t.charAt(u++)),n=s<<2|o>>4,i=(15&o)<<4|a>>2,r=(3&a)<<6|l,c+=String.fromCharCode(n),64!=a&&(c+=String.fromCharCode(i)),64!=l&&(c+=String.fromCharCode(r));while(u<t.length);return c}};return t}(),MD5=function(){var e=function(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n},t=function(e,t){return e<<t|e>>>32-t},n=function(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},i=function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t},r=function(e){for(var t="0123456789abcdef",n="",i=0;i<4*e.length;i++)n+=t.charAt(e[i>>2]>>i%4*8+4&15)+t.charAt(e[i>>2]>>i%4*8&15);return n},s=function(n,i,r,s,o,a){return e(t(e(e(i,n),e(s,a)),o),r)},o=function(e,t,n,i,r,o,a){return s(t&n|~t&i,e,t,r,o,a)},a=function(e,t,n,i,r,o,a){return s(t&i|n&~i,e,t,r,o,a)},l=function(e,t,n,i,r,o,a){return s(t^n^i,e,t,r,o,a)},c=function(e,t,n,i,r,o,a){return s(n^(t|~i),e,t,r,o,a)},u=function(t,n){
t[n>>5]|=128<<n%32,t[(n+64>>>9<<4)+14]=n;for(var i,r,s,u,d=1732584193,p=-271733879,h=-1732584194,f=271733878,m=0;m<t.length;m+=16)i=d,r=p,s=h,u=f,d=o(d,p,h,f,t[m+0],7,-680876936),f=o(f,d,p,h,t[m+1],12,-389564586),h=o(h,f,d,p,t[m+2],17,606105819),p=o(p,h,f,d,t[m+3],22,-1044525330),d=o(d,p,h,f,t[m+4],7,-176418897),f=o(f,d,p,h,t[m+5],12,1200080426),h=o(h,f,d,p,t[m+6],17,-1473231341),p=o(p,h,f,d,t[m+7],22,-45705983),d=o(d,p,h,f,t[m+8],7,1770035416),f=o(f,d,p,h,t[m+9],12,-1958414417),h=o(h,f,d,p,t[m+10],17,-42063),p=o(p,h,f,d,t[m+11],22,-1990404162),d=o(d,p,h,f,t[m+12],7,1804603682),f=o(f,d,p,h,t[m+13],12,-40341101),h=o(h,f,d,p,t[m+14],17,-1502002290),p=o(p,h,f,d,t[m+15],22,1236535329),d=a(d,p,h,f,t[m+1],5,-165796510),f=a(f,d,p,h,t[m+6],9,-1069501632),h=a(h,f,d,p,t[m+11],14,643717713),p=a(p,h,f,d,t[m+0],20,-373897302),d=a(d,p,h,f,t[m+5],5,-701558691),f=a(f,d,p,h,t[m+10],9,38016083),h=a(h,f,d,p,t[m+15],14,-660478335),p=a(p,h,f,d,t[m+4],20,-405537848),d=a(d,p,h,f,t[m+9],5,568446438),f=a(f,d,p,h,t[m+14],9,-1019803690),h=a(h,f,d,p,t[m+3],14,-187363961),p=a(p,h,f,d,t[m+8],20,1163531501),d=a(d,p,h,f,t[m+13],5,-1444681467),f=a(f,d,p,h,t[m+2],9,-51403784),h=a(h,f,d,p,t[m+7],14,1735328473),p=a(p,h,f,d,t[m+12],20,-1926607734),d=l(d,p,h,f,t[m+5],4,-378558),f=l(f,d,p,h,t[m+8],11,-2022574463),h=l(h,f,d,p,t[m+11],16,1839030562),p=l(p,h,f,d,t[m+14],23,-35309556),d=l(d,p,h,f,t[m+1],4,-1530992060),f=l(f,d,p,h,t[m+4],11,1272893353),h=l(h,f,d,p,t[m+7],16,-155497632),p=l(p,h,f,d,t[m+10],23,-1094730640),d=l(d,p,h,f,t[m+13],4,681279174),f=l(f,d,p,h,t[m+0],11,-358537222),h=l(h,f,d,p,t[m+3],16,-722521979),p=l(p,h,f,d,t[m+6],23,76029189),d=l(d,p,h,f,t[m+9],4,-640364487),f=l(f,d,p,h,t[m+12],11,-421815835),h=l(h,f,d,p,t[m+15],16,530742520),p=l(p,h,f,d,t[m+2],23,-995338651),d=c(d,p,h,f,t[m+0],6,-198630844),f=c(f,d,p,h,t[m+7],10,1126891415),h=c(h,f,d,p,t[m+14],15,-1416354905),p=c(p,h,f,d,t[m+5],21,-57434055),d=c(d,p,h,f,t[m+12],6,1700485571),f=c(f,d,p,h,t[m+3],10,-1894986606),h=c(h,f,d,p,t[m+10],15,-1051523),p=c(p,h,f,d,t[m+1],21,-2054922799),d=c(d,p,h,f,t[m+8],6,1873313359),f=c(f,d,p,h,t[m+15],10,-30611744),h=c(h,f,d,p,t[m+6],15,-1560198380),p=c(p,h,f,d,t[m+13],21,1309151649),d=c(d,p,h,f,t[m+4],6,-145523070),f=c(f,d,p,h,t[m+11],10,-1120210379),h=c(h,f,d,p,t[m+2],15,718787259),p=c(p,h,f,d,t[m+9],21,-343485551),d=e(d,i),p=e(p,r),h=e(h,s),f=e(f,u);return[d,p,h,f]},d={hexdigest:function(e){return r(u(n(e),8*e.length))},hash:function(e){return i(u(n(e),8*e.length))}};return d}();Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice,i=Array.prototype.concat,r=n.call(arguments,1);return function(){return t.apply(e?e:this,i.call(r,n.call(arguments,0)))}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length,n=Number(arguments[1])||0;for(n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=t);n<t;n++)if(n in this&&this[n]===e)return n;return-1}),function(e){function t(e,t){return new s.Builder(e,t)}function n(e){return new s.Builder("message",e)}function i(e){return new s.Builder("iq",e)}function r(e){return new s.Builder("presence",e)}var s;s={VERSION:"1.1.3",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<s.XHTML.tags.length;t++)if(e==s.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if("undefined"!=typeof s.XHTML.attributes[e]&&s.XHTML.attributes[e].length>0)for(var n=0;n<s.XHTML.attributes[e].length;n++)if(t==s.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<s.XHTML.css.length;t++)if(e==s.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){s.NS[e]=t},forEachChild:function(e,t,n){var i,r;for(i=0;i<e.childNodes.length;i++)r=e.childNodes[i],r.nodeType!=s.ElementType.NORMAL||t&&!this.isTagEqual(r,t)||n(r)},isTagEqual:function(e,t){return e.tagName.toLowerCase()==t.toLowerCase()},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom(),e.appendChild(e.createElement("strophe"))):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return s._xmlGenerator||(s._xmlGenerator=s._makeGenerator()),s._xmlGenerator},_getIEXmlDom:function(){for(var e=null,t=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<t.length&&null===e;n++)try{e=new ActiveXObject(t[n])}catch(i){e=null}return e},xmlElement:function(e){if(!e)return null;var t,n,i,r=s.xmlGenerator().createElement(e);for(t=1;t<arguments.length;t++)if(arguments[t])if("string"==typeof arguments[t]||"number"==typeof arguments[t])r.appendChild(s.xmlTextNode(arguments[t]));else if("object"==typeof arguments[t]&&"function"==typeof arguments[t].sort)for(n=0;n<arguments[t].length;n++)"object"==typeof arguments[t][n]&&"function"==typeof arguments[t][n].sort&&r.setAttribute(arguments[t][n][0],arguments[t][n][1]);else if("object"==typeof arguments[t])for(i in arguments[t])arguments[t].hasOwnProperty(i)&&r.setAttribute(i,arguments[t][i]);return r},xmlescape:function(e){return e=e.replace(/\&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/'/g,"&apos;"),e=e.replace(/"/g,"&quot;")},xmlTextNode:function(e){return s.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;if(window.DOMParser){var n=new DOMParser;t=n.parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType==s.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType==s.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return s.xmlescape(t)},copyElement:function(e){var t,n;if(e.nodeType==s.ElementType.NORMAL){for(n=s.xmlElement(e.tagName),t=0;t<e.attributes.length;t++)n.setAttribute(e.attributes[t].nodeName.toLowerCase(),e.attributes[t].value);for(t=0;t<e.childNodes.length;t++)n.appendChild(s.copyElement(e.childNodes[t]))}else e.nodeType==s.ElementType.TEXT&&(n=s.xmlGenerator().createTextNode(e.nodeValue));return n},createHtml:function(e){var t,n,i,r,o,a,l,c,u,d,p;if(e.nodeType==s.ElementType.NORMAL)if(r=e.nodeName.toLowerCase(),s.XHTML.validTag(r))try{for(n=s.xmlElement(r),t=0;t<s.XHTML.attributes[r].length;t++)if(o=s.XHTML.attributes[r][t],a=e.getAttribute(o),"undefined"!=typeof a&&null!==a&&""!==a&&a!==!1&&0!==a)if("style"==o&&"object"==typeof a&&"undefined"!=typeof a.cssText&&(a=a.cssText),"style"==o){for(l=[],c=a.split(";"),i=0;i<c.length;i++)u=c[i].split(":"),d=u[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),s.XHTML.validCSS(d)&&(p=u[1].replace(/^\s*/,"").replace(/\s*$/,""),l.push(d+": "+p));l.length>0&&(a=l.join("; "),n.setAttribute(o,a))}else n.setAttribute(o,a);for(t=0;t<e.childNodes.length;t++)n.appendChild(s.createHtml(e.childNodes[t]))}catch(h){n=s.xmlTextNode("")}else for(n=s.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(s.createHtml(e.childNodes[t]));else if(e.nodeType==s.ElementType.FRAGMENT)for(n=s.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(s.createHtml(e.childNodes[t]));else e.nodeType==s.ElementType.TEXT&&(n=s.xmlTextNode(e.nodeValue));return n},escapeNode:function(e){return e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=s.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},log:function(e,t){},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){var t;if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var n,i,r=e.nodeName;for(e.getAttribute("_realname")&&(r=e.getAttribute("_realname")),t="<"+r,n=0;n<e.attributes.length;n++)"_realname"!=e.attributes[n].nodeName&&(t+=" "+e.attributes[n].nodeName.toLowerCase()+"='"+e.attributes[n].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/>/g,"&gt;").replace(/</g,"&lt;")+"'");if(e.childNodes.length>0){for(t+=">",n=0;n<e.childNodes.length;n++)switch(i=e.childNodes[n],i.nodeType){case s.ElementType.NORMAL:t+=s.serialize(i);break;case s.ElementType.TEXT:t+=s.xmlescape(i.nodeValue);break;case s.ElementType.CDATA:t+="<![CDATA["+i.nodeValue+"]]>"}t+="</"+r+">"}else t+="/>";return t},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){s._connectionPlugins[e]=t}},s.Builder=function(e,t){"presence"!=e&&"message"!=e&&"iq"!=e||(t&&!t.xmlns?t.xmlns=s.NS.CLIENT:t||(t={xmlns:s.NS.CLIENT})),this.nodeTree=s.xmlElement(e,t),this.node=this.nodeTree},s.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return s.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(e){for(var t in e)e.hasOwnProperty(t)&&this.node.setAttribute(t,e[t]);return this},c:function(e,t,n){var i=s.xmlElement(e,t,n);return this.node.appendChild(i),n||(this.node=i),this},cnode:function(e){var t,n=s.xmlGenerator();try{t=void 0!==n.importNode}catch(i){t=!1}var r=t?n.importNode(e,!0):s.copyElement(e);return this.node.appendChild(r),this.node=r,this},t:function(e){var t=s.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var n=s.createHtml(t);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},s.Handler=function(e,t,n,i,r,o,a){this.handler=e,this.ns=t,this.name=n,this.type=i,this.id=r,this.options=a||{matchBare:!1},this.options.matchBare||(this.options.matchBare=!1),this.options.matchBare?this.from=o?s.getBareJidFromJid(o):null:this.from=o,this.user=!0},s.Handler.prototype={isMatch:function(e){var t,n=null;if(n=this.options.matchBare?s.getBareJidFromJid(e.getAttribute("from")):e.getAttribute("from"),t=!1,this.ns){var i=this;s.forEachChild(e,null,function(e){e.getAttribute("xmlns")==i.ns&&(t=!0)}),t=t||e.getAttribute("xmlns")==this.ns}else t=!0;return!(!t||this.name&&!s.isTagEqual(e,this.name)||this.type&&e.getAttribute("type")!=this.type||this.id&&e.getAttribute("id")!=this.id||this.from&&n!=this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(n){throw n.sourceURL?s.fatal("error: "+this.handler+" "+n.sourceURL+":"+n.line+" - "+n.name+": "+n.message):n.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",n,n.message)),s.fatal("error: "+this.handler+" "+n.fileName+":"+n.lineNumber+" - "+n.name+": "+n.message)):s.fatal("error: "+n.message+"\n"+n.stack),n}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},s.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},s.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},s.Connection=function(e,t){this.service=e,this.options=t||{};var n=this.options.protocol||"";0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===n.indexOf("ws")?this._proto=new s.Websocket(this):this._proto=new s.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this._idleTimeout=null,this._disconnectTimeout=null,this.do_authentication=!0,this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this.paused=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var i in s._connectionPlugins)if(s._connectionPlugins.hasOwnProperty(i)){var r=s._connectionPlugins[i],o=function(){};o.prototype=r,this[i]=new o,this[i].init(this)}},s.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){return"string"==typeof e||"number"==typeof e?++this._uniqueId+":"+e:++this._uniqueId+""},connect:function(e,t,n,i,r,o){this.jid=e,this.authzid=s.getBareJidFromJid(this.jid),this.authcid=s.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.errors=0,this.domain=s.getDomainFromJid(this.jid),this._changeConnectStatus(s.Status.CONNECTING,null),this._proto._connect(i,r,o)},attach:function(e,t,n,i,r,s,o){this._proto._attach(e,t,n,i,r,s,o)},xmlInput:function(e){},xmlOutput:function(e){},rawInput:function(e){},rawOutput:function(e){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(e,t,n,i){var r=null,s=this;"function"==typeof e.tree&&(e=e.tree());var o=e.getAttribute("id");o||(o=this.getUniqueId("sendIQ"),e.setAttribute("id",o));var a=this.addHandler(function(e){r&&s.deleteTimedHandler(r);var i=e.getAttribute("type");if("result"==i)t&&t(e);else{if("error"!=i)throw{name:"StropheError",message:"Got bad IQ type of "+i};n&&n(e)}},null,"iq",null,o);return i&&(r=this.addTimedHandler(i,function(){return s.deleteHandler(a),n&&n(null),!1})),this.send(e),o},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(e)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(e,t){var n=new s.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,i,r,o,a){var l=new s.Handler(e,t,n,i,r,o,a);return this.addHandlers.push(l),l},deleteHandler:function(e){this.removeHandlers.push(e)},disconnect:function(e){if(this._changeConnectStatus(s.Status.DISCONNECTING,e),s.info("Disconnect was called because: "+e),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=r({xmlns:s.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}},_changeConnectStatus:function(e,t){for(var n in s._connectionPlugins)if(s._connectionPlugins.hasOwnProperty(n)){var i=this[n];if(i.statusChanged)try{i.statusChanged(e,t)}catch(r){s.error(""+n+" plugin caused an exception changing status: "+r)}}if(this.connect_callback)try{this.connect_callback(e,t)}catch(o){s.error("User connection callback caused an exception: "+o)}},_doDisconnect:function(){null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),s.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(s.Status.DISCONNECTED,null),this.connected=!1},_dataRecv:function(e,t){s.info("_dataRecv called");var n=this._proto._reqToData(e);if(null!==n){this.xmlInput!==s.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==s.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(s.serialize(n)));for(var i,r;this.removeHandlers.length>0;)r=this.removeHandlers.pop(),i=this.handlers.indexOf(r),i>=0&&this.handlers.splice(i,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var o,a,l=n.getAttribute("type");if(null!==l&&"terminate"==l){if(this.disconnecting)return;return o=n.getAttribute("condition"),a=n.getElementsByTagName("conflict"),null!==o?("remote-stream-error"==o&&a.length>0&&(o="conflict"),this._changeConnectStatus(s.Status.CONNFAIL,o)):this._changeConnectStatus(s.Status.CONNFAIL,"unknown"),void this.disconnect("unknown stream-error")}var c=this;s.forEachChild(n,null,function(e){var t,n;for(n=c.handlers,c.handlers=[],t=0;t<n.length;t++){var i=n[t];try{!i.isMatch(e)||!c.authenticated&&i.user?c.handlers.push(i):i.run(e)&&c.handlers.push(i)}catch(r){s.warn("Removing Strophe handlers due to uncaught exception: "+r.message)}}})}},mechanisms:{},_connect_cb:function(e,t,n){s.info("_connect_cb was called"),this.connected=!0;var i=this._proto._reqToData(e);if(i){this.xmlInput!==s.Connection.prototype.xmlInput&&(i.nodeName===this._proto.strip&&i.childNodes.length?this.xmlInput(i.childNodes[0]):this.xmlInput(i)),this.rawInput!==s.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(s.serialize(i)));var r=this._proto._connect_cb(i);if(r!==s.Status.CONNFAIL){this._authentication.sasl_scram_sha1=!1,this._authentication.sasl_plain=!1,this._authentication.sasl_digest_md5=!1,this._authentication.sasl_anonymous=!1,this._authentication.legacy_auth=!1;var o=i.getElementsByTagName("stream:features").length>0;o||(o=i.getElementsByTagName("features").length>0);var a,l,c=i.getElementsByTagName("mechanism"),u=[],d=!1;if(!o)return void this._proto._no_auth_received(t);if(c.length>0)for(a=0;a<c.length;a++)l=s.getText(c[a]),this.mechanisms[l]&&u.push(this.mechanisms[l]);return this._authentication.legacy_auth=i.getElementsByTagName("auth").length>0,(d=this._authentication.legacy_auth||u.length>0)?void(this.do_authentication!==!1&&this.authenticate(u)):void this._proto._no_auth_received(t)}}},authenticate:function(e){var n;for(n=0;n<e.length-1;++n){for(var r=n,o=n+1;o<e.length;++o)e[o].prototype.priority>e[r].prototype.priority&&(r=o);if(r!=n){var a=e[n];e[n]=e[r],e[r]=a}}var l=!1;for(n=0;n<e.length;++n)if(e[n].test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[n],this._sasl_mechanism.onStart(this);var c=t("auth",{xmlns:s.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var u=this._sasl_mechanism.onChallenge(this,null);c.t(Base64.encode(u))}this.send(c.tree()),l=!0;break}l||(null===s.getNodeFromJid(this.jid)?(this._changeConnectStatus(s.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(s.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(i({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:s.NS.AUTH}).c("username",{}).t(s.getNodeFromJid(this.jid)).tree())))},_sasl_challenge_cb:function(e){var n=Base64.decode(s.getText(e)),i=this._sasl_mechanism.onChallenge(this,n),r=t("response",{xmlns:s.NS.SASL});return""!==i&&r.t(Base64.encode(i)),this.send(r.tree()),!0},_auth1_cb:function(e){var t=i({type:"set",id:"_auth_2"}).c("query",{xmlns:s.NS.AUTH}).c("username",{}).t(s.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return s.getResourceFromJid(this.jid)||(this.jid=s.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(s.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1},_sasl_success_cb:function(e){if(this._sasl_data["server-signature"]){var t,n=Base64.decode(s.getText(e)),i=/([a-z]+)=([^,]+)(,|$)/,r=n.match(i);if("v"==r[1]&&(t=r[2]),t!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}return s.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null),this._sendRestart(),!1},_sasl_auth1_cb:function(e){this.features=e;var t,n;for(t=0;t<e.childNodes.length;t++)n=e.childNodes[t],"bind"==n.nodeName&&(this.do_bind=!0),"session"==n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(s.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var r=s.getResourceFromJid(this.jid);return r?this.send(i({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:s.NS.BIND}).c("resource",{}).t(r).tree()):this.send(i({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:s.NS.BIND}).tree()),!1},_sasl_bind_cb:function(e){if("error"==e.getAttribute("type")){s.info("SASL binding failed.");var t,n=e.getElementsByTagName("conflict");return n.length>0&&(t="conflict"),this._changeConnectStatus(s.Status.AUTHFAIL,t),!1}var r,o=e.getElementsByTagName("bind");return o.length>0?(r=o[0].getElementsByTagName("jid"),void(r.length>0&&(this.jid=s.getText(r[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(i({type:"set",id:"_session_auth_2"}).c("session",{xmlns:s.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(s.Status.CONNECTED,null))))):(s.info("SASL binding failed."),this._changeConnectStatus(s.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(e){if("result"==e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(s.Status.CONNECTED,null);else if("error"==e.getAttribute("type"))return s.info("Session creation failed."),this._changeConnectStatus(s.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(s.Status.AUTHFAIL,null),!1},_auth2_cb:function(e){return"result"==e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(s.Status.CONNECTED,null)):"error"==e.getAttribute("type")&&(this._changeConnectStatus(s.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var n=new s.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,i,r){var o=new s.Handler(e,t,n,i,r);return o.user=!1,this.addHandlers.push(o),o},_onDisconnectTimeout:function(){return s.info("_onDisconnectTimeout was called"),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e,t,n,i;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)t=this.removeTimeds.pop(),e=this.timedHandlers.indexOf(t),e>=0&&this.timedHandlers.splice(e,1);var r=(new Date).getTime();for(i=[],e=0;e<this.timedHandlers.length;e++)t=this.timedHandlers[e],!this.authenticated&&t.user||(n=t.lastCalled+t.period,n-r<=0?t.run()&&i.push(t):i.push(t));this.timedHandlers=i,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(this._onIdle.bind(this),100))}},e&&e(s,t,n,i,r),s.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},s.SASLMechanism.prototype={test:function(e){return!0},onStart:function(e){this._connection=e},onChallenge:function(e,t){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},s.SASLAnonymous=function(){},s.SASLAnonymous.prototype=new s.SASLMechanism("ANONYMOUS",(!1),10),s.SASLAnonymous.test=function(e){return null===e.authcid},s.Connection.prototype.mechanisms[s.SASLAnonymous.prototype.name]=s.SASLAnonymous,s.SASLPlain=function(){},s.SASLPlain.prototype=new s.SASLMechanism("PLAIN",(!0),20),s.SASLPlain.test=function(e){return null!==e.authcid},s.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass},s.Connection.prototype.mechanisms[s.SASLPlain.prototype.name]=s.SASLPlain,s.SASLSHA1=function(){},s.SASLSHA1.prototype=new s.SASLMechanism("SCRAM-SHA-1",(!0),40),s.SASLSHA1.test=function(e){return null!==e.authcid},s.SASLSHA1.prototype.onChallenge=function(e,t,n){var i=n||MD5.hexdigest(1234567890*Math.random()),r="n="+e.authcid;return r+=",r=",r+=i,e._sasl_data.cnonce=i,e._sasl_data["client-first-message-bare"]=r,r="n,,"+r,this.onChallenge=function(e,t){for(var n,i,r,s,o,a,l,c,u,d,p,h="c=biws,",f=e._sasl_data["client-first-message-bare"]+","+t+",",m=e._sasl_data.cnonce,g=/([a-z]+)=([^,]+)(,|$)/;t.match(g);){var v=t.match(g);switch(t=t.replace(v[0],""),v[1]){case"r":n=v[2];break;case"s":i=v[2];break;case"i":r=v[2]}}if(n.substr(0,m.length)!==m)return e._sasl_data={},e._sasl_failure_cb();for(h+="r="+n,f+=h,i=Base64.decode(i),i+="\0\0\0",s=a=core_hmac_sha1(e.pass,i),l=1;l<r;l++){for(o=core_hmac_sha1(e.pass,binb2str(a)),c=0;c<5;c++)s[c]^=o[c];a=o}for(s=binb2str(s),u=core_hmac_sha1(s,"Client Key"),d=str_hmac_sha1(s,"Server Key"),p=core_hmac_sha1(str_sha1(binb2str(u)),f),e._sasl_data["server-signature"]=b64_hmac_sha1(d,f),c=0;c<5;c++)u[c]^=p[c];return h+=",p="+Base64.encode(binb2str(u))}.bind(this),r},s.Connection.prototype.mechanisms[s.SASLSHA1.prototype.name]=s.SASLSHA1,s.SASLMD5=function(){},s.SASLMD5.prototype=new s.SASLMechanism("DIGEST-MD5",(!1),30),s.SASLMD5.test=function(e){return null!==e.authcid},s.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},s.SASLMD5.prototype.onChallenge=function(e,t,n){for(var i,r=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,s=n||MD5.hexdigest(""+1234567890*Math.random()),o="",a=null,l="",c="";t.match(r);)switch(i=t.match(r),t=t.replace(i[0],""),i[2]=i[2].replace(/^"(.+)"$/,"$1"),i[1]){case"realm":o=i[2];break;case"nonce":l=i[2];break;case"qop":c=i[2];break;case"host":a=i[2]}var u=e.servtype+"/"+e.domain;null!==a&&(u=u+"/"+a);var d=MD5.hash(e.authcid+":"+o+":"+this._connection.pass)+":"+l+":"+s,p="AUTHENTICATE:"+u,h="";return h+="charset=utf-8,",h+="username="+this._quote(e.authcid)+",",h+="realm="+this._quote(o)+",",h+="nonce="+this._quote(l)+",",h+="nc=00000001,",h+="cnonce="+this._quote(s)+",",h+="digest-uri="+this._quote(u)+",",h+="response="+MD5.hexdigest(MD5.hexdigest(d)+":"+l+":00000001:"+s+":auth:"+MD5.hexdigest(p))+",",h+="qop=auth",this.onChallenge=function(){return""}.bind(this),h},s.Connection.prototype.mechanisms[s.SASLMD5.prototype.name]=s.SASLMD5}(function(){window.Strophe=arguments[0],window.$build=arguments[1],window.$msg=arguments[2],window.$iq=arguments[3],window.$pres=arguments[4]}),Strophe.Request=function(e,t,n,i){this.id=++Strophe._requestId,this.xmlData=e,this.data=Strophe.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=i||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var e=new Date;return(e-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var e=new Date;return(e-this.dead)/1e3},this.xhr=this._newXHR()},Strophe.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"==e.tagName)throw Strophe.error("invalid response received"),Strophe.error("responseText: "+this.xhr.responseText),Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML)),"parsererror"}else this.xhr.responseText&&(Strophe.error("invalid response received"),Strophe.error("responseText: "+this.xhr.responseText),Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML)));return e},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml")):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},Strophe.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this._requests=[]},Strophe.Bosh.prototype={strip:null,_buildBody:function(){var e=$build("body",{rid:this.rid++,xmlns:Strophe.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),e},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null},_connect:function(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold;var i=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":Strophe.NS.BOSH});n&&i.attrs({route:n});var r=this._conn._connect_cb;this._requests.push(new Strophe.Request(i.tree(),this._onRequestStateChange.bind(this,r.bind(this._conn)),i.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,t,n,i,r,s,o){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=i,this._conn.domain=Strophe.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,
this.wait=r||this.wait,this.hold=s||this.hold,this.window=o||this.window,this._conn._changeConnectStatus(Strophe.Status.ATTACHED,null)},_connect_cb:function(e){var t,n,i=e.getAttribute("type");if(null!==i&&"terminate"==i)return Strophe.error("BOSH-Connection failed: "+t),t=e.getAttribute("condition"),n=e.getElementsByTagName("conflict"),null!==t?("remote-stream-error"==t&&n.length>0&&(t="conflict"),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,t)):this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(),Strophe.Status.CONNFAIL;this.sid||(this.sid=e.getAttribute("sid"));var r=e.getAttribute("requests");r&&(this.window=parseInt(r,10));var s=e.getAttribute("hold");s&&(this.hold=parseInt(s,10));var o=e.getAttribute("wait");o&&(this.wait=parseInt(o,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random())},_emptyQueue:function(){return 0===this._requests.length},_hitError:function(e){this.errors++,Strophe.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._onDisconnectTimeout()},_no_auth_received:function(e){e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var t=this._buildBody();this._requests.push(new Strophe.Request(t.tree(),this._onRequestStateChange.bind(this,e.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){for(var e;this._requests.length>0;)e=this._requests.pop(),e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(Strophe.info("no requests during idle cycle, sending blank request"),e.push(null)),this._requests.length<2&&e.length>0&&!this._conn.paused){for(var t=this._buildBody(),n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":Strophe.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new Strophe.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._processRequest(this._requests.length-1)}if(this._requests.length>0){var i=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),i>Math.floor(Strophe.TIMEOUT*this.wait)&&(Strophe.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(Strophe.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}},_onRequestStateChange:function(e,t){if(Strophe.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)return void(t.abort=!1);var n;if(4==t.xhr.readyState){n=0;try{n=t.xhr.status}catch(i){}if("undefined"==typeof n&&(n=0),this.disconnecting&&n>=400)return void this._hitError(n);var r=this._requests[0]==t,s=this._requests[1]==t;(n>0&&n<500||t.sends>5)&&(this._removeRequest(t),Strophe.debug("request id "+t.id+" should now be removed")),200==n?((s||r&&this._requests.length>0&&this._requests[0].age()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),Strophe.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0):(Strophe.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),(0===n||n>=400&&n<600||n>=12e3)&&(this._hitError(n),n>=400&&n<500&&(this._conn._changeConnectStatus(Strophe.Status.DISCONNECTING,null),this._conn._doDisconnect()))),n>0&&n<500||t.sends>5||this._throttledRequestHandler()}},_processRequest:function(e){var t=this,n=this._requests[e],i=-1;try{4==n.xhr.readyState&&(i=n.xhr.status)}catch(r){Strophe.error("caught an error in _requests["+e+"], reqStatus: "+i)}if("undefined"==typeof i&&(i=-1),n.sends>this.maxRetries)return void this._onDisconnectTimeout();var s=n.age(),o=!isNaN(s)&&s>Math.floor(Strophe.TIMEOUT*this.wait),a=null!==n.dead&&n.timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait),l=4==n.xhr.readyState&&(i<1||i>=500);if((o||a||l)&&(a&&Strophe.error("Request "+this._requests[e].id+" timed out (secondary), restarting"),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){},this._requests[e]=new Strophe.Request(n.xmlData,n.origFunc,n.rid,n.sends),n=this._requests[e]),0===n.xhr.readyState){Strophe.debug("request id "+n.id+"."+n.sends+" posting");try{n.xhr.open("POST",this._conn.service,!this._conn.options.sync)}catch(c){return Strophe.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var u=function(){if(n.date=new Date,t._conn.options.customHeaders){var e=t._conn.options.customHeaders;for(var i in e)e.hasOwnProperty(i)&&n.xhr.setRequestHeader(i,e[i])}n.xhr.send(n.data)};if(n.sends>1){var d=1e3*Math.min(Math.floor(Strophe.TIMEOUT*this.wait),Math.pow(n.sends,3));setTimeout(u,d)}else u();n.sends++,this._conn.xmlOutput!==Strophe.Connection.prototype.xmlOutput&&(n.xmlData.nodeName===this.strip&&n.xmlData.childNodes.length?this._conn.xmlOutput(n.xmlData.childNodes[0]):this._conn.xmlOutput(n.xmlData)),this._conn.rawOutput!==Strophe.Connection.prototype.rawOutput&&this._conn.rawOutput(n.data)}else Strophe.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+n.xhr.readyState)},_removeRequest:function(e){Strophe.debug("removing request");var t;for(t=this._requests.length-1;t>=0;t--)e==this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(t){if("parsererror"!=t)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){Strophe.info("_sendTerminate was called");var t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());var n=new Strophe.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(this._conn._onIdle.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?Strophe.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):Strophe.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},Strophe.Websocket=function(e){this._conn=e,this.strip="stream:stream";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var n="";n+="ws"===e.options.protocol&&"https:"!==window.location.protocol?"ws":"wss",n+="://"+window.location.host,n+=0!==t.indexOf("/")?window.location.pathname+t:t,e.service=n}},Strophe.Websocket.prototype={_buildStream:function(){return $build("stream:stream",{to:this._conn.domain,xmlns:Strophe.NS.CLIENT,"xmlns:stream":Strophe.NS.STREAM,version:"1.0"})},_check_streamerror:function(e,t){var n=e.getElementsByTagName("stream:error");if(0===n.length)return!1;for(var i=n[0],r="",s="",o="urn:ietf:params:xml:ns:xmpp-streams",a=0;a<i.childNodes.length;a++){var l=i.childNodes[a];if(l.getAttribute("xmlns")!==o)break;"text"===l.nodeName?s=l.textContent:r=l.nodeName}var c="WebSocket stream error: ";return c+=r?r:"unknown",s&&(c+=" - "+r),Strophe.error(c),this._conn._changeConnectStatus(t,r),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){var t=this._check_streamerror(e,Strophe.Status.CONNFAIL);if(t)return Strophe.Status.CONNFAIL},_handleStreamStart:function(e){var t=!1,n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in stream:stream":n!==Strophe.NS.CLIENT&&(t="Wrong xmlns in stream:stream: "+n);var i=e.namespaceURI;"string"!=typeof i?t="Missing xmlns:stream in stream:stream":i!==Strophe.NS.STREAM&&(t="Wrong xmlns:stream in stream:stream: "+i);var r=e.getAttribute("version");return"string"!=typeof r?t="Missing version in stream:stream":"1.0"!==r&&(t="Wrong version in stream:stream: "+r),!t||(this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<stream:stream ")||0===e.data.indexOf("<?xml")){var t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;t=e.data.replace(/<stream:stream (.*[^\/])>/,"<stream:stream $1/>");var n=(new DOMParser).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&(this._connect_cb(n),this.streamStart=e.data.replace(/^<stream:(.*)\/>$/,"<stream:$1>"))}else{if("</stream:stream>"===e.data)return this._conn.rawInput(e.data),this._conn.xmlInput(document.createElement("stream:stream")),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"Received closing stream"),void this._conn._doDisconnect();var i=this._streamWrap(e.data),r=(new DOMParser).parseFromString(i,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(r,null,e.data)}},_disconnect:function(e){if(this.socket.readyState!==WebSocket.CLOSED){e&&this._conn.send(e);var t="</stream:stream>";this._conn.xmlOutput(document.createElement("stream:stream")),this._conn.rawOutput(t);try{}catch(n){Strophe.info("Couldn't send closing stream tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){Strophe.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return this.streamStart+e+"</stream:stream>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(e){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(Strophe.error("Websocket closed unexcectedly"),this._conn._doDisconnect()):Strophe.info("Websocket closed")},_no_auth_received:function(e){Strophe.error("Server did not send any auth methods"),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"Server did not send any auth methods"),e&&(e=e.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_onError:function(e){Strophe.error("Websocket error "+e),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"The WebSocket connection could not be established was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var t=0;t<e.length;t++)if(null!==e[t]){var n,i;"restart"===e[t]?(n=this._buildStream(),i=this._removeClosingTag(n),n=n.tree()):(n=e[t],i=Strophe.serialize(n)),this._conn.xmlOutput(n),this._conn.rawOutput(i),this.socket.send(i)}this._conn._data=[]}},_onMessage:function(e){var t,n;if("</stream:stream>"===e.data){var i="</stream:stream>";return this._conn.rawInput(i),this._conn.xmlInput(document.createElement("stream:stream")),void(this._conn.disconnecting||this._conn._doDisconnect())}if(0===e.data.search("<stream:stream ")){if(n=e.data.replace(/<stream:stream (.*[^\/])>/,"<stream:stream $1/>"),t=(new DOMParser).parseFromString(n,"text/xml").documentElement,!this._handleStreamStart(t))return}else n=this._streamWrap(e.data),t=(new DOMParser).parseFromString(n,"text/xml").documentElement;if(!this._check_streamerror(t,Strophe.Status.ERROR))return this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(Strophe.serialize(t))):void this._conn._dataRecv(t,e.data)},_onOpen:function(){Strophe.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var t=this._removeClosingTag(e);this._conn.rawOutput(t),this.socket.send(t)},_removeClosingTag:function(e){var t=Strophe.serialize(e);return t=t.replace(/<(stream:stream .*[^\/])\/>$/,"<$1>")},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},Strophe.addConnectionPlugin("ping",{_c:null,init:function(e){this._c=e,Strophe.addNamespace("PING","urn:xmpp:ping")},ping:function(e,t,n,i){var r=this._c.getUniqueId("ping"),s=$iq({type:"get",to:e,id:r}).c("ping",{xmlns:Strophe.NS.PING});this._c.sendIQ(s,t,n,i)},pong:function(e){var t=e.getAttribute("from"),n=e.getAttribute("id"),i=$iq({type:"result",to:t,id:n});this._c.sendIQ(i)},addPingHandler:function(e){return this._c.addHandler(e,Strophe.NS.PING,"iq","get")}}),function(e,t){Strophe.addConnectionPlugin("udeskIM",{_connection:null,_fromUser:null,_toUser:null,init:function(e){this._connection=e},connect:function(t,n){var i=t.username;this._fromUser=t,n=n||{},this.options=n,this._connection.connect(i,t.password,function(t){var i="";for(var r in Strophe.Status)if(t==Strophe.Status[r]){i=r.toLowerCase();break}console.log("Strophe "+i),n[i]&&n[i](),n.always&&n.always(i),"disconnect"===i&&e.log("info",{StropheStatus:"disconnect",status:"disconnect"})})},disconnect:function(){this._connection.disconnect()},flush:function(){this._connection.flush()},setToUser:function(e){e.username=e.username||e.jid,this._toUser=e},info:function(){var e=this.options.log||{};e.info&&e.info.apply(null,arguments)},error:function(){var e=this.options.log||{};e.error&&e.error.apply(null,arguments)},appendChildren:function(e,t){if(e&&t){for(var n=$.isArray(t.children)?t.children:[t.children],i=0,r=n.length;i<r;i++){var s=n[i];s&&s.name&&(i&&e.up(),e=e.c(s.name,s.attributes||{}).t("object"==typeof s.value&&s.value?JSON.stringify(s.value):s.value||""))}return e}},sendMessage:function(t){if(this._fromUser&&this._toUser){var n=$msg(e.$.extend({to:this._toUser.username,from:this._fromUser.username,type:"chat"},t.attributes));this.appendChildren(n,t);var i=n.tree();t.attributes.id&&this.info("sendMessage",i.outerHTML);try{return this._connection.send(i)}catch(r){}return!1}},sendPresence:function(t){if(this._fromUser){var n=$pres(e.$.extend({},t.attributes)),i=t.children;return i&&(n=n.c(i.name,i.attributes).t(i.value)),this._connection.send(n.tree())}},sendIQ:function(e){var t=$iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"});return this._connection.sendIQ(t,function(t){return e(t)}),!0},receiveMessageListener:function(e){var t=this;return this._connection.addHandler(function(n){t.info("onMessage",n.outerHTML);try{e(t.parseXml(n))}catch(i){t.error(i,{type:"onMessageException"})}return!0},null,"message",null,null,null),!0},receivePresenceListener:function(e){var t=this;return this._connection.addHandler(function(n){t.info("onPresence",n.outerHTML);try{e(t.parseXml(n))}catch(i){t.error(i,{type:"onPresenceException"})}return!0},null,"presence"),!0},xmlescape:function(e){return e?Strophe.xmlescape(e):""},getNodeValue:function(e){return e.nodeValue||e.textContent||e.text||""},parseAttrs:function(t){var n=this,i={};return t?(e.$.each(t.attributes,function(){i[this.nodeName]=n.getNodeValue(this)}),i):i},parseElement:function(e){if(!e)return null;var t={name:e.nodeName,value:this.getNodeValue(e),html:e.innerHTML||"",attributes:this.parseAttrs(e)},n=t.attributes.from;return n&&(t.attributes.jid=Strophe.getBareJidFromJid(n)),t},parseXml:function(e){if(!e)return null;var t=this,n=this.parseElement(e)||{};return n.children={},$(e).children().each(function(){var e=t.parseElement(this);n.children[e.name]=e}),n}}),e.ifIE()&&Strophe.addConnectionPlugin("flxhr",{init:function(e){"withCredentials"in new XMLHttpRequest?Strophe.Request.prototype._newXHR=function(){var e=new XMLHttpRequest;return e.overrideMimeType&&e.overrideMimeType("text/xml"),e.onreadystatechange=this.func.bind(null,this),e}:t.flensed&&flensed.flXHR?Strophe.Request.prototype._newXHR=function(){var t=new flensed.flXHR({autoUpdatePlayer:!0,instancePooling:!0,noCacheHeader:!1,onerror:function(t){console.log(t),e._changeConnectStatus(Strophe.Status.CONNFAIL,"flXHR connection error"),e._onDisconnectTimeout()}});return t.onreadystatechange=this.func.bind(null,this),t}:Strophe.error("flXHR plugin loaded, but flXHR not found.  Falling back to native XHR implementation.")}}),t.console=t.console||{log:function(){}}}(this.udesk,this),function(e,t,n){e.ns("WS"),e.WS.Timer=n(e,t)}(this.udesk,this,function(e,t){function n(e){e=$.extend({},e),this.props=e}return n.create=function(e){return new n(e)},$.extend(n.prototype,{start:function(e){var t=this.props;e=$.extend({interval:5e4},e),this.stop(!0),this.status="start",this.timer=setInterval(function(){e.cb&&e.cb(),t.onStart&&t.onStart()},e.interval)},stop:function(e){var t=this.props;clearInterval(this.timer),e||(t.onStop&&t.onStop(),this.status="stoped")}}),n}),function(e,t,n){e.WS=n(e,t)}(this.udesk,this,function(e,t){function n(e){e=$.extend({},e),this.props=e,this.handlers=[],this.client=new r(e.server_url),this.ping=i.create(),this.reconnect=i.create()}var i=e.WS.Timer,r=t.WebSocket||t.MozWebSocket,s=["connecting","open","closing","closed"];return $.extend(n,{isSupperted:function(){return!!r},create:function(e){return new n(e)},extend:function(e){return $.extend(n.prototype,e)}}),n.extend({getReadyState:function(){return s[this.client.readyState]},isReadyState:function(e){var t=this.getReadyState();if("array"!==$.type(e))return e===t;for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return!0},transformSend:function(e){var t=this.props.transformSend;return $.isFunction(t)&&(e=t(e)),e},transformOn:function(e,t){var n=this.props.transformOn,i=t?t.data:{};if("string"==typeof i)try{i=JSON.parse(i)}catch(r){}return $.isFunction(n)&&(i=n(e,i)),i},send:function(e){var t,n=this.props;try{return e=t=this.transformSend(e),(!n.sendStart||n.sendStart(e)!==!1)&&($.isPlainObject(t)&&(t=JSON.stringify(t)),this.isReadyState("open")&&this.client.send(t),n.sendStop&&n.sendStop(e),e)}catch(i){}},sendSync:function(e,t){t=$.extend({timeout:3e3},t);var n,i,r=this,s=$.Deferred(),o=this.props,a=t.success||o.sendSuccess,l=t.erro||o.sendError,c=t.complete||o.sendComplete,u=t.receiptCondition||o.sendSyncReceiptCondition,d=this.send(e),p="message";return d&&$.isFunction(u)?(this.on(p,n=function(e,t){u(d,e,t)&&(r.off(p,n),s.resolve(e,t),a&&a(d,e,t),c&&c(d,e,t),clearTimeout(i))}),i=setTimeout(function(e){e="回执超时",r.off(p,n),s.reject(e),l&&l(d,e),c&&c(d,e)},t.timeout)):s.reject("",d),s.promise()},close:function(e,t){this.off(),this.ping.stop(),this.reconnect.stop(),this.client.close(e,t)},ensure:function(e,t){t=$.extend({timeout:5e3},t);var n=$.Deferred();return this.isReadyState(e)?n.resolve():(this.on(e,function(){n.resolve()}),setTimeout(function(e){n.reject("超时")},t.timeout)),n.promise()},on:function(e,t){var n=this,i=function(i){t&&t(n.transformOn(e,i),i)};return this.handlers.push({name:e,fn:t,_fn:i}),this.client.addEventListener(e,i),this},one:function(e,t){var n=this;return this.on(e,function(i){t&&t(n.transformOn(e,i),i),n.off(e,t)})},off:function(e,t){for(var n,i=this.client,r=this.handlers,s=r.length-1;s>=0;s--)n=r[s],e&&n.name!==e||t&&t!==n.fn||(r.splice(s,1),i.removeEventListener(n.name,n._fn));return this}}),n}),function(e,t,n){e.fullscreen=n(e,t)}(this.udesk,this,function(e,t){function n(){if(c){var e=$.Deferred();return e.resolve(),e.promise()}return c=!0,$.getScript("/static_cmps/screenfull/min.js")}function i(){return n().then(function(){return screenfull.enabled})}function r(e){return n().then(function(){screenfull.request()})}function s(){return n().then(function(){screenfull.exit()})}function o(e){return n().then(function(){return screenfull.toggle(e)})}function a(){return n().then(function(){return screenfull.isFullscreen})}function l(e){return n().then(function(){screenfull.off("change"),screenfull.on("change",function(){e&&e(screenfull.isFullscreen)})})}var c;return{load:n,enabled:i,isFull:a,request:r,exit:s,toggle:o,onChange:l}}),function(e,t,n){e.ns("Sign"),e.Sign.Base=n(e,t)}(this.udesk,this,function(e,t){function n(e){e=$.extend({actionKey:"method"},e),this.props=e,this.ws=i.create(e)}var i=e.WS;return n.create=function(e){return new n(e)},$.extend(n.prototype,{getToken:function(e){return $.post(this.props.token_url,e)},mapSendData:function(e,t,n){if(e)return n=n||{},n.mapSendData?n.mapSendData(e,t):(t=t||{},t[this.props.actionKey]=e,t)},send:function(e,t,n){if(t=this.mapSendData(e,t,n))return this.ws.send(t)},sendSync:function(e,t,n){if(t=this.mapSendData(e,t,n))return this.ws.sendSync(t,n)},login:function(e){var t=this,n=(this.props,this.ws),i=$.Deferred();return e=$.extend({app_id:e.subdomain,ua:navigator.userAgent,state:"idle",expire:300},e),t.loginRes?(i.resolve(t.loginRes),i.promise()):(this.getToken({app_id:e.app_id,token:e.token,expire:e.expire,timestamp:e.timestamp,subdomain:e.subdomain,type:e.type}).always(function(r){console.log("login"),r.sig_token?n.ensure("open").then(function(){t.sendSync("login",{app_id:e.app_id,user_id:e.user_id,ua:e.ua,state:e.state,res_id:e.res_id,token:r.sig_token},{timeout:5e3}).always(function(e){e.uid?(t.loginRes=e,i.resolve(e)):i.reject({message:"登录失败",trace:e})})},function(e){i.reject({message:"ws "+n.getReadyState(),trace:e})}):i.reject({message:"获取token失败",trace:r})}),i.promise())},logout:function(){var e=this.sendSync("logout");return this.loginRes=null,this.ws.close(),e},on:function(e){this.ws.on("message",e)},one:function(e){this.ws.one("message",e)},off:function(e){this.ws.off("message",e)}}),n}),function(e,t,n){e.ns("Sign"),e.Sign.App=n(e,t)}(this.udesk,this,function(e,t){function n(e){return f[e]}function i(e,t){f[e]=t}function r(e,t){$.isPlainObject(e)?$.each(e,function(e,t){m[e]=t}):m[e]=t}function s(){var e="/spa1/remote_control_access_token";return $.get(e).then(function(e){return e=e||{},r(e.data),e.data},function(e){console.log("GET remote_access_token error")})}function o(){var e=d.ws,t=0;e.ping.start({interval:5e4,cb:function(){d.sendSync("ping",null,{timeout:3e3,mapSendData:function(e){return e},receiptCondition:function(e,t,n){return"pong"===t}}).then(function(){t=0},function(){"stoped"!==e.ping.status&&(t++,console.log("Pong error",t))})}})}function a(){var e=d.ws,t=0;f.loginFailedCounter>5||f.isReconnect||(f.isReconnect=!0,e.reconnect.start({interval:1e3,cb:function(){switch(t++,t){case 1:case 6:case 11:case 21:case 31:break;default:t>31&&e.reconnect.stop()}}}))}function l(e,t){if(!e)return t;if("login"===t.method||"logout"===t.method)return"login"===t.method&&g.trigger("login",m),"transformSend"===e?(f.is_vcall&&(t=m.vcall[e](t)),f.is_remote&&(t=m.remote[e](t)),t):("sendStart"===e&&f.is_vcall&&m.vcall[e](t),t);var n=parseInt(t.method_id||0);return n>=1e3&&n<2e3?m.remote[e]?m.remote[e](t):t:m.vcall[e]?m.vcall[e](t):t}function c(e){return d?d:(d=p.create($.extend({token_url:m.remote_control_token_url||m.vcall_token_url,transformSend:function(e){return $.isPlainObject(e)?l("transformSend",e):e},transformOn:function(e,t){return t},sendSyncReceiptCondition:function(e,t){return e.msg_id===t.msg_id},sendStart:function(e){l("sendStart",e)},sendStop:function(e){},sendSuccess:function(e,t){},sendError:function(e,t){}},e)),h.sign=d,d.on(function(e){return $.isPlainObject(e)?void l("onMessage",e):e}),d.ws.on("open",function(e){i("isReconnect",!1)}),d.ws.on("close",function(e){i("isLogin",!1),d.ws.ping.stop(),a()}),d.ws.on("error",function(e){console.log("[sign][error]",e)}),d)}function u(e,t){if(i("is_"+e,!0),t&&r(e,t),t&&r("user_id",t.user_id),n("isLogin")||n("isInit")){var a=$.Deferred();return a.resolve(),a.promise()}return i("isInit",!0),s(e).then(function(){return c({server_url:m.server_url}).login({user_id:m.user_id,app_id:m.app_id,token:m.token,timestamp:m.timestamp,subdomain:m.subdomain,type:e}).then(function(e){return o(),i("isInit",!1),i("isLogin",!0),f.loginFailedCounter=0,e},function(e){return i("isInit",!1),f.loginFailedCounter=(f.loginFailedCounter||0)+1,e})})}var d,p=e.Sign.Base,h={},f={},m={},g={clientList:{},listen:function(e,t){this.clientList[e]||(this.clientList[e]=[]),this.clientList[e].push(t)},trigger:function(){var e=Array.prototype.shift.call(arguments),t=this.clientList[e];if(!t||0===t.length)return!1;for(var n,i=0;n=t[i++];)n.apply(this,arguments)}};return h={init:u,event:g}}),function(e,t,n){e.ns("remoteControl"),e.remoteControl.receivedPop=n(e,t)}(this.udesk,this,function(e,t){function n(){l.on("click","[data-act]",function(e,t){t=$(this).data("act"),h[t]&&h[t](e)})}function i(){var t=e.common,n=t.UDL;l=$(u),n.parseElements(l),p.append(l),l.find(".nick").text(d.from_nickname)}function r(){$(".remote-received-pop").remove()}function s(e){$.extend(!0,d,e)}function o(t){s(t),a=e.remoteControl.app,r(),i(),n()}var a,l,c=e.Sign.App,u=['<div class="remote-received-pop">','<img class="remote-icon" src="images/remote-control.png" />','<span class="nick ellipsis"></span>','<a data-act="close" class="close-receive-box"><i class="icon icon-guanbi"></i></a>','<a class="btn btn-default download-remote-btn" href="https://s1-rc-pub-low.oss-cn-hangzhou.aliyuncs.com/download/UdeskRC_V1.0.0.1.exe" download>下载安装远程控制端</a>','<a data-act="lanuchRemote" href="" class="lanuch-remote-btn link">如已安装远程控制端，点击立即使用 </a>','<span class="remote-tip">请求远程协助连接您的电脑</span>','<a data-act="reject" class="reject-btn btn btn-default">拒绝</a>','<a data-act="accept" class="accept-btn btn btn-primary">接受</a>',"</div>"].join(""),d={},p=$("#main"),h={accept:function(e){c.sign.send("accept",{method_id:1003,body:{invitation_id:d.invitation_id}}),$(".reject-btn, .accept-btn").hide(),$(".close-receive-box,.download-remote-btn,.lanuch-remote-btn").show()},reject:function(e){c.sign.send("reject",{method_id:1004,body:{invitation_id:d.invitation_id}}),r()},close:function(e){c.sign.send("cancel",{method_id:1002,body:{invitation_id:d.invitation_id}}),r()},lanuchRemote:function(e){var t="UdeskRemote://?role=controlled&token="+d.token+"&invitation_id="+d.invitation_id+"&chan_id=no&address=no&session_name=no";$(".lanuch-remote-btn").attr("href",t),a.lanuchRemote=!0,r()}};return{init:o,setConfig:s,destroy:r}}),function(e,t,n){e.ns("remoteControl"),e.remoteControl.app=n(e,t)}(this.udesk,this,function(e,t){function n(e){return $.extend(h,e)}function i(e,t){$.isPlainObject(e)?$.each(e,function(e,t){p[e]=t}):p[e]=t}function r(){return navigator.platform.indexOf("Mac")>-1}function s(){var e=r();return!e}function o(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function a(e){e.seq_id||(p.seq_id=(p.seq_id||1)+1);var t={},n="REQ";t[e.method]=!0;var i=$.extend({ver:u,seq_id:p.seq_id,msg_id:o(),msg_type:n,res_id:"web",timestamp:+new Date,ua:navigator.userAgent,body:{}},e);return(t.login||t.logout)&&delete i.body,i}function l(e){var t=e.method,n={},r={},s=e.rcode;if("000003"===s)return console.log(e.rdesc);if(r[t]=!0,n[e.msg_type]=!0,n.REP)r.invite?"000000"===s||("000300"===s?i("remote_status","remoteing"):"000002"===s&&i("remote_status","paramError")):r.accept&&(i("remote_status","acceptRepSuccess"),m.setConfig(e.body));else if(n.EVT);else if(n.NTF)switch(t){case"invite":i("remote_status","receiving"),i("receiving",e),m.init({from_user_id:e.body.from_user_id,from_nickname:e.body.from_nickname,invitation_id:e.body.invitation_id});break;case"accept":i("remote_status","accepted"),i("accepted",e);break;case"rejected":i("remote_status","rejected"),i("rejected",e);break;case"chan_create":i("controll_status","chan_create");break;case"chan_del":i("controll_status","chan_del"),i("chan_del",e)}}function c(e,t){if(e=n(e),!t){if(!s())return;if(p.isInit)return;p.isInit=!0}return f.init("remote",{user_id:h.user_id,seq_id:p.seq_id,transformSend:a,onMessage:l}).then(function(e){d.isRcInitOk=!0,i("remote_status","rcInitSucess"),console.log("isRcInitOk")},function(e){console.log("初始化失败")})}var u="1.0",d={},p={},h={},f=e.Sign.App,m=e.remoteControl.receivedPop;return d={init:c,state:p}}),function(e,t,n){e.ns("vcall"),e.vcall.Channel=n(e,t)}(this.udesk,this,function(e,t){function n(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function i(){var e=$.Deferred();return AgoraRTC.getDevices(function(t){for(var n=[],i=[],r=0;r!==t.length;++r){var s=t[r];"audioinput"===s.kind?n.push(s):"videoinput"===s.kind?i.push(s):console.log("Some other kind of source/device: ",s)}e.resolve({microphoneId:n.length?n[0].deviceId:"",cameraId:i.length?i[i.length-1].deviceId:"",microphones:n,cameras:i})}),e.promise()}function r(t,n){var i=(""+t).toUpperCase();switch(t){case"360p":15===n&&(i+="_4");break;case"480p":i=15===n?"8":"9";break;case"720p":case"1080p":15===n&&(i+="_3");break;default:i="240p",e.isMob()&&(i=" "+i)}return console.log(i),i}function s(e){e=$.extend({mode:"interop"},e),$.extend(this,{props:e,state:{seq_id:0,channel_id:e.channel_id||n()},device:{},channel:{},handlers:{},localStreams:[],remoteStreams:[]})}return $.extend(s,{guid:n,genVideoProfile:r,create:function(e){return new s(e)},extend:function(e){return $.extend(s.prototype,e)}}),s.extend({init:function(){var e=this,t=this.props,n=$.Deferred(),r=this.client=AgoraRTC.createClient({mode:t.mode});return r.init(t.appId,function(){console.log("AgoraRTC client initialized"),i().then(function(t){e.device=t||{}}),n.resolve()},function(e){console.log("AgoraRTC client init failed",e),n.reject(e)}),n.promise()},join:function(e){if(e){e=$.extend({uid:null},e);var t=this,n=this.state,i=$.Deferred();return $.extend(n,e),this.client.join(e.channel_key,e.channel_name||n.channel_id,e.uid,function(e){console.log("User "+e+" join channel successfully"),t.uid=e,i.resolve(e)},function(e){console.log("Join channel failed",e),i.reject(e)}),i.promise()}},createStream:function(e){var t=this.localStream,n=this.device||{};return e=$.extend({streamID:this.uid,cameraId:n.cameraId,microphoneId:n.microphoneId,audio:!0,video:!0,screen:!1},e),t=this.localStream=AgoraRTC.createStream(e),e.video&&t.setVideoProfile(r(e.resolution,e.frameRate)),this.localStreams.push(t),t},leave:function(){var e=this,t=$.Deferred(),n=this.client;return n&&n.leave(function(){console.log("Leavel channel successfully"),$.each(e.localStreams,function(){this.close()}),e.localStream=null,e.localStreams.length=0,t.resolve()},function(e){console.log("Leave channel failed",e),t.reject()}),t.promise()},transformOn:function(e,t){var n=this.props.transformOn,i=t;return $.isFunction(n)&&(i=n(e,t)),i},on:function(e,t){var n=this,i=this.handlers;i[e]=i[e]||[],i[e].length||this.client.on(e,function(e){return function(t){$.each(n.handlers[e],function(){this(n.transformOn(e,t),t)})}}(e)),i[e].push(t)},off:function(e,t){var n=this.handlers,i=n[e];if(e){if(i)for(var r=i.length-1;r<-1;r--)if(!t||t===i[r])return void i.splice(r,1)}else n.length=0},destroy:function(){this.off(),this.leave()}}),s}),function(e,t,n){e.ns("vcall"),e.vcall.dropdown=n(e,t)}(this.udesk,this,function(e,t){function n(){a.off().on("click",function(e){var t=$(this),n=t.data("act");l.onClick&&l.onClick(n,e),a.removeClass("open")})}function i(){var t=e.common,n=t.UDL,i='<a class="icon icon-video" data-toggle="dropdown" data-act="video" data-tip="'+n.gl("video")+'"></a>';a=$(i),n.parseElements(a),c.append(a),console.log("editorAutoShow"),e.common.editorAutoShow()}function r(){$(".vcall-dropdown").remove()}function s(t){l=t=t||{},o=e.vcall.app,c=$(t.container||c),r(),i(),n()}var o,a,l,c=$("body");return{init:s}}),function(e,t,n){e.ns("vcall"),e.vcall.sentPop=n(e,t)}(this.udesk,this,function(e,t){function n(){
a.on("click","[data-act]",function(e,t){t=$(this).data("act"),p[t]&&p[t](e)})}function i(){var t=e.common,n=t.UDL;a=$(u),n.parseElements(a),d.append(a),a.find(".nick").text(l.sendee_name),a.find(".desc").text(e.replaceTpl(n.g("vcall.ringing_desc"),{type:n.gl(o.getState("call_type"))}))}function r(){$(".vcall-pop").remove()}function s(t){l=t=t||{},o=e.vcall.app,r(),i(),n()}var o,a,l,c=e.Sign.App,u=['<ul class="vcall-pop vcall-sent-pop">',"    <li>",'        <span class="circle"><i class="icon icon-video-solid"></i></span>','        <span udl-g="vcall.to"></span> <span class="nick ellipsis"></span>','        <p class="desc text-muted"></p>',"    </li>",'    <li class="text-right">','        <a data-act="cancel" class="btn btn-danger btn-sm" udl-gl="cancel"></a>',"    </li>","</ul>"].join(""),d=$("body"),p={cancel:function(e){r(),c.sign.send("cancel")}};return{init:s,destroy:r}}),function(e,t,n){e.ns("vcall"),e.vcall.receivedPop=n(e,t)}(this.udesk,this,function(e,t){function n(){a.on("click","[data-act]",function(e,t){t=$(this).data("act"),p[t]&&p[t](e)})}function i(){var t=e.common,n=t.UDL;a=$(u),n.parseElements(a),d.append(a),a.find(".nick").text(l.sendee_name),a.find(".desc").text(e.replaceTpl(n.g("vcall.ringing_desc"),{type:n.gl(o.getState("call_type"))}))}function r(){$(".vcall-pop").remove()}function s(t){l=t=t||{},o=e.vcall.app,r(),i(),n()}var o,a,l,c=e.Sign.App,u=['<ul class="vcall-pop vcall-received-pop">',"    <li>",'        <span class="circle"><i class="icon icon-video-solid"></i></span>','        <span class="nick ellipsis"></span>','        <p class="desc text-muted"></p>',"    </li>",'    <li class="text-right">','        <a data-act="deny" class="btn btn-danger btn-sm" udl-g="vcall.danger"></a>','        <a data-act="accept" class="btn btn-primary btn-sm" udl-g="vcall.accept"></a>',"    </li>","</ul>"].join(""),d=$("body"),p={accept:function(e){r(),c.sign.send("answer")},deny:function(e){r(),c.sign.send("cancel",{reason:"001"})}};return{init:s,destroy:r}}),function(e,t,n){e.ns("vcall"),e.vcall.chatBox=n(e,t)}(this.udesk,this,function(e,t){function n(e){e=e||c.channel.remoteStream,e&&h&&(h.empty(),h.show(),e.play("remoteStream"),d&&d.addClass("pip2"),g=!0)}function i(){h&&(h.empty(),d.removeClass("pip2"))}function r(){var e=c.channel.localStream;e&&($("#localStream").empty(),e.play("localStream"))}function s(){d.on("click","[data-act]",function(e,t){t=$(this).data("act"),_[t]&&_[t](e)}),m||(m=!0,u.onChange(function(e){d[(e?"add":"remove")+"Class"]("fullscreen")}))}function o(){var t=e.common,i=t.UDL;d=$(b),i.parseElements(d),p=d.find(".title"),h=d.find("#remoteStream"),"audio"===f.type&&d.addClass("audioEnabled"),y.append(d),p.text(e.replaceTpl(i.g("vcall.chat_title"),{name:f.sendee_name,type:i.gl(f.type)})),r(),n()}function a(){i(),$(".vcall-chat-box").remove()}function l(t){f=t=t||{},c=e.vcall.app,u=e.fullscreen,a(),o(),s()}var c,u,d,p,h,f,m,g,v=e.Sign.App,b=['<div class="vcall-chat-box">','  <div class="statusbar clearfix">','      <span class="title"></span>','      <div class="pull-right">','          <a data-act="fullscreen" class="icon icon-square"></a>',"      </div>","  </div>",'  <div class="media-box">','      <div id="localStream" data-act="switchPip" class="local-stream"></div>','      <div id="remoteStream" data-act="switchPip" class="remote-stream"></div>',"  </div>",'  <div class="toolbar text-center clearfix">','      <div class="pull-left"></div>','      <a data-act="switchMute" class="icon icon-microphone1" title="静音"></a>','      <a data-act="switchMicrophone" class="icon icon-horn" title="扬声器"></a>','      <a data-act="switchAudio" class="icon icon-video" title="视频"></a>','      <div class="pull-right">','        <a data-act="hangup" class="btn btn-danger btn-sm" udl-g="vcall.hangup"></a>',"      </div>","  </div>","</div>"].join(""),y=$("body"),_={fullscreen:function(e){u.enabled().then(function(e){e?u.toggle(d[0]):console.log("Do not support full screen！")})},switchMute:function(e){var t=c.channel,n=d.is(".muteEnabled");t.localStream[n?"enableAudio":"disableAudio"](),d[(n?"remove":"add")+"Class"]("muteEnabled")},switchMicrophone:function(e){var t=d.is(".microphoneEnabled");c.switchMicrophone(t).then(function(){r()}),d[(t?"remove":"add")+"Class"]("microphoneEnabled")},switchAudio:function(e){var t=c.channel,n=d.is(".audioEnabled");t.localStream[n?"enableVideo":"disableVideo"](),d[(n?"remove":"add")+"Class"]("audioEnabled")},hangup:function(e){a(),c.channel.leave(),v.sign.send("bye")},switchPip:function(e){var t=$(e.currentTarget),n=c.channel;0!==parseInt(t.css("top"))&&n.localStream&&n.remoteStream&&d.toggleClass("pip2")}};return{init:l,destroy:a,showRemoteStream:n,removeRemoteStream:i}}),function(e,t,n){e.ns("vcall"),e.vcall.app=n(e,t)}(this.udesk,this,function(e,t){function n(e,t,n){t=t||{},n=n||t.type||"debug","undefined"!=typeof AgoraRTC&&AgoraRTC.Logger.log({debug:0,info:1,error:2,none:3,warning:4}[n],e,t)}function i(){var t="https:"===location.protocol,n=0===location.host.indexOf("localhost");return(n||t)&&e.WS.isSupperted()}function r(){var e=$.Deferred();return I.isLoadedSDK?(e.resolve(),e.promise()):(I.isLoadedSDK=!0,$.getScript("/static_cmps/AgoraRTCSDK/2.2.0.js"))}function s(e){return I[e]}function o(e,t){$.isPlainObject(e)?$.each(e,function(e,t){I[e]=t}):I[e]=t}function a(e){return $.extend(D,e)}function l(e,t){var n="",i="audio"===I.call_type?"语音":"视频",r={};if(r[t.method]=!0,r.invite)n="发起"+i;else if(r.cancel){switch(t.reason){case"001":n="拒接";break;case"003":n="未接";break;default:n="取消"}n+=i}else if(r.busy)n="正忙";else{if(!r.bye)return;n="结束"+i}"send"===e?n=D.sender_name+n:"recv"===e&&(n=D.sendee_name+n),D.onCallStatus&&D.onCallStatus($.extend({},t,{isRecv:"recv"===e,call_desc:n}))}function c(e){y&&y.destroy();var t=$.Deferred();return e=$.extend({appId:D.agora_app_id,channel_id:I.channel_id},e),y=x.create(e),A.channel=y,y.init().then(function(){y.on("stream-added",function(e){var t=e.stream;y.client.subscribe(t),clearTimeout(I.peerLeaveTimer)}),y.on("stream-subscribed",function(e){var t=y.remoteStream;t=e.stream,y.remoteStream=t,C.showRemoteStream(t)}),y.on("stream-removed",function(e){var t=e.stream;t&&(t.stop(),y.remoteStream=null,C.removeRemoteStream())}),y.on("peer-leave",function(e){var t=e.stream;t&&(t.stop(),y.remoteStream=null,C.removeRemoteStream(),I.peerLeaveTimer=setTimeout(function(){w.sign.send("stop_media"),w.sign.send("bye")},3e4))}),y.on("error",function(e){n("Got error msg:",e.reason),"DYNAMIC_KEY_TIMEOUT"===e.reason&&y.client.renewChannelKey(y.channel_key)}),w.sign.sendSync("get_channel_token",{channel_id:e.channel_id}).always(function(e){e.channel_token?(o({uid:e.agora_uid,channel_token:e.channel_token}),t.resolve(e)):t.reject("获取channel_token失败",e)})},t.reject),t.promise()}function u(e){var t,n=$.Deferred();return e=$.extend({video:"audio"!==I.call_type},e),t=y.createStream(e),t.init(function(){y.client.publish(t),w.sign.send("start_media"),o("call_status","chating"),n.resolve(t)},n.reject),n.promise()}function d(e){var t=$.Deferred();return e=$.extend({uid:I.uid,channel_id:I.channel_id,channel_key:I.channel_token},e),e.force||"chating"!==s("call_status")?(o("call_status","chating"),y.join({uid:e.uid,channel_key:e.channel_key}).then(function(){u(e.stream).then(function(){k.destroy(),S.destroy(),C.init({sendee_name:D.sendee_name,type:I.call_type}),t.resolve()},t.reject)},function(e){t.reject("加入channel失败",e)}),t.promise()):(t.reject("In chating"),n("In chating"),t.promise())}function p(e){I.isInit&&(e=e||{},y&&(!e.noNeedStopMedia&&w.sign.send("stop_media"),e.needBye&&w.sign.send("bye"),y.leave(),y=null),C.destroy(),k.destroy(),S.destroy(),o("call_status"))}function h(e){var t=$.Deferred();if(e)c().then(function(){d({force:!0}).then(t.resolve,t.reject)},t.reject);else{var n=y.device.microphones;n&&n[1]?u({microphoneId:n[1].deviceId}).then(t.resolve,t.reject):t.reject("No microphone")}return t.promise()}function f(e){if(!$.isPlainObject(e))return e;e.seq_id||(I.seq_id=(I.seq_id||1)+1);var t={},n="REQ";return t[e.method]=!0,(t.start_media||t.stop_media)&&(n="NTF"),t.login||t.logout||(e.channel_id=e.channel_id||I.channel_id),$.extend({ver:E,msg_id:x.guid(),msg_type:n,seq_id:I.seq_id,res_id:"web",ua:navigator.userAgent,from_user_id:D.user_id||"",to_user_id:D.to_user_id||"",biz_session_id:D.biz_session_id||"",timestamp:+new Date},e)}function m(e){var t=e.method,n={},i={};n[t]=!0,i[e.msg_type]=!0,i.REQ&&((n.cancel||n.bye)&&(o("call_status"),_.exit()),n.invite?o($.extend({call_status:"sending"},e)):n.answer?c().then(d):n.bye&&p(),l("send",e))}function g(e){if(!$.isPlainObject(e))return e;var t=e.method,i={},r={},s=e.rcode;if(i[t]=!0,r[e.msg_type]=!0,s&&"000000"!==s&&n("[sign][rcode="+s+"]",e.reason||e.rdesc||e.msg),r.EVT)i.invite?e.user_id!==D.user_id&&(o($.extend({call_status:"receiving"},e)),S.init({sendee_name:D.sendee_name})):i.answer?c().then(d):i.bye&&p(),(i.cancel||i.bye)&&(o("call_status"),S.destroy()),l("recv",e),w.sign.send(t,{seq_id:e.seq_id,msg_id:e.msg_id,msg_type:"ACK",channel_id:e.channel_id});else if(r.REP)switch(s){case"004":o("call_status"),S.destroy();break;case"000101":D.showTip("客户未登录视频"),o("call_status"),k.destroy();break;case"000103":D.showTip("对方正忙"),o("call_status"),l("recv",{method:"busy"}),k.destroy()}}function v(e){a({agora_app_id:e.agora_app_id})}function b(s,l){if(s=a(s),!l){if(!i())return;if(I.isInit)return;I.isInit=!0}r().then(function(){var i=AgoraRTC.checkSystemRequirements();return i?(o({call_type:"video"}),w.event.listen("login",v),w.event.listen("reconnectFail",p),w.init("vcall",{user_id:D.user_id,seq_id:I.seq_id,transformSend:f,sendStart:m,onMessage:g}).then(function(n){var i=e.context||{},r=i.config||{},s=r.buttons_enable||{};s.vcall&&T.init({container:D.container,theme_color:D.theme_color,onClick:function(e,t){if(I.call_status){if("chating"===I.call_status)return D.showTip("请结束当前视频通话")}else o({call_type:e}),k.destroy(),S.destroy(),k.init({type:e,sendee_name:D.sendee_name}),w.sign.send("invite",{call_type:e,channel_id:x.guid()})}}),$(t).bind("unload",function(e){w.sign.send("bye")})},function(e){n("初始化失败",e)})):void n("不支持音视频聊天！",i)})}var y,_=e.fullscreen,x=e.vcall.Channel,w=e.Sign.App,T=e.vcall.dropdown,k=e.vcall.sentPop,S=e.vcall.receivedPop,C=e.vcall.chatBox,E="1.0",A=(!e.isTestENV(),{}),I={},D={},N=e.common||{};N.frameConfig||{};return A={log:n,state:I,getState:s,setState:o,setConfig:a,init:b,genChannelId:x.guid,switchMicrophone:h,leaveChannel:p}}),function(e,t){function n(e,t){var n=[];t&&(e=encodeURIComponent(e),e=e.replace(/%2F/g,"/"));for(var i=0;i<e.length;i++){var r=e.charCodeAt(i).toString(16);n.push(r)}return n.join("")}var i=t.location.pathname||"",r=0===i.indexOf("/im_client")?i:"/im_client/",s=e.context,o={unreadCount:0,unreadMsgsHeight:0},a={modal:null,apiPath:"/spa1/",isMob:!1,currentMode:"fullscreen",stopQueuing:!1,agent_id:"",chat_creator:"customer",invited:!1,last_im_session_id:null,getUserTimes:0,loadFiles:[],init:function(t){var n=this,i=a.innerController.isInnerMode;t=t||{},n.initData(),n.currentMode=n.urlParamObj.currentMode||n.currentMode,n.bodyEl.addClass(n.currentMode),!t.notUser&&n.initAjax(),n.setFavicon(),n.getFrameConfig({themeColorSelector:".theme-c",themeBGSelector:".theme-bg",themeBDSelector:".theme-bd",isTicket:t.isTicket,cb:function(r){e.setContext({config:r,themeColor:r.theme_color,previewTextWidth:n.autoCalcWidth(a.UDL.g("label.preview")),downloadTextWidth:n.autoCalcWidth(a.UDL.g("label.download")),agentTransferTextWidth:n.autoCalcWidth(a.UDL.g("agent.transfer"),{tagName:"a",css:{fontSize:"16px"}})}),n.frameConfig=r,t.onBefore&&t.onBefore(n.frameConfig),!i&&n.abjuctCenterBox(r.pc_no_max_window),r.h5Mode&&n.applyH5Mode(),n.editorAutoShow(),t.notUser?t.onAfter&&t.onAfter({frameConfig:r,urlParamObj:n.urlParamObj||{}}):n.imClientValid(r,function(){n.loadUser(function(i,s,o,a,l,c){return n.customer=i,n.company=s,n.agentResp=c||"",n.csrf_token=i.csrf_token||"",n.last_im_session_id=i.last_im_session_id||0,n.initSidebox(),n.bindContentScroll(),n.log.init(i),e.log.config({user:{role:o,user_id:i.user_id,agent_id:i.agent_id,jid:i.username,agent_jid:i.agent_jid,chatting:i.chatting,company_id:s.id,company_name:s.name}}),e.setContext({role:o,customer:i,company:s,robotConfig:s.robot}),"customer"!==o?n.showModal("noAuthority"):a?(n.hideModal(),l&&$(".black-list-tip").text(l),n.blackListEl.show(),void n.headerEl.show()):void(t.onAfter&&t.onAfter({frameConfig:r,customer:n.customer,urlParamObj:n.urlParamObj||{},company:s}))})})}})},initData:function(){var n=e.ifIE()||e.isIE11(),i=this.urlParamObj=e.urlParams(t.location.href),r=!!i.sdk_token,s={doc:$(document)};i.invite_user_key=i._INVITE_USER_KEY,delete i._INVITE_USER_KEY,this.isMob="none"!=$(".hidden-place .visible-mob").css("display"),this.agent_id&&(i.agent_id=this.agent_id),this.isHeadless=r,this.bodyEl=s.body=$(document.body),this.headerEl=s.header=$("#header"),this.footerEl=s.footer=$("#footer"),this.mainEl=s.main=$("#main"),this.contentEl=s.content=$("#content"),this.messagesEl=s.messages=this.contentEl.find(".messages"),this.sideBoxEl=s.sideBox=$("#side-box"),this.btnFullScreenEl=s.btnFullScreen=$("#btnFullScreen"),this.bottomPanelEl=s.bottomPanel=$("#bottomPanel"),this.btpTextEl=s.btpText=$("#btp-text"),this.btpBtnsEl=s.btpBtns=$("#btp-btns"),this.blackListEl=s.blackList=$("#black-list"),this.guideListEl=s.guideList=$("#guideList"),this.h5TransferEl=s.h5Transfer=$("#btnTransfer2"),this.pagesEl=s.pages=$("#pages"),this.copyRightEl=s.copyRight=$("#copy-right"),e.setContext({isIE:n,isIE8:n&&e.ifIE(8),isIE9:n&&e.ifIE(9),isLowIE:n&&e.ifIE(9,"lte"),isPC:e.isPC(),isMob:e.isMob(),isIos:e.isIos(),isMobCSS:this.isMob,isSDK:r,isHttps:"https:"===location.protocol,isInner:"inner"===i.currentMode,isHeadless:this.isHeadless,urlParams:i,els:s}),console.log("Init context",e.context)},initAjax:function(){var t=this,n=this.urlParamObj;$(document).ajaxSend(function(i,r,s){var o=s.noParams||"",a=s.url||"";t.csrf_token&&t.needAddTokenByUrl(a)&&r.setRequestHeader("X-CSRF-Token",t.csrf_token),function(e){$.each(e,function(e,i){var r=t.customer||{},a=s[i],l={access_token:r.access_token,user_id:r.user_id};if(a&&"string"==typeof a&&a.indexOf(".js")===-1&&!o){if(a.indexOf("no_additional_params")>-1)return;n.web_token&&!/[\?\&]web_token=/.test(a)&&(l.web_token=n.web_token),s[i]+=("data"===i||/[\?\&]/.test(a)?"&":"?")+t.jsonParam(l)}})}(["url","data"]),e.log.info(i.type,{path:s.url||s.data,method:s.type})}).ajaxComplete(function(t,n,i){e.log[200===n.status?"info":"error"](t.type,{path:i.url||i.data,status:n.status,statusText:n.statusText,method:i.type})})},needAddTokenByUrl:function(e){if(!e)return!1;e+="";var t=location.origin||"",n=e.indexOf("/spa1/")>-1;return/^(http:\/\/|https:\/\/)/.test(e)?!!(e.indexOf(t)>-1&&n):!!n},initAjaxOnlySetCSRFToken:function(e){var t=this;(e||this.csrf_token)&&$(document).ajaxSend(function(n,i,r){var s=r.url||"";t.needAddTokenByUrl(s)&&i.setRequestHeader("X-CSRF-Token",e||t.csrf_token)})},getSideBoxData:function(e){var t=this;$.get(t.apiPath+"im/im_newspaper/window",{im_web_plugin_id:t.urlParamObj.web_plugin_id},function(n){n=n||{};var i=[],r=t.company.robot||{},s="udesk_robot"===r.channel;$.each(n.side_data,function(e,t){t.enable&&(t.type=t.key,t.nick=t.name,"robot_auto_suggest"===t.key&&s&&i.push(t),"robot_auto_suggest"!==t.key&&i.push(t))}),n.side_data=i,t.sideRes=n,e&&e(n)})},needSideListion:function(e){var t=!1;return $.each(e||[],function(e,n){"custom_url"===n.key&&$.trim(n.url)&&(t=!0)}),t},initSidebox:function(){var t=this,n=a.innerController.isInnerMode;n||e.isMob()||this.getSideBoxData(function(n){e.im.sidebox.init({container:t.sideBoxEl,need_clear:!0,side_data:n.side_data,right_width:n.data.right_width,product:e.im.sidebox.getProductData(t.urlParamObj),after:function(e){if(e){var n;t.bodyEl.removeClass("fullscreen").addClass("side"),n={right:Math.min(t.sideBoxEl.width(),$("#main").width()/2)+2,width:"auto"},t.contentEl.css(n),t.footerEl.css(n),t.bottomPanelEl.css(n),t.isWindowCenter&&t.abjuctCenterBox(null,!0)}}})})},imgViewerInit:function(){if(!e.isPC()||!a.innerController.isInnerMode){var t,n=".msg:not(.msg-file) img",i=a.messagesEl,r=function(){var e=$.Deferred();return t?(e.resolve(),e.promise()):(t=!0,$.getScript("js/lib/img-viewer.js"))};r(),i.on("click",n,function(t){var s,o=$(this),a=[];i.find(n).map(function(e,t){o[0]===this&&(s=e);var n=t.naturalWidth?t.naturalWidth:$(t).width(),i=t.naturalHeight?t.naturalHeight:$(t).height();a.push({src:this.src,title:this.title,w:n,h:i})}),r().then(function(){e.imgViewer.load(a,{index:s})})})}},imClientValid:function(e,t){var n=this,i=this.urlParamObj||{},r=this.preloadData||{};return r.im_client_valid_enable=r.im_client_valid_enable||e.im_client_valid_enable||!1,r.im_client_valid_enable?void $.get(n.apiPath+"im_client_valid",{v_nonce:i.v_nonce||"",v_timestamp:i.v_timestamp||"",v_signature:i.v_signature||""}).always(function(e){return e?1e3!==e.code?n.showModal("no_through_valid"):void(t&&t()):n.showModal("networkError")}):t&&t()},doTransfer:function(){var t=this,n=s.els;s.chatAgent?($.each([">.queue-event","#noWordtimeEventMsg"],function(e,t){n.messages.append(n.messages.find(t))}),a.goBottom()):this.beforeTransfer(function(){var n=$("#btnTransfer"),i=n.is(":visible"),r=$("#btnTransfer2"),o=r.is(":visible");n.hide(),s.isTransfer=!0,s.chatAgent=e.chatAgent.create(),s.chatAgent.init({tryShowBtnTransfer:function(){i&&n.click(function(){s.chatAgent=null,t.doTransfer()}).show(),o&&r.click(function(){s.chatAgent=null,t.doTransfer()}).show()}})})},beforeTransfer:function(t){var n=this.urlParamObj;n.user_id=this.customer.user_id;try{$.get(this.apiPath+"im_user/pre_form",n).always(function(n){n=n||{},e.setContext({show_pre_form:n.show_pre_form||!1}),t&&t()})}catch(i){t&&t()}},doTransferCount:function(n,i){var r=this,s=r.urlParamObj||e.urlParams(t.location.href);$.get(r.apiPath+"im/km_robot_transer",{customer_jid:r.customer.username,web_plugin_id:s&&s.web_plugin_id,session_id:n}).always(function(){var e="Transfer||"+r.customer.username;r.sessionStore(e,e+"||"+(n||"")),i&&i(e)})},doTransferTurnPage:function(n,i){var r=this,s=this.urlParamObj||e.urlParams(t.location.href);$.ajax({async:2!==n,url:"/spa1/im/km_robot_transer",data:{customer_jid:r.customer.username,web_plugin_id:s&&s.web_plugin_id,session_id:i,operate_type:n}})},loadUser:function(e){var t=this,n=this.urlParamObj||{},i={};n.sdk_token?(i={device_type:n.platform_name,device_info:{app_name:n.app_name,app_version:n.app_version,platform_name:n.platform_name,version:n.platform_version,device:n.device,phoneModal:n.phoneModal,phoneVersion:n.phoneVersion,networkStatus:n.networkStatus,carrier:n.carrier,scaleScreen:n.scaleScreen}},$.each(["app_name","app_version","platform_name","platform_version","device","phoneModal","phoneVersion","networkStatus","carrier","scaleScreen"],function(e,t){delete n[t]})):(i={device_type:"web",device_info:t.getDevices()},$.each(["cur_url","cur_title","pre_url","src_url"],function(e,t){delete n[t]}));var r=$.extend({device:i},n);t.getUser(r,e)},getUser:function(e,t){var n=this,i=this.urlParamObj||{},r=i.echostr,s=n.getUserTimes;e=$.extend({ud_check_cookie:navigator.cookieEnabled,ud_check_ws:"undefined"!=typeof WebSocket},e),$.post(n.apiPath+"im_user",e).always(function(o){if(i.sdk_token&&(!o||200!=o.code)&&s<1)return s++,n.getUserTimes=s,void setTimeout(function(){n.getUser(e,t)},1e3);n.getUserTimes=0,o=o||{};var a=o.im_user,l=o.company;if(r&&r!==o.echostr)return n.showModal("customError",{content:n.UDL.g("tip.accessError")});switch(o.code){case 9001:return n.showModal("customError",{content:n.UDL.g("tip.robotError")});case 9002:case 9003:return n.showModal("customError",{content:o.message});case 9200:return n.showModal("noAuthorityAdmin")}a?t(a,l,o.role,o.is_blocked,o.black_list_notice,o.agent_resp):n.showModal("error")})},showBotomPanel:function(e,t){var n=this,i=n.frameConfig.theme_color,r=window.location.href;switch(r+=(r.indexOf("?")>-1?"&":"?")+"t="+ +new Date,e){case"chat_done":n.btpTextEl.text(n.UDL.g("agent.over")),n.btpBtnsEl.html('<a style="width:140px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;background-color:'+i+'" href="'+r+'" class="btn btn-sm btn-success btn-chat-done" title="'+n.UDL.g("agent.newChat")+'">'+n.UDL.g("agent.newChat")+"</a>");break;case"agent_offline":n.btpTextEl.text(n.UDL.g("agent.agOffline")),n.btpBtnsEl.html('<a style="width:85px;margin-right:17px;border-radius: 1px;background-color:'+i+'" href="'+r+'" class="btn btn-sm btn-success">'+n.UDL.g("label.refresh")+'</a><a style="width:85px;border-radius: 1px;background-color:'+i+'" class="btn btn-default btn-sm theme-bg btn-feedback">'+n.UDL.g("label.leaveMsg")+"</a>");break;case"queuing":n.btpTextEl.text(n.UDL.g("agent.leaveMsgTip")),n.btpBtnsEl.html('<a style="width:140px;border-radius: 1px;background-color:'+i+'" class="btn btn-sm btn-default theme-bg btn-feedback">'+n.UDL.g("label.leaveMsg")+"</a>")}this.goBottom(),n.bottomPanelEl.show()},showModal:function(t,n){var i,s,o,a,l=!0,c=this,u="",d=!0,p=$("#main");switch(!p.size()&&(p=null),t){case"loading":s="<i></i>";break;case"networkError":s="<p></br>"+c.UDL.g("tip.networkError")+"<p>";break;case"no_through_valid":s='<img src="images/no-valid.png"><p>'+c.UDL.g("tip.wrongRequest")+"<p>",e.ui.appBar({title:c.UDL.g("tip.validRequest")});break;case"chat_done":s="{iconbar-smile}<p>"+c.UDL.g("agent.over")+"<p>";break;case"disconnect":s="{iconbar-alert}<p>"+c.UDL.g("tip.disconnect")+" </p>";break;case"queuing":d=!1,s="<p>{message}</p>";break;case"agent_offline":s=["{iconbar-smile}","<p>"+c.UDL.g("tip.agOffline")+"</p>",'<p class="btnbar">','  <a class="btn btn-default btn-feedback">'+c.UDL.g("label.leaveMsg")+"</a> &nbsp; &nbsp; &nbsp;",'  <a href="'+location.href+'" class="btn btn-default">'+c.UDL.g("label.refresh")+"</a>","</p>"].join("");break;case"agent_notfound":s="{iconbar-alert}<p>"+c.UDL.g("tip.noAgent")+'</p><p><a class="btn btn-default btn-sm btn-feedback">'+c.UDL.g("label.leaveMsg")+"</a></p>";break;case"noAuthority":a=!0,s="{iconbar-smile}<p>"+c.UDL.g("tip.forbid")+"</p><p>"+c.UDL.g("tip.logoutTip")+"</p>";break;case"noAuthorityAdmin":a=!0,s="{iconbar-smile}<p>"+c.UDL.g("tip.forbidAdmin")+"</p><p>"+c.UDL.g("tip.logoutTip")+"</p>";break;case"error":s="{iconbar-alert}<p>"+c.UDL.g("tip.connectFail")+' <a href="'+location.href+'">'+c.UDL.g("label.refresh")+"</a>   "+c.UDL.g("tip.retry")+"</p > ";break;case"customError":s="{iconbar-smile}<p>{content}</p>";break;case"feedbackError":s="{iconbar-alert}<p>"+c.UDL.g("tip.dataFail")+"</p>";break;case"robotError":var h=location.search&&location.search.replace("?",""),f=r+"?transfer=true"+(h?"&"+h:"");s="{iconbar-alert}<p>"+c.UDL.g("tip.robotWrong")+'&nbsp;<a style="text-decoration:underline;" href='+f+">"+c.UDL.g("tip.agentService")+"</a></p>";break;case"robotDelay":var h=location.search&&location.search.replace("?",""),f=r+"?transfer=true"+(h?"&"+h:"");s="{iconbar-alert}<p>"+c.UDL.g("tip.networkWeek")+'&nbsp;<a style="text-decoration:underline;" href='+f+">"+c.UDL.g("tip.agentService")+"</a></p>";break;default:d=!1}if(s=e.replaceTpl(s,$.extend({"iconbar-smile":'<p class="iconbar"><i class="icon icon-tixing text-info"></i></p>',"iconbar-alert":'<p class="iconbar"><i class="icon icon-alert text-warning"></i></p>',"iconbar-ok":'<p class="iconbar"><i class="icon icon-ok text-success"></i></p>'},n)),o=e.ui[l?"tinyModal":"modal"]({container:p,clz:t,title:i,content:s,contentClz:u,needClose:!1,isMob:c.isMob,cssAttrs:d?{color:"#fff"}:null,mask:{container:p}}),c.modal=o,"queuing"===t){var m=c.sideBoxEl,g=$(".side"),v=g.find(".mask.queuing"),b=g.find(".im-pop.queuing"),y=m.css("width").replace("px","")||270;m.is(":visible")&&(v.css({right:y+"px"}),b.css({left:"15px",right:parseFloat(y)+15+"px",margin:0})),v.height()<300&&b.css("top","35%")}return o},hideModal:function(e){var t=this.modal;t&&(e?t.el.is("."+e)&&t.hide():t.hide())},getFileType:function(t){t=t||{};var n=t.name||"",i=t.type||"",r="image/"===i.slice(0,6)?"image":"file",s=!1;return e.platform({weixin:function(){s=!0},mqq:function(){s=!0}}),"file"===r&&0===n.indexOf("image%3A")&&s&&"application/octet-stream"===i&&(r="image"),r},autoCalcWidth:function(e,t){t=$.extend({tagName:"span"},t);var n,i=$("<"+t.tagName+">").text(e);return t.css&&i.css(t.css),i.appendTo(this.bodyEl),n=i.width(),i.remove(),n},getDevices:function(){var e=this,t=this.urlParamObj||{},n=t.pre_url||"",i=t.cur_url||this.getReferrer()||location.href,r=t.src_url||this.getReferrer()||"",s=n,o=t.cur_title||"",a=this.getSearchInfo(location.href,r||s),l=n,c=i,u=r;try{l=decodeURIComponent(n)||""}catch(d){}try{c=decodeURIComponent(i)||""}catch(d){}try{u=decodeURIComponent(r)||""}catch(d){}return{version:1,referrer:s||"",accessUrl:l,accessUrl_desc:"",cur_url:c,cur_url_desc:o,channel:t.channel||"",searchType:a.searchType,src_url:u,keyword:a.keyword,sysInfo:e.getSystem(),bowserInfo:e.getBrowser(),resolution:window.screen.width+"*"+window.screen.height}},escapeXSS:function(t){return e.xss(t)},replaceEmotions:function(e){return e.replace(/\[emoji([^\].]+)\]/g,'<span class="emoji emoji$1"></span>')},replaceLinks:function(e){return e.replace(/((http|https):\/\/([\w-]+\.)+[\w-:]+(\/[\w-.\/\?\;%&=#\：\:\d]*)?)/g,'<a href="$1" target="_blank">$1</a>')},isEmail:function(e){var t=/^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/;return t.test(e)},isPhone:function(e){var t=/^1[345789]\d{9}$/;return t.test(e)},isLink:function(e){var t=/((http|https):\/\/([\w-]+\.)+[\w-]+(\/[\w-.\/\?\;%&=]*)?)/g;return t.test(e)},compareStr:function(e,t,n){var i=(""+e).split("."),r=(""+t).split("."),s=Math.max(i.length,r.length),o=[],a=[],l=function(e){for(var t=e.length;t<s;t++)e.push("0");return e},c=function(e){for(var t=e,n=e.length;n<=3;n++)t="0"+t;return t};i=l(i),r=l(r);for(var u=0,d=i.length;u<d;u++)o.push(c(i[u]));for(var p=0,h=r.length;p<h;p++)a.push(c(r[p]));var f=o.join("."),m=a.join(".");switch(n){case">":return f>m;case"<":return f<m;default:return f>=m}},hasFlash:function(){var e=!1;try{if(document.all){var t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");t&&(e=!0)}}catch(n){}return e},flashChecker:function(){var e=0,t=0;if(document.all)try{var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(n){e=1;var i=n.GetVariable("$version");t=parseInt(i.split(" ")[1].split(",")[0])}}catch(r){}return{f:e,v:t}},getReferrer:function(){var e;try{e=window.top.document.referrer}catch(t){if(window.parent)try{e=window.parent.document.referrer}catch(n){e=""}}if(e||(e=document.referrer),!e)try{window.opener&&(e=window.opener.location.href)}catch(i){e=""}return e},getKeyword:function(t,n){if(!t)return"";n=n||"";var i,r=e.urlParams(t),s=e.urlParams(n),o={baidu:{key:"wd|word"},bing:{key:"q|pq"},sogou:{key:"keyword|query"},yahoo:{key:"p"}},a=n.split("/")[2]||"",l=a.split("."),c=l[l.length-2],u=o[c];if(r.udesk_wd)return r.udesk_wd;if(u){i=u.key.split("|");for(var d=0,p=i.length;d<p;d++)if(s[i[d]])return s[i[d]]}else if(s.q)return s.q;return""},getSearchInfo:function(e,t){try{t=decodeURIComponent(t||"")}catch(n){}var i={baidu:"百度",google:"谷歌",haosou:"好搜",so:"好搜",bing:"必应",youdao:"有道",taobao:"淘宝",sogou:"搜狗",sm:"神马",yahoo:"雅虎",toutiao:"今日头条"},r=t.split("/")[2]||"",s=r.split("."),o=s[s.length-2];return{searchType:i[o]||r.replace("www.","")||"直接访问",keyword:this.getKeyword(e,t)}},_mime:function(e,t){try{var n=navigator.mimeTypes;for(var i in n)if(n[i][e]==t)return!0;return!1}catch(r){return!1}},getBrowser:function(){var t,n="",i=navigator.userAgent;if(/[Ff]irefox(\/\d+\.\d+)/.test(i))tempArray=/([Ff]irefox)\/(\d+\.\d+)/.exec(i),n+=tempArray[1]+tempArray[2];else if(/MSIE \d+\.\d+/.test(i))tempArray=/MS(IE) (\d+\.\d+)/.exec(i),n+=tempArray[1]+tempArray[2];else if(/[Vv]ersion\/\d+\.\d+\.\d+(\.\d)* *[Ss]afari/.test(i))tempArray=/[Vv]ersion\/(\d+\.\d+\.\d+)(\.\d)* *([Ss]afari)/.exec(i),n+=tempArray[3]+tempArray[1];else if(/[Oo]pera.+[Vv]ersion\/\d+\.\d+/.test(i))tempArray=/([Oo]pera).+[Vv]ersion\/(\d+)\.\d+/.exec(i),n+=tempArray[1]+tempArray[2];else if(/edge/i.test(i))n+="Edge";else if(/[Cc]hrome\/\d+/.test(i)){if(window.chrome){var r=this._mime("type","application/vnd.chromium.remoting-viewer");r?n="360":(tempArray=/([Cc]hrome)\/(\d+)/.exec(i),n+=tempArray[1]+tempArray[2])}t=!0}else t=!0;return t&&e.platform({weixin:function(){n="微信"},qq:function(){n="QQ"},weibo:function(){n="微博"}}),n},getSystem:function(){var t,n=navigator.platform,i=navigator.userAgent,r="";return n.indexOf("Win")>-1?r+=i.indexOf("Windows NT 5.0")>-1?"Win2000":i.indexOf("Windows NT 5.1")>-1?"WinXP":i.indexOf("Windows NT 5.2")>-1?"Win2003":i.indexOf("Windows NT 6.0")>-1?"WindowsVista":i.indexOf("Windows NT 6.1")>-1||i.indexOf("Windows 7")>-1?"Win7":i.indexOf("Windows NT 6.2")>-1||i.indexOf("Windows 8")>-1?"Win8":i.indexOf("Windows NT 6.3")>-1||i.indexOf("Windows 8.1")>-1?"Win8.1":i.indexOf("Windows NT 10")>-1||i.indexOf("Windows 10")>-1?"Win10":"Win"+((/Windows (\d+\.\d+)/.exec(i)||[])[1]||"dows"):n.indexOf("Mac")>-1?r+="Mac":n.indexOf("X11")>-1?r+="Unix":n.indexOf("Linux")>-1?(r+="Linux",t=!0):t=!0,t&&e.platform({android:function(){r="Android"},ios:function(e){r="IOS("+e+")"},wp:function(e){r="Windows phone"}}),r||(r+="Other"),r},setFavicon:function(t){$.get("/favicon",function(n){if(e.isIE11()&&n){var i=document.createElement("link");i.rel="shortcut icon",i.type="image/x-icon",i.href=n,$("head").append($(i))}else n&&$("head").append('<link rel="shortcut icon bookmark" href="'+n+'" type="image/x-icon">');t&&t(n)})},getFrameConfig:function(n){n=n||{};var i=this,r=i.preloadData||{},s=i.urlParamObj||e.urlParams(t.location.href),o=function(t){t=t||{};var o=$.extend({theme_color:"#307AE8"},t.data);o.web_plugin_id=o.web_plugin_id||r.web_plugin_id,o.im_client_valid_enable=t.im_client_valid_enable||!1,e.isMob()&&(o.h5Mode_enabled=s.udesk_h5mode||(o.h5_intergration||{}).enabled,o.h5Mode=!0,o.newh5=!0,o.h5Mode_enabled&&(i.isHeadless=!0)),o.logo_url=o.logo_url||"images/default_head.png",o.frame_title=e.xss(o.frame_title);for(var a in n)if(a.indexOf("Selector")>0){var l;"themeColorSelector"===a?l="color":"themeBGSelector"===a?l="background":"themeBDSelector"===a&&(l="border"),$(n[a]).css(l,o.theme_color)}i.renderPage(o,$.extend({},n,{renderLang:function(){n.renderLang&&n.renderLang(),n.cb&&n.cb(o)}}))};if(!n.isTicket&&r.window)return o({data:r.window,im_client_valid_enable:r.im_client_valid_enable||!1});var a={code:1e3,data:{buttons_enable:{emoji_enabled:!1,upload_enabled:!1,screenshot_enabled:!1,download_logs_enabled:!1,agent_cellphone_enabled:!1,agent_cellphone:"",vcall:!1,remote:null,vc_app_id:null},frame_close:"",frame_name:"",frame_title:"",pc_no_max_window:{},h5_intergration:{}},im_client_valid_enable:!1};n.isTicket?o(a):$.get(i.apiPath+"im/im_customize/window",{im_web_plugin_id:s.web_plugin_id,language:s.language}).always(o)},getLangCfg:function(e,t){var n=$("#localesId"),i=n.data("src"),r=i;e=e||"zh-cn",i&&("zh-cn"===e?$.getJSON(i,function(e){a.UDL.setData(e),t&&t()}):($.getJSON(i,function(e){a.UDL.setDefaultData(e)}),r=i.replace(/\/[^\/]+\.json/,"/"+e+".json"),$.getJSON(r).always(function(e){a.UDL.setData(e),t&&t()})))},renderPage:function(n,i){i=i||{};var r=this,s=this.urlParamObj||null;s||(s=e.urlParams(t.location.href)||{});var o=i.language||s.language||n.lang;this.getLangCfg(o,function(){var e=r.UDL;i.feedback||i.isTicket||(n.frame_name=e.g("agent.onlineAg"),document.title=n.frame_title||n.frame_name,$("#copy-right a").text(e.g("label.copyRight")),$(".black-list-tip").text(e.g("agent.blackList"))),i.renderLang&&i.renderLang()})},getRoot:function(){var e=window.parent;try{return e.udesk&&e.udesk.ui?e:window}catch(t){return window}},genPageUrl:function(e,t){var n,i=this.customer,r=this.frameConfig||{};return t=t||{},n=t.params||{},r.h5Mode&&(n.udesk_h5_mode=1),i&&(n.udesk_access_token=i.access_token,n.udesk_customer_id=i.user_id),(e||"")+location.search+(location.search?"&":"?")+this.jsonParam(n)},goFeedback:function(e){var t,n=this.getRoot(),i=e.hideBoardAll;e=$.extend({btnBack:!0,onClick:function(n,r){if("back"===n){var s=t.parent(),o=s.find("#pre-form"),a=s.find("#choiceAgent");
e.onBack&&e.onBack(),s.children().removeClass("open"),i||(o.size()?o.addClass("open"):a.size()&&a.addClass("open"))}}},e),t=n.udesk.ui.board({id:"feedbackPage",type:"iframe",title:a.UDL.g("feedback.title"),noAnimate:e.noAnimate,header:{btnBack:e.btnBack,onClick:e.onClick},body:this.genPageUrl("feedback.html",{params:{deep:"deep"}})}),a.stopQueuing=!0,e.cb&&e.cb()},goChatLog:function(e){var t=this.getRoot(),n=t.udesk.ui.board({id:"chatLogPage",type:"iframe",title:a.UDL.gl("msgLog"),header:{btnBack:!0,onClick:function(e,t){"back"===e&&n.removeClass("open")}},body:this.genPageUrl("chat_log.html")})},_store:function(e,n,i){if(e="UDESK_"+e,i=i||t.localStorage)try{if(void 0===n)return i.getItem(e)||"";if(!n)return i.removeItem(e);i.setItem(e,n||"")}catch(r){}},store:function(e,t){return this._store(e,t)},supportStore:function(){if(!t.localStorage||"object"!=typeof localStorage)return!1;try{return localStorage.setItem("udesk_test","test"),localStorage.getItem("udesk_test"),localStorage.removeItem("udesk_test"),!0}catch(e){return!1}},sessionStore:function(e,n){return this._store(e,n,t.sessionStorage)},clearMsgs:function(){a.messagesEl.empty()},showTip:function(t,n,i){i=i||{},t=t||this.UDL.g("tip.optSuccess"),n=n||"success",n="error"===n?"danger":n,n="warn"===n?"warning":n,e.ui.tip(t,$.extend({type:n,css:{marginTop:this.isHeadless?0:62}},i))},winAlert:function(e){setTimeout(function(){window.alert(e)},300)},goBottom:function(){setTimeout(function(){try{a.contentEl.removeClass("scrollbar").addClass("scrollbar"),a.contentEl.scrollTop(a.messagesEl.height()+999)}catch(e){}},100)},loadJS:function(e,t,n){if(e){if(!n){if($.inArray(e,this.loadFiles)>-1)return t&&t();this.loadFiles.push(e)}$.getScript(e,t)}},formatDateTime:function(e,t){function n(e){return e<10?"0"+e:e}if(e){var i;try{i=new Date(e)}catch(r){a.log.info(r)}var s=""+n(i.getHours())+":"+n(i.getMinutes())+":"+n(i.getSeconds());return((new Date).toDateString()!==i.toDateString()||t)&&(s=""+i.getFullYear()+"/"+(i.getMonth()+1)+"/"+i.getDate()+" "+s),s}},moveCursor:function(e,t){if(e.focus(),t=$.isNumeric(t)?t:e.value.length,document.selection){var n=e.createTextRange();n.moveStart("character",t),n.collapse(),n.select()}else $.isNumeric(e.selectionStart)&&$.isNumeric(e.selectionEnd)&&(e.selectionStart=e.selectionEnd=t)},formatRichMsg:function(e){if(!e)return""},getIosVersion:function(){var e=navigator.userAgent.toLowerCase(),t=e.match(/cpu iphone os (.*?) like mac os/);return t?t[1].replace(/_/g,"."):""},abjuctCenterBox:function(n,i){if(!e.isMob()&&(n=n||a.frameConfig.pc_no_max_window||{},n.enabled)){var r=t.document,l=this.bodyEl,c=l.find("#main"),u=s.els.sideBox,d=(r.documentElement||l[0]).clientWidth,p=(r.documentElement||l[0]).clientHeight,h=function(){var e={},t=o.initMainWidth,n=u.width();i&&(t+=n,c.width(t),e.maxWidth="100%"),c.css($.extend(e,{"margin-top":-(c.height()/2)+"px","margin-left":-(t/2)+"px",overflow:"hidden"})),i&&(n=u.width(),a.contentEl.css("right",n+2),a.footerEl.css("right",n+2),a.bottomPanelEl.css("right",n+2))};a.hasWinParent()||(d>=n.maxWidth||p>=n.maxHeight)&&(console.log(l),a.isWindowCenter=!0,l.addClass(" center-box"),n.background_url&&l.css("background-image","url("+n.background_url+")"),o.isAbjuctCenterBox||(o.initMainWidth=c.width(),o.isAbjuctCenterBox=!0),setTimeout(function(){h(),$(t).resize(h)},5))}},applyH5Mode:function(){var e=this.frameConfig,t=this.footerEl.find(".toolbar");t.find("a").each(function(){var e=this,t=e.className||"",n="icon-",i="icon-h5-";"btnSurvey"===e.id?e.className=t.replace(/icon-good[1]?/,"icon-good1"):e.className=t.replace(i,n).replace(n,i)}),this.bodyEl.addClass("h5mode"),this.bodyEl.addClass("newh5"),this.urlParamObj.sdk_token||e.h5Mode_enabled||this.bodyEl.addClass("has-header"),this.h5TransferEl.css("color",e.theme_color)},autoSize:function(t){t=t||{};var n=this,i=(n.innerController.isInnerMode,n.frameConfig.h5Mode,$("#copy-right")),r=i.is(":visible")?i.height():0,s=Math.max(n.footerEl.outerHeight(),n.footerEl.find(".textbox").outerHeight())+r,o=r;n.footerEl.is(".singleline")&&(r+=12,s+=12,o+=12),e.isMob()&&(s+=12),t.offsetY&&(r+=t.offsetY,s+=t.offsetY),n.contentEl.css("bottom",s+"px"),n.guideListEl.css("bottom",s+"px"),n.bottomPanelEl.css("bottom",r+"px"),n.footerEl.css("bottom",r+"px"),e.isPC()&&n.sideBoxEl.css("bottom",r+"px"),t.cb&&t.cb()},editorAutoShow:function(){if(this.frameConfig.h5Mode){var e,t=this,n=a.footerEl,i=n.find(".toolbar"),r=n.find(".more-box"),s=$('<a href="javascript:;" class="icon icon-add more-btn" style="width:initial"></a>'),o=n.outerWidth()-28,l=n.find(".more-btn");l.size()&&l.remove();var c=i.find("a").filter(function(){var e=$(this);return e.width("initial"),e.attr("clickshow")||"none"!==e.css("display")});$.each(c,function(e,t){if(e>0){var n=$(t);n.css({width:"initial",position:"initial",top:"auto",right:"auto"}),n.removeAttr("clickShow")}}),r.width(0).hide().empty();var u=c.length;console.log(u),0!==u&&(u<=2?$.each(c,function(e,t){if(e>0){var n=$(t);n.css({width:"initial",position:"relative",top:"auto",right:"auto"}),n.removeAttr("clickShow"),r.hide()}}):u>2&&u<5?(c.eq(0).after(s),$.each(c,function(e,t){if(e>0){var n=$(t);n.css({width:"62px",position:"absolute",top:"-68px",right:10+62*(e-1)+"px",display:"none"}),n.attr({clickShow:!0});var i=n.data("tip")||"",s=$('<div class="btn-tip">'+i+"</div>");s.css({right:62*(e-1)+"px"}),r.append(s);var o=r.width()||0;r.width(o+62)}}),s.off("click").on("click",function(e){"block"!==r.css("display")?($.each(c,function(e,t){$(t).attr("clickshow")&&$(t).show()}),r.show()):t.hideMoreBox(),e.preventDefault()})):($.each(c,function(e,t){var n=$(t);n.css({width:"auto",position:"relative",top:"auto",right:"auto",display:"block"}),n.removeAttr("clickShow"),r.hide()}),c.css("width",o/u-1+"px"),e=!0),e&&n.addClass("bottom-line"),this.autoSize())}},hideMoreBox:function(){var e=a.footerEl,t=e.find(".toolbar"),n=e.find(".more-box"),i=t.find("a").filter(function(){var e=$(this);return"none"!==e.css("display")});$.each(i,function(e,t){$(t).attr("clickshow")&&$(t).hide()}),n.hide()},getBtnMsgLogsHtml:function(e){var t=this,n="btn-msg-logs",i="click."+n,r=['<div class="text-center">','   <a class="'+n+' text-muted">'+a.UDL.gl("viewMsgLog")+"</a>","</div>"].join("");return a.bodyEl.off(i).on(i,"."+n,function(){t.goChatLog(e)}),r},formatImgContent:function(e){return e=(e||"").replace(/<img [^>]*\/>/g,function(e){var t=$(e).attr("src");return'<a href="'+t+'" target="_blank">'+e+"</a>"})},formatAttachment:function(e){var t=[];if(!e.address||!e.name||!e.size)return"";var n=WebUploader.Base.formatSize(e.size),i=a.getFileImgByFileUrl(e.address,"02");return t=['<div class="attachment-item">',i+" ",'<span class="attachment-name">'+e.name+"</span>",'<span class="attachment-size">('+n+")</span>",'<a href="'+e.address+'" class="attachment-download" target="_blank" download="'+e.name+'" >'+a.UDL.g("label.download")+"</a>","</div>"].join("")},jsonParam:function(e){var t=[];if("object"==typeof e){for(var n in e){var i=encodeURIComponent(n),r=encodeURIComponent(e[n]);t.push(i+"="+r)}return t.join("&")}return e},findValueInArr:function(e,t){t=t||[];for(var n=0,i=t.length;n<i;n++)if(t[n]===e)return!0;return!1},needXss:function(t,n,i){var r=["text","number","numeric","link","area_text","location"];return t?(i=i||r,this.findValueInArr(t,i)?e.xss(n):n):e.xss(n)},setBtnSendActive:function(t){var n={},i=this.frameConfig||{},r=i.theme_color,s=$.trim(this.txtMsgEl.val()),o=this.btnSendEl,a=this.footerEl.find(".toolbar"),l=this.footerEl.find(".textbox"),c=a.find("a").filter(function(){var e=$(this);return e.attr("clickshow")||"none"!==e.css("display")}),u=(a.find(".more-btn"),o.outerWidth());if(i.h5Mode)if(t=!0,s){var d;d=c.size()<=2?u+15:u-15,c.size()&&d&&a.css({right:d+"px"}),l.css({paddingRight:u+d-25}),o.show()}else a.css({right:"12px"}),l.css({paddingRight:"58px"}),o.hide();else t="undefined"==typeof t||t,t=t&&!!s,n.color=t?e.context.isLowIE?"#242e33":"#FFF":"rgba(36, 46, 51, .8)";n.backgroundColor=t?r:"#F5F5F5",n.borderColor=t?r:"#E6E6E6",n.cursor=t?"pointer":"default",o.css(n)},orderedCuttingGroupTime:function(e){e=e||{};var t="orderedCuttingGroupTime",n=t+".isRecv",i=new Date(e.time).getTime();return o[t]&&e.isRecv===o[n]&&i-o[t]<=3e4?i=o[t]:(o[t]=i,o[n]=e.isRecv),(e.isRecv?"RECV":"")+i},parseMsgGroupTime:function(e){var t=e.data("group-time"),n=a.messagesEl.find('[data-group-time="'+t+'"]'),i=[],r=n.size(),s="time-item",o="time-first-item",l="time-last-item",c=[s,o,l];r>1&&(n.each(function(e){var t=$(this),n=[s],a=!t.is(".no-group"),c=t.data("msgid")||"";a&&c&&0!==c.indexOf("SYS-")?(e?e===r-1?n.push(l):t.removeClass(o+" "+l):n.push(o),t.addClass(n.join(" "))):i.push(t)}),$.each(i,function(){var e=$(this),t=e.prev(),n=e.next();t.is("."+s)&&(t.is("."+o)?t.removeClass(c.join(" ")):t.addClass(l)),n.is("."+s)&&(n.is("."+l)?n.removeClass(c.join(" ")):n.addClass(o))}))},setReaded:function(){var e=this.messagesEl.find(".first-unread-msg");if(e.size()){var t=this.contentEl.scrollTop(),n=e.position().top;this.setFloatMsgBase(),this.animateScroll(n-t+22)}},setFloatMsgBase:function(){var e=this.footerEl.find(".float-box"),t=this.messagesEl.find(".first-unread-msg");e.hide().remove(),o.unreadCount=0,o.unreadMsgsHeight=0,t.size()&&t.removeClass("first-unread-msg")},bindContentScroll:function(){var e=this;this.contentEl.off("scroll").on("scroll",function(){var t=e.footerEl.find(".float-box");if(t.size()){var n=e.contentEl.scrollTop(),i=e.messagesEl.outerHeight()+12,r=e.contentEl.outerHeight()-24;i-r-n<o.unreadMsgsHeight&&e.setFloatMsgBase()}})},showUnreadMsg:function(e,t,n){var i=this.footerEl.find(".float-box"),r=this;if(!t&&n){if(o.unreadCount++,i.size())i.find("span").html(o.unreadCount+this.UDL.g("tip.unreadMsgs"));else{var s='<div class="float-box"><div class="float-msg"><i class="icon icon-xiajiantou"></i> <span> '+o.unreadCount+"条新消息</span></div></div>";this.footerEl.append(s),e.addClass("first-unread-msg")}this.footerEl.on("click",".float-msg",function(){r.setReaded()})}},judgeScrollDistance:function(t,n){if(n=n||{},e.ifIE(8))return this.goBottom();console.log("xxx1: "+(new Date).getTime());var i=this,r=t.find(".msg img");if(r.size()){var s=r.size();$.each(r,function(e,r){r.complete?(s--,s<=0&&i.judgeMsgElNeedAction(t,n)):($(r).load(function(){s--,s<=0&&i.judgeMsgElNeedAction(t,n)}),$(r).error(function(){s--,s<=0&&i.judgeMsgElNeedAction(t,n)}))})}else i.judgeMsgElNeedAction(t,n)},judgeMsgElNeedAction:function(e,t){var n=this.messagesEl.children(),i=n.eq(-2).outerHeight()+parseInt(n.eq(-2).css("marginTop")),r=n.eq(-3).outerHeight()+parseInt(n.eq(-3).css("marginTop")),s=n.eq(-4).outerHeight()+parseInt(n.eq(-4).css("marginTop")),o=i+r+s+24,a=this.contentEl.scrollTop(),l=this.contentEl.outerHeight()-24,c=this.messagesEl.outerHeight()+12,u=parseInt(e.css("marginTop"))||0,d=e.outerHeight()+u+(t.isRobot?-20:0),p=!1,h=!1;if(t.isRobot)p=t.isRecv||!1;else{var f=e.data("group-time")||"";p=(f+"").indexOf("RECV")>-1,h=e.hasClass("item-loading")}var m;if(t.isRobot){var g=e.prev();m=g.find("> .msg-recv").size()>=1}else{var g=e.prev(),v=g?g.data("group-time"):"";m=(v+"").indexOf("RECV")>-1}var b={msgsElHeight:c,currentScrollHeight:a,contentElHeight:l,resaultHeight:d,lastHeight:o,msgIsRecv:p,previsRecv:m,isMsgLoading:h,isRobot:t.isRobot,msgEl:e};this.doScrollOrSetUnread(b)},doScrollOrSetUnread:function(e){console.log("xxx2: "+(new Date).getTime()),e=e||{};var t=e.msgsElHeight,n=e.currentScrollHeight,i=e.contentElHeight,r=e.resaultHeight,s=e.lastHeight,a=e.msgIsRecv,l=e.isMsgLoading,c=e.isRobot,u=e.msgEl,d=e.previsRecv,p=t-n-i-r;return s<=p&&(a||l)&&!c?(l||(o.unreadMsgsHeight+=r),void this.showUnreadMsg(u,l,a)):void this.scrollDistance({previsRecv:d,resaultHeight:r,diffScroll:p,isRobot:c,msgIsRecv:a})},scrollDistance:function(e){var t=e.previsRecv,n=e.resaultHeight,i=e.isRobot,r=r,s=e.diffScroll,o=this.contentEl.outerHeight(),a=!r&&i;t?n>o-46?this.animateScroll(o+s-60):this.scrollBottom(a):n>o-66?this.animateScroll(o+s-80):this.scrollBottom(a)},animateScroll:function(e){var t=this;o.scrollTimer&&clearTimeout(o.scrollTimer),o.scrollTimer=setTimeout(function(){try{a.contentEl.removeClass("scrollbar").addClass("scrollbar");var n=t.contentEl.scrollTop(),i=e,r=Math.floor(.4*i);r>600&&(r=600),a.contentEl.animate({scrollTop:n+e},r)}catch(s){}},50)},animateScrollBottom:function(){var e=(this.messagesEl.find(".msg img"),this);e.scrollBottom()},scrollBottom:function(e){var t=this;if(e){var n=t.messagesEl.outerHeight();a.contentEl.removeClass("scrollbar").addClass("scrollbar"),a.contentEl.scrollTop(n+9999)}else o.scrollBottomTimer&&clearTimeout(o.scrollBottomTimer),o.scrollBottomTimer=setTimeout(function(){try{var e=t.messagesEl.outerHeight();a.contentEl.removeClass("scrollbar").addClass("scrollbar"),a.contentEl.animate({scrollTop:e+9999})}catch(n){}},50)},getFileImgByFileUrl:function(t,n,i){var r;return i=i||{},n=n||"01",r=/\.(pdf)/.test(t)?"pdf":/\.(doc|docx|odt)/.test(t)?"word":/\.(xls|xlsx|csv)/.test(t)?"excel":/\.(ppt|pptx)/.test(t)?"ppt":/\.(txt)/.test(t)?"txt":"unknow",e.createHtml("img",{src:"images/"+r+n+".png",css:i.css})},hasWinParent:function(){var e=window,t=e.parent;try{return!(e.top===e.self||!t.udesk||!t.udesk.ui)}catch(n){return!1}},getWeixinBrowser:function(){var t="";return e.platform({weixin:function(){var e=navigator.userAgent.toLocaleLowerCase().match(/micromessenger\/([\d\.]+)/i)||[];t=e[1]||""}}),t},needBlurAction:function(){var t=!1;return e.isIos()&&e.platform({weixin:function(){var e=a.getWeixinBrowser();e&&a.compareStr(e,"6.7",">")&&(t=!0)}}),t},initFooter:function(){var t,n=s.els,i=a.getIosVersion()||"0.0.0",r=a.compareStr(i,"11.0.3","<")||a.compareStr(i,"11.2.6",">"),o=a.compareStr(i,"11.0.3","<"),l=/[Vv]ersion\/\d+\.\d+(\.\d+)* .*[Ss]afari/.test(navigator.userAgent),c=/mqqbrowser|mqq/.test(navigator.userAgent.toLowerCase()),u=parseInt(n.footer.css("bottom")),d=s.isMob&&s.isIos&&l&&!c;a.setBtnSendActive();try{n.txtMsg.placeholder()}catch(p){}$(window).resize(function(){s.isMob&&a.goBottom()}),e.platform({ios:function(){n.txtMsg.focus(function(e){a.goBottom(),e.stopPropagation()})}}),n.txtMsg.off().on("click",function(){var e=this;r?setTimeout(function(){try{if(d)if(o)e.scrollIntoView();else{var t=n.doc.scrollTop();n.doc.scrollTop(t+28)}else e.scrollIntoView()}catch(i){}},350):d&&(t=!0,n.footer.css({bottom:u+28+"px"}))}).on("blur",function(){if(t&&(n.footer.css({bottom:u+"px"}),t=!1),a.needBlurAction())try{var e,i,r=1;i=setTimeout(function(){e=document.documentElement.scrollTop||document.body.scrollTop,e-=r,window.scrollTo(0,e),e+=r,window.scrollTo(0,e);var t=a.innerController.isInnerMode;t&&a.innerController.postMsg({type:"innerInputBlur"})},100)}catch(s){}}).on("input propertychange",function(){a.setBtnSendActive()}),n.footer.off("click").on("click",function(){n.txtMsg.focus()}),n.footer.children().off("click").click(function(e){e.stopPropagation()})},checkFileCanPreview:function(t){t=t||"";var i=/\.((doc)|(docx)|(odt)|(rtf)|(wps)|(ppt)|(pptx)|(odp)|(dp)|(xls)|(xlsx)|(ods)|(csv)|(et)|(pdf))$/g,r=/\.(pdf)$/g,s=/\?download/g,o=t.match(i),a=t.match(r),l="",c=location.hostname,u=c.indexOf("s2.udesk.cn")>-1?"s2.":"";if(!o)return"";if(a&&e.isMob()){var d=t.split("?"),p="file:"===location.protocol?"http:":location.protocol,l=p+"//static-ud.udesk.cn/lib/pdf/pdf@2.0/web/viewer.html?file="+t;return l}try{if(s.test(t)){var d=t.split("?");l="https://preview-proxy."+u+"udesk.cn/preview/wopi/files/"+n(d[0],!0)+"/documents"}else l="https://preview-proxy."+u+"udesk.cn/preview/wopi/files/"+n(t,!0)+"/documents";return l}catch(h){return""}}};a.UDL={setData:function(e){this.data=e,this.parseElements()},setDefaultData:function(e){this.defaultData=e},parseElements:function(e){$("[udl-g],[udl-gl],[udl-gt]",e).each(function(){var e,t=$(this),n=t.attr("udl-g"),i=t.attr("udl-gl"),r=t.attr("udl-gt"),s=t.attr("udl-property"),o="g",l=n,c={};i&&(o="gl",l=i),r&&(o="gt",l=r),e=a.UDL[o](l),s?(c[s]=e,t.attr(c)):t.html(e)})},g:function(t,n){var i=a.UDL.data||{},r=a.UDL.defaultData||{};t=t||"";for(var s="",o=t.split("."),l=i[o[0]],c=1;c<o.length;c++)"object"==typeof l&&(l=l[o[c]]||"");if(!l&&!$.isEmptyObject(r)){for(var s=r[o[0]],c=1;c<o.length;c++)"object"==typeof s&&(s=s[o[c]]||"");l=s}return n&&l&&"object"!=typeof l&&(l=e.replaceTpl(l,n)),l||o[o.length-1]||""},gl:function(e,t){return a.UDL.g("label."+e,t)},gt:function(e,t){return a.UDL.g("tip."+e,t)}},a.tipsNewMessage={id:null,time:300,music:null,title:document.title||"",muted:!1,init:function(){var e=this;this.title=document.title;try{audiojs.events.ready(function(){e.music=audiojs.create($("#audio-music")[0])})}catch(t){}$(document.body).on("mouseover",function(){e.stop()})},start:function(t,n){var i=this,r="【　　　　】",s="【"+a.UDL.g("tip.newMsgTitle")+"】",o=r+this.title,l=s+this.title;if(!this.muted){n.indexOf("emoji")>-1&&(n="");var n=n||a.UDL.g("tip.newMsg"),t=t||a.UDL.g("label.notify");document.title=l;try{i.music.play()}catch(c){a.log.info(c)}if(!a.innerController.isInnerMode)try{e.notification(t,n)}catch(c){}i.id||(clearInterval(i.id),i.id=setInterval(function(){document.title=document.title===o?l:o},i.time))}},stop:function(){var e=this;"undefined"!=typeof e.id&&(clearInterval(e.id),e.id=void 0,document.title=e.title)},mute:function(){this.muted=!0},unmute:function(){this.muted=!1}},a.log={init:function(e){$.getScript("/im_client/cmps/raven-js/dist/raven.min.js").then(function(){$.getJSON("/im_client/log_filters/sentry.json").then(function(t){var n=0;Raven.config("https://cd85964a2473493893a800f2c92500ce@sentry.udesk.cn/3",$.extend({shouldSendCallback:function(e){return++n<=50}},t)).install(),Raven.setUserContext({id:e.user_id,username:e.username})})})},info:function(){console.log(arguments)},debug:function(e){e&&this.error(e,{extra:"debug"})},error:function(e,n){if(e){var i="[object Error]"==Object.prototype.toString.call(e);console.log(e,n),t.Raven&&Raven[i?"captureException":"captureMessage"](e,{extra:n})}}},a.innerController={isInnerMode:!1,msgListener:function(e){window.addEventListener?window.addEventListener("message",function(t){try{var n=JSON.parse(t.data)||{};e&&e(n)}catch(t){}}):window.attachEvent("onmessage",function(t){try{var n=JSON.parse(t.data)||{};e&&e(n)}catch(t){}})},storageListener:function(e){try{window.addEventListener?window.addEventListener("storage",function(t){e&&e(t)}):document.attachEvent&&!K.Browser.opera?document.attachEvent("onstorage",function(t){e&&e(t)}):window.attachEvent("onstorage",function(t){e&&e(t)})}catch(t){}},postMsg:function(e,t){var n=a.getRoot();e=JSON.stringify(e)||"",t=t||"*",n.parent.postMessage(e,t)},postNewMsg:function(e,t){switch(t){case"redirect":case"timeout":return;case"file":case"audio":e="［"+a.UDL.g("label.file")+"］";break;case"image":e="［"+a.UDL.g("label.image")+"］";break;case"message":e=e;break;default:e=a.UDL.g("tip.newMsgTitle")}this.postMsg({msg:e,type:"newMsg"})},postAgentInfo:function(e){var t={type:"agent",nick:e.nick,src:e.avatar};this.postMsg(t)},fnStore:{openPanel:function(e){a.preloadData=e.preloadData,s.els.txtMsg.focus(),a.goBottom()},clearUnread:function(e){try{a.store("unread",0)}catch(t){}},postClearUnread:function(e){try{a.innerController.postMsg({type:"clearUnread"})}catch(t){}},forceChat:function(e){t.location.reload()},autoSize:function(e){a.autoSize()}},registeFn:function(e,t){if(e&&t){var n=this.fnStore[e];n?$.isArray(n)?n.push(t):$.isFunction(n)?this.fnStore[e]=[n,t]:this.fnStore[e]=t:this.fnStore[e]=t}},execFn:function(e,t){var n=this.fnStore;if(e&&n[e]){t=t||{};var i=n[e];if(i)if($.isArray(i))for(var r=0,s=i.length;r<s;r++)$.isFunction(i[r])&&i[r](t);else $.isFunction(i)&&i(t)}},listeneStorage:function(){var e=this;this.storageListener(function(t){t=t||{},"UDESK_msg"===t.key?e.execFn("showStoreMsg"):"UDESK_unread"===t.key&&e.execFn("postClearUnread")})},init:function(e){var t=this;this.isInnerMode=!0,this.msgListener(function(e){e=e||{};var n=e.type||"";t.execFn(n,e)})}},t.console=t.console||{log:function(){}},e.common=a}(this.udesk,this),function(e,t){var n={},i=e.common;n.chat={msgLoadingHtml:'<img class="wait-img" src="images/loading-sun.gif"/>',msgResendHtml:'<img class="fail-img" src="images/msg-resend.png"/>',msgItemTpl:function(e){var t=["clearfix"],n=[];return e=e||{},e.groupTime&&n.push('data-group-time="'+e.groupTime+'"'),e.clz&&t.push(e.clz),['<dd class="'+t.join(" ")+'" data-msgId={msgId} data-received=0 '+n.join(" ")+">",'    <div class="msg {clz} {typeClz}"><div class="sender"><span class="sender-text">{senderName}</span><span class="time-text">{msgTime}&#8197;<b> </b></span></div><i {avatarStyle}></i><span style="{style}">{msg}</span></div>','    <span class="msg-status">',this.msgLoadingHtml,this.msgResendHtml,"    </span>","</dd>"].join("")},imgItemTpl:function(t,n){var r=this,s='<img src="{msg}">';return e.isMob()?s='<img src="{msg}">':i.innerController.isInnerMode&&(s='<a href="{msg}" target="_blank"><img src="{msg}"></a>'),e.replaceTpl(r.msgItemTpl(n),{typeClz:"msg-img",msg:s})},fileItemTpl:function(t,n,r){r=r||{};var s,o=i.getFileImgByFileUrl(n,r.isRecv?"02":"03"),a=[],l=10;return t&&(a.push({href:t,target:"_blank",text:i.UDL.g("label.preview")}),l+=e.context.previewTextWidth),r.noDownload||(a.push({href:"{msg}",target:"_blank",text:i.UDL.g("label.download")}),l+=e.context.downloadTextWidth),s=e.joinStr('<div class="file-box" style="padding-right:'+l+'px">',o+" ",'<div class="file-name">','<a href="{msg}" target="_blank">{filename}</a>','<div class="text-muted">{filesize}</div>',"</div>",'<div class="btns">',e.map(a,function(t,n){return e.createHtml("a",n)}),"</div>","</div>"),e.replaceTpl(this.msgItemTpl(r),{typeClz:"msg-file",msg:s})},videoItemTpl:function(){var t=this;return e.replaceTpl(t.msgItemTpl(),{typeClz:"msg-video",msg:'<video src={msg} controls="controls">Video address：{msg}</video>'})},uploadingTpl:function(){var t=this;return e.replaceTpl(t.msgItemTpl(),{typeClz:"msg-uploading",msg:'<div class="progress-max" id={fileId}><div class="progress-per"></div></div>'})},titleItemTpl:function(){return'<dt class="hide"><h4>{msg}</h4></dt>'},titleRadiusItemTpl:function(t){var n;return t=t||{},n=t.msg,delete t.msg,e.createHtml("dt",$.extend({html:'<span class="event-bar">'+n+"</span>"},t))},ads_textTpl:function(){return['<div class="side-text scrollbar">','<div class="side-title">{title}</div>','<div class="side-content">{links}</div>',"</div>"].join("")},ads_imgTpl:function(){return['<div class="side-img">','<a href="{image_link}" target="_blank">','<img src="{image}" /></a></div>'].join("")},structTpl:function(t){t=t||{};var n,i=this,r=t.buttons||[],s="",o="",a="",l="";t.img_url&&(s=['<li class="list-group-item">','<img src="'+t.img_url+'" class="struct-img">',"</li>"].join("")),t.title&&(a="<label>"+t.title+"</label>"),t.description&&(l='<p class="text-muted">'+t.description+"</p>"),(a||l)&&(o='<li class="list-group-item text-left">'+a+l+"</li>"),n='<ul class="list-group">'+s+o;for(var c=0;c<r.length;c++){var u=r[c];"link"===u.type?n+='<li class="list-group-item"><a href="'+u.value+'" target="_blank">'+u.text+"</a></li>":"phone"===u.type&&(n+='<li class="list-group-item"><a class="show-tel" href="tel:'+u.value+'">'+u.text+"</a>")}return n+="</ul>",e.replaceTpl(i.msgItemTpl(),{typeClz:"msg-struct",msg:n})},productTpl:function(t){var n=["msg-product"],i=[];if(t=t||{},t.imgUrl&&(n.push("has-img"),i.push('<img src="'+t.imgUrl+'" />')),t.url?i.push('<a href="'+t.url+'" target="_blank">'+t.name+"</a>"):i.push(t.name),t.params){i.push('<div class="params clearfix">');for(var r,s=0,o=t.params.length;s<o;s++)r=t.params[s],i.push('<span style="'),r.color&&i.push("color: "+r.color+";"),r.size&&i.push("font-size: "+(r.size||12)+"px;"),r.bold&&i.push("font-weight: bold;"),i.push('">'+r.text+"</span>"),r["break"]&&i.push("<br/>");i.push("</div>")}return e.replaceTpl(this.msgItemTpl(),{typeClz:n.join(" "),msg:i.join("")})},surveyTpl:function(t){var n=['<dd class="clearfix survey-event" data-received=1>','    <div class="text-center">','<div class="sender survey-sender">','<span class="sender-text">{senderName}</span>',"</div>",'<div class="survey-text event-bar">',"<span>"," &nbsp;{iconText} &nbsp;",'<a href="javascript:;" class="{surveyClass}" data-im_sub_session_id="{im_sub_session_id}" data-agent_id="{agent_id}" data-methods="{methodFlag}" data-jid="{jid}">{surveyText}</a>',"</span>","</div>","</div>","</dd>"].join("");return e.replaceTpl(n,$.extend({clz:"",senderName:"",msgTime:"",iconText:"",surveyText:"",surveyClass:""},t))},queueTpl:function(t){var n=['<dd class="clearfix queue-event text-center" data-received=1 {groupTimeAttr}>','<div class="queue-text event-bar">','<p class="queue-num">',"{queueText} ",t.leaveText?"{leaveText}":"","</p>","</div>","</dd>"].join("");return e.replaceTpl(n,$.extend({clz:"",senderName:"",msgTime:"",queueText:"",leaveText:"",groupTimeAttr:t.groupTime?'data-group-time="'+t.groupTime+'"':""},t))},loadingTpl:function(t){return t=t||{},e.replaceTpl(this.msgItemTpl({clz:"item-loading"}),$.extend({msg:'<img src="images/loading3.gif" />'},t,{msgTime:i.formatDateTime(t.msgTime)}))}},n.feedback={basicFieldTpl:function(){return['<div class="form-group {classHidden}" data-valid="{isValid}" data-field="{name}">',this.usePlaceholder?"":"<label>{title}</label>","   {content}","</div>"].join("")},basicInputTpl:function(){var e="";return this.usePlaceholder&&(e=' placeholder="{title}"'),'<input type="{content_type}" {val} value="{value}" data-title="{title}" name="{name}" data-otype="{otype}" {checkedAttr} class="{clazz}" '+e+" />"},basicOptionTpl:function(){return"<option {val} {checkedAttr} title={text}>{text}</option>"},basicSelectInputTpl:function(){return'<div><label class="check-btn">'+this.basicInputTpl()+"<span>{text}</span></label></div>"},basicCheckboxTpl:function(){return e.replaceTpl(this.basicSelectInputTpl(),{clazz:"field",content_type:"checkbox"})},basicRadioTpl:function(){return e.replaceTpl(this.basicSelectInputTpl(),{clazz:"field",content_type:"radio"})},basicTextTpl:function(){return e.replaceTpl(this.basicInputTpl(),{clazz:"form-control",content_type:"text"})},numberFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.positiveInt"),otype:"number"})},dateFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.date"),otype:"date"})},timeFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.time"),otype:"time"})},datetimeFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.time"),otype:"datetime"})},linkFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.link"),otype:"link"})},numericFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.int"),otype:"numeric"})},textFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl()})},selectFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:'<select name="{name}" class="form-control" style="color:#9DA1A5;">{content}</select>'})},textareaFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:'<textarea data-title="{placeholder}" name="{name}" class="form-control" placeholder={placeholder} >{value}</textarea>'})},selectInputField:function(){return e.replaceTpl(this.basicFieldTpl(),{content:'<span class="lab">{title}：</span><div class="selectedInput">{content}</div>'})},cascadeFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:'<span class="lab">{title}：</span><div class="cascade-field">{content}</div>'})},getFieldTpl:function(t,n,i,r){i=i||null;var r=r||"",s="true"===n.rq,o=n.name+(s?" <span class='star'>*</span>":""),a={title:o,name:n.id,isValid:s?n.id:0,val:r,placeholder:n.name,value:n.value||"",classHidden:n.hiddenClass?"hidden-group":""};return i&&(a.content=i),e.replaceTpl(t,a)},customFieldsHandler:function(t,n,r){var s,o=this;switch(t.content_type){case"text":s=o.getFieldTpl(o.textFieldTpl(),t);break;case"area_text":case"location":s=o.getFieldTpl(o.textareaFieldTpl(),t);break;case"radio":var a=[];$.each(t.select_options,function(n,i){a.push(e.replaceTpl(o.basicRadioTpl(),{name:t.id,val:"value="+i.value||n,text:i.title,checkedAttr:t.value&&t.value===i.value?"checked='checked'":""}))}),s=o.getFieldTpl(o.selectInputField(),t,a.join(""));break;case"checkbox":var l=[],c=[];t.value&&(c=t.value.split(",")),$.each(t.select_options,function(n,i){l.push(e.replaceTpl(o.basicCheckboxTpl(),{name:t.id,val:"value="+i.value||n,text:i.title,checkedAttr:c.length&&$.inArray(i.value,c)!=-1?"checked='checked'":""}))}),s=o.getFieldTpl(o.selectInputField(),t,l.join(""));break;case"droplist":var u=[];u.unshift("<option value=''>"+t.name+"</option>"),$.each(t.select_options,function(n,i){u.push(e.replaceTpl(o.basicOptionTpl(),{val:"value="+i.value||n,text:i.title,checkedAttr:t.value&&t.value===i.value?"selected = 'selected'":""}))}),s=o.getFieldTpl(o.selectFieldTpl(),t,u.join(""));break;case"chained_droplist":var u=[],c=[];t.value&&(c=t.value.split(",")),n.classes=["cascade-0"];var d=o.getFormatOptions(t.select_options,n.classes);$.each(n.classes,function(e,t){var n=c[e];r?u.push('<div class="cascade '+t+' hide form-control" data-value="'+(n||"")+'" data-floor="'+e+'"></div>'):e<1?u.push('<select data-value="'+n+'" data-first-title="'+i.UDL.g("tip.pleaseChoice")+'" class="'+t+' form-control"></select>'):u.push('<select data-value="'+n+'" class="'+t+' form-control"></select>')}),s=o.getFieldTpl(o.cascadeFieldTpl(),t,u.join("")),n.fields.push({id:t.id,options:d,selects:n.classes,value:c});break;case"date":s=o.getFieldTpl(o.dateFieldTpl(),t);break;case"time":s=o.getFieldTpl(o.timeFieldTpl(),t);break;case"datetime":s=o.getFieldTpl(o.datetimeFieldTpl(),t);break;case"number":s=o.getFieldTpl(o.numberFieldTpl(),t);break;case"numeric":s=o.getFieldTpl(o.numericFieldTpl(),t);break;case"link":s=o.getFieldTpl(o.linkFieldTpl(),t)}return s},getFormatOptions:function(e,t){var n=this,i=[];return e=e||[],$.each(e,function(e,r){var s=r||{},o={name:s.title,value:r.value||e+""};s.subs&&(0===e&&n.setCascadeClass(t),o.sub=n.getFormatOptions(s.subs,t)),i.push(o)}),i},setCascadeClass:function(e){var t=e.length;e.push("cascade-"+t)},fieldHandler:function(n,i,r){$.each(n.fields,function(t,n){r?e.cascade&&e.cascade({el:$('[data-field="'+n.id+'"]').find(".cascade-field"),valueIds:n.value,url:n.options,selects:n.selects}):$('[data-field="'+n.id+'"]').find(".cascade-field").cxSelect({jsonName:"name",jsonValue:"value",jsonSub:"sub",url:n.options,selects:n.selects,nodata:"none"})}),i.on("change",".cascade-field select",function(e){try{var t=$(e.target);t.val()||0===t.val()?t.css("color","#555"):t.css("color","#999")}catch(n){}}),i.find('[data-otype="date"]').click(function(){WdatePicker()}),i.find('[data-otype="time"]').click(function(){WdatePicker({dateFmt:"HH:mm:ss"})}),i.find('[data-otype="datetime"]').click(function(){WdatePicker({dateFmt:"yyyy-MM-dd HH:mm"})}),i.find('[data-otype="numeric"]').on("keyup",function(){var e=$(this),t=/[^-?\d+\.?\d+]/g;e.val(e.val().replace(t,""))}).on("beforepaste",function(){t.clipboardData.setData("text",t.clipboardData.getData("text").replace(reg,""))}),i.find('[data-otype="number"]').on("keyup",function(){var e=$(this);e.val(parseInt(e.val())||0)}).on("beforepaste",function(){t.clipboardData.setData("text",parseInt(t.clipboardData.getData("text"))||0)});try{$("[data-title]").placeholder()}catch(s){}},fieldValueHandler:function(e,t){switch(e.content_type){case"droplist":t=[t];break;case"radio":case"checkbox":var n=[];$('input[name="'+e.id+'"]:checked').each(function(){n.push($(this).val())}),t=n;break;case"chained_droplist":var n=[];$.each($('[data-field="'+e.id+'"]').find("select"),function(e,t){var i=$(t).val();(i||0===i)&&$(t).val()&&n.push($(t).val())}),t=n.join(",")}return t},fieldValid:function(e,t){var n=[],r=[],s=["droplist","radio","checkbox","chained_droplist"];
if("true"!==e.rq&&e.rq!==!0||t||r.push(e.name),"email"===e.id&&t&&!i.isEmail(t)&&n.push(i.UDL.g("tip.emailError")),"link"===e.content_type&&t&&!i.isLink(t)&&n.push(e.name+i.UDL.g("tip.fmtError")),$.inArray(e.content_type,s)>-1&&("true"===e.rq||e.rq===!0))if("chained_droplist"===e.content_type&&(t=t.split(",")),t.length){var o=[];$.each(t,function(e,t){$.trim(t)&&o.push($.trim(t))}),o.length||r.push(e.name)}else r.push(e.name);return{errorArr:n,rqArr:r}}},n.feedback_tab={basicFieldTpl:function(){return['<div class="form-group {classHidden} {clz}" data-valid="{isValid}" data-field="{name}">','<label class="">{labelText}</label><span class="required">*</span>',"{content}</div>"].join("")},basicInputTpl:function(){return'<input type="{content_type}" {val} value="{value}" data-title="{title}" name="{name}" data-otype="{otype}" {checkedAttr}  class="{clazz}" />'},basicOptionTpl:function(){return"<option {val} {checkedAttr}>{text}</option>"},basicSelectInputTpl:function(){return'<div><label class="check-btn">'+this.basicInputTpl()+"<span>{text}</span></label></div>"},basicCheckboxTpl:function(){return e.replaceTpl(this.basicSelectInputTpl(),{clazz:"field",content_type:"checkbox"})},basicRadioTpl:function(){return e.replaceTpl(this.basicSelectInputTpl(),{clazz:"field",content_type:"radio"})},basicTextTpl:function(){return e.replaceTpl(this.basicInputTpl(),{clazz:"form-control",content_type:"text"})},numberFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.positiveInt"),otype:"number"})},dateFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.date"),otype:"date"})},timeFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.time"),otype:"time"})},datetimeFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.time"),otype:"datetime"})},linkFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.link"),otype:"link"})},numericFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.int"),otype:"numeric"})},textFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl()})},selectFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:'<select name="{name}" class="form-control" style="color:#9DA1A5;">{content}</select>'})},textareaFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:'<textarea data-title="{title}" name="{name}" value="{value}" class="form-control" >{value}</textarea>'})},selectInputField:function(){return e.replaceTpl(this.basicFieldTpl(),{content:'<div class="selectedInput">{content}</div>'})},cascadeFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:'<div class="cascade-field">{content}</div>'})},getFieldTpl:function(t,n,i,r){i=i||null;var r=r||"",s={labelText:n.field_label,title:n.field_label,name:n.field_name,isValid:n.required?n.field_name:0,val:r,clz:n.required?"req":"",value:n.value||"",classHidden:n.hiddenClass?"hidden-group":""};return i&&(s.content=i),e.replaceTpl(t,s)},customFieldsHandler:function(t,n){var r,s=this;switch(t.content_type){case"text":r=s.getFieldTpl(s.textFieldTpl(),t);break;case"area_text":case"location":r=s.getFieldTpl(s.textareaFieldTpl(),t);break;case"radio":var o=[];$.each(t.select_options,function(n,i){o.push(e.replaceTpl(s.basicRadioTpl(),{name:t.field_name,val:"value="+i.value||n,text:i.title,checkedAttr:t.value&&t.value===i.value?"checked='checked'":""}))}),r=s.getFieldTpl(s.selectInputField(),t,o.join(""));break;case"checkbox":var a=[],l=[];t.value&&(l=t.value.split(",")),$.each(t.select_options,function(n,i){a.push(e.replaceTpl(s.basicCheckboxTpl(),{name:t.field_name,val:"value="+i.value||n,text:i.title,checkedAttr:l.length&&$.inArray(i.value,l)!=-1?"checked='checked'":""}))}),r=s.getFieldTpl(s.selectInputField(),t,a.join(""));break;case"droplist":var c=[];c.unshift("<option value=''>"+t.field_label+"</option>"),$.each(t.select_options,function(n,i){c.push(e.replaceTpl(s.basicOptionTpl(),{val:"value="+i.value||n,text:i.title,checkedAttr:t.value&&t.value===i.value?"selected = 'selected'":""}))}),r=s.getFieldTpl(s.selectFieldTpl(),t,c.join(""));break;case"chained_droplist":var c=[],l=[];t.value&&(l=t.value.split(","));var u=s.getFormatOptions(t.select_options,n.classes);$.each(n.classes,function(e,t){var n=l[e];e<1?c.push('<select data-value="'+n+'" data-first-title="'+i.UDL.g("tip.pleaseChoice")+'" class="'+t+' form-control"></select>'):c.push('<select data-value="'+n+'" class="'+t+' form-control"></select>')}),r=s.getFieldTpl(s.cascadeFieldTpl(),t,c.join("")),n.fields.push({id:t.field_name,options:u,selects:n.classes});break;case"date":r=s.getFieldTpl(s.dateFieldTpl(),t);break;case"time":r=s.getFieldTpl(s.timeFieldTpl(),t);break;case"datetime":r=s.getFieldTpl(s.datetimeFieldTpl(),t);break;case"number":r=s.getFieldTpl(s.numberFieldTpl(),t);break;case"numeric":r=s.getFieldTpl(s.numericFieldTpl(),t);break;case"link":r=s.getFieldTpl(s.linkFieldTpl(),t)}return r},getFormatOptions:function(e,t){var n=this,i=[];return e=e||[],$.each(e,function(e,r){var s=r||{},o={name:s.title,value:r.value||e+""};s.subs&&(n.setCascadeClass(t),o.sub=n.getFormatOptions(s.subs,t)),i.push(o)}),i},setCascadeClass:function(e){var t=e.length;e.push("cascade-"+t)},fieldHandler:function(e,n){$.each(e.fields,function(e,t){$('[data-field="'+t.id+'"]').find(".cascade-field").cxSelect({jsonName:"name",jsonValue:"value",jsonSub:"sub",url:t.options,selects:t.selects,nodata:"none"})}),n.on("change",".cascade-field select",function(e){try{var t=$(e.target);t.val()||0===t.val()?t.css("color","#555"):t.css("color","#999")}catch(n){}}),n.find('[data-otype="date"]').click(function(){WdatePicker()}),n.find('[data-otype="time"]').click(function(){WdatePicker({dateFmt:"HH:mm:ss"})}),n.find('[data-otype="datetime"]').click(function(){WdatePicker({dateFmt:"yyyy-MM-dd HH:mm"})}),n.find('[data-otype="numeric"]').on("keyup",function(){var e=$(this),t=/[^-?\d+\.?\d+]/g;e.val(e.val().replace(t,""))}).on("beforepaste",function(){t.clipboardData.setData("text",t.clipboardData.getData("text").replace(reg,""))}),n.find('[data-otype="number"]').on("keyup",function(){var e=$(this);e.val(parseInt(e.val())||0)}).on("beforepaste",function(){t.clipboardData.setData("text",parseInt(t.clipboardData.getData("text"))||0)});try{$("[data-title]").placeholder()}catch(i){}},fieldValueHandler:function(e,t){switch(e.content_type){case"droplist":t=[t];break;case"radio":case"checkbox":var n=[];$('input[name="'+e.id+'"]:checked').each(function(){n.push($(this).val())}),t=n;break;case"chained_droplist":var n=[];$.each($('[data-field="'+e.id+'"]').find("select"),function(e,t){var i=$(t).val();(i||0===i)&&$(t).val()&&n.push($(t).val())}),t=n.join(",")}return t},fieldValid:function(e,t){var n=[],r=[],s=["droplist","radio","checkbox","chained_droplist"];if("true"!==e.rq&&e.rq!==!0||t||r.push(e.field_label),"email"===e.id&&t&&!i.isEmail(t)&&n.push(i.UDL.g("tip.emailError")),"link"===e.content_type&&t&&!i.isLink(t)&&n.push(e.field_label+i.UDL.g("tip.fmtError")),$.inArray(e.content_type,s)>-1&&("true"===e.rq||e.rq===!0))if("chained_droplist"===e.content_type&&(t=t.split(",")),t.length){var o=[];$.each(t,function(e,t){$.trim(t)&&o.push($.trim(t))}),o.length||r.push(e.field_label)}else r.push(e.field_label);return{errorArr:n,rqArr:r}}},n.ticket={msgLoadingHtml:'<img class="wait-img" src="images/loading-sun.gif"/>',msgResendHtml:'<img class="fail-img" src="images/msg-resend.png"/>',msgItemTpl:function(e){var t=["clearfix"],n=[];return e=e||{},e.clz&&t.push(e.clz),['<dd class="'+t.join(" ")+'" data-msgId={msgId} '+n.join(" ")+">",'   <div class="msg {clz} {typeClz}">','       <div class="sender">','       <span class="sender-text ellipsis">{senderName}</span>','       <span class="time-text">',"           {msgTime}&#8197;","       </span>","   </div>","       <i {avatarStyle}></i>",'       <span style="{style}">{msg}</span>',"   </div>","</dd>"].join("")},imgItemTpl:function(t,n){var r=this,s='<img src="{msg}">';return e.isMob()?s='<img src="{msg}">':i.innerController.isInnerMode&&(s='<a href="{msg}" target="_blank"><img src="{msg}"></a>'),e.replaceTpl(r.msgItemTpl(n),{typeClz:"msg-img",msg:s})},fileItemTpl:function(t,n,r){r=r||{};var s,o=i.getFileImgByFileUrl(n,r.isRecv?"02":"03"),a=[],l=10;return t&&(a.push({href:t,target:"_blank",text:i.UDL.g("label.preview")}),l+=e.context.previewTextWidth),r.noDownload||(a.push({href:"{msg}",target:"_blank",text:i.UDL.g("label.download")}),l+=e.context.downloadTextWidth),s=e.joinStr('<div class="file-box" style="padding-right:'+l+'px">',o+" ",'<div class="file-name">','<a href="{msg}" target="_blank">{filename}</a>','<div class="text-muted">{filesize}</div>',"</div>",'<div class="btns">',e.map(a,function(t,n){return e.createHtml("a",n)}),"</div>","</div>"),e.replaceTpl(this.msgItemTpl(r),{typeClz:"msg-file",msg:s})},videoItemTpl:function(){var t=this;return e.replaceTpl(t.msgItemTpl(),{typeClz:"msg-video",msg:'<video src={msg} controls="controls">Video address：{msg}</video>'})},uploadingTpl:function(){var t=this;return e.replaceTpl(t.msgItemTpl(),{typeClz:"msg-uploading",msg:'<div class="progress-max" id={fileId}><div class="progress-per"></div></div>'})},titleItemTpl:function(){return'<dt class="hide"><h4>{msg}</h4></dt>'},titleRadiusItemTpl:function(t){var n;return t=t||{},n=t.msg,delete t.msg,e.createHtml("dt",$.extend({html:'<span class="event-bar">'+n+"</span>"},t))},ads_textTpl:function(){return['<div class="side-text scrollbar">','<div class="side-title">{title}</div>','<div class="side-content">{links}</div>',"</div>"].join("")},ads_imgTpl:function(){return['<div class="side-img">','<a href="{image_link}" target="_blank">','<img src="{image}" /></a></div>'].join("")},structTpl:function(t){t=t||{};var n,i=this,r=t.buttons||[],s="",o="",a="",l="";t.img_url&&(s=['<li class="list-group-item">','<img src="'+t.img_url+'" class="struct-img">',"</li>"].join("")),t.title&&(a="<label>"+t.title+"</label>"),t.description&&(l='<p class="text-muted">'+t.description+"</p>"),(a||l)&&(o='<li class="list-group-item text-left">'+a+l+"</li>"),n='<ul class="list-group">'+s+o;for(var c=0;c<r.length;c++){var u=r[c];"link"===u.type?n+='<li class="list-group-item"><a href="'+u.value+'" target="_blank">'+u.text+"</a></li>":"phone"===u.type&&(n+='<li class="list-group-item"><a class="show-tel" href="tel:'+u.value+'">'+u.text+"</a>")}return n+="</ul>",e.replaceTpl(i.msgItemTpl(),{typeClz:"msg-struct",msg:n})},productTpl:function(t){var n=["msg-product"],i=[];if(t=t||{},t.imgUrl&&(n.push("has-img"),i.push('<img src="'+t.imgUrl+'" />')),t.url?i.push('<a href="'+t.url+'" target="_blank">'+t.name+"</a>"):i.push(t.name),t.params){i.push('<div class="params clearfix">');for(var r,s=0,o=t.params.length;s<o;s++)r=t.params[s],i.push('<span style="'),r.color&&i.push("color: "+r.color+";"),r.size&&i.push("font-size: "+(r.size||12)+"px;"),r.bold&&i.push("font-weight: bold;"),i.push('">'+r.text+"</span>"),r["break"]&&i.push("<br/>");i.push("</div>")}return e.replaceTpl(this.msgItemTpl(),{typeClz:n.join(" "),msg:i.join("")})},surveyTpl:function(t){var n=['<dd class="clearfix survey-event" data-received=1>','    <div class="text-center">','<div class="sender survey-sender">','<span class="sender-text">{senderName}</span>',"</div>",'<div class="survey-text event-bar">',"<span>"," &nbsp;{iconText} &nbsp;",'<a href="javascript:;" class="{surveyClass}" data-im_sub_session_id="{im_sub_session_id}" data-agent_id="{agent_id}" data-methods="{methodFlag}" data-jid="{jid}">{surveyText}</a>',"</span>","</div>","</div>","</dd>"].join("");return e.replaceTpl(n,$.extend({clz:"",senderName:"",msgTime:"",iconText:"",surveyText:"",surveyClass:""},t))},queueTpl:function(t){var n=['<dd class="clearfix queue-event text-center" data-received=1 {groupTimeAttr}>','<div class="queue-text event-bar">','<p class="queue-num">',"{queueText} ",t.leaveText?"{leaveText}":"","</p>","</div>","</dd>"].join("");return e.replaceTpl(n,$.extend({clz:"",senderName:"",msgTime:"",queueText:"",leaveText:"",groupTimeAttr:t.groupTime?'data-group-time="'+t.groupTime+'"':""},t))},loadingTpl:function(t){return t=t||{},e.replaceTpl(this.msgItemTpl({clz:"item-loading"}),$.extend({msg:'<img src="images/loading3.gif" />'},t,{msgTime:i.formatDateTime(t.msgTime)}))}},e.template=n}(this.udesk,this),function(e,t,n){var i=e.common,r=(i.company,/(vipkid|vipkid-tr)/.test(location.host));e.ns("im.index.sidebox");var s,o,a,l=e.im||{},c=[],u=!0,d=!0,p=!0,h=['<div class="media">','  <div class="media-left">','    <a href="{url}" target="_blank">','      <img src="{image}" alt="{title}">',"    </a>","  </div>",'  <div class="media-body word-break">','    <a class="media-heading" href="{url}" target="_blank">{title}</a>',"    {innerDetails}","  </div>","  {details}","</div>"].join(""),f=function(e){return e+"_TabPanel"},m=function(t){if(t){var n;for(var i in t)if(0===i.indexOf("product_")){n=n||{};var r="product_url"===i?t[i]:e.xss(t[i]);n[i.replace("product_","")]=r}return n}},g=function(t){if(t){var n=t.product_params;if(n)return n;for(var i in t)"title"!==i&&"url"!==i&&"image"!==i&&(n=n||{},n[i]=e.xss(t[i]));return n}},v=function(e){r||s.append(s.find(">.sidebox"))},b=function(t,n){if(!t)return"";var i="";return t.enable&&(i=e.unXss(t.content)||"<div></div>"),i},y=function(t){if(!t)return"";t=n.extend({},t);var i="",r=g(t);if(!n.isEmptyObject(r)){for(var s in r)i+=e.replaceTpl("<p>{k}：{v}</p>",{k:s,v:r[s]});i='<div class="details">'+i+"</div>"}return t.innerDetails=a?i:"",t.details=a?"":i,e.replaceTpl(h,t,{omitXss:"details,innerDetails"})},_=function(){var e=['<div class="sidebox '+(a?"inner":"")+'">','<div class="tab-content">'];return n.each(c,function(t,n){e.push('<div id="'+f(n.sort_key)+'" class="'+n.clz+'">'+n.html+"</div>")}),e.push("</div></div>"),e.join("")},x=function(e){if(!e.url)return"";var t=i.urlParamObj||{};n.each(["cur_url","cur_title","pre_url","src_url"],function(e,n){delete t[n]});var r="",s=[],o=e.url;for(var a in t)s.push(a+"="+t[a]);return r=s.join("&"),o+=o.indexOf("?")>-1?"&"+r:"?"+r,'<iframe src="'+o+'"></iframe>'},w=function(e,t){return t.im_sub_session_id?'<div class="loading-div"><p class="loading"></p></div>':""},T=function(){return'<div class="loading-div"><p class="loading"></p></div>'},k=function(e){p&&n.get(i.apiPath+"im/im_newspaper/window/agent_card",{im_sub_session_id:e,im_web_plugin_id:i.urlParamObj.web_plugin_id||""}).always(function(e){if(e&&1e3===e.code){var t='<div class="agent-div">',r={aliase_nick_name:"姓名",work_id:"工号",email:"邮箱",cellphone:"电话"};n.each(e.data,function(e,n){if(n.enable)switch(n.key){case"avatar":t+='<div class="agent-avatar"><img src="'+(n.content||"images/agent-on.png")+'" /></div>';break;case"aliase_nick_name":case"work_id":case"email":case"cellphone":var i=['   <div class="agent-item">','       <label class="">'+r[n.key]+"：</label>",'       <div class="">'+(n.content||"")+"</div>","   </div>"].join("");t+=i;break;case"desc":t+='<div class="agent-desc">'+(n.content||"")+"</div>"}}),t+="</div>",n(".agent_card_TabPanel").empty().append(t),p=!1}else n(".agent_card_TabPanel").empty(),i.showTip("数据请求异常,请联系客服","error")})},S=function(e){var t={};n.each(e.side_data,function(e,n){"robot_auto_suggest"===n.key&&(t=n)});var r=t.question||{},s=t.hot_question||{},o=r.enable,a=s.enable,l=i.urlParamObj.web_plugin_id,c=n(".robot_auto_suggest_TabPanel");o&&u?n.get(i.apiPath+"im/im_newspaper/window/robot_auto_suggest",{im_web_plugin_id:l||"",s:"common",model_key:r.id}).always(function(e){if(e&&1e3===e.code){var t=e.data||[],r='<div class="common-qustion"><h4>常见问题</h4>';n.each(t,function(e,t){var i='<div class="common-div"><p class="common-title">'+t.name+"</p><ul>",s=t.questionList||[],o="";n.each(s,function(e,t){var n=['<li class="hot-li clearfix">',"<span>"+(e+1)+'. </span><a href="javascript:;" >'+t.content+"</a>",'<div class="hot-answer">'+t.answer.content+"</div>","</li>"].join("");o+=n}),i+=o,i+="</ul></div>",r+=i}),r+="</div>",c.find(".loading-div").remove(),c.append(r),u=!1}else i.showTip("数据请求异常,请联系客服!","error")}):c.find(".loading-div").remove(),a&&d?n.get(i.apiPath+"im/im_newspaper/window/robot_auto_suggest",{im_web_plugin_id:l||"",s:"hot",limit_day_num:s.max,limit_result_num:s.top}).always(function(e){if(e&&1e3===e.code){var t=e.data||[],r='<div class="hot-qustion"><h4>热点问题</h4><ul>';n.each(t,function(e,t){var n=['<li class="hot-li clearfix">',"<span>"+(e+1)+'. </span><a href="javascript:;" >'+t.content+"</a>",'<div class="hot-answer">'+t.answer.content+"</div>","</li>"].join("");r+=n}),r+="</ul></div>",c.find(".loading-div").remove(),c.prepend(r),d=!1}else i.showTip("数据请求异常,请联系客服!","error")}):c.find(".loading-div").remove(),c.off("click",".hot-li a").on("click",".hot-li a",function(){var e=n(this).parent().find(".hot-answer");e.slideToggle()})},C=function(e){var t=n("ul.nav-ul > li").eq(0).find("a")[0];"agent_card"===n(t).attr("data-id")&&k(e.im_sub_session_id),"robot_auto_suggest"===n(t).attr("data-id")&&S(e)},E=function(e){var t,i=[];i.push('<ul class="nav nav-tabs nav-justified">'),n.each(c,function(e,t){i.push("<li "),!e&&i.push('class="active"'),i.push('><a data-id="'+t.key+'" href="#'+f(t.sort_key)+'" style="border-left:0;">'+t.nick+"</a>"),i.push("</li>")}),i.push("</ul>"),t=n(i.join("")),t.on("click","a",function(t){t.preventDefault();var i=n(this).attr("data-id")||this.getAttribute("data-id");"agent_card"===i&&k(e.im_sub_session_id),"robot_auto_suggest"===i&&S(e),n(this).tab("show")}),s.find(">.sidebox").prepend(t),C(e)},A=function(e){var t,i=[],r=70,a=s.outerWidth(),l=s.outerWidth()-56,u=Math.floor(a/r)>=o,d=Math.floor(l/r)||1;if(e.isInner)return E(e);if(u){var p=(100/o).toFixed(1);i.push('<ul class="nav-ul clearfix">'),n.each(c,function(e,t){i.push('<li style="width: '+p+'%;"'),!e&&i.push('class="active"'),i.push('><a title= "'+t.nick+'" data-id="'+t.key+'" href="#'+f(t.sort_key)+'" >'+t.nick+"</a>"),i.push("</li>")}),i.push("</ul>"),t=n(i.join(""))}else{var p=(100/d).toFixed(1),h=27,m=Math.ceil(l/d),g=o*m,v=l||100-p+.2,b=['<div class="nav-div"><button class="left" style="width:'+(h-1)+'px"><i class="icon icon-arrow-left"></i></button>','<div class="scroll-div scrollbar-x scrollbar-hover" style="width:'+(v+2)+'px"><ul class="nav-ul clearfix" style="width:'+g+'px">'].join("");i.push(b),n.each(c,function(e,t){i.push('<li style="width:'+m+'px;"'),!e&&i.push('class="active"'),i.push('><a title= "'+t.nick+'" data-id="'+t.key+'" href="#'+f(t.sort_key)+'" >'+t.nick+"</a>"),i.push("</li>")});var y=["</ul></div>",'<button class="right" style="width:'+(h-1)+'px"><i class="icon icon-arrow-right"></i></button></div>'].join("");i.push(y),t=n(i.join(""))}t.on("click","li a",function(t){t.preventDefault();var i=n(this).attr("data-id")||this.getAttribute("data-id");"agent_card"===i&&k(e.im_sub_session_id),"robot_auto_suggest"===i&&S(e),n(this).tab("show")}).on("click","button.left",function(){var e=n(".scroll-div").scrollLeft();e<m?n(".scroll-div").animate({scrollLeft:0},"fast"):n(".scroll-div").animate({scrollLeft:e-m},"fast")}).on("click","button.right",function(){var e=n(".scroll-div").scrollLeft(),t=n(".scroll-div").width();e+t>=g?n(".scroll-div").animate({scrollLeft:g-t},"fast"):n(".scroll-div").animate({scrollLeft:e+m},"fast")}),s.find(">.sidebox").prepend(t),C(e)},I=function(e){var t=0,r=e.side_data||[{key:"product",nick:i.UDL.g("label.consulting")},{key:"custom_content",nick:i.UDL.g("label.official")}],s={custom_content:b,custom_url:x,product:y,agent_card:w,robot_auto_suggest:T};c.length=0,n.each(r,function(n,r){"product"===r.key?i.urlParamObj.udesk_hide_product||(r.html=y(e.product)||"",r.html&&(r.clz="tab-pane "+(t?"":"active"),t++,o++,c.push(r))):a||(r.html=s[r.key](r,e)||"",r.html&&(r.clz="tab-pane scrollbar "+(t?" ":"active ")+f(r.key),t++,o++,c.push(r)))})},D=function(e){e=e||{},s=n(e.container),o=0,a=e.isInner,u=!0,d=!0,p=!0;var t,i,l,c;if((!a||!r)&&(!e.isInner&&s.empty(),!(!e.side_data||e.side_data.length<1||a)||e.product)){if(I(e),A(e),t=n(window).width()/2,e.right_width){if(e.right_width>=t&&(e.right_width=t),!a)var h=Math.max(e.right_width,100);s.css("width",h+"px")}i=_(),l=s.children(),c=l.first(),l.size()>2?s.append(i):c.size()?c.after(i):s.prepend(i),o>0&&A(e),e.after&&e.after(o)}};l.sidebox={init:D,moveTo:v,getProductData:m}}(this.udesk,this,$),function(e,t,n){function i(e,t){var i,r=y.urlParamObj;i=r.web_plugin_id?"/spa1/im/im_pre_form/"+r.web_plugin_id+"?channel_type=ImWebPlugin&channel_type_id="+r.web_plugin_id:"/spa1/im/im_pre_form/undefined?channel_type=&channel_type_id=",n.get(i).always(function(i){if(i=i||{},1e3==i.code){if(setting=i.im_pre_form||{},v.isOldCustomer){var r=[];n.each(setting.fields,function(e,t){t.hidden||r.push(t)}),setting.fields=r}e&&e(setting)}else t&&t()})}function r(){v.en_captcha&&(k.codeEl.val(""),n.get(T.getCaptcha).always(function(e){return 1e3!==e.code?u(y.UDL.g("tip.getCodeError")):(k.captcha_key=e.captcha_key,k.img_url=e.img_url,void k.imgEl.attr("src",k.img_url))}))}function s(e){var t=[];return n.each(e,function(e,n){var i="";n=n||{},v.isOldCustomer&&n.hidden||(i=n.content_type?x.customFieldsHandler(n,w):x.getFieldTpl(x.textFieldTpl(),n),t.push(i))}),t.join("")}function o(){return e.joinStr('<div id="preform-captcha" class="form-group no-form" data-valid="captcha" data-field="captcha">',"   <label>"+_("verifiyCode")+' <span class="star">*</span></label>','   <input id="preform-captcha-code" value="" class="form-control" />','   <div class="preform-captcha-img">','       <img id="preform-cap-pic" alt="" src="" />','       <a class="toggle-cap">'+_("changeASheet")+"</a>","   </div>","</div>")}function a(){v.en_captcha&&k.containerEl.on("click",".toggle-cap",function(e){r()})}function l(){var e=[],t=[],i=[],s=k.codeEl.val();n.each(v.fields,function(r,s){var o=n("[name="+s.id+"]").val();o=x.fieldValueHandler(s,o);var a=x.fieldValid(s,o)||{};t=t.concat(a.rqArr),e=e.concat(a.errorArr),i.push({id:s.id,value:y.needXss(s.content_type,o),tp:s.tp})}),e=n.unique(e||[]),t=n.unique(t||[]);var o="";if(e.length||t.length)return t.length&&(o=t.join(", ")+y.UDL.g("tip.rq")),e.length&&(o&&(o+=","),o+=e.join(", ")),u(o);if(v.en_captcha&&!s)return u(y.UDL.g("tip.validCode"));var a=y.urlParamObj,l={fields:i};v.en_captcha&&(l.captcha=s,l.captcha_key=k.captcha_key),a.web_plugin_id&&(l.web_plugin_id=a.web_plugin_id),a.session_key&&(l.session_key=a.session_key),n.post(T.saveForm,l).always(function(e){return e=e||{},1e3!=e.code?9200==e.code?(r(),u(y.UDL.g("tip.reenter"))):u(e.message||y.UDL.g("tip.saveFail")):void p()})}function c(e){v.en_captcha=e,e||k.containerEl.hide()}function u(e){y.showTip(e,"danger")}function d(e){y.hideModal(),v.allReady&&v.allReady(e)}function p(){m&&m.removeClass("open"),v.allDone&&v.allDone()}function h(){y.hideModal(),m&&m.addClass("open")}function f(t){t=t||{},v=t,g=t.isInner;var u=y.frameConfig.theme_color,h=t.board||{};i(function(i){return v.fields=i.fields,i.en_captcha||i.fields.length?(m=e.ui.board(n.extend({id:"pre-form",title:i.title,body:e.ui.form({container:t.container,desc:i.welcome_enable?i.welcome:"",body:e.joinStr(s(i.fields),o()),buttons:[{tagName:"a",act:"submit",text:_("submit"),"class":"btn btn-success",css:{backgroundColor:u}},{html:y.getBtnMsgLogsHtml("preform")}],onClick:function(e){"submit"===e&&l()}})},h)),k.containerEl=m.find("#preform-captcha"),k.imgEl=m.find("#preform-cap-pic"),k.codeEl=m.find("#preform-captcha-code"),c(i.en_captcha),x.fieldHandler(w,m),r(),d(i),void a()):p()},function(){p()})}e.ns("im");var m,g,v,b=e.im||{},y=e.common,_=(y.UDL.g,y.UDL.gl),x=(y.UDL.gt,e.template.feedback),w={classes:["cascade-0"],fields:[]},T={saveForm:"/spa1/im/im_pre_form/customer.json",getCaptcha:"/spa1/im/web_im_feedbacks/captcha"},k={containerEl:"",imgEl:"",codeEl:"",captcha_key:"",img_url:""};b.preform={init:f,show:h}}(this.udesk,this,$),function(e,t){function n(e,t,n){var i=m+"file_upload_policy?marking="+t+"&key="+e;h.get(i).then(function(t){1e3===t.code?(t.imageName=e,n&&n(t)):f.winAlert("上传时获取token失败")},function(e){f.winAlert("上传时获取token失败")})}function i(e){var t=e.file||{},n=t.name.split(".")[0],i=(""+1e6*Math.random()).substring(0,3);return n+"_"+Math.ceil(+new Date/1e3)+"_"+i+"."+t.ext}function r(e){var t,n,i,r,o,a,l,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",d=0;for(e=s(e);d<e.length;)t=e.charCodeAt(d++),n=e.charCodeAt(d++),i=e.charCodeAt(d++),r=t>>2,o=(3&t)<<4|n>>4,a=(15&n)<<2|i>>6,l=63&i,isNaN(n)?a=l=64:isNaN(i)&&(l=64),u=u+c.charAt(r)+c.charAt(o)+c.charAt(a)+c.charAt(l);return u}function s(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t}function o(e){var t=e.config||{},n=t.imageName||"";return h.ajax({url:b+"/putb64/-1/key/"+r(n),type:"POST",data:e.data,noParams:!0,beforeSend:function(e){e.setRequestHeader("Content-Type","application/octet-stream"),e.setRequestHeader("Authorization","UpToken "+t.token)},success:function(n){n&&n.key?e.success&&e.success({src:g[t.bucket]+"/"+n.key}):e.error&&e.error(n)},error:function(){e.error&&e.error(),!e.noTip&&f.tips.error("上传失败，请重新上传")}})}function a(e){return h.post(m+"upload_base64_file",{key:e.key,marking:"web.mg.rich_editor_copy",img_base64:e.data}).always(function(t){t&&1e3===t.code&&t.src?e.success&&e.success(t):e.error&&e.error()})}function l(e){var t=e.config||{};return h.ajax({url:t.host,type:"PUT",data:e.data,noParams:!0,beforeSend:function(e){var n=t.fields||{};console.log(n),e.setRequestHeader("Content-Type","image/jpg"),e.setRequestHeader("X-Udesk-Minio-policy",n.policy),e.setRequestHeader("X-Udesk-Minio-x-amz-algorithm",n["x-amz-algorithm"]),e.setRequestHeader("X-Udesk-Minio-x-amz-credential",n["x-amz-credential"]),e.setRequestHeader("X-Udesk-Minio-x-amz-date",n["x-amz-date"]),e.setRequestHeader("X-Udesk-Minio-x-amz-signature",n["x-amz-signature"]),e.setRequestHeader("X-Udesk-Minio-key",n.key),e.setRequestHeader("X-Amz-Meta-Content-Encoding","base64,=")},success:function(n){e.success&&e.success({src:t.host+"/"+t.file_path})},error:function(){e.error&&e.error(),!e.noTip&&f.tips.error("上传失败，请重新上传")}})}function c(e,t){return delete t.code,e.policy_config=t,e}function u(e){var t=e.policy_config||{};return e.formatSize=WebUploader.Base.formatSize(e.size),e._type=0===(e.type||"").indexOf("image/")?"image":"file",e.storage_policy=t.storage_policy,e.bucket=t.bucket,e.dir=t.dir,e}function d(e){p&&p.removeFile(e)}var p,h=e.$,f=e.common,m=f.apiPath,g={udeskim:"https://qn-im.udesk.cn",udeskpub:"https://qn-public.udesk.cn"},v="https:"===location.protocol,b=v?"https://up.qbox.me":"http://up.qiniu.com",y=["exe","html"],_=function(t){return p=WebUploader.create({auto:!1,swf:"/im_client/cmps/webuploader/dist/Uploader.swf",dnd:t.dnd,paste:t.paste,disableGlobalDnd:t.disableGlobalDnd,pick:t.pick,duplicate:t.duplicate,fileSingleSizeLimit:t.fileSingleSizeLimit||52428800,fileSizeLimit:t.fileSizeLimit||1047527424,resize:!1}),p.on("fileQueued",function(e){return h.inArray(e.ext,y)>-1?(p.cancelFile(e),void f.winAlert("出于安全性考虑，不支持"+e.ext+"类型文件上传")):void n(e.name,t.marking,function(n){function i(){p.upload(e),t.fileQueued&&t.fileQueued(e,p)}e=c(e,n),t.manualUpload?t.manualUpload(p,e,function(){i()}):i()})}),p.on("uploadBeforeSend",function(e,t,n){var r=e.file,s=r.policy_config;switch(s.storage_policy){case"qiniu":t.token=s.token,t.key=i(e),e.file.random_filename=t.key,e.file.url=g[s.bucket]+"/"+t.key;break;case"ali":t.policy=s.policy,t.OSSAccessKeyId=s.accessid,t.Signature=s.signature;var o=i(e);t.key=s.dir+o,e.file.random_filename=o,e.file.url=s.host+"/"+t.key;break;case"minio":e.file.random_filename=s.file_name,e.file.url=s.host+"/"+s.file_path,t=h.extend(t,s.fields);break;default:t.token=s.token,t.key=i(e),e.file.random_filename=t.key,e.file.storage_policy=s.storage_policy}}),p.on("uploadStart",function(t){var n=t.policy_config||{};"qiniu"===n.storage_policy&&e.ifIE(9,"lte")?p.options.server=b:p.options.server=t.policy_config.host}),p.on("uploadProgress",function(e,n){t.uploadProgress&&t.uploadProgress(e,n)}),p.on("uploadSuccess",function(e,n){e=u(e),t.uploadSuccess&&t.uploadSuccess(e,n)}),p.on("uploadError",function(e,n){t.uploadError&&t.uploadError(e,n)}),p.on("error",function(e){var n="",i=t.fileSingleLimit||50;switch(e){case"Q_EXCEED_NUM_LIMIT":n=f.UDL.g("tip.overLimit");break;case"Q_TYPE_DENIED":n=f.UDL.g("tip.forbidType");break;case"Q_EXCEED_SIZE_LIMIT":n=f.UDL.g("tip.overSize");break;case"F_DUPLICATE":n=f.UDL.g("tip.uploadSuccess");break;case"F_EXCEED_SIZE":n=f.UDL.g("tip.overxm",{num:i});break;default:n=f.UDL.g("tip.uploadError")}f.winAlert(n)}),p.on("dndAccept",function(e){t.dndAccept&&t.dndAccept(e)}),p},x=function(e){e=e||{};var t=e.config||{};switch(t.storage_policy){case"qiniu":o(e);break;case"ali":a(e);break;case"minio":l(e)}},n=n;e.uploader={init:_,removeFile:d,getToken:n,getImgByBase64:x,baseCode64:r}}(this.udesk,this),function(e,t,n){e.chatAgent={create:function(){return e.setContext({isRobotChat:!1}),n(e,t)}}}(this.udesk,this,function(e,t){function i(){}function r(){}function s(e,t){return Ze=_t.showModal(e,t),r(),Ze}function o(e){return e=e||i,nt?e(nt):void yt.get(Nt+"im_surveys").always(function(t){return t&&1e3==t.code?(t.im_survey.star.options.reverse(),nt=t.im_survey,e(nt)):e()})}function a(e,t){var n=!1;return t&&t.enabled&&yt.each(t.methods,function(){if((!e||this.flag===e)&&this.enabled)return n=!0,!n}),n}function c(t){d(),t=t||{};var n=t.jid||"",r=(t.successFn||i,t.cancelFn||i),s=t.noAuthFn||i,l=(t.hasSurveyFn||i,t.needCloseWin),c=("customer_invite"===t.methodFlag||t.notShowTitle,t.notShowSurveyEvent||!1),p=!t.im_sub_session_id||t.im_sub_session_id===cn;return it&&p?l&&we():void o(function(i){function o(e){var t=[],n=e?e.split(/,|，/):[],i=n.length,r=i>2?i>3?"n":3:i;return i&&yt.each(n,function(e,n){t.push('<li class="tag-item item-col-'+r+'"><span>'+n+"</span></li>")}),t.join("")}function h(e,t,n,i){var r="",s="";yt.each(e,function(e,n){n.id===t&&(r=n.tags||"",s=n.remark_option)}),yt(".survey-options-tags").empty().append(o(r)),yt(".survey-mark-wrapped").empty(),n&&"required"===s?yt(".survey-mark-wrapped").append('<span class="survey-mark-required">*</span><textarea class="survey-mark" maxlength=200 placeholder="'+i+'"></textarea>'):n&&"optional"===s&&yt(".survey-mark-wrapped").append('<textarea class="survey-mark" maxlength=200 placeholder="'+i+'"></textarea>')}function f(e){C.text(i.star.options[e-1].text),S.each(function(t){t<e?yt(this).attr("src","images/star-selected.png"):yt(this).attr("src","images/star-normal.png")})}if(!i||!a(t.methodFlag,i))return s();!c&&I(t),d();var m=[],g="",v="";if("text"===i.show_type){var b=i.text.default_option_id||null;m.push('<div class="survey-options-wrapped option-text">'),yt.each(i.text.options,function(t){this.enabled+""=="true"&&(b===this.id?(m.push(e.replaceTpl('<label><input type="radio" checked="checked" name="survey_options" data-option="{id}"/> {text}</label>',this)),this.tags&&(g=this.tags||""),v=this.remark_option||"optional"):m.push(e.replaceTpl('<label><input type="radio" name="survey_options" data-option="{id}"/> {text}</label>',this)))}),m.push("</div>")}else if("expression"===i.show_type){var y=i.expression.default_option_id||i.expression.options[0].id,_=i.expression.options[0].text;yt.each(i.expression.options,function(e){y===this.id&&(_=this.text||"")}),m.push('<div class="survey-options-wrapped option-expression">'),m.push('<ul class="expression-image-wrapped clearfix">'),yt.each(i.expression.options,function(t){0===t?y===this.id?(m.push(e.replaceTpl('<li data-type="survey01" data-option="{id}" class="survey-expression-item selected"><img src="images/survey01-selected.png" /><br/>{text}</li>',this)),
this.tags&&(g=this.tags||""),v=this.remark_option||"optional"):m.push(e.replaceTpl('<li data-type="survey01" data-option="{id}" class="survey-expression-item"><img src="images/survey01.png" /><br/>{text}</li>',this)):1===t?y===this.id?(m.push(e.replaceTpl('<li data-type="survey02" data-option="{id}" class="survey-expression-item selected"><img src="images/survey02-selected.png" /><br/>{text}</li>',this)),this.tags&&(g=this.tags||""),v=this.remark_option||"optional"):m.push(e.replaceTpl('<li data-type="survey02" data-option="{id}" class="survey-expression-item"><img src="images/survey02.png" /><br/>{text}</li>',this)):2===t&&(y===this.id?(m.push(e.replaceTpl('<li data-type="survey03" data-option="{id}" class="survey-expression-item selected"><img src="images/survey03-selected.png" /><br/>{text}</li>',this)),this.tags&&(g=this.tags||""),v=this.remark_option||"optional"):m.push(e.replaceTpl('<li data-type="survey03" data-option="{id}" class="survey-expression-item"><img src="images/survey03.png" /><br/>{text}</li>',this)))}),m.push("</ul>"),m.push("</div>")}else if("star"===i.show_type){var x=i.star.default_option_id||i.star.options[4].id,w=4,_="";yt.each(i.star.options,function(e){x===this.id&&(w=e,_=this.text,g=this.tags||"",v=this.remark_option)}),m.push('<div class="survey-options-wrapped option-star">'),m.push('<div class="star-image-wrapped">'),yt.each(i.star.options,function(t){t<w?m.push(e.replaceTpl('<img class="star-rating-item" alt="{text}" src="images/star-selected.png" data-option="{id}">',this)):t===w?m.push(e.replaceTpl('<img class="star-rating-item selected" alt="{text}" src="images/star-selected.png" data-option="{id}">',this)):t>w&&m.push(e.replaceTpl('<img class="star-rating-item" alt="{text}" src="images/star-normal.png" data-option="{id}">',this))}),m.push("</div>"),m.push('<span class="star-option-desec">'+_+"</span>"),m.push("</div>")}if(m.push('<ul class="survey-options-tags">'),m.push(o(g)),m.push("</ul>"),m.push('<div class="survey-mark-wrapped">'),i.remark_enabled&&"hide"!==v&&("required"===v?m.push('<span class="survey-mark-required">*</span><textarea class="survey-mark" maxlength=200 placeholder="'+(i&&i.remark)+'"></textarea>'):"optional"===v&&m.push('<textarea class="survey-mark" maxlength=200 placeholder="'+(i&&i.remark)+'"></textarea>')),m.push("</div>"),m.push(['<p class="btnbar clearfix">','  <a class="btn btn-yes btn-tg">'+_t.UDL.g("label.submit")+"</a>","</p>",'<a class="close-survey btn-tg icon icon-guanbi"></a>'].join("")),Ze=_t.modal=e.ui.modal({clz:"statsurvey",container:_t.mainEl,title:i.title||_t.UDL.g("agent.askSurvey"),content:m.join(""),contentClz:"scrollbar",needClose:!1}),yt(".mask.statsurvey").height()<300&&yt(".im-modal.statsurvey dd").css("max-height",170),yt(".survey-options-tags").on("click",".tag-item",function(){yt(this).toggleClass("tag-item-active")}),"text"===i.show_type)yt('.option-text [name="survey_options"]').on("change",function(){var e=parseInt(yt(this).data("option"));h(i.text.options,e,i.remark_enabled,i.remark)});else if("expression"===i.show_type)yt(".survey-expression-item").on({mouseenter:function(){var e=yt(this);e.find("img").attr("src","images/"+e.data("type")+"-selected.png")},click:function(){var e=yt(this),t=e.find("img"),n=parseInt(e.data("option"));return!e.hasClass("selected")&&(e.siblings().each(function(){var e=yt(this);e.find("img").attr("src","images/"+e.data("type")+".png"),e.removeClass("selected")}),t.attr("src","images/"+e.data("type")+"-selected.png"),e.addClass("selected"),void h(i.expression.options,n,i.remark_enabled,i.remark))},mouseleave:function(){var e=yt(this);e.hasClass("selected")||e.find("img").attr("src","images/"+e.data("type")+".png")}});else if("star"===i.show_type){var T=w+1,k=yt(".star-image-wrapped"),S=k.find(".star-rating-item"),C=yt(".star-option-desec");k.on("mouseover",".star-rating-item",function(){f(yt(this).index()+1)}).on("click",".star-rating-item",function(){if(yt(this).index()+1===T)return!1;T=yt(this).index()+1;var e=parseInt(yt(this).data("option"));h(i.star.options,e,i.remark_enabled,i.remark)}).on("mouseout",function(){f(T)})}Ze.el.on("click",".btn-tg",function(){var e=yt(this);if(e.is(".btn-no")||e.is(".close-survey"))d(),l&&we(),r();else if(e.is(".btn-yes")){var s=Ze.el.find(".survey-mark").val(),o=0,a="",c="optional",h=[];if("text"===i.show_type?o=Ze.el.find(":checked").data("option"):"expression"===i.show_type?o=Ze.el.find(".option-expression .selected").data("option"):"star"===i.show_type&&(o=i.star.options[T-1].id),tn)return;if(!o)return _t.showTip(_t.UDL.g("tip.pleaseSurvey"),"warn");if(yt.each(i[i.show_type].options,function(e){o===this.id&&(c=this.remark_option)}),i.remark_enabled&&"required"===c&&!s.trim())return yt(".survey-mark-wrapped").has(".mark-required").length||yt(".survey-mark-wrapped").append("<span class='mark-required'>"+_t.UDL.g("tip.surveyRemarkRequire")+"</span>"),_t.showTip(_t.UDL.g("tip.surveyRemarkRequire"),"error");if(s&&s.length>200)return _t.showTip(_t.UDL.g("tip.overMaxLength"),"warn");e.addClass("disabled"),"text"===i.show_type?a=Ze.el.find(":checked").parent().text():"expression"===i.show_type?a=Ze.el.find(".option-expression .selected").attr("alt"):"star"===i.show_type&&(a=i.star.options[T-1].text),Ze.el.find(".tag-item-active").each(function(){h.push(yt(this).text())});xe({type:"survey",content:_t.UDL.g("label.satisfaction")+yt.trim(a),appendProps:{auto:!0,survey_option_id:o}});tn=!0;var f=n.split("_")[1]||t.agent_id||"";yt.post(Nt+"im_sessions/surveys",{customer_id:Et.user_id,agent_id:t.agent_id||f||Wt.agent_id,im_sub_session_id:t.im_sub_session_id||cn,option_id:o,survey_remark:s,type:i.show_type,tags:h.join(",")}).always(function(n){tn=!1,n&&1e3===n.code?(_t.showTip(_t.UDL.g("label.evaluating")),u(t.im_sub_session_id||cn),t.successFn&&t.successFn()):n&&9200===n.code&&(u(t.im_sub_session_id||cn),_t.showTip(n.message,"warn")),e.removeClass("disabled"),d(),l&&we(),p&&(it=!0),"after_session"===t.methodFlag&&(Gt=!0,_t.showBotomPanel("chat_done")),"agent_invite"===t.methodFlag&&fn&&(Gt=!0,_t.showBotomPanel("chat_done"))})}})})}function u(e){_t.messagesEl.find(".show-survey[data-im_sub_session_id="+e+"]").each(function(e,t){yt(t).text(_t.UDL.g("label.hasEvaluation")).off("click").addClass("has-survey").removeClass("show-survey")})}function d(e){_t.hideModal(e)}function p(){_t.bottomPanelEl.hide()}function h(t){Ke.connect(t,{connected:function(){en++,v(),m(),g(),b(),$(),Qt||Y(),en>1&&(clearTimeout(Ye),Ye=setTimeout(function(){_({isEmpty:!0,data:{mode:"reconnected"}})},Math.ceil(30*Math.random()*1e3))),yt(".tip-bar").hide(),setTimeout(function(){!lt&&(lt=e.im.sidebox.getProductData($t)),lt&&U(lt)},1e3)},disconnected:function(){Zt++,(Qt||It)&&(st=setTimeout(function(){h(t)},Zt>3?3e4:3e3))},connfail:function(){en||(clearTimeout(Ye),s("disconnect"))},always:function(e){Vt={},Vt[e]=!0},log:_t.log})}function f(e){Qt=!1,clearInterval(rt);try{e&&Ke.flush(),Ke.disconnect()}catch(t){}je(),e&&clearTimeout(st)}function m(){Ke.receivePresenceListener(function(e){var t=e.attributes,n=(t.type||"",t.jid),i=(e.children,t.curjid||"");n!==Et.username&&(Xt=i===Et.username)})}function g(){Ke.receiveMessageListener(function(t){var n=t.attributes,i=n.type||"chat",r=n.jid,s=t.children,o=s.delay,a=n.id,l=s.request||null,u=s.received||null,p=s.session||{},h=p.attributes?p.attributes.session_key:"";"default"===h?h="":h;var f,m,g,v=s["input-notice"],b=Rt===h;if(!(cn&&n.im_sub_session_id&&n.im_sub_session_id<cn)){o&&(m=o.attributes||{},g=m.stamp||"");var y,_,x,w,k,S,C,A,I,D,N,L=new Date;g&&(L=g);try{y=yt.parseJSON(s.body.value)}catch(j){}if(yt.isPlainObject(y)||(y=xe()),!o||"redirect"!==y.type){n.im_sub_session_id&&b&&(cn=n.im_sub_session_id||"");var $=s.action||{};$.attributes=$.attributes||{};var M=$.value||"",q=$.attributes.type||"";if(!i||"error"!==i)if(Wt.jid||It||(Wt.jid=r,W(Wt)),e.ui.appBar({inputting:""}),clearTimeout(Tt.inputNoticeTimer),v)try{v=yt.parseJSON(v.value),"input"===v.type&&(e.ui.appBar({inputting:St("inputting")}),E({isLoading:!0,msgTime:L},!0),Tt.inputNoticeTimer=setTimeout(function(){e.ui.appBar({inputting:""})},5e3))}catch(j){}else{if("isover"===q)return _t.autoSize(),F(M,r,h);if((n.isreqsurvey||s.isreqsurvey)&&(!Rt&&!h||h&&Rt==h))return c({methodFlag:"agent_invite",successFn:d,jid:r});if(u&&u.attributes)return re(u.attributes.id,"normal","",u.attributes);if(f="rollback"===y.send_status,l&&n.id&&!f&&O(n.id,r,h,o),(l||y.monitor)&&n.id&&!f){if(yt.inArray(n.id,Kt)>-1)return;R(n.id)}if(b&&(y.auto&&"market"!==y.push_type&&Jt&&!It&&z("","","","",!0),_=y.type,x=y.data||{},A="market"===y.push_type,D="sys_welcome_msg"===y.push_type,N="agent_welcome_msg"===y.push_type,w=x.content||"",msgStyle=y.monitor?x.font:y.font,msgStyle||(msgStyle=""),k=n.nick||"",I=y.invitation&&y.inviter?y.inviter.nick_name:"",I&&(k=I),msgFormId=y.form_id||"",afterTransferAgent=y.new_agent_name||"","survey"!==_&&"close"!==_)){var H=!1;switch(_){case"redirect":var P=e.id();z(w.group_id,w.agent_id,{redirect:!0},function(e){yt(".agentName"+P).text(e.nick)}),w=_t.UDL.g("tip.transferSuccess")+',<span class="agentName'+P+'"></span>&nbsp;&nbsp;'+_t.UDL.g("tip.service");break;case"rich":Xt=!0,w&&_t.tipsNewMessage.start(n.nick,"");break;case"form":Xt=!0,H=!0,yt.get(Nt+"im/im_session_forms/"+msgFormId,{property:"true"}).always(function(e){if(e&&1e3===e.code){delete e.code,S=e,un["formFields_"+e.id]=S,C=T(S);var t={type:_,msg:C,filename:x.filename||"",filesize:x.filesize||"",msgTime:L};E(t,!0)}w&&_t.tipsNewMessage.start(n.nick,"")});break;case"struct":Xt=!0,w&&_t.tipsNewMessage.start(n.nick,"");break;case"product":Xt=!0,w&&_t.tipsNewMessage.start(n.nick,"");break;default:Xt=!0,w&&_t.tipsNewMessage.start(n.nick,w)}if(!H){Ut&&Pt.postNewMsg(w,_);var U={isRecv:!0,type:_,msgId:"struct"===_?(""+a).replace("to_customer",""):a,msg:w,style:msgStyle,filename:x.filename||"",filesize:x.filesize||"",msgTime:L,senderName:k,send_status:y.send_status};afterTransferAgent?U.senderName=afterTransferAgent:x.timeout_freq||A||x.timeout_auto_msg||D?U.senderName=_t.UDL.g("label.system"):N&&(U.senderName=k||Wt.nick||""),f&&ce(a).remove(),E(yt.extend({},U),!0),console.log("【回执序号】"+y[Nn.key],Nn.value)}}}}}})}function v(){var e=function(){try{Ke.sendPresence({attributes:{},children:{name:"status",value:"online",attrs:{}}})}catch(e){}};e(),et=setInterval(function(){e()},3e4)}function b(){try{zt.ping.ping(Et.username,function(){},function(){},3e4),zt.ping.addPingHandler(function(e){return zt.ping.pong(e),!0})}catch(e){}}function y(t){return t.msg&&(t.msg=_t.replaceLinks(e.xssNotSymbol(t.msg,"&")),t.msg.search("emoji")>-1&&(t.msg=e.ui.emotionToHtml(t.msg))),t}function _(e){e=e||{},Me({data:e.data,cb:function(t){if(0!=t.length)try{e.isEmpty&&(_t.messagesEl.empty(),Tt.showedMsgIds=[]);var n=Tt.showedMsgIds||[],i=w(t);$e(ln?"historyMsg":"noMoreMsg"),yt.each(i,function(e,t){if(t.message_id&&"robot"!==t.session_type){ce(t.message_id).remove();var i=yt.inArray(t.message_id,n);i>-1&&n.splice(i,1)}if(t.local)t.noScroll=!0,E(t,t.isRecv);else{var r=ne(t.sender),s="";"agent"===t.sender&&"system"===t.status&&(s=_t.UDL.g("label.system"));try{var o=JSON.parse(t.content);"survey"===o.type?I({agent_id:t.agent_id,id:t.message_id,im_sub_session_id:t.im_sub_session_id,jid:"",created_at:t.created_at,hasSurvey:!!o.survey_option_id,noScroll:!0}):E({type:o.type,msg:o.data.content,msgId:t.message_id,senderName:s||t.agent_nick_name,style:o.font?o.font:"",msgTime:t.created_at,filename:o.filename||o.data.filename||"",filesize:o.filesize||o.data.filesize||"",session_type:t.session_type,content_raw:t.content_raw,noScroll:!0},r)}catch(a){}}}),x(),_t.animateScrollBottom(),e.cb&&e.cb()}catch(r){}}})}function x(){!lt&&(lt=e.im.sidebox.getProductData($t)),lt&&"inner"!==$t.currentMode&&e.isMob()&&e.im.sidebox.init({isInner:!0,container:_t.messagesEl,product:lt})}function w(e){for(var t,n,i=0;l=e.length,i<l;i++){var r=e[i];r.message_id;try{var s=JSON.parse(r.content),o=s.data||{},a="close"===s.type||"form"===s.type||"form_received"===s.type||"invitation"===s.type||"system"===r.status&&"survey"!==s.type&&!o.timeout_freq&&!o.timeout_auto_msg&&"market"!==s.push_type&&"sys_welcome_msg"!==s.push_type&&"agent_welcome_msg"!==s.push_type||"monitor"===r.status&&"internal"===r.log_type;"robot_transfer"===s.type?t=i:a&&(e.splice(i,1),i--)}catch(c){}}return n=t?e.slice(0,t+1).concat(e.slice(t+1)):e}function T(t){var n,i=[];return yn.usePlaceholder=!0,yt.each(t.fields,function(e,t){n=t.content_type?yn.customFieldsHandler(t,_n):yn.getFieldTpl(yn.textFieldTpl(),t),i.push(n)}),yn.usePlaceholder=!1,e.joinStr('<div class="ui-form form-msg-box" data-fields-id="'+t.id+'">','   <p class="form-scheme">'+t.scheme+"</p>",'   <form class="form-list">'+i.join("")+"</form>",'   <span class="red"></span>','   <hr class="hr-1" />','   <a class="from-submit-btn">'+St("submit")+"</a>","   </a>","</div>")}function S(e,t){t=t||{};var n=0,i=3,r=!1;e&&!function s(o,a){return n++,n>i?a():void yt.ajax({url:Nt+"im/im_logs/customer_save",type:"POST",data:o(e),timeout:5e3}).always(function(n){if(1e3!==n.code){if(5013===n.code)return Gt=!0,_t.sessionStore("input_text",t.content),void setTimeout(function(){location.reload()},10);!r&&j(e,t.message_id,{needSave:!1,only_need_save:!0,needCheckReceived:!1}),r=!0,s(o,a)}else a(n)})}(function(e){var n=Wt.agent_id,i=Et.user_id,r={message_id:t.message_id||"",user_id:i,reply_user_type:"customer",content:e};return{last_replier:"customer",agent_id:n,customer_id:i,im_sub_session_id:cn,platform:"web",reply:r,xmppStatus:Vt}},function(e){t.cb&&t.cb(e)})}function C(e){var t=Tt.showedMsgIds||[];return!e||!(yt.inArray(e,t)>-1)&&(t.push(e),Tt.showedMsgIds=t,!0)}function E(e,t,n){var i=e.msgId||e.message_id,r=e.noScroll||!1;if(!C(i))return void(n&&n());e.senderName=e.senderName||Wt.nick||St("system"),_t.messagesEl.find(">.item-loading").remove();var s=A(e,t);return s&&(_t.messagesEl.append(s),_t.parseMsgGroupTime(s),!r&&_t.judgeScrollDistance(s),yn.fieldHandler(_n,yt(".form-list"))),n&&n(),s}function A(t,n,i){var r,s,o=!1,a="icon icon-arrow-left",l="rollback"===t.send_status,c=t.isLoading,u="image"===t.type,d=!0;if(i=i||{},"robot"===t.session_type)return void xt.chatRobot.showMsgByLog(t,{isRecv:n,renderFn:i.renderFn,delayShowWelcomeMsg:i.delayShowWelcomeMsg});if(xt.isTransfer&&"robot_transfer"===t.type)return void He(t.msg);if(n?(t.clz="msg-recv",a+="-copy"):t.clz="msg-send "+(u?"":"theme-bg"),t.iconClz=a,t.typeClz=t.type||"message",Mt.h5Mode_enabled&&Tt.avatar&&(t.avatarStyle='style="background-image: url('+Tt.avatar+')"'),l)r=yt(bn.titleRadiusItemTpl({msg:_t.UDL.g("label.withdrawed",{agent:t.senderName})}));else if(c)r=yt(bn.loadingTpl(t));else{var p=_t.orderedCuttingGroupTime({time:t.msgTime,isRecv:n});switch(t.type){case"image":s=bn.imgItemTpl(Ut,{clz:"no-group",groupTime:p});break;case"file":var h=_t.checkFileCanPreview(t.msg);h&&(t.file_pre=h),s=bn.fileItemTpl(h,t.msg,{noDownload:!n,isRecv:n,clz:"no-group",groupTime:p});break;case"video":s=e.ifIE(9,"lt")?bn.fileItemTpl("",t.msg,{noDownload:!n,isRecv:n}):bn.videoItemTpl();break;case"uploading":s=bn.uploadingTpl();break;case"redirect":s=bn.titleItemTpl(),o=!1;break;case"rich":e.isPC()&&_t.innerController.isInnerMode&&(t.msg=_t.formatImgContent(t.msg)),o=!1;break;case"form":o=!1,d=!1;break;case"struct":s=bn.structTpl(t.msg),o=!1;break;case"vcall":s='<dd class="msg-vcall">{msgTime}<p><span class="event-bar">{msg}</span></p></dd>',o=!1;break;case"product":s=bn.productTpl(t.msg);break;case"robot_transfer":s=bn.titleRadiusItemTpl({msg:t.msg}),o=!1;break;default:o=!0}s||(s=bn.msgItemTpl({groupTime:d?p:""})),t.msgTime=_t.formatDateTime(t.msgTime||t.created_at),"image"===t.type&&(t=yt.extend({},t,{msg:encodeURI(t.msg)})),r=yt(e.replaceTpl(s,o?y(t):t)),r.find(".theme-bg").each(function(){var e=yt(this);e.css("background",Ht),e.find(">i").css({color:Ht,borderLeftColor:Ht})})}return i.renderFn&&i.renderFn(r),r}function I(e){var t='<i class="icon icon-good"></i> &nbsp;'+_t.UDL.g("label.survey"),n=e.hasSurvey?_t.UDL.g("label.hasEvaluation"):_t.UDL.g("label.evaluation"),i=e.hasSurvey?"has-survey":"show-survey";if(!C(e.msgId))return void(cb&&cb());var r=bn.surveyTpl(yt.extend({},{clz:"",msgTime:_t.formatDateTime(e.created_at||new Date),iconText:t,surveyClass:i,surveyText:n,agent_id:e.agent_id||Wt.agent_id,im_sub_session_id:e.im_sub_session_id||cn,jid:e.jid||""},e));return e.needStr?r:(_t.messagesEl.append(r),void _t.animateScrollBottom())}function D(e){var t=_t.messagesEl.find(".queue-event");if(t.size()>0)return void t.find(".queue-tip").text(e.msg);var n=new Date,i='<span class="queue-tip">'+e.msg+"</span>",r=jt?'<a class="goFeedbackBtn">'+_t.UDL.g("label.leaveMsg")+"</a>":"",s=bn.queueTpl(yt.extend({},{clz:"",msgTime:_t.formatDateTime(n),queueText:i,leaveText:r,groupTime:_t.orderedCuttingGroupTime({time:n})},e));return e.needStr?s:(_t.messagesEl.append(s),_t.animateScrollBottom(),xt.chatRobot.tryShowBtnTransfer(),void yt(".goFeedbackBtn").off("click").on("click",function(){_t.hideMoreBox(),_t.goFeedback({hideBoardAll:!0,cb:function(){f()}})}))}function N(){var e="noWordtimeEventMsg";yt("#"+e).remove(),xt.chatRobot.tryShowBtnTransfer(),yt.get(Nt+"im/web_im_feedbacks/setting_templet",$t,function(t){wt.messages.append(bn.titleRadiusItemTpl({id:e,msg:(""+t.setting.digest2).replace(/(^<p>)|(<\/p>$)/g,"")+' <a class="btn-feedback">'+St("leaveMsg")+"</a>"}))})}function L(){_t.bodyEl.on("click",".show-survey",function(){_t.hideMoreBox();var e=(yt(this).attr("data-methodFlag"),yt(this).attr("data-im_sub_session_id")),t=yt(this).attr("data-agent_id"),n=yt(this).attr("data-jid");c({notShowTitle:!0,notShowSurveyEvent:!0,im_sub_session_id:e,agent_id:t,jid:n||""})})}function j(t,n,i){i=i||{};var r,s=!("needSave"in i)||i.needSave,o=!("needReceived"in i)||i.needReceived,a=!("needCheckReceived"in i)||i.needCheckReceived,l="only_need_save"in i&&i.only_need_save,c=i.session_key||Rt,u=[];if(clearTimeout(tt),t){if("string"==typeof t)try{t=JSON.parse(t)}catch(d){}if(yt.isPlainObject(t)){if(s?t.no_need_save=!0:t.no_need_save=!1,t.im_sub_session_id=t.im_sub_session_id||cn,l&&(t.only_need_save=!0),a&&(t[Nn.key]=Nn.increment()),r=t.data?t.data.content:"",t.data&&t.data.content){var p=t.type||"";"message"===p&&(t.data.content=e.xssNotEnter(r))}t=JSON.stringify(t)}}u.push({name:"body",value:t}),i.children&&(u=u.concat(i.children)),(o||a)&&u.push({name:"request",value:"",attributes:{xmlns:"urn:xmpp:receipts"}}),c&&u.push({name:"session",value:"session",attributes:{xmlns:"udesk:session",type:"session",platform:"web",session_key:c}}),Ke.sendMessage({attributes:yt.extend({id:n},i.attributes),children:u}),s&&S(t,{message_id:n,content:r}),a&&ae(t,n)}function $(){Wt.jid&&j(xe({type:"private"}),"",{needSave:!1,needReceived:!1,needCheckReceived:!1})}function R(e){Kt.push(e)}function M(){return e.guid("msg",Rt)}function F(e,t,n){if("overtest"===e)n==Rt&&j("","",{needSave:!1,needReceived:!1,needCheckReceived:!1,attributes:{to:t},children:[{name:"action",value:"overready",attributes:{xmlns:"udesk:action",type:"isover"}}]});else if("over"===e&&n==Rt){if(Pt.postMsg({type:"chatDone"}),fn=!0,t!==Wt.jid)return;c({methodFlag:"after_session",needCloseWin:!0,noAuthFn:function(){Gt=!0,_t.showBotomPanel("chat_done"),f(!0)}})}return!0}function O(e,t,n,i){e&&(n&&n!=Rt?setTimeout(function(){q(e,t,n,i)},500):q(e,t,n,i))}function q(e,t,n,i){var r="";!n||i?r="":!i&&n&&n!=Rt?r="offline":!i&&n&&n==Rt&&(r=""),j("","",{needSave:!1,needReceived:!1,needCheckReceived:!1,attributes:{to:t},children:[{name:"received",value:"",attributes:{xmlns:"urn:xmpp:receipts",id:e,status:r,is_self:n==Rt}}]})}function H(){an.off("input propertychange"),an.on("input propertychange",function(){if(_t.setBtnSendActive(),Xt){var e=xe({content:an.val()});clearTimeout(tt),tt=setTimeout(function(){P(e)},300)}})}function P(e){j(e,"",{needSave:!1,needReceived:!1,needCheckReceived:!1,children:[{name:"premsg",value:"",attributes:{xmlns:"udesk:premsg",premsg:"true"}}]})}function U(e){e&&j("","",{needReceived:!1,needCheckReceived:!1,children:[{name:"product",value:JSON.stringify({data:e,type:"product",platform:"web"})}]})}function B(e,t,n,i){e=e||"",t=t||"",n=n||{},"agent"===_t.chat_creator&&(n.active_guest=_t.chat_creator),"agent"===_t.chat_creator||Et.chatting||_t.invited||(n.ask_chatting=!0),n.web_plugin_id=$t.web_plugin_id||"",vt=yt.extend({group_id:e,agent_id:t,customer_jid:Et.username,session_key:Rt,menu_id:n.menu_id,needLoading:!0},n),yt.get(Nt+"im/pre_sessions",vt).always(function(e){e=e||{},yt.each(e.im_logs||[],function(e,t){var n=ne(t.sender);if(!xt.isTransfer)try{var i=JSON.parse(t.content);E({type:i.type,msg:i.data.content,msgId:t.message_id,senderName:t.agent_nick_name,style:i.font?i.font:"",msgTime:t.created_at,filename:i.filename||i.data.filename||"",filesize:i.filesize||i.data.filesize||"",session_type:t.session_type},n)}catch(r){}}),!e.is_worktime&&N(),i&&i()}),J("agent",{}),_t.messagesEl.find("dt").removeClass("hide"),d(),p()}function z(e,t,n,i,r,o){e=e||"",t=t||"",n=n||{},"agent"===_t.chat_creator?n.active_guest=_t.chat_creator:"sys"===$t.sender&&(n.active_guest="sys"),"agent"===_t.chat_creator||Et.chatting||_t.invited||(n.ask_chatting=!0),n.web_plugin_id=$t.web_plugin_id||"",o&&"queue"===o.source&&_t.log.debug("[排队消息6k记录]: Start getAgent; MsgId: "+o.msgId),ct=yt.get(Nt+"im/agent",yt.extend({group_id:e||$t.group_id,agent_id:t||$t.agent_id,customer_jid:Et.username,session_key:Rt,h5push:$t.h5push,menu_id:n.menu_id,needLoading:!0},n)).always(function(a){if(a=a||{},rn=!1,Jt=!1,bt=!1,o&&"queue"===o.source&&_t.log.debug("[排队消息6k记录]: End getAgent; MsgId: "+o.msgId+"; res: "+JSON.stringify(a)),a.exception)return s("error");switch(a.code){case 2e3:Z(a,i);break;case 2001:if(It=!1,Sn++,Jt=!0,dt=!0,at=a.queue,Pt.postMsg({type:"queuing"}),Sn<2?(!xt.isTransfer&&We("queuingPage"),d(),ge(function(){_t.animateScrollBottom(),D({type:"queue",msg:a.message||[]})})):D({type:"queue",msg:a.message}),_t.setBtnSendActive(),!xt.isTransfer&&J("agent",{}),_t.stopQueuing)return;r||setTimeout(function(){Jt&&z(e,t,yt.extend(n,{needLoading:!1}),i)},8e3);break;case 2002:if(dt&&!ut)return ut=!0,void setTimeout(function(){z(e,t,yt.extend(n,{needLoading:!1}),i)},5e3);if(ee(3),!a.is_worktime)return void N();_t.goFeedback({noAnimate:!0,replace:!0,btnBack:!0,onBack:function(){Tt.initCfg.tryShowBtnTransfer&&Tt.initCfg.tryShowBtnTransfer()}}),f(!0);break;default:s("error"),f(!0)}})}function W(e){Wt=e||{},J("agent",Wt),Ke.setToUser(Wt)}function V(t){var n=_t.innerController.isInnerMode;n||e.isMob()||!t||(Lt?X(Lt,t):_t.getSideBoxData(function(e){X(e,t)}))}function X(t,n){var i;yt.each(t.side_data,function(e,t){"agent_card"===t.key&&t.enable&&(i=!0)}),i&&e.im.sidebox.init({container:_t.sideBoxEl,need_clear:!0,side_data:t.side_data,right_width:t.data.right_width,im_sub_session_id:n,product:e.im.sidebox.getProductData($t),after:function(e){if(e){var t;_t.bodyEl.removeClass("fullscreen").addClass("side"),t={right:Math.min(_t.sideBoxEl.width(),yt("#main").width()/2)+2,width:"auto"},_t.contentEl.css(t),_t.footerEl.css(t),_t.bottomPanelEl.css(t),_t.isWindowCenter&&_t.abjuctCenterBox(null,!0)}}})}function Q(){var e=Nt+"sdk_offline_messages/customer_clear_message";yt.post(e,{user_id:Et.user_id,access_token:Et.access_token,appid:"",session_key:Rt,customer_id:Et.user_id}).always(function(e){!e||1e3!==e.code})}function J(t,n){var i="",r="",s="";if(n=n||{},i=n.nick||n.title||Mt.frame_title||kt("agent.onlineAg"),s=n.avatar||Mt.logo_url||"images/default_head.png",It||(r=Mt.agent_introduce),"agent"===t){if(_t.store("agent_nick",n.nick),i===Tt.title&&Tt.avatar===s)return;Tt.title=i,Tt.avatar=s}e.ui.config({appBar:{btnBack:!1,title:i,desc:r,avatar:s}}),e.ui.appBar()}function G(e,t,n,i,r){return e=e||"",t=t||"",n=n||{},i=i||!1,i?(We("show_pre_session"),B(e,t,n,r)):z(e,t,n,r)}function K(){var e=$t.group_id||"",t=$t.agent_id||"";if(!Et.chatting&&!e&&!t)return te("",function(e){Tt.choiceAgentData=e,Ve(e)})}function Y(){var e=$t.group_id||"",t=$t.agent_id||"";return Et.chatting&&At?Z(At):Et.chatting?G(e,t,{},It):e||t?G(e,t,{},It):void 0}function Z(t,n){It=!1,bt=!1,dt=!1,Qt=!0,cn=t.im_sub_session_id,We("agent"),_t.setBtnSendActive(),W(t.agent),_t.messagesEl.find("dt").removeClass("hide"),xt.isTransfer||pe(),V(cn),oe(),Q(),d(),p(),ee(1),!lt&&(lt=e.im.sidebox.getProductData($t)),lt&&U(lt),H(),Ut&&(Pt.postAgentInfo(t.agent),Pt.postMsg({type:"chatting"})),Et.chatting=!0,n&&n(t.agent),Ue(),Be(),wt.messages.find(".queue-event").remove(),ke(),qt&&Se(),Pe(),xt.isTransfer&&He(kt("agent.transferred"))}function ee(e){In&&(_t.sessionStore(En,""),_t.doTransferTurnPage(e,In))}function te(e,t){e=e||$t.menu_id||"item_0";var n=_t.UDL.g("agent.choiceAgent");try{n=Et.im_group.group_menus.name||_t.UDL.g("agent.choiceAgent")}catch(i){}var r={id:e,item_name:n},s=function(t){var n;return yt.each(t,function(){this.id===e&&(n=this)}),n||r},o=function(t){var n=[];return yt.each(t,function(){this.parentId===e&&n.push(this)}),n},a=function(e){e=e||{};var n=e.group_menus||{},i=n.items||[];return e.enable&&i.length?(Yt=i,void t(yt.extend({items:o(i)},s(i)||r))):G("","",{},It)};return Yt&&Yt.length?t(yt.extend({items:o(Yt)},s(Yt)||r)):void(Et.im_group?a(Et.im_group):yt.get(Nt+"im/im_group",{im_web_plugin_id:$t.web_plugin_id}).always(function(e){e=e||{},a(e.data)}))}function ne(e){return"agent"===e||(""+e).indexOf("robot")>0}function ie(e,t,n,i){yt.inArray(e,on)===-1&&on.push(e),t.hide(),n.show(),n.click(function(){ue(e)||(j(i,e),re(e,"wait"),n.off("click"))})}function re(e,t,n,i){i=i||{};var r=ce(e),s=r.find(".wait-img"),o=r.find(".fail-img"),a=function(){o.hide(),s.show()};switch(t){case"wait":i.failFn?se(e,{successFn:function(t){var n=yt.unique(t.message_ids||[]);yt.inArray(e,n)>-1?(o.hide(),s.hide(),r.attr("data-received",1)):(a(),i.failFn())},errorFn:function(){a(),i.failFn()},needTimeout:!0}):a();break;case"fail":se(e,{successFn:function(t){var i=yt.unique(t.message_ids||[]);yt.inArray(e,i)>-1?(o.hide(),s.hide(),r.attr("data-received",1)):ie(e,s,o,n)},errorFn:function(){ie(e,s,o,n)},needTimeout:!0});break;case"normal":o.hide(),s.hide(),r.attr("data-received",1);break;default:o.hide(),s.hide()}return!0}function se(e,t){t=t||{};var n,i="/spa1/im/im_logs/customer_send";n="string"==typeof e?[e]:e,setTimeout(function(){yt.post(i,{im_sub_session_id:cn,message_ids:n}).always(function(e){!e||1e3!==e.code&&5103!==e.code?t.errorFn&&t.errorFn():t.successFn&&t.successFn(e)})},t.needTimeout?1e3:50)}function oe(){clearInterval(rt),rt=setInterval(function(){on=yt.unique(on),on.length>0&&se(on,{successFn:function(e){on=yt.unique(on);for(var t=yt.unique(e.message_ids||[]),n=yt.unique(e.err_message_ids||[]),i=0,r=t.length;i<r;i++)re(t[i],"normal");for(var i=0;r=on.length,i<r;i++){var s=on[i];if(!s)return;n.indexOf(s)>-1?(on.splice(i,1),i--):t.indexOf(s)>-1&&(on.splice(i,1),i--)}}})},1e4)}function ae(e,t,n){return n=n||"first","first"===n?setTimeout(function(){return Vt.connected?void(ue(t)||re(t,"wait","",{failFn:function(){le(e,t,1)}})):re(t,"fail")},1e3):ue(t)?re(t,"normal"):re(t,"fail",e)}function le(e,t,n){return n<=5?void setTimeout(function(){return Vt.connected?ue(t)?re(t,"normal"):void se(t,{successFn:function(i){var r=yt.unique(i.message_ids||[]);yt.inArray(t,r)>-1?(failImgEl.hide(),waitImgEl.hide(),msgEl.attr("data-received",1)):(j(e,t,{needSave:!1,needReceived:!0,needCheckReceived:!1}),le(e,t,n+1))},errorFn:function(){j(e,t,{needSave:!1,needReceived:!0,needCheckReceived:!1}),le(e,t,n+1)}}):re(t,"fail")},3e3):ae(e,t,"last")}function ce(e){return _t.messagesEl.find('[data-msgId="'+e+'"]')}function ue(e){return 1==ce(e).attr("data-received")}function de(e,t){!bt&&It&&z("","",vt,t)}function pe(){setTimeout(function(){_()},100)}function he(t){var n;if("string"==typeof t)try{t=JSON.parse(t)}catch(i){}if(yt.isPlainObject(t)){if(n=t.data?t.data.content:""){var r=t.type||"";"message"===r&&(t.data.content=e.xssNotEnter(n))}t=JSON.stringify(t)}return t}function fe(e,t,n){if(!e||!t)return n&&n();var i="/spa1/im/pre_sessions/msg";yt.post(i,{msg:e,msg_id:t,customer_id:Et.user_id,session_key:Rt,timeout:2e3,msg_mode:"pre_session",local:!0}).always(function(i){i=i||{},1e3==i.code?(rn=!1,yt("#btnSend").css("background-color",Ht),Tn=0,n&&n()):6e3==i.code?(_t.log.debug("[Pre_sessions_code6k记录]/pre_sessions/msg: msgId: "+t+"; code: "+i.code+"; customer_id: "+Et.user_id+"; "+JSON.stringify(i)),rn=!1,yt("#btnSend").css("background-color",Ht),Tn=0,n&&n()):Tn<2?(fe(e,t,n),Tn++):(_t.log.debug("[Pre_sessions_fail]/pre_sessions/msg: msgId: "+t+"; code: "+i.code+"; customer_id: "+Et.user_id+"; "+JSON.stringify(i)),rn=!1,_t.setBtnSendActive(),Tn=0,n&&n())})}function me(e,t){if(_t.findValueInArr(t,Cn)||Cn.push(t),!e||!t)return cb&&cb();var n="/spa1/im/pre_sessions/msg";yt.post(n,{msg:e,msg_id:t,customer_id:Et.user_id,session_key:Rt,timeout:2e3,msg_mode:"queue",local:!0}).always(function(n){n&&1e3==n.code?kn=0:n&&9200==n.code?(_t.showTip(n.message,"warn"),kn=0):n&&6e3==n.code?(_t.log.debug("[排队消息6k记录]: msgId: "+t+"; code: "+n.code+"; customer_id: "+Et.user_id+"; "+JSON.stringify(n)),z("","","","","",{source:"queue",msgId:t})):kn<2&&(me(e,t),kn++)})}function ge(e){var t="/spa1/im/pre_sessions/msg";yt.get(t,{customer_id:Et.user_id,session_key:Rt}).always(function(t){t&&1e3==t.code?ve(t,e):_t.showTip("加载消息失败,请刷新重试")})}function ve(t,n){yt.each(t.im_logs||[],function(t,n){"customer"!==n.sender||_t.findValueInArr(n.message_id,Cn)||Cn.push(n.message_id);var i=ne(n.sender),r="";try{var s=JSON.parse(n.content),o=s.data.content;"message"===s.type&&o&&(s.data.content=e.unXssNotEnter(o))}catch(a){}"agent"===n.sender&&"system"===n.status&&(r=_t.UDL.g("label.system")),E({noScroll:!0,type:s.type,msg:s.data.content,msgId:n.message_id,senderName:r||n.agent_nick_name,style:s.font?s.font:"",msgTime:n.created_at,filename:s.filename||s.data.filename||"",filesize:s.filesize||s.data.filesize||""},i)}),n&&n()}function be(e,t,n){return Cn.length>19?(_t.showTip("排队页面最多发送20条消息!","warn"),!0):(me(e,t),!1)}function ye(t,n){n=n||{};var i=n.content||yt.trim(an.val()),r=n.type?"text"===n.type?"":n.type:"",o=M(),a=new Date;if(i){if(e.ifIE(9,"lte")&&!Vt.connected)return void _t.showTip(_t.UDL.g("label.connecting"));if(dt||(It||Qt)&&!nn&&!rn){var l=function(){if(!r&&"product"!==r)for(var e=0,t=sn.length;e<t;e++){for(var n=sn[e],l=new RegExp(n,"img"),c=n.length,u="";u.length<c;)u+="*";i=i.replace(l,u)}var d=xe({content:i,type:r});if(!Vt.connected&&!dt)return void s("error");if(It){rn=!0,_t.setBtnSendActive(!1),setTimeout(function(){rn=!1,_t.setBtnSendActive()},3e3);var p=he(d);fe(p,o,function(){de(d,function(e){bt=!1}),bt=!0})}else if(dt){var p=he(d);if(be(p,o))return}else j(d,o);E({msg:i,type:r,msgId:o,msgTime:a,created_time:+new Date,local:!0}),an.val("").height(ot),Xt&&!dt&&P(xe({content:""})),an.trigger("autosize:resized")},c=function(){_t.showTip("发送过频，请稍后再试","error"),nn=!0,_t.setBtnSendActive(!1),setTimeout(function(){nn=!1,_t.setBtnSendActive()},3e3)};e.msgFrequency?e.msgFrequency({content:i,type:r,success:l,fail:c}):e.loader.js("./lib/msg-frequency.js").then(function(){e.msgFrequency({content:i,type:r,success:l,fail:c})}),gn.hide(),_t.setBtnSendActive()}}}function _e(){_t.hideMoreBox(),pn||(pn=!0,yt.get("/spa1/im_sessions/save_chat_log",{customer_id:Et.user_id}).always(function(e){pn=!1;var t=e.file_url||"";t?window.open(t):_t.winAlert(_t.UDL.g("tip.downloadFail"))}))}function xe(e){e=e||{};var t=yt.extend({type:e.type||"message",version:1,platform:"web",data:yt.extend({content:e.content||"",filename:e.filename||"",filesize:e.filesize||""},e.data),filename:e.filename||"",filesize:e.filesize||"",im_sub_session_id:e.im_sub_session_id||cn},e.appendProps);return JSON.stringify(t)}function we(){Gt=!0,_t.showBotomPanel("chat_done"),f(!0);var t=!1;e.platform({weixin:function(){t=!0}}),Ut||t||e.isMob()||(e.closeWindow(),gn.hide())}function Te(e){var t="/spa1/im_sessions/has_survey";yt.post(t,{agent_id:Wt.agent_id,customer_id:Et.user_id,customer_jid:Et.username,im_sub_session_id:cn}).always(function(t){t=t||{},it=t.has_survey,e&&e()})}function ke(){if(!Tt.hasInitFooter){
Tt.hasInitFooter=!0,xt.isTransfer&&xt.chatRobot.destroy(),wt.footer.show(),_t.initFooter(),ot=wt.txtMsg.height(),_t.editorAutoShow(),_t.setBtnSendActive();try{an.placeholder()}catch(t){}an.focus(),gn=e.ui.emotion({isSdk:xt.isSDK,isInner:Ut,isCopyRight:xt.isCopyRight,target:wt.btnEmotion,container:wt.main,click:function(e){var t=yt(this).data("value");t&&wt.txtMsg.val(wt.txtMsg.val()+t),!vn&&_t.moveCursor(wt.txtMsg[0]),gn.hide(),autosize.update(wt.txtMsg[0]),_t.setBtnSendActive(),_t.hideMoreBox()},show:function(){if(vn){var e=yt(".im-emotion");_t.autoSize({offsetY:e.outerHeight(),cb:function(){}})}},hide:function(){vn&&_t.autoSize()}}),wt.btnSend.off("click").click(ye),wt.btnDownload.click(_e),wt.txtMsg.off("keydown").on("keydown",function(e){if(13==e.keyCode){if(e.shiftKey)return;return ye(),e.preventDefault()}}).off("click").on("click",function(){gn&&gn.hide(),_t.hideMoreBox()}),_t.btnDownloadEl.click(_e),_t.footerEl.on("click",function(){an.focus()})}}function Se(){return WebUploader.Uploader.support()?void(Tt.initUploader||(Tt.initUploader=!0,ft=e.uploader.init({marking:"client.chat_upload",auto:!1,swf:"/im_client/cmps/webuploader/dist/Uploader.swf",dnd:"#content,#footer textarea",paste:"#footer textarea",disableGlobalDnd:!0,pick:{id:"#btnFile",multiple:!0},duplicate:!0,fileSingleSizeLimit:52428800,fileSingleLimit:50,resize:!1,dndAccept:function(){Tt.isUploadDndAccept=!0},fileQueued:function(e,t){var n=new Date;if(!It||!rn){It&&(rn=!0,setTimeout(function(){rn=!1},3e3));var i=E({fileId:e.id,type:"uploading",msgTime:n});i&&i.attr("data-file-id",e.id),ht=!1}},manualUpload:function(t,n,i){var r="image"===_t.getFileType(n),s=Tt.isUploadDndAccept;if(clearTimeout(Tt.uploadQueueTimer),Tt.isUploadDndAccept=!1,Tt.uploadQueueCounter=(Tt.uploadQueueCounter||0)+1,Tt.uploadQueueTimer=setTimeout(function(){Tt.uploadQueueCounter=0},1e3),e.ifIE()&&("image.png"!==n.name||n.random_filename||(ht=!0)),ht||!r||s||Tt.uploadQueueCounter>1)return i&&i(n);try{t.makeThumb(n,function(r,s){e.ui.imgPreview({src:s,onClick:function(e){"close"===e?n&&t.cancelFile(n):"send"===e&&i&&i(n)}})},1,1)}catch(o){return i&&i()}},uploadProgress:function(e,t){var n=(100*t).toFixed(1),i=_t.messagesEl.find('>[data-file-id="'+e.id+'"]');n=n>99.9?99.9:n,i.find(".progress-per").css("width",n+"%")},uploadSuccess:function(t,n){if(rn=!1,e.ifIE(9,"lte"))Ce(t,n);else if("qiniu"===t.storage_policy){var i="https://qn-im.udesk.cn/"+n.key,r=_t.getFileType(t),s="image"===r;yt.ajax({url:s?i+"?imageInfo":i+"?stat",type:"GET",noParams:!0}).always(function(e){e=e||{};var i=s?e.size:e.fsize;"undefined"==typeof i?(dn=1,Ce(t,n)):0===i&&dn<2?(ft.upload(t),dn++):0===i&&dn>=2?(dn=1,yt("#"+t.id).parents(".clearfix").remove(),t&&ft.removeFile(t,!0),_t.winAlert(_t.UDL.g("tip.sendFail"))):(dn=1,Ce(t,n))})}else Ce(t,n)},uploadError:function(e){rn=!1,yt("#"+e.id).parents(".clearfix").remove(),_t.winAlert(_t.UDL.g("tip.sendFail"))}}))):void _t.showTip(_t.UDL.g("tip.updateFlash"),"warn")}function Ce(e,t){var n,i,r=e.url,s=r,o=_t.getFileType(e),a=M(),l=new Date;"file"==o?("mp4"===e.ext&&(o="video"),n=e.name,r=r,s=r+"?download/"+n,i=WebUploader.Base.formatSize(e.size)):"image"==o&&("qiniu"===e.storage_policy?(r+="?imageMogr/auto-orient",s=r):"ali"===e.storage_policy&&(r+="?x-oss-process=image/auto-orient,1",s=r));var c=xe({content:r,type:o,filename:n,filesize:i}),u={msg:s,filename:n||"",filesize:i||"",type:o,msgId:a,msgTime:_t.formatDateTime(l,!0)};if(It)fe(c,a,function(){de(c,function(e){bt=!1}),bt=!0});else if(dt){if(be(c,a))return}else j(c,a);yt("#"+e.id).parents(".clearfix").remove(),E(u)}function Ee(){e.isMob()||(_t.editorAutoShow(),Ae(function(){var e=function(e,t,n,i,r,s,o,a){if(e<0)return void Ie();if(yt.inArray(e,[1,4])>-1){if(4===e&&"0"!=s)return;De({src:"data:image/png;base64,"+o,data:o})}},t=function(){},n=function(){};mt=new NiuniuCaptureObject,mt.FinishedCallback=e,mt.PluginLoadedCallback=t,mt.VersionCallback=n,mt.InitNiuniuCapture()}))}function Ae(e){_t.loadJS(xn+"/niuniucapture.js",e)}function Ie(){var e=wn?"dmg":"exe",t=xn+"/CaptureInstall."+e;_t.showTip(_t.UDL.g("tip.downloadPlugin2")+'<a class="btn-download" target="_blank" href="'+t+'" download="CaptureInstall.'+e+'">'+_t.UDL.g("tip.install")+"</a>","warn",{timer:3e4})}function De(t){gt=t||{};var n="image"+ +new Date+(""+1e6*Math.random()).substring(0,3)+".png";e.uploader.getToken(n,"web.mg.rich_editor_copy",function(t){e.ui.imgPreview({src:gt.src,onClick:function(i){function r(e){if(e){var t;t=e.src?e.src:Ne({key:e.key,isImg:!0});var n,i=_t.UDL.g("label.screenshot")+(new Date).getFullYear()+""+((new Date).getMonth()+1)+".png",r=M(),s=xe({type:"image",content:t,filename:i});if(dt){if(be(s,r))return}else j(s,r);var o={msg:t,filename:i||"",filesize:n||"",type:"image",msgId:r,msgTime:new Date};E(o)}else _t.showTip(_t.UDL.g("tip.uploadErrorRetry"),"error")}"send"===i&&("qiniu"===t.storage_policy?e.ifIE()?yt.post("/spa1/web_proxy/qiniu_putb64",{token:t.token,data:gt.data,key:e.uploader.baseCode64(n),noParams:!0}).always(function(e){e&&e.data?r(e.data):_t.showTip(_t.UDL.g("tip.uploadErrorRetry"),"error")}):e.uploader.getImgByBase64({config:t,data:gt.data,noTip:!0,success:function(e){r(e)},error:function(){_t.showTip(_t.UDL.g("tip.uploadErrorRetry"),"error")}}):e.uploader.getImgByBase64({config:t,data:gt.data,key:n,noTip:!0,success:function(e){r(e)},error:function(){_t.showTip(_t.UDL.g("tip.uploadErrorRetry"),"error")}}))}})})}function Ne(e){if(!e)return"";var t,n,i=e,r=typeof e;if("function"===r||"object"===r&&e){if(e.src)return e.src;i=e.key,t=e.isImg||(file.type||"").indexOf("image/")>=0}return n="https://qn-public.udesk.cn/"+i,t||(n+="?download/"+file.name),n}function Le(){yt(t).bind("beforeunload",function(t){if(!(Ut||Gt||_t.isBeforeunload||$t.udesk_skip_preclose||e.isMob()||e.remoteControl.app.lanuchRemote)){var n=_t.UDL.g("tip.confirmClose");return Qt&&!Jt&&!it&&a("customer_invite",nt)&&(c({methodFlag:"customer_invite",successFn:function(){d(),p()}}),n=_t.UDL.g("tip.haveNotSurvey")+"\n\n"+_t.UDL.g("tip.stay")+"\n"+_t.UDL.g("tip.leave")),t.returnValue=n,Gt=!0,n}}).bind("unload",function(){f(!0),e.vcall.app.leaveChannel({needBye:!0})})}function je(){at&&(ee(2),yt.ajax({async:!1,url:"/spa1/im/close_queue",data:{queue:at}}))}function $e(e){var t="show-history",n=_t.UDL.g("tip."+e)||e,i=yt("#"+t);return i.size()?i.html(n):(i=yt('<dt><h4><a id="'+t+'">'+n+"</a></h4></dt>"),_t.messagesEl.prepend(i)),i}function Re(){var e="/spa1/im/im_logs/customer_logs",t={session_key:Rt,im_web_plugin_id:$t.web_plugin_id};t.im_session_id=_t.last_im_session_id||0,t.more_marking=_t.last_more_marking,yt.get(e,t).always(function(e){if(1e3==e.code&&e.im_logs.length){_t.last_im_session_id=e.last_im_session_id,_t.last_more_marking=e.more_marking;var t=e.im_logs||[];t=Fe(t,e.now,!0),qe(t),$e("moreMsg"),e.more_marking||(ln=!1,$e("noMoreMsg"),_t.bodyEl.off("click","#show-history"))}else ln=!1,$e("noMoreMsg"),_t.bodyEl.off("click","#show-history")})}function Me(e){e=e||{};var t=e.cb,n="/spa1/im/im_logs/customer_logs",i=yt.extend({session_key:Rt,im_web_plugin_id:$t.web_plugin_id},e.data);Dn||(Dn=!0,xt.isTransfer&&(i.robot_transfer=!0),yt.get(n,i).always(function(e){if(e=e||{},Dn=!1,1e3==e.code&&e.im_logs.length){_t.last_im_session_id=e.last_im_session_id,_t.last_more_marking=e.more_marking,e.more_marking?$e("moreMsg"):(ln=!1,$e("noMoreMsg"),_t.bodyEl.off("click","#show-history"));var n=e.im_logs||[];n=Fe(n,e.now),hn=n,t&&t(e.im_logs||[])}else ln=!1,$e("noMoreMsg"),_t.bodyEl.off("click","#show-history"),t&&t([])}))}function Fe(t,i,r){t=t||[],i=i||new Date;for(var s=nt?nt.survey_expire:"",o=!!nt&&nt.enabled,a=60*(s||48)*60*1e3,l=!1,c=0,u=t.length;c<u;c++){var d=t[c],p=e.parseJSON(d.content||{});if("survey"===p.type&&p.survey_option_id){l=!0;break}}if(l)for(var h=0;n=t.length,h<n;h++){var d=t[h],p=e.parseJSON(d.content||{});"survey"===p.type&&"undefined"==typeof p.survey_option_id&&(t.splice(h,1),h--)}else for(var f=0;k=t.length,f<k;f++){var d=t[f],p=e.parseJSON(d.content||{}),m=new Date(i)-new Date(d.created_at);"survey"===p.type&&(!o||r&&m>a)&&(t.splice(f,1),f--)}return t}function Oe(){yt.get(_t.apiPath+"im_sensitive_words/customer").always(function(e){if(e&&1e3===e.code&&e.customer_is_open){var t=e.customer_words_string||"";t&&(sn=(t.split(",")||[]).sort(function(e,t){return t.length-e.length}))}})}function qe(e){var t=function(e){yt("#show-history").parents("dt").after(e),_t.contentEl.scrollTop()};e.reverse(),yt.each(e,function(e,n){var i=ne(n.sender),r=JSON.parse(n.content)||{};if(!("system"===n.status&&"survey"!==r.type||"close"===r.type||"form"===r.type||"form_received"===r.type||"invitation"===r.type||"monitor"===n.status&&"internal"===n.log_type)){var s="monitor"===n.status?n.user_nick_name||Wt.nick||n.agent_nick_name:n.agent_nick_name;n.inviter&&(s=n.inviter.nick_name);var o;"survey"===r.type?(o=I({agent_id:n.agent_id,im_sub_session_id:n.im_sub_session_id,jid:"",hasSurvey:!!r.survey_option_id,created_at:n.created_at,needStr:!0}),t(o)):o=A({msgId:n.message_id,type:r.type,msg:r.data.content,filename:r.filename||r.data.filename||"",filesize:r.filesize||r.data.filesize||"",senderName:s,style:r.font?r.font:"",msgTime:n.created_at,send_status:"rollback"===n.send_status?"rollback":"",session_type:n.session_type,content_raw:n.content_raw},i,{delayShowWelcomeMsg:!0,renderFn:t})}})}function He(e){var t=yt("#"+Tt.transferEventMsgId);e&&t.find("span").html(e),t.show(),wt.messages.find(">.bot").last().after(t)}function Pe(){var e=yt('[data-act="survey"]');return It||dt?(e.hide(),void _t.editorAutoShow()):void o(function(){a("customer_invite",nt)?(e.show(),e.off("click").click(function(){_t.hideMoreBox(),Te(function(){return it?_t.showTip(_t.UDL.g("robot.hasSurvey"),"error"):void c({methodFlag:"customer_invite",successFn:function(){d(),p()}})})})):e.hide(),_t.editorAutoShow()})}function Ue(){Mt.buttons_enable.company_vcall&&e.vcall.app.init({container:_t.footerEl.find(".toolbar"),user_id:Et.username,to_user_id:Wt.jid,biz_session_id:cn,theme_color:Ht,sender_name:Et.nick,sendee_name:Wt.nick,onCallStatus:function(e){E({type:"vcall",msg:e.call_desc,msgId:e.msg_id,msgTime:new Date},e.isRecv)},showTip:function(e){_t.showTip(e,"error")},cb:function(){_t.editorAutoShow()}})}function Be(){Mt.buttons_enable.remote&&e.remoteControl.app.init({user_id:Et.username})}function ze(){Qt||K(),xt.isTransfer?It&&(ke(),qt&&Se(),He()):(It&&We("show_pre_session"),ke(),qt&&Se(),It&&J("company")),Ot&&Ee()}function We(e){wt.btnEmotion.show(),wt.btnFile.show(),wt.btnScreenShot.show(),"show_pre_session"===e||"queuingPage"===e?(wt.btnDownload.hide(),wt.btnAgentTel.hide()):"agent"===e&&(wt.btnDownload.show(),wt.btnAgentTel.show()),_t.editorAutoShow()}function Ve(t){Tt.hasChoiceAgent=!0,Tt.choiceAgentBoardEl=e.ui.board({id:"choiceAgent",title:e.xss(t.item_name)||kt("agent.choiceAgent"),noAnimate:!Et.show_pre_form,replace:!0,header:{btnBack:!!t.parentId,onClick:function(e){"back"===e&&te(t.parentId,function(e){Ve(e)})}},body:e.ui.form({body:e.joinStr('<ul class="list">',e.map(t.items,function(t,n){var i=["data-id="+n.id];return i.push("data-act="+(n.has_next?"next":"item")),n.group_id&&i.push("data-group_id="+n.group_id),e.joinStr("<li "+i.join(" ")+">",' <a class="btn btn-default can-wrap">'+e.xss(n.item_name)+"</a>","</li>")}),"</ul>"),buttons:[{html:_t.getBtnMsgLogsHtml("choiceAgent")}],onClick:function(e,t){var n=t.el.data("id"),i=t.el.data("group_id")||"";if("next"===e)te(n,function(e){Ve(e)});else if("item"===e)return Tt.choiceAgentBoardEl.parent().children().removeClass("open"),G(i,"",{menu_id:n},It)}})})}function Xe(){var n=_t.sessionStore("input_text");n&&(an.val(n),_t.sessionStore("input_text","")),An=_t.sessionStore(En),In=An?An.split("||")[2]:"",Oe(),o(),ze(),e.loader.js("./lib/msg-frequency.js"),t.WebSocket||console.log("WebSocket is not supported!");var i=Et.im_server;i=Et.im_ws_available&&t.WebSocket&&!e.ifIE()?Et["im_ws"+(Bt?"s":"")]:i.replace(/http[s]?:/i,location.protocol),console.log("server_url",i),zt=new Strophe.Connection(i),Ke=zt.udeskIM,h(Et),Pt.registeFn("openPanel",function(){return Vt.connected?void _t.animateScrollBottom():t.location.reload()}),Pt.registeFn("setReferrer",function(e){saveDevices(Et.user_id,e.referrer)}),Pt.registeFn("setProduct",function(t){t.product&&(_t.messagesEl.find(">.sidebox").size()?e.im.sidebox.moveTo({container:_t.messagesEl}):(e.im.sidebox.init({isInner:!0,container:_t.messagesEl,product:t.product}),lt=t.product),_t.animateScrollBottom())}),Pt.registeFn("forceLoadPage",function(e){_t.isBeforeunload=!0}),Le(),Pt.registeFn("showStoreMsg",_),$e("historyMsg"),L(),_t.bodyEl.on("click",".btn-feedback",function(){_t.hideMoreBox(),ct&&ct.abort(),Jt=!1,_t.goFeedback({btnBack:!0,hideBoardAll:!0,cb:function(){f()}})}).on("click","#show-history",function(){Re()}),_t.btnFileEl.off("click").on("click",function(){_t.hideMoreBox(),ht=!0,Tt.uploadQueueCounter=0}),_t.bodyEl.on("click",".from-submit-btn",function(e){var t=!0,n=yt(this).parents(".form-msg-box"),i=(yt(this).prev(),n.attr("data-fields-id")),r=un["formFields_"+i],s=n.find(".form-list"),o=n.parents(".msg"),a=o.find(">span"),l=/((http|https):\/\/([\w-]+\.)+[\w-]+(\/[\w-.\/\?\;%&=]*)?)/g,c=[];if(_t.hideMoreBox(),!pt){r||(t=!1,yt.get(Nt+"im/im_session_forms/"+i,{property:"true"}).always(function(e){e&&1e3===e.code&&(delete e.code,r=e)})),yt.each(r.fields,function(e,n){var i=s.find("[name="+n.id+"]").val(),r=n.content_type||"";switch(r){case"droplist":i=i?[i]:"";break;case"radio":case"checkbox":var o=[];s.find('input[name="'+n.id+'"]:checked').each(function(){o.push(yt(this).val())}),i=o;break;case"chained_droplist":var o=[];yt.each(s.find('[data-field="'+n.id+'"]').find("select"),function(e,t){var n=yt(t).val();(n||0===n)&&yt(t).val()&&o.push(yt(t).val())}),i=o.join(",")}return"true"!==n.rq&&n.rq!==!0||i?"email"===n.id&&i&&!_t.isEmail(i)?(t=!1,_t.showTip(_t.UDL.g("tip.emailError"),"danger"),!1):"link"===n.content_type&&i&&!l.test(i)?(t=!1,_t.showTip(_t.UDL.g("tip.WrongLink"),"danger"),!1):void c.push({id:n.id,value:i,tp:n.tp}):(t=!1,_t.showTip(n.name+_t.UDL.g("tip.noFill"),"danger"),!1)});var u={fields:c,id:r.id,customer_id:Et.user_id,agent_id:Wt.agent_id,company_id:Dt.id};if(t){pt=!0;var d="/spa1/im/im_session_forms/message_save";yt.ajax({url:d,type:"POST",data:u}).always(function(e){var t='<i class="icon icon-msg-ok"></i> '+Ct("subSuc"),n='<i class="icon icon-msg-close"></i> '+Ct("subFail");if(pt=!1,o.removeClass("form"),o.addClass("bg-success"),a.html(t),1e3===e.code){var i=xe({type:"form_received",content:_t.UDL.g("tip.customerForm",{customer:r.describe})});j(i,M())}else if(5104===e.code){var s="";c.forEach(function(e){if("cellphone"===e.id)return void(s=e.value)});var i=xe({type:"form_received",content:_t.UDL.g("tip.phoneForm",{num:s})});j(i,M())}else if(5105===e.code){var l="";c.forEach(function(e){if("email"===e.id)return void(l=e.value)});var i=xe({type:"form_received",content:_t.UDL.g("tip.emailForm",{email:l})});j(i,M())}else o.removeClass("bg-success").addClass("bg-danger"),a.html(n)})}}}),_t.messagesEl.on("click",".show-tel",function(e){_t.hideMoreBox();var t=yt(this).attr("href");t&&(_t.winAlert(_t.UDL.g("label.call")+t.substring(4)),e.preventDefault())}),_t.screenShotEl.off("click").on("click",function(){_t.hideMoreBox(),mt||Ee();var e=["1.","png"].join(""),t=mt.DoCapture(e,0,3,0,0,0,0);t&&Ie()}),Ut&&xt.isTransfer&&Pt.postMsg({type:"transfer"}),Lt?_t.needSideListion(Lt.side_data)&&Qe(Lt.side_data):_t.getSideBoxData(function(e){_t.needSideListion(e.side_data)&&Qe(e.side_data)}),e.ui.appBar()}function Qe(t){e.loader.js("./lib/iframe-listener.js").then(function(){e.iframeListener.init({side_data:t}),e.iframeListener.setListenerPage("agent"),e.iframeListener.registeFn("sendMsg",function(e){ye(null,e)})})}function Je(t){Tt.hasPreform=!0,e.im.preform.init({isInner:Ut,isOldCustomer:Et.has_pre_form,allDone:function(){t&&t()}})}function Ge(t){t=t||{},Tt.initCfg=t,Et.show_pre_form||xt.show_pre_form?Je(function(){e.setContext({show_pre_form:!1}),Xe()}):Xe()}var Ke,Ye,Ze,et,tt,nt,it,rt,st,ot,at,lt,ct,ut,dt,pt,ht,ft,mt,gt,vt,bt,yt=e.$,_t=e.common,xt=e.context,wt=xt.els,Tt={transferEventMsgId:"transferEventMsg"},kt=_t.UDL.g,St=_t.UDL.gl,Ct=_t.UDL.gt,Et=_t.customer,At=_t.agentResp,It=Et.show_pre_session||!1,Dt=_t.company,Nt=_t.apiPath,Lt=_t.sideRes,jt=(_t.isMob,Dt.leave_enable),$t=_t.urlParamObj,Rt=$t.session_key||"",Mt=_t.frameConfig||{},Ft=Mt.buttons_enable||{},Ot=Ft.screenshot_enabled,qt=(Ft.download_logs_enabled,Ft.emoji_enabled,Ft.upload_enabled),Ht=(Ft.agent_cellphone_enabled,Ft.agent_cellphone,Mt.theme_color),Pt=_t.innerController,Ut=Pt.isInnerMode,Bt="https:"===location.protocol,zt=null,Wt={},Vt={},Xt=!1,Qt=!1,Jt=!1,Gt=!1,Kt=[],Yt=[],Zt=0,en=0,tn=(_t.supportStore(),!1),nn=!1,rn=!1,sn=[],on=[],an=(_t.bodyEl,_t.txtMsgEl),ln=!0,cn=0,un={},dn=1,pn=!1,hn=null,fn=!1,mn="msg_"+Et.user_id;Rt&&(mn=mn+"_"+Rt);var gn,vn=Mt.h5Mode,bn=e.template.chat||{},yn=e.template.feedback||{},_n={classes:["cascade-0"],fields:[]},xn="/static_cmps/NiuniuCapture/180509",wn=0===navigator.platform.indexOf("Mac"),Tn=0,kn=0,Sn=0,Cn=[],En="Transfer||"+Et.username,An=_t.sessionStore(En),In=An?An.split("||")[2]:"",Dn=!1,Nn={key:"seq_num",init:function(){this.value=parseInt(_t.sessionStore(Nn.key))||0},increment:function(){return this.value=(this.value||0)+1,_t.sessionStore(Nn.key,this.value),this.value},isSkip:function(e){var t=this.old_recv_sn;return this.old_recv_sn=e,"undefined"!=typeof t&&"undefined"!=typeof e&&parseInt(e)>parseInt(t)+1}};return Nn.init(),{init:Ge}}),function(e,t,n,i){e.ns("robot"),e.robot.structCardMsg=function(i){return new n(i,e,t)},$.extend(n.prototype,i),console.log("Load Udesk robot/struct-card-msg.js"),/chrome/i.test(navigator.userAgent)}(this.udesk,this,function(e,t,n){this.state={},this.props=this.mapProps(e),this.tpls={main:['<dl class="{className}">',"<dt>{title}</dt>",'<dd><ul class="clearfix">{content}</ul></dd>',"</dl>"].join(""),listItem:['<li data-act="item" data-data=\'{dataStr}\' class="ellipsis"><a>{value}</a></li>'].join(""),productItem:["<li data-act=\"item\" data-data='{dataStr}'>",'<img src="{image}" />','<a data-act="url" href="{url}" target="_blank">{name}</a>','<div class="expend-html clearfix">{expendHtml}</div>',"</li>"].join(""),productInfo:'<span style="{style}">{info}</span>',cardMain:['<dl class="{className}">',"<dt>{title}</dt>",'<dd><ul class="clearfix">{content}</ul></dd>',"</dl>"].join(""),cardMainNoTitle:['<dl class="{className}">','<dd><ul class="clearfix">{content}</ul></dd>',"</dl>"].join(""),FAQListTpl:['<li class="card-li list-box">','    <div class="list-header">{suggestContent}</div>','    <ul class="list-body list-menu">',"       {msg}","    </ul>","</li>"].join(""),pagerItem:'<li class="text-right card-li"><a data-act="group">换一组</a></li>',titleItem:"<p>{title}</p>"},this.tpls.tableItem=this.tpls.listItem,this.loadSrc(),this.render()},{loadSrc:function(){udesk.loader.css("robot/struct-card-msg.css")},mapProps:function(e){e=e||{};var t=e.answer||{},n=t.msgType||"",i=n.replace(/^(selective|show)_/,""),r=/^selective_/.test(n),s=t.ansCon||{},o=s.cardList||[],a=s.turnFlag||!1,l=e.insertMethod||"append",c={},u="custom_card"===n?"custom-card-msg":"struct-msg";return c[i]=!0,"product"===i&&(r="show_product"===n),{container:$(e.container),type:i,msgType:n,_className:u,typeIs:c,selectable:r,title:s.title,pageSize:s.showSize,insertMethod:l,answer:t,data:s.productList||s.optionList||o||[],turnFlag:a,render:e.render,afterRender:e.afterRender,on:e.on}},needPage:function(){var e=this.props,t=e.pageSize,n=e.data,i=e.turnFlag;return!(!i||!t)&&Math.ceil(n.length/t)>1},getPageData:function(){var e,t=this.props,n=this.state,i=t.data,r=n.pageIndex||0,s=t.pageSize;return this.needPage()&&(e=Math.ceil(i.length/s),r+1>e&&(r=0,n.pageIndex=0),i=i.slice(r*s,r*s+s)),i},genItem:function(e){if(!e)return"";var t=this.props.msgType,n=e.type;if("custom_card"!==t){var i=this.props.type,r=this.tpls[i+"Item"];return e=$.extend({dataStr:JSON.stringify(e),expendHtml:this.genExpendHtml(e)},e),udesk.replaceTpl(r,e)}return 1===n?this.genRichItem(e):2===n?this.genFAQItem(e):void 0},genRichItem:function(e){var t='<li class="card-li">{content}</li>';return e.isHit&&(1===e.hitType&&e.hitContent?t='<li class="card-li"><a href="{hitContent}" target="_blank" style="display: inline;">{content}</a></li>':2===e.hitType&&e.hitContent&&(t='<li data-act="item" data-data="{hitContent}" class="card-li">{content}</li>')),udesk.replaceTpl(t,e)},genFAQItem:function(e){var t=this.tpls.FAQListTpl;return udesk.replaceTpl(t,{msg:udesk.joinStr(udesk.map(e.suggestList,function(e,t){return'<li class="list-item-disc" data-act="item" data-data="'+t.content+'"><a class="" href="javascript:;">'+t.content+"</a></li>"})),suggestContent:e.suggestContent||"猜你想问"})},gen:function(){var e=this,t=this.props,n=(this.state,this.tpls),i=t.data,r=[],s=[t._className,t.type+"-"+t._className],o=this.needPage();return o&&(i=this.getPageData()),t.className&&s.push(t.className),!t.selectable&&s.push("unselectable"),$.each(i,function(t,n){r.push(e.genItem(n))}),o&&r.push(udesk.replaceTpl(n.pagerItem)),t.title?udesk.replaceTpl(n.cardMain,{title:t.title,className:s.join(" "),content:r.join("")}):udesk.replaceTpl(n.cardMainNoTitle,{className:s.join(" "),content:r.join("")})},genExpendHtml:function(e){if(!e||!e.infoList)return"";var t=this.tpls.productInfo,n=[];return $.each(e.infoList,function(e,i){var r=[];i.color&&r.push("color: "+i.color),i.boldFlag&&r.push("font-weight: bold"),n.push(udesk.replaceTpl(t,{info:i.info,style:r.join(";")}))}),n.join("")},on:function(e){var t=this,n=this.props;this.el.off(),this.el.on("click","[data-act]",function(i){var r=$(this),s=r.data("act"),o=r.data("data")||r.parents("li").data("data"),a={};if(s){if(a[s]=!0,a.group)return void t.incrementPage();if(n.selectable){if(a.url)return void i.stopPropagation()}else i.preventDefault();o&&(e&&e(s,o,n.answer),n.on&&n.on(s,o,n.answer))}})},incrementPage:function(){this.state.pageIndex=(this.state.pageIndex||0)+1,this._render("replace")},_render:function(e){var t=this.props,n=this.gen(),i=$(n),r="replace"===e;t.render&&(i=$(t.render(n,this))),r&&this.el.replaceWith(i),this.el=i,this.on()},render:function(){var e=this.props;this.destroy(),this._render(),e.afterRender&&e.afterRender(this.el)},destroy:function(){this.el&&(this.el.off(),this.el.remove())}}),function(e,t,n){e.chatRobot={create:function(){return n(e,t)}}}(this.udesk,this,function(e,t){function n(e){console.log("[CHATROBOT]",e,arguments)}function i(t,n){var i=["list-body"];return t=t||{title:U.UDL.g("robot.questions")},i.push(n?"list-menu submenu one-submenu":"accordion"),e.replaceTpl(ke,{typeClz:"",msg:e.joinStr('<div class="list-box">','   <div class="list-header">'+t.title+"</div>",'   <ul class="'+i.join(" ")+'" '+(n?"":'id="accordion"')+">","       {msg}","   </ul>","</div>")})}function r(){if(be)return be;var e={};for(var t in ie)0===t.indexOf("robot_")&&(e[t]=ie[t]);return ie.sdk_token&&(e.app_id=ie.app_id,e.sdk_token=ie.sdk_token,e.sdk_version=ie.sdk_version),e}function s(){var e={};for(var t in ie)0===t.indexOf("c_")&&(e[t]=ie[t]);return e}function o(e){return P.extend(e||{},r(),{im_web_plugin_id:ie&&ie.web_plugin_id})}function a(e,t){t=t||{},!ae.name&&(ae.name=e.webConfig.robotName),!ae.logoUrl&&(ae.logoUrl=e.webConfig.logoUrl),!ae.sessionId&&(ae.sessionId=e.sessionId);var n=t.delayShowWelcomeMsg,i={isRecv:!1,clz:"msg-recv",log_created_at:e.log_created_at,content:e.webConfig.helloWord,messagesEl:t.messagesEl,renderFn:t.renderFn,noScroll:t.noScroll};!n&&x(i),K&&!ae.name&&(ae.name=U.UDL.g("robot.aicpRobotName")),!ae.logoUrl&&(ae.logoUrl="images/bot.png"),(G||Y||K)&&e.topAsk&&e.topAsk.length&&(G&&(ae.logid=e.logId),x({isRecv:!0,clz:"msg-recv",log_created_at:e.log_created_at,content:{gusList:e.topAsk,listType:"commonQuestion",leadingWord:e.webConfig.leadingWord||U.UDL.g("robot.questions")},renderFn:t.renderFn,noScroll:t.noScroll})),n&&x(i)}function l(e,t){var n=o({s:Ie.BASE});n.customer=s(),setTimeout(function(){H||U.showModal("robotDelay")},5e3),P.get(re,n).always(function(n){n&&1e3==n.code?(le=JSON.stringify(n),U.setBtnSendActive(),a(n),e&&e()):t&&t()})}function c(e,t,n,i,r){var s=o({s:e?Ie.HELP:Ie.UNHELP,aId:t||"",cluid:n||"",logId:i||"",sessionId:ae.sessionId});Y&&(s.hitQuestion=r),P.get(re,s,function(e){T(e)})}function u(e,t){if(!Y){var n=o({s:Ie.GUIDE,q:e,sessionId:ae.sessionId});P.get(re,n,function(e){t&&t(e.list)})}}function d(){fe.unbind("input"),fe.unbind("propertychange");var e=U.getIosVersion()||"0.0.0",t=U.compareStr(e,"11.0.3",">");fe.bind("input propertychange",function(){clearTimeout(ce),ce=setTimeout(function(){h()},100),U.setBtnSendActive()}),fe.on("click",function(){var e=this;t||setTimeout(function(){try{e.scrollIntoView()}catch(t){}},400)})}function p(e){var t=P.trim(fe.val()),n=t.split(""),i=/^[\u4e00-\u9fa5]+$/;return P.each(n,function(t,n){if(i.test(n)){var r="<span style='color:red'>"+n+"</span>";e=e.replace(n,r)}}),e}function h(){var t=P.trim(fe.val());if(t!==ve){if(!t||t.length<2)return he.empty().hide();ve=t,u(t,function(t){t&&t.length&&(he.empty(),e.$.each(t,function(e,t){!t||e>9||he.append('<li data-query-type="9" class="ql guide-anwser" data-question-id="'+t.questionId+'" >'+(e+1)+"、"+p(t.question)+"</li>")}),P.trim(fe.val())&&B.isRobotChat&&he.show())})}}function f(e,t){var n=e.type,i={s:"fadeback"};if("over"!==n){i.sessionId=ae.sessionId,G?(i.surveyContent=e.surveyContent,i.sessionSurveyOptionId=n):i.level=n;var r=o(i);0===n&&(r.sub="fuck"),P.get(re,r,function(e){t&&t(e.message),T(e)})}}function m(t,n){n=n||V("robot.isSatisfied");var i=["<h3>"+n+"</h3>"];if(G){var r=[{id:2,text:V("robot.satisfied")},{id:3,text:V("robot.general")},{id:4,text:V("robot.unsatisfied")}];i.push('<dd class="bot scrollbar robot-survey">'),P.each(r,function(){i.push(e.replaceTpl('<label><input type="radio" name="survey_options" data-option="{id}"/> {text}</label>',this))}),i.push(['<p class="hide robot-survey-remark"><textarea class="survey-mark" maxlength=200></textarea></p>','<p class="btnbar robot-survey-btn">','  <a class="btn btn-yes">'+V("label.submit")+"</a>","</p>","</dd>"].join(""))}else i.push(['<p class="btnbar yunwen-robot-btn">','  <a class="btn btn-no sur-yes" style="padding:6px 12px;">'+V("robot.satisfied")+"</a> &nbsp; &nbsp; &nbsp;",'  <a class="btn btn-no sur-no" style="padding:6px 12px;">'+V("robot.unsatisfied")+"</a>","</p>"].join(""));ue=e.ui.modal({clz:"statsurvey",container:U.mainEl,title:V("robot.robotSurvey")||"",content:i.join(""),hide:null,needClose:!0,isMob:se}),ue.el.on("change","input[name='survey_options']:eq(2)",function(){var e=P(this),t=ue.el.find(".survey-mark").parent();e.is(":checked")?t.removeClass("hide"):t.addClass("hide")}),ue.el.on("click",".btn",function(){var e,t={},n=P(this);if(n.is(".sur-no"))e=0;else if(n.is(".sur-yes"))e=1;else if(n.is(".btn-yes")){var i=ue.el.find(".survey-mark").val(),r=ue.el.find(":checked").data("option");if(!r)return U.showTip(V("tip.pleaseSurvey"),"warn");if(r=+r,i&&i.length>200)return U.showTip(V("tip.overMaxLength"),"warn");e=r,4===e&&(t.surveyContent=i)}ue.close(),de=!0,t.type=e,f(t,function(e){U.showTip(V("robot.thanks"))})})}function g(t){return t&&(t=e.xssNotSymbol(t,"&")),t}function v(e){if(!e)return"";var t=P("<div />").html(e),n=t.find(".flow-item");return n.length&&n.each(function(e,t){var n=P(this),i=n.data("type"),r=n.data("id")||"",s=2===i?"wflink":"ql";n.addClass(s+" robot-flow"),n.attr("data-query-type",8),n.attr("data-question-id",r)}),t.html()}function b(){P(document.body).on("click",".audio-static",function(){var e=P(this),t=e.find("audio")[0];try{t.onended=function(){e.removeClass("audio-playing"),t.pause()}}catch(n){}e.hasClass("audio-playing")?(e.removeClass("audio-playing"),t.pause()):(e.addClass("audio-playing"),t.play())})}function y(t){var n,i=t.msgType,r=t.ansCon;if("image"===i)return'<img src="'+r+'" />';if("audio"===i){if(e.ifIE(9,"lt"))return'<a href="'+r+'" target="_blank">'+r+"</a>";var s=document.createElement("audio");return s.src=r,s.style.display="none",P(document.body).append(s),s.onloadedmetadata=function(){var e=Math.ceil(s.duration);P('[data-src="'+r+'"]').html(" "+e+'<sup>"</sup>')},n=['<a class="audio-static" href="javascript:;">','<audio src="'+r+'" class="hide"></audio>',"</a>",'<b class="duration" data-src="'+r+'"></b>'].join("")}if("link"===i){var o=r.faviconUrl||"images/link-lue.png",a=r.faviconUrl?"":"default-fav",l=r.title||r.answerUrl;return n=['<a href="'+r.answerUrl+'" target="_blank" class="link-outside-a">','<span style="background-image: url('+o+')" class="favicon-img '+a+'"></span>','<span class="ellipsis word-break favicon-text" title="'+l+'">'+l+"</span>","</a>"].join("")}return r}function _(t){var n,r=[],s=ke,o="";if(t.flowId)r=v(t.flowContent);else if(t.ansCon){r=t.ansCon,r=y(t),o+=t.msgType?" msg-"+t.msgType:"",e.isPC()&&xe&&"link"!==t.msgType&&(r=U.formatImgContent(r));var a=t.attachmentList||[],l=[],c="";if(P.each(a,function(e,t){l.push(U.formatAttachment(t))}),c=l.join(""),c&&(r+=e.replaceTpl(Ae,{msg:c})),t.relateList&&t.relateList.length&&(r+=e.replaceTpl(Ce,{msg:e.joinStr(e.map(t.relateList,function(e,t){return'<li class="list-item-disc"><a class="ql" data-question-id="'+(t.questionId||"")+'" data-query-type="7" href="javascript:;">'+(t.question||t.content)+"</a></li>"}))})),!K&&t.aId){var u=['style="color: '+ge+'"'];Y&&u.push('data-hit-question="'+t.hitQuestion+'"'),s=Se.replace("{helpBoxAttrs}",u.join(" "))}}else if(2===t.switchStaffType)r=t.switchStaffTips||U.UDL.g("robot.autoSwitchStaffTips");else{if(!t.gusList.length)return;var d=t.gusWords;if("commonQuestion"===t.listType){var p=1===t.gusList.length;if(s="commonQuestion"===t.listType?i({title:t.leadingWord},p):Ee,p){var h=t.gusList[0];P.each(h.optionsList,function(e,t){r.push('<li class="list-item-disc common-ql" data-question-id="'+t.questionId+'" data-query-type="6"><a href="javascript:;">'+t.question+"</a></li>")})}else P.each(t.gusList,function(e,t){var n=t.questionTypeId||"",i=t.questionType||"";r.push('<li class="list-item"><div class="link" data-question-type-id="'+n+'">'+i+'<i class="icon icon-arrow-down"></i></div><ul class="list-menu submenu">'),P.each(t.optionsList||[],function(e,t){r.push('<li class="list-item-disc common-ql" data-question-id="'+t.questionId+'" data-query-type="6"><a href="javascript:;">'+t.question+"</a><li>")}),r.push("</ul></li>")})}else d=P.isPlainObject(d)?d.afterWords:d,s="commonQuestion"===t.listType?i({title:t.leadingWord}):Ee,P.each(t.gusList,function(e,t){var n=t.questionId||"",i=t.question;r.push('<li class="list-item-disc"><a class="ql" data-question-id="'+n+'" data-query-type="7" href="javascript:;">'+i+"</a></li>")}),d&&r.push('<div class="list-header">'+d+"</div>");r=r.join("")}return _e&&!k("go_chat")||1===t.switchStaffType&&(o+=" has-go-chat",r=r+'<a class="btn-go-chat btn-hollow" data-udesk-go-chat>'+(t.switchStaffTips||U.UDL.g("agent.transfer"))+"</a>"),n={tpl:s,param:{msg:r,clz:"msg-recv",typeClz:o,aid:t.aId||0,cluid:t.cluid||"",logid:ae.logid||""}}}function x(t){t=P.extend({clz:"",log_created_at:new Date},t);var n,i=t.content||{},r=ke,s={msg:i,clz:t.clz,senderName:ae.name,msgTime:U.formatDateTime(t.log_created_at)},o=t.messagesEl||z.messages;if(("msg-recv"===t.clz||ye&&ae.logoUrl)&&(s.avatarStyle='style="background-image: url('+ae.logoUrl+')"'),t.isRecv){switch(i.msgType){case"selective_table":case"selective_list":case"selective_product":case"show_product":case"custom_card":n=!0}if(n)e.robot.structCardMsg({container:o,answer:i,render:function(n,a){var l=P(e.replaceTpl(r,P.extend(s,{clz:"msg-recv msg_"+i.msgType,msg:n})));return t.renderFn?t.renderFn(l):o.append(l),l},afterRender:function(e){t.renderFn||t.noScroll||U.judgeScrollDistance(e,{isRecv:t.isRecv,isRobot:!0})},on:function(e,t,n){if("item"===e){var i=t.value||t.name||t;w(i)}}});else{var a=_(i);r=a.tpl,s=P.extend({},s,a.param),s&&s.clz&&s.typeClz&&(s.clz+=" "+s.typeClz,delete s.typeClz)}}else!t.clz&&(s.clz="theme-bg");if(!n){var l=P(e.replaceTpl(r,s)),c=l.find(".btn-go-chat");
if(t.renderFn?t.renderFn(l):(o.append(l),t.noScroll||U.judgeScrollDistance(l,{isRecv:t.isRecv,isRobot:!0})),"commonQuestion"===i.listType&&o.find("#accordion").length){new De(P("#accordion"),(!1))}o.find(".theme-bg").each(function(){var e=P(this);e.css("background",ge),e.find("i").css("color",ge).css("border-left-color",ge)}),se&&c.size()&&c.css("left",o.width()/2-c.outerWidth()/2)}}function w(e,t,n){var i=e||P.trim(fe.val()),r=t?t.queryType:"",s=r?Ie.CLICK:Ie.CHAT;if("iframe"===n&&(i=e.content),i=g(i)){var a=o(P.extend({s:s,question:i,sessionId:ae.sessionId},t));clearTimeout(ce),he.empty().hide(),G||(x({content:i}),fe.val("").height(q)),U.setBtnSendActive(),U.autoSize(),P.get(re,a,function(e){var t=e.switchStaffType,n=e.switchStaffTips;return 0!==e.status?U.showTip(U.UDL.g("tip.newError"),"danger"):6400===e.code?U.showTip(U.UDL.g("tip.sensitiveWords"),"danger"):(G&&(clearTimeout(ce),he.empty().hide(),x({log_created_at:e.log_created_at,content:i}),fe.val("").height(q),C()),K&&C(),ae.logid=e.logId,x({isRecv:!0,log_created_at:e.log_created_at,content:1===t?P.extend({switchStaffType:t,switchStaffTips:n},e.robotAnswer[0]):e.robotAnswer[0]}),T(e,!0),void U.setBtnSendActive())})}}function T(e,t){1e3===e.code&&0===e.status&&2===e.switchStaffType&&(x({isRecv:!0,log_created_at:e.log_created_at,content:{switchStaffTips:e.switchStaffTips,switchStaffType:e.switchStaffType}}),_e?t?setTimeout(function(){k("auto_transfer")&&S("auto_transfer")},200):k("auto_transfer")&&S("auto_transfer"):setTimeout(function(){E()},2e3))}function k(e){var t=ie.udesk_sdk_features;return!!t&&(","+t+",").indexOf(","+e+",")>-1}function S(e,t){e&&(document.location="js://webview?"+P.param(P.extend({udesk_notice_type:e},t)))}function C(){ee&&Z&&!te&&(pe++,pe>=Z&&(_e?U.compareStr(ie.sdk_version,"4.0",">=")&&S("show_transfer"):D(),te=!0))}function E(){k("go_chat")?S("go_chat"):(P("#"+W.transferEventMsgId).remove(),z.messages.append(P(Te.titleRadiusItemTpl({id:W.transferEventMsgId,msg:V("agent.transferring")}))),U.doTransferCount(ae.sessionId,function(){U.doTransfer(),clearTimeout(ce),he.empty().hide()}))}function A(){d(),U.surveyEl.click(function(e){return de?U.showTip(V("robot.hasSurvey")):(e.stopPropagation(),m("survey"))}),U.bodyEl.on("click.bot",".ql",function(e){var t=P(this),n=t.hasClass("guide-anwser"),i=t.text()||"",r=t.data("question-id"),s=t.data("query-type"),o={logId:ae.logid,queryType:s,questionId:r};n&&(i=i.replace(/^\d+、/,"")),G||K||Y?w(i,o):w(i),e.stopPropagation()}),U.btnInnerTransferEl.click(E),me.on("click.bot",".help",function(e){var t=P(this),n=!0,i=t.parents("dd"),r=t.parents(".help-box"),s=t.find(".icon"),o=i.attr("aid"),a=i.attr("cluid"),l=i.attr("logid"),u=r.data("hit-question");return e.stopPropagation(),r.find(".active").size()?U.showTip(X("hasEvaluation"),"danger"):(t.is(".help-no")&&(n=!1),c(n,o,a,l,u),t.addClass("active"),void(s[0].className=s[0].className.replace("good1","good2")))}).on("click.bot",".wflink",function(e){var t=P(this),n=t.hasClass("robot-flow"),i=t.attr("rel"),r=t.text(),s=o({s:Ie.GUIDEA,fid:i,sessionId:ae.sessionId,question:r});n&&(s.flowId=t.data("id")),P.get(re,s,function(e){ae.logid=e.logId,x({content:r}),x({isRecv:!0,content:e.robotAnswer[0]})}),e.stopPropagation()}).on("click.bot",".submenu li.common-ql",function(e){var t=P(this),n=t.text()||"",i=t.data("question-id"),r=t.data("query-type"),s={logId:ae.logid,queryType:r,questionId:i};G||K||Y?w(n,s):w(n),e.stopPropagation()})}function I(e){var t=he.find(".ql"),n="up"===e?t.last():t.first();if(he.find(".active").length){var i=he.find(".active"),r="up"===e?i.prev(".ql"):i.next(".ql");return r=r.length?r:n,r.addClass("active").siblings().removeClass("active")}return n.addClass("active")}function D(){_e||(P("#btnTransfer").show(),ye&&U.h5TransferEl.css("display","inline-block")),W.hasShowBtnTransfer=!0}function N(){B.isTransfer&&W.hasShowBtnTransfer&&B.chatRobot.showBtnTransfer()}function L(t,n){if(t){n=n||{};var i=t.content_raw,r=t.created_at,s=n.isRecv?"msg-recv":"";try{return i=e.parseJSON(t.content_raw),i.webConfig?a(i,{messagesEl:n.messagesEl,renderFn:n.renderFn,delayShowWelcomeMsg:n.delayShowWelcomeMsg,noScroll:n.noScroll}):(!r&&(r=i.log_created_at),i.question?i=i.question:i.robotAnswer&&(i=B.isRobotChat?P.extend({switchStaffType:i.switchStaffType,switchStaffTips:i.switchStaffTips},i.robotAnswer[0]):i.robotAnswer[0]),x({isRecv:n.isRecv,clz:s,log_created_at:r,content:i,messagesEl:n.messagesEl,renderFn:n.renderFn,noScroll:n.noScroll}))}catch(o){}}}function j(){var e={im_web_plugin_id:ie.web_plugin_id};P.get("/spa1/im/im_logs/customer_logs",e).always(function(e){var t;if(e=e||{},t=e.im_logs||[],t.length){U.last_more_marking=e.more_marking,z.messages.empty(),t=$(t);var n=t.length>1;P.each(t,function(){L(this,{isRecv:(""+this.sender).indexOf("robot")>0,noScroll:n})}),n&&U.scrollBottom()}})}function $(t){var n=t[0]||{};try{var i=e.parseJSON(n.content_raw||"");if(i&&i.webConfig)return t;var r=JSON.parse(le),s=P.extend({agent_avatar:"",agent_id:"",agent_nick_name:"机器人",content:"",content_raw:le,log_type:"",sender:"udesk_robot",session_type:"robot"},r);return t.unshift(s),t}catch(o){return t}}function R(){n("destroy"),z.body.off(".bot"),z.messages.off(".bot"),z.footer.off(".bot"),z.btnSend.off(),z.btnSurvey.off(),z.txtMsg.off(),z.btnSurvey.hide(),z.body.removeClass("robot"),he.empty().hide(),P(W.transferSelector).remove(),P("#"+W.transferEventMsgId).hide(),P(".has-go-chat").removeClass("has-go-chat")}function M(){U.initFooter(),q=z.txtMsg.height(),z.txtMsg.focus(),z.btnSend.click(function(){w()}),z.txtMsg.on("keydown",function(e){switch(e.keyCode){case 13:if(e.shiftKey)return;if(he.find(".active").length){var t=he.find(".active").text();return w(t),e.preventDefault()}return w(),e.preventDefault();case 27:he.hide().empty();break;case 38:e.preventDefault(),I("up");break;case 40:e.preventDefault(),I("down")}}),z.body.on("click.bot",W.transferSelector,function(){E()})}function F(t){e.loader.js("./lib/iframe-listener.js").then(function(){e.iframeListener.init({side_data:t}),e.iframeListener.setListenerPage("robot"),e.iframeListener.registeFn("sendMsg",function(e){w(e,"","iframe")})})}function O(){var t="udesk_robot"===J.channel&&J.show_robot_times;(K||Y)&&U.surveyEl.hide(),U.footerEl.show(),l(function(){e.ui.config({appBar:{title:ae.name,avatar:ae.logoUrl}}),e.ui.appBar(),J.transfer&&!t&&D(),M(),A(),U.editorAutoShow(),ye&&U.applyH5Mode(),b(),H=!0,U.hideModal(),oe?U.needSideListion(oe.side_data)&&F(oe.side_data):U.getSideBoxData(function(e){U.needSideListion(e.side_data)&&F(e.side_data)}),j()},function(){U.showModal("robotError")})}var q,H,P=e.$,U=e.common,B=e.context,z=B.els,W={transferSelector:".btn-transfer, [data-udesk-go-chat]",transferEventMsgId:"transferEventMsg"},V=U.UDL.g,X=U.UDL.gl,Q=(U.UDL.gt,U.company),J=Q.robot,G=J&&"udesk_robot"===J.channel,K=J&&"aicp_robot"===J.channel,Y=J&&"zhuiyi_robot"===J.channel,Z=G?J.show_robot_times:0,ee=J.transfer,te=!1,ne=U.customer||{},ie=(U.apiPath,U.urlParamObj),re="/udesk_im/aifaq/v1/web_proxy",se=U.isMob,oe=U.sideRes,ae={},le={},ce=null,ue=null,de=!1,pe=0,he=(screen||window.screen,U.guideListEl),fe=U.txtMsgEl,me=(U.footerEl,U.messagesEl),ge=U.frameConfig.theme_color,ve="",be=r(),ye=U.frameConfig.h5Mode,_e=(U.frameConfig.h5Mode_enabled,!!ie.sdk_token),xe=U.innerController.isInnerMode,we="Transfer||"+ne.username,Te=e.template.chat||{};U.sessionStore(we,"");var ke=e.joinStr('<dd class="bot clearfix" aid="{aid}" cluid="{cluid}" logid="{logid}">','   <div class="msg {clz} {typeClz}">','       <div class="sender"><span class="sender-text">{senderName}</span><span class="time-text">{msgTime}&#8197;<b> </b></span></div><i {avatarStyle}></i><span style="{style}">{msg}</span>',"   </div>","</dd>"),Se=e.replaceTpl(ke,{typeClz:"",msg:["{msg}",'<hr class="hr-1" />','<div class="help-box" {helpBoxAttrs}>','<a class="help help-yes">','<i class="icon icon-good1" ></i>',"<span> "+U.UDL.g("robot.useful")+'</span><hr class="vr-1" /></a>','<a class="help help-no">','<i class="icon icon-no-good1" ></i>',"<span> "+U.UDL.g("robot.useless")+"</span></a>","</div>"].join("")}),Ce=e.joinStr('<div class="list-box">','    <div class="list-header">'+V("robot.questions")+"</div>",'    <ul class="list-body list-menu">',"       {msg}","    </ul>","</div>"),Ee=e.replaceTpl(ke,{typeClz:"",msg:Ce}),Ae=['<hr class="hr-1" />','<div class="attachment-list-wrapped">',"{msg}","</div>"].join(""),Ie={BASE:"p",GUIDE:"ig",CHAT:"aq",SCHAT:"avq",GUIDEA:"getflw",HELP:"addufc",UNHELP:"addulc",CLICK:"hit"},De=function(e,t){this.el=e||{},this.multiple=t||!1;var n=this.el.find(".link");n.on("click",{el:this.el,multiple:this.multiple},this.dropdown)};return De.prototype.dropdown=function(e){var t=e.data.el,n=P(this),i=n.next(),r=this;i.toggle(),n.parent().toggleClass("open"),e.data.multiple||t.find(".submenu").not(i).hide().parent().removeClass("open"),setTimeout(function(){try{r.scrollIntoView()}catch(e){}},250)},{state:W,init:O,showMsgByLog:L,showBtnTransfer:D,tryShowBtnTransfer:N,destroy:R}}),function(e,t,n){$(function(){n(e,t)})}(this.udesk,this,function(e,t){function n(e,t){var n=c.agentTransferTextWidth>160?c.agentTransferTextWidth:160;setTimeout(function(){e.find(".title-box").width((t.titleWidth||l(t.container).width())-(c.isMob||g?50:n)-(t.btnBack?0:30)-60)},50)}function i(t){var i=c.isPC,r=c.isMob,s=c.isHeadless,o=c.themeColor,t=c.config,l=c.els;return{isInner:g,isCSSMob:u.isMob,themeColor:o,show:function(e){e&&e.find(">dt, .btn-yes").css("background",o),e&&e.find(">dt, .btn-yes").css("border-color",o),e&&e.find(".btn-no").css("border-color",o)},appBar:{container:l.header,getButtons:function(e){var t=[];return t.push({act:"muted",iconName:e.muted?"stereos-off":"stereos-on",title:p("mesagePromptSound"),"data-toggle":"tooltip","data-placement":"bottom"}),g&&t.push({act:"minimize",iconName:"line",title:p("minimize"),"data-toggle":"tooltip","data-placement":"bottom"}),a&&!g&&t.push({id:"btnTransfer",act:"transfer",iconName:"person",text:d("agent.transfer"),"class":"btn-transfer"}),t},onClick:function(t){if("minimize"===t)u.innerController.postMsg({type:"hidePanel"});else if("muted"===t){var n=u.tipsNewMessage;n.muted?n.unmute():n.mute(),e.ui.config({appBar:{muted:n.muted}}),e.ui.appBar()}},onReady:function(t,i){e.ui.tooltip(t),n(t,i)}},editor:{container:l.footer,textarea:{rows:1,placeholder:h("placeInputHere")},btnSend:{id:"btnSend",text:p("send")},getButtons:function(n){var s=t.buttons_enable||{},o=[];return s.emoji_enabled&&o.push({id:"btnEmotion",iconName:"biaoqing",title:p("emoji"),tip:p("emoji")}),s.upload_enabled&&o.push({id:"btnFile",iconName:"upload",title:p("upload"),tip:p("file")}),i&&s.screenshot_enabled&&o.push({id:"btnScreenShot",iconName:"jianqie",title:p("screenshot")}),i&&s.download_logs_enabled&&o.push({id:"btnDownload",iconName:"download",title:h("downloadLastChats")}),o.push({id:"btnSurvey",act:"survey",iconName:"good",title:p("survey"),tip:p("evaluation")}),r&&s.agent_cellphone_enabled&&t.agent_cellphone&&o.push({id:"btnAgentTel",iconName:"tel",href:"tel:"+t.agent_cellphone,tip:p("tell")}),g&&o.push({id:"btnTransfer",text:d("agent.transfer"),"class":"inner-btn-transfer btn-transfer ellipsis"}),e.map(o,function(e,t){return t.title&&(t["data-toggle"]="tooltip"),t})},onReady:function(t,n){var i={};u.btnSendEl=i.btnSend=t.find("#btnSend"),u.btnEmotionEl=i.btnEmotion=t.find("#btnEmotion"),u.btnFileEl=i.btnFile=t.find("#btnFile"),u.screenShotEl=i.btnScreenShot=t.find("#btnScreenShot"),u.btnDownloadEl=i.btnDownload=t.find("#btnDownload"),u.surveyEl=i.btnSurvey=t.find("#btnSurvey"),u.btnAgentTelEl=i.btnAgentTel=t.find("#btnAgentTel"),u.txtMsgEl=i.txtMsg=t.find("textarea"),u.btnInnerTransferEl=i.btnInnerTransfer=t.find("#btnTransfer"),e.setContext({els:i}),e.ui.tooltip(t)}},board:{container:l.pages,themeColor:o,header:!s&&{getButtons:function(e){var t=[];return e.needClose?t.push({act:"close",iconName:"guanbi",title:"关闭","data-toggle":"tooltip","data-placement":"bottom"}):g&&t.push({act:"minimize",iconName:"line",title:"最小化","data-toggle":"tooltip","data-placement":"bottom"}),t}},onClick:function(e,t){"close"===e&&t.el.removeClass("open")},onReady:function(t,i){e.ui.tooltip(t),n(t,i)}},imgPreview:{title:p("sendImage"),sendText:p("sure")},tip:{container:l.main}}}function r(e){var t=!1,n=e.customer,i=e.company.robot||{},r=i.channel;return n.chatting||"faqrobot"!==r&&"udesk_robot"!==r&&"aicp_robot"!==r&&"zhuiyi_robot"!==r||(t=!0),(m.transfer||"agent"===u.chat_creator)&&(t=!1),v&&(t=!0),t}function s(e){e=e||{},u.goFeedback({btnBack:!!m.transfer});var t="Transfer||"+e.customer.username,n=u.sessionStore(t),i=n?n.split("||")[2]:"";i&&(u.sessionStore(t,""),u.doTransferTurnPage(3,i))}function o(){if(!y){y=!0;var t=[];b&&t.push("msie"),v&&t.push("hideHdr"),e.isMob()&&e.platform({weixin:function(e){t.push("weixin")},android:function(e){t.push("android")},ios:function(e){t.push("ios "+e)}}),t.length&&f.addClass(t.join(" ")),u.init({onBefore:function(t){var n=u.flashChecker()||{},r=c.els;c.isLowIE&&(!n.f||n.v<29)&&r.main.find(">.tip-bar").show(),e.ui.config(i(t)),c.isHeadless||e.ui.appBar({title:d("agent.onlineAg")}),e.ui.editor()},onAfter:function(t){t=t||{};var n=t.company,i=c.els,o=e.chatRobot.create();if(a=r(t),n.show_banner&&!u.hasWinParent()&&(u.isCopyRight=!0,i.copyRight.show(),i.body.addClass("has-copy-right")),u.autoSize(),!c.isLowIE&&autosize(i.txtMsg),i.txtMsg.on("autosize:resized",function(){u.autoSize()}),i.sideBox.removeClass("hide"),u.tipsNewMessage.init(),e.setContext({isCopyRight:u.isCopyRight}),a)e.ui.appBar({title:d("robot.title"),avatar:"images/bot.png"}),f.addClass("robot"),o.init();else{if(!n.agent_available)return void s(t);if(!n.work_time)return void s(t);e.chatAgent.create().init()}e.setContext({hasRobot:a,isRobotChat:a,chatRobot:o}),u.imgViewerInit()}})}}var a,l=e.$,c=e.context,u=e.common,d=u.UDL.g,p=u.UDL.gl,h=u.UDL.gt,f=l("body"),m=e.urlParams(t.location.href),g="inner"===m.currentMode,v=!!m.sdk_token,b=e.ifIE()||e.isIE11(),y=!1;u.innerController.listeneStorage(),g&&u.innerController.init(),g&&!m.transfer?(u.innerController.registeFn("chatting",function(e){u.agent_id=e.agent_id||"",u.chat_creator=e.chat_creator,u.invited=!!e.invited,o()}),u.innerController.registeFn("queuing",function(e){u.agent_id=e.agent_id||"",u.chat_creator=e.chat_creator,o()}),u.innerController.postMsg({type:"askPanelState"})):o()});