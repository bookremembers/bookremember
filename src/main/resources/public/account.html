<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>添加地址</title>
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="css/font.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/response.css">
</head>
<body>
<style type="text/css">
    .public_head span {
        color: #7d7d7d;
        font-size: 14px;
        padding: 0 15px;
        cursor: pointer;
        letter-spacing: 1px;
    }

    .header-btn {
        color: #333;
    }

    .public_head p {
        line-height: 35px;
        padding-bottom: 10px;
    }

    #fork{
        width: 20px;
        height: 20px;
        text-align: center;
        line-height: 20px;
        border-radius: 50px;
        margin-left: 307px;
        background-color: white;
        margin-top: -8px;
    }

    .small_msg{
        padding-left: 20px;
        color: red;
    }
</style>
<div style="overflow-x: hidden;background-color: #f3f3f5;padding:0">
    <header style="background-color: #fff;padding-bottom:5px;padding-left: 85px;padding-right: 85px">
        <a href="https://www.shiqichuban.com/?fp=1" style="display: inline-block;margin-top: 10px;padding-left: 0">
            <img id="logo" src="images/logo40.png" style="width:94px" alt="拾柒">
        </a>
        <div class="hdUser public_head"
             style="text-align: right;padding-left: 0;padding-right: 0;padding-top:10px;float:right">
            <div style="padding-top: 12px;">
                <span>
                		<a class="header-btn" href="sq_index.html">主页</a>
                	</span>
                <span><a href="order.html">订单</a></span>
                <span class="my_shiqi" style="position: relative;">
                		<a id="my_sq">我的拾柒</a>
                		<i><img class="my_icon_img" src="images/card_info_desc_icon.png"></i>
                		<div class="my_list"
                             style="display: none;position: absolute;z-index:1000;width: 120px;right:0px;top:46px;background-color: #fff;padding-top:15px;border-radius: 4px;box-shadow: 0px 1px 4px #ccc;">
                			<p style="text-align: center;"><a href="integral.html">我的积分</a></p>
                			<p style="text-align: center;" id="messagebox">我的消息</p>
                			<p style="position: absolute;left:50%;top:-20px;width:0;height: 0;border:10px solid rgba(0,0,0,0);border-bottom-color:#fff;"></p>
                		</div>
                	</span>
                <span>|</span>
                <span class="my_seting" style="position: relative;">
                		<a id="setting">我的设置</a>
                		<div id="setting_ul"
                             style="position: absolute; z-index: 1000; width: 120px; right: 0px; top: 46px; background-color: rgb(255, 255, 255); padding-top: 15px; border-radius: 4px; box-shadow: rgb(204, 204, 204) 0px 1px 4px; display: none;">
                			 <p style="text-align: center;"><a href="account.html">账户设置</a></p>
							 <p style="text-align: center;"><a href="#">会员中心</a></p>
							 <p style="text-align: center;" id="logout_btn"><a href="javascript:void(0)">退出登录</a></p>
                			 <p style="position: absolute;left:50%;top:-20px;width:0;height: 0;border:10px solid rgba(0,0,0,0);border-bottom-color:#fff;"></p>
                		</div>
                	</span>
            </div>
        </div>
    </header>
    <div style="padding:0">
        <div class="grid_main grid_content clearfix">
            <div class="comWrap">
                <nav class="comNav">
                    <a href="#" class="cur">我的信息</a>
                    <a href="#">头 像</a>

                </nav>
    <div class="comInner clearfix" id="contents_box">
        <ul class="userSafe">
            <li id="ida" class="">
                <span class="tb">笔名</span>
                <span class="tb mid" id="username"></span>
                <span class="tb t_right"><a href="#" id="edit_box" class="blue edit_box">编辑</a></span>
            </li>

            <li class="contents hide" id="idb">
                <div class="model">
                    <form class="comForm" method="POST" id="form-update-nickname" action="#">
                        <input type="hidden" name="_token" value="ugWCGaddUHwyBKtUBVFBOfJH57pmd7kCgIQ1vuSu">
                        <a id="fewer" class="f_r blue box_up">收起</a>
                        <h5>修改笔名</h5>
                        <div class="fmL">
                            <label class="label">新笔名</label>
                            <span class="r iptBdr"><input type="text" id="form_nick_name" name="nickname"
                                                          class="ipt" maxlength="10" placeholder="小于10个字符"></span>
                        </div>
                        <div class="btnsItem t_right">
                            <button type="button" id="save_btn" class="btn btnPrimary">保 存</button>
                            <a id="close1" class="btn btnDefault ml10 box_up">关 闭</a>
                        </div>
                    </form>
                </div>

            </li>
            <li class=" " id="idc">
                <span class="tb">收货地址</span>
                <span class="tb mid" id="setAddress">湖南省 长沙市 芙蓉区五一广场，牛耳教育 CTT </span>
                <span class="tb t_right"><a href="#" id="edit_box2" class="blue edit_box">编辑</a></span>
            </li>
            <li class="contents hide" id="idd">
                <div class="model">
                    <form class="comForm" id="form-update-addr" action="#" method="POST">
                        <input type="hidden" name="_token" value="ugWCGaddUHwyBKtUBVFBOfJH57pmd7kCgIQ1vuSu">
                        <a id="fewer2" class="f_r blue box_up">收起</a>
                        <h5>收货地址</h5>
                        <div class="fmL add_address_btn">
                            <span class="iptBdr" id="insertAddress"><i class="icon iconAdd"></i>&nbsp;新增收货地址</span>
                        </div>
                        <div class="add_address hide" style="display:none" id="ide">
                            <h5>修改收货地址</h5>
                            <div class="fmL">
                                <label class="label"><i
                                        style="color: #f00;padding-right: 5px;">*</i>收货人姓名</label>
                                <span class="r iptBdr"><input type="text" name="name" value="" class="ipt"
                                                              id="consigneeName"></span> <small class="small_msg" ></small>
                            </div>
        <div class="fmL">
            <label class="label"><i
                    style="color: #f00;padding-right: 5px;">*</i>所在地区</label>
            <span class="r">
              <select class="select" id="province" name="province" value="" style="width:110px;">
				  <!--省份-->
			  </select>
              <select class="select" name="city" id="city" value="" style="width:110px;">
				  <!--城市-->
			  </select>
              <select class="select" name="district" id="district" value="" style="width:110px;">
				  <!--区市-->
			  </select>
            </span><small class="small_msg" ></small>
                 </div>
                    <div class="fmL">
                        <label class="label"><i
                                style="color: #f00;padding-right: 5px;">*</i>详细地址</label>
                        <span class="r iptBdr"><input type="text" name="detail_addr" value=""
                                                      class="ipt" id="detailedAddress"></span><small class="small_msg" ></small>
                    </div>
                    <div class="fmL">
                        <label class="label">邮政编码</label>
                        <span class="r iptBdr"><input type="text" name="zip_code" value="" class="ipt" id="zipCode"></span>
                    </div>
                    <div class="fmL">
                        <label class="label"><i
                                style="color: #f00;padding-right: 5px;">*</i>手机号码</label>
                        <span class="r iptBdr"><input type="text" name="mobile" value="" class="ipt"
                                                      id="phone"></span><small class="small_msg" ></small>
                    </div>
                    <div class="fmL error_tips hide" style="color: #f00;text-align: center;"></div>
                    <div class="btnsItem t_right">
                        <button id="save_btn2" class="btn btnPrimary save_addr" type="button">保 存</button>
                        <a id="close2" class="btn btnDefault ml10 close_address_panel">关 闭</a>
                    </div>
                </div>
                <div class="wrapAddrss" style="" id="idf">
                    <!--<div class="tbAddress" isdefault="1"
                         desc="湖南省 长沙市 芙蓉区 五一广场，牛耳教育 CTT">
                        <div class="tbHd">
                            <dl>
                                <dt>默认地址</dt>
                                <dd>
                                    <a href="javascript: modifyAddr({&quot;id&quot;:862992,&quot;uid&quot;:12966489,&quot;name&quot;:&quot;CTT&quot;,&quot;province&quot;:&quot;\u6e56\u5357\u7701&quot;,&quot;city&quot;:&quot;\u957f\u6c99\u5e02&quot;,&quot;district&quot;:&quot;\u8299\u84c9\u533a&quot;,&quot;detail_addr&quot;:&quot;\u4e94\u4e00\u5e7f\u573a\uff0c\u725b\u8033\u6559\u80b2&quot;,&quot;zip_code&quot;:&quot;410000&quot;,&quot;mobile&quot;:&quot;18273061353&quot;,&quot;tel&quot;:null,&quot;deleted_at&quot;:null,&quot;created_at&quot;:&quot;2019-07-12 16:31:14&quot;,&quot;updated_at&quot;:&quot;2019-07-12 16:31:14&quot;,&quot;default_addr&quot;:1})"
                                       class="blue">修改</a>
                                    <span>|</span><a
                                        href="javascript: deleteAddr(&#39;/v1/user_addr/delete/862992&#39;, &#39;tbAddress862992&#39;)"
                                        class="blue">删除</a>
                                </dd>
                            </dl>
                        </div>
                        <div class="tbCon">
                            <dl>
                                <dt>收货人</dt>
                                <dd>CTT</dd>
                            </dl>
                            <dl>
                                <dt>所在地址</dt>
                                <dd>湖南省 长沙市 芙蓉区</dd>
                            </dl>
                            <dl>
                                <dt>详细地址</dt>
                                <dd>五一广场，牛耳教育</dd>
                            </dl>
                            <dl>
                                <dt>&nbsp;</dt>
                                <dd>&nbsp;</dd>
                            </dl>
                            <dl>
                                <dt>邮编</dt>
                                <dd>410000</dd>
                            </dl>
                            <dl>
                                <dt>手机</dt>
                                <dd>18273061353</dd>
                            </dl>
                        </div>
                    </div>-->

                </div>
            </form>
        </div>
        </li>
    </ul>
</div>
</div>
</div>

        <!--<textarea style="display: none;" id="add_node_tpl">&lt;div class="tbAddress" id="tbAddress&lt;%id%&gt;" isdefault="0" desc="&lt;%province%&gt; &lt;%city%&gt; &lt;%district%&gt; &lt;%detail_addr%&gt; &lt;%name%&gt;"&gt;
        &lt;div class="tbHd"&gt;
        &lt;dl&gt;
        &lt;dt&gt;&nbsp;&lt;/dt&gt;
        &lt;dd&gt;&lt;a href="javascript: defaultAddr('/v1/user_addr/default/&lt;%id%&gt;', 'tbAddress&lt;%id%&gt;')" class="blue"&gt;设为默认地址&lt;/a&gt;&lt;span&gt;|&lt;/span&gt;
        &lt;a href='javascript: modifyAddr(&lt;%json%&gt;)' class="blue"&gt;修改&lt;/a&gt;
        &lt;span&gt;|&lt;/span&gt;&lt;a href="javascript: deleteAddr('/v1/user_addr/delete/&lt;%id%&gt;', 'tbAddress&lt;%id%&gt;')" class="blue"&gt;删除&lt;/a&gt;
        &lt;/dd&gt;
        &lt;/dl&gt;
        &lt;/div&gt;
        &lt;div class="tbCon"&gt;
        &lt;dl&gt;
        &lt;dt&gt;收货人&lt;/dt&gt;
        &lt;dd&gt;&lt;%name%&gt;&lt;/dd&gt;
        &lt;/dl&gt;
        &lt;dl&gt;
        &lt;dt&gt;所在地址&lt;/dt&gt;
        &lt;dd&gt;&lt;%province%&gt; &lt;%city%&gt; &lt;%district%&gt;&lt;/dd&gt;
        &lt;/dl&gt;
        &lt;dl&gt;
        &lt;dt&gt;详细地址&lt;/dt&gt;
        &lt;dd&gt;&lt;%detail_addr%&gt;&lt;/dd&gt;
        &lt;/dl&gt;
        &lt;dl&gt;
        &lt;dt&gt;&nbsp;&lt;/dt&gt;
        &lt;dd&gt;&nbsp;&lt;/dd&gt;
        &lt;/dl&gt;
        &lt;dl&gt;
        &lt;dt&gt;邮编&lt;/dt&gt;
        &lt;dd&gt;&lt;%zip_code%&gt;&lt;/dd&gt;
        &lt;/dl&gt;
        &lt;dl&gt;
        &lt;dt&gt;手机&lt;/dt&gt;
        &lt;dd&gt;&lt;%mobile%&gt; &lt;/dd&gt;
        &lt;/dl&gt;
        &lt;/div&gt;
        &lt;/div&gt;
        </textarea>-->
        <div class="mask pos-mask" style="position: fixed; height: 868px;display: none;" id="fullScreen"></div>
        <div class="dlPos tipPos pos-success" style="background-color: white;display: none;" dataurl="" id="popup">
            <div class="dlWrap">
                <div class="dlHd">
                    <div id="fork">
                    <a href="#">✖</a>
                    </div>
                </div>
                <div class="dlCon dlSuccess">
                    <div class="tc"><img src="images/iconYes.png" alt="保存成功"></div>
                    <p class="q">保 存 成 功</p>
                </div>
            </div>
        </div>
        <div class="dlPos tipPos pos-fail" style="display: none;" id="idh">
            <div class="dlWrap">
                <div class="dlHd">
                    <a href="#" class="closed icon iconClosed"></a>
                </div>
                <div class="dlCon dlSuccess">
                    <div class="tc"><img src="images/iconX.png" alt="保存失败"></div>
                    <p class="q">保 存 失 败</p>
                </div>
            </div>
        </div>
    </div>
    <footer style="height:60px;background-color: #f3f3f3;border-top:1px solid #c8c8c8">
        <div class="grid_main">
            <p class="f_l">拾柒网络技术（北京）有限公司 &gt;&gt;</p>
            <p class="f_r">京ICP备15043038</p>
        </div>
    </footer>
</div>
<script src="js/jquery-3.2.1.js"></script>
<script type="text/javascript" src="layer/2.4/layer.js"></script>
<script>
   /* $("#fullScreen").hide();
    $("#popup").hide();*/
    var uid = 0;
    $(() => {
        queryName();
    });

    function queryName() {
        $.ajax({
            type: "post",
            url: "queryLoginUser",
            dataType: "json",
            success: (data) => {
                console.log(data);
                $("#username").html(data.username);
                uid = data.uid;
            }
        })
    }

    /*保存  修改用户名*/
    $("#save_btn").click(() => {
        let newName = $("#form_nick_name").val();
        if (!newName) {
            layer.msg("新笔名不能为空", {icon: 2, time: 1000});
            return;
        }
        $.ajax({
            type: "post",
            url: "updName",
            data: {"newName": newName, "uid": uid},
            dataType: "json",
            success: (data) => {
                console.log(data);
                if (data == 1) {
                    layer.msg("修改成功", {icon: 1, time: 1000});
                    queryName();
                    $("#username").html(newName);
                    $("#ida").show(1000);
                    $("#idb").hide(1000);
                } else {
                    layer.msg("修改失败", {icon: 2, time: 1000});
                }
            }
        })
    })


    $('#setting').on('mouseover', function () {
        $('.my_list').hide();
        $('#setting_ul').show();
    });
    $('.my_seting').on('click', function () {
        $('#setting_ul').toggle();
    });

    $('#my_sq').on('mouseover', function () {
        $('#setting_ul').hide();
        if (!$('.my_icon_img').hasClass('rote_v1')) {
            $('.my_icon_img').addClass('rote_v1');
            $('.my_list').show();
            $('#setting_ul').hide();
            $('.my_icon_img').css({
                'transform': 'rotate(90deg)',
                '-webkit-transform': 'rotate(90deg)',
                '-ms-transform': 'rotate(90deg)',
                '-moz-transform': 'rotate(90deg)',
                '-o-transform': 'rotate(90deg)',
            })
        } else {
            $('.my_icon_img').removeClass('rote_v1');
            $('.my_list').hide();
            $('.my_icon_img').css({
                'transform': 'rotate(0)',
                '-webkit-transform': 'rotate(0)',
                '-ms-transform': 'rotate(0)',
                '-moz-transform': 'rotate(0)',
                '-o-transform': 'rotate(0)',
            })
        }

    });

    $('#my_sq').on('click', function () {

        if (!$('.my_icon_img').hasClass('rote_v1')) {
            $('.my_list').show();
            $('#setting_ul').hide();
            $('.my_icon_img').addClass('rote_v1');
            $('.my_icon_img').css({
                'transform': 'rotate(90deg)',
                '-webkit-transform': 'rotate(90deg)',
                '-ms-transform': 'rotate(90deg)',
                '-moz-transform': 'rotate(90deg)',
                '-o-transform': 'rotate(90deg)',
            })
        } else {
            $('.my_icon_img').removeClass('rote_v1');
            $('.my_list').hide();
            $('.my_icon_img').css({
                'transform': 'rotate(0)',
                '-webkit-transform': 'rotate(0)',
                '-ms-transform': 'rotate(0)',
                '-moz-transform': 'rotate(0)',
                '-o-transform': 'rotate(0)',
            })
        }
    });

    //笔名  编辑
    $("#edit_box").click(function () {
        $("#ida").hide(1000);
        $("#idb").show(1000);
    })
    //收起
    $("#fewer").click(function () {
        $("#ida").show(1000);
        $("#idb").hide(1000);
    })
    //关闭1
    $("#close1").click(function () {
        $("#ida").show(1000);
        $("#idb").hide(1000);
    })

   function queryAllAddress(){
       $.ajax({
           type:"post",
           url:"queryAddressByUid",
           data:{"uid":uid},
           dataType:"json",
           success:(data)=>{
               console.log(data);
               let temp=``;
               $.each(data,(index,obj)=>{
                   console.log(obj.atype)
                   temp+=`<div class="tbAddress" isdefault="${obj.addressid}"
                                 desc="${obj.provinceName} ${obj.cityName} ${obj.areaName}，${obj.amore} ${obj.aname}">
                            <div class="tbHd">
                            <dl>
                        `;
                   if (obj.atype==1){
                       temp+=`<dt>默认地址</dt>`;
                   }
                   if (obj.atype!=1){
                       temp+=`<dd style="float: right;">
                                <a href="javascript:;" onclick="setDefaultAddress(${obj.addressid},${obj.uid})">
                                    设置为默认地址
                                </a><span>|</span>
                            `;
                   }else {
                       temp+=`<dd>`;
                   }
                   temp+=`
                        <a href="javascript:;" class="blue" onclick="updAddress(${obj.addressid})">修改</a>
                        <span>|</span>
                      <a href="javascript:;" class="blue" onclick="delAddress(${obj.addressid})">删除</a>
                        </dd>
                    </dl>
                        </div>
                        <div class="tbCon">
                            <dl>
                                <dt>收货人</dt>
                                <dd>${obj.aname}</dd>
                            </dl>
                            <dl>
                                <dt>所在地址</dt>
                                <dd>${obj.provinceName} ${obj.cityName} ${obj.areaName}</dd>
                            </dl>
                            <dl>
                                <dt>详细地址</dt>
                                <dd>${obj.amore}</dd>
                            </dl>
                            <dl>
                                <dt>&nbsp;</dt>
                                <dd>&nbsp;</dd>
                            </dl>
                            <dl>
                                <dt>邮编</dt>
                                <dd>${obj.code}</dd>
                            </dl>
                            <dl>
                                <dt>手机</dt>
                                <dd>${obj.phone}</dd>
                            </dl>
                        </div>
                    </div>
                    `;
               })
               $("#idf").html(temp);
           }
       })
   }

   //地址  编辑
   $("#edit_box2").click(function () {
       /*点击编辑便查询用户的所有地址*/
       queryAllAddress();
       $("#idc").hide(1000);
       $("#idd").show(1000);
   })

    //新增收货地址
    $("#insertAddress").click(function () {
        $("#ide").show(1000);
        $.ajax({
            type: "post",
            url: "allProvince",
            dataType: "json",
            success: (data) => {
                console.log(data)
                let province = `<option value="-1">请选择</option>`;
                $.each(data, (index, obj) => {
                    province += `
					    	<option value="${obj.provinceCode}">${obj.provinceName}</option>
					    `;
                })
                $("#province").html(province);
            }
        })
    })
    /*根据省份查询城市*/
    $("#province").change(() => {
        let provinceCode = $("#province").val();
        $.ajax({
            type: "post",
            url: "allCity",
            data: {"provinceCode": provinceCode},
            dataType: "json",
            success: (data) => {
                console.log(data);
                let city = `<option value="-1">请选择</option>`;
                $.each(data, (index, obj) => {
                    city += `
			        	<option value="${obj.cityCode}">${obj.cityName}</option>
			        `;
                })
                $("#city").html(city);
            }
        })
    })
    /*根据城市查询地区*/
    $("#city").change(() => {
        let cityCode = $("#city").val();
        $.ajax({
            type: "post",
            url: "allArea",
            data: {"cityCode": cityCode},
            dataType: "json",
            success: (data) => {
                console.log(data);
                var district = `<option value="-1">请选择</option>`;
                $.each(data, (index, obj) => {
                    district += `
			        	<option value="${obj.areaCode}">${obj.areaName}</option>
			        `;
                })
                $("#district").html(district);
            }
        })
    })
    /*关闭弹窗*/
    $("#fork").click(()=>{
        $("#popup").hide(500);
        $("#fullScreen").hide();
    })
    //收起
    $("#fewer2").click(function () {
        $("#idc").show(1000);
        $("#idd").hide(1000);
    })
    //关闭2
    $("#close2").click(function () {
        $("#idc").show(1000);
        $("#idd").hide(1000);
    })
    //保存2
    $("#save_btn2").click(function () {
        var consigneeName = $("#consigneeName").val();
        if (!consigneeName) {
            /*$("#btn_text").html("收 货 人 不 能 为 空");
            $("#fullScreen").show();
            $("#popup").show(500);*/
            $(".small_msg").eq(0).html("请 填 写 收 货 人")
            return;
        }else {
            $(".small_msg").eq(0).html("")
        }
        var province=$("#province").val();
        var city=$("#city").val();
        var area=$("#district").val();
        if (!province || !city || !area){
            $(".small_msg").eq(1).html("请 选 择 地 址");
            return;
        }else{
            $(".small_msg").eq(1).html("");
        }
        var detailedAddress=$("#detailedAddress").val();
        if (!detailedAddress){
            $(".small_msg").eq(2).html("请 填 写 详 细 地 址");
            return;
        }else{
            $(".small_msg").eq(2).html("");
        }
        var phone=$("#phone").val();
        if (!phone) {
            $(".small_msg").eq(3).html("请 填 写 联 系 方 式");
            return;
        }else {
            $(".small_msg").eq(3).html("");
        }
        var zipCode=$("#zipCode").val();
        //发送ajax
        $.ajax({
            type: "post",
            url: "addAddress",
            data: {"uid":uid,"provinceid":province,"cityid":city,"areaid":area,"aname":consigneeName,"amore":detailedAddress,"code":zipCode,"phone":phone},
            dataType: "json",
            success: (data) => {
                console.log(data);
                if (data>0){
                    $("#fullScreen").show();
                    $("#popup").show(500);
                    $("#ide").hide(1000);
                }else{
                    $("#fullScreen").show();
                    $("#idh").show(500);
                }
            }
        })
    })
    function delAddress(addressId) {
        layer.confirm("确定删除该地址？删除后将无法恢复",{icon:9,title:"删除确认"},function (index) {
            $.ajax({
                type:"post",
                url:"deleteByAddressId",
                data:{"addressid":addressId},
                dataType:"json",
                success:(data)=>{
                    console.log(data);
                    if (data==1){
                        queryAllAddress();
                        layer.msg("删除成功",{icon:1,time:1000});
                    }else{
                        layer.msg("删除失败",{icon:2,time:1000});
                    }
                }
            })
            layer.close(index);
        })
    }
    function setDefaultAddress(addressId,uid) {
        
    }
</script>


</body>
</html>