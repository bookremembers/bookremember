<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- 图标库 -->
    <link rel="stylesheet"
          href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
</head>
<style>
    * {
        padding: 0px;
        margin: 0px;
    }

    #img1 {
        background-image: url('ctt_images/bk4.jpg');
        background-size: 100% 100%;
    }

    #img2 {
        background-image: url('ctt_images/bk3.jpg');
        background-size: 100% 100%;
    }

    #img3 {
        background-image: url('ctt_images/bk2.jpg');
        background-size: 100% 100%;
    }

    #img4 {
        background-image: url('ctt_images/bk1.jpg');
        background-size: 100% 100%;
    }

    @font-face {
        font-family: firstFont;
        src: url('ttf/燃烧小宇宙.ttf');
    }

    @font-face {
        font-family: twoFont;
        src: url('ttf/青呱石头体.ttf');
    }

    @font-face {
        font-family: threeFont;
        src: url('ttf/简体.ttf');
    }

    #bottomTop i:hover {
        cursor: pointer;
    }

    .modal-body input, #forget input {
        border-color: #878787;
        border-style: solid;
        border-top-width: 0px;
        border-right-width: 0px;
        border-bottom-width: 1px;
        border-left-width: 0px;
        outline: none;
        width: 100%;
    }

    #myModalLabel ul {
        list-style: none;
    }

    #myModalLabel ul li {
        width: 180px;
        text-align: center;
    }

    #myModalLabel ul div {
        width: 180px;
        margin: 10px;
        float: left;
        color: black;
        font-weight: 200;
    }

    #myModalLabel ul li a {
        text-decoration: none;
        color: black;
    }

    #myModalLabel ul li a:hover {
        text-decoration: none;
        color: black;
    }

    .body {
        width: 400px;
        margin: auto;
    }

    #myModalLabel {
        margin-left: 50px;
    }

    /*竖排字体样式： width: 50px; font-size: 50px; word-wrap: break-word; letter-spacing: 20px;*/
</style>
<body>
<div>
    <div style="width: 100%;height: 70px;">
        <div style="float: right;margin-right: 200px;letter-spacing: 20px;line-height: 70px;">
            <button type="button" style="background: black;color: white;" class="btn btn-default" data-toggle="modal"
                    data-target="#loginReg" onclick="islogin()">登录
            </button>
            <button type="button" style="background: black;color: white;" class="btn btnDefault" data-toggle="modal"
                    data-target="#loginReg" onclick="isreg()">注册
            </button>
        </div>
    </div>
    <!--模态框-->
    <div class="modal fade" id="loginReg" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
         data-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        <ul>
                            <div onclick="login()" style="cursor: pointer;" id="div_login">
                                <li><a href="javascript:;">登录</a></li>
                            </div>
                            <div onclick="reg()" style="cursor: pointer;" id="div_reg">
                                <li><a href="javascript:;">注册</a></li>
                            </div>
                        </ul>
                    </h4>
                </div>
                <!--登录-->
                <div id="login">
                    <div class="modal-body">
                        <br>
                        <div class="body">
                            <p>
                                <input type="text" id="login_username" placeholder="用户名" class="form-group">
                            </p>
                            <p>
                                <input type="password" id="login_password" placeholder="密码" class="form-group">
                            </p>
                            <small><a href="javascript:;" onclick="forgetPwd()">忘记密码？</a></small>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div style="width: 70%;height: 40px;border-radius: 10px;background-color: #000;color: #fff;text-align: center; letter-spacing: 8px;font-size: 14px;line-height: 40px;cursor: pointer;margin: auto"
                             id="btn_login">
                            登录
                        </div>
                    </div>
                </div>
                <!--注册-->
                <div id="reg">
                    <div class="modal-body">
                        <br>
                        <div class="body">
                            <p>
                                <input type="text" placeholder="用户名" class="form-group" id="name">
                            </p>
                            <p>
                                <input type="password" placeholder="密码" class="form-group" id="pwd">
                            </p>
                            <p>
                                <input type="password" placeholder="重复密码" class="form-group" id="pwd2">
                            </p>
                            <p>
                                <input type="text" placeholder="验证码" class="form-group" style="width: 35%;" id="code">
                                <canvas class="show-captcha" id="canvas" width="150" height="40"></canvas>
                                <a href="#" id="changeImg">看不清？换一张</a>

                            </p>
                            <p>
                                <input type="text" placeholder="手机号码" class="form-group" id="phone">
                            </p>
                            <p>
                                <input type="checkbox" style="width: 20px;margin-left: 100px;" class="form-group"
                                       id="agreement">
                                <small>阅读并接受<a href="javascript:;" onclick="lookAgreement()">《用户服务与隐私协议》</a></small>
                            </p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="btn_reg" class="btn btn-info btn-block"
                                style="width: 70%;margin: auto">
                            注册
                        </button>
                    </div>
                </div>
                <!--忘记密码-->
                <div id="forget">
                    <div class="modal-body">
                        <br>
                        <div class="body">
                            <h4>请填写您的用户名和手机号码获取验证码</h4>
                            <br>
                            <p>
                                <input type="text" placeholder="用户名" class="form-group" id="nameid">
                            </p>
                            <p>
                                <input type="text" placeholder="手机号码" class="form-group" id="mobile">
                            </p>
                            <p>
                                <input type="text" placeholder="输入验证码" class="form-group" style="width: 70%;" id="inputCode">
                                <button type="button" class="btn btn-default" onclick="acquire()">获取验证码</button>
                            </p>
                            <p>
                                <button type="button" class="btn btn-success" onclick="submitCode()" style="width: 70%;margin: auto">提交</button>
                            </p>
                        </div>
                    </div>
                </div>
                <!--修改密码-->
                <div id="updPwd">
                    <div class="modal-body">
                        <br>
                        <div class="body">
                            <h4>修改密码</h4>
                            <br>
                            <p>
                                <input type="password" placeholder="新密码" class="form-group" id="resetPwd">
                            </p>
                            <p>
                                <input type="password" placeholder="确认密码" class="form-group" id="qrResetPwd">
                            </p>
                            <p>
                                <button type="button" class="btn btn-success" onclick="submitPwd()" style="width: 70%;margin: auto">确认</button>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="width: 100%;height: 750px;color: snow;" id="img1">
        <div style="float: right;margin-top: 60px;margin-right: 100px;">
            <h1 style="font-family: twoFont;font-size: 80px;letter-spacing: 20px;">写点什么...</h1>
        </div>
    </div>
    <div style="width: 100%;height: 750px;color: snow;" id="img2">
        <div style="float: right;margin-top: 170px;">
            <h1 style="font-family: firstFont;font-size: 80px;letter-spacing: 20px;">让生活更有仪式感</h1>
            <p>Life is not the days you live, but the days you remember, so that each day is worth remembering</p>
        </div>
    </div>
    <div style="width: 100%;height: 750px;color: snow;" id="img3">
        <h1 style="font-family: twoFont;float: right;margin-top: 60px;font-size: 80px;letter-spacing: 20px;">
            写点什么...</h1>
    </div>
    <div style="width: 100%;height: 750px;color: snow;" id="img4">
        <h1 style="font-family: twoFont;float: right;margin-top: 60px;font-size: 80px;letter-spacing: 20px;">
            写点什么...</h1>
    </div>
    <div style="width: 100%;height: 100px;">
        <img src="ctt_images/head.jpg" width="100%" height="100%">
    </div>
    <hr>
    <br>
    <div style="width: 100%;height: 1000px;">
        <div style="width: 600px;height: 750px;float: left;margin-left: 50px;">
            <img src="ctt_images/tu2.jpg" width="100%" height="100%">
        </div>
        <div style="float: left;width: 100px;height: 700px;">
            <p style="width: 50px; font-size: 50px;font-family: threeFont; word-wrap: break-word; letter-spacing: 20px;padding-left: 70px;">
                生活不止眼前的苟且
            </p>
        </div>
        <div style="float: left;width: 100px;height: 700px;">
            <p style="width: 50px; font-size: 50px;font-family: threeFont; word-wrap: break-word; letter-spacing: 20px;padding-left: 50px;padding-top: 300px;">
                还有诗和远方
            </p>
        </div>
        <div style="float: left;width: 600px;height: 1600px;padding-left: 100px;">
            <img src="ctt_images/tu5.jpg" width="100%" height="100%">
        </div>
    </div>
    <div style="position: fixed;right: 30px;bottom: 30px;" id="bottomTop">
        <i class="fa fa-long-arrow-up" aria-hidden="true" style="color: red;font-size: 30px;"></i>
    </div>
</div>
<script type="text/javascript" src="js/jquery-3.2.1.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" src="layer/2.4/layer.js"></script>
<script type="text/javascript" src="h-ui.admin/js/H-ui.admin.js"></script>
<script type="text/javascript">
    $("#img2").hide()
    $("#img3").hide()
    $("#img4").hide()
    $("#forget").hide()
    $("#updPwd").hide();
    var i = 0;
    $(() => {
        var random = "";

        /**生成一个随机数**/
        function randomNum(min, max) {
            return Math.floor(Math.random() * (max - min) + min);
        }

        /**生成一个随机色**/
        function randomColor(min, max) {
            var r = randomNum(min, max);
            var g = randomNum(min, max);
            var b = randomNum(min, max);
            return "rgb(" + r + "," + g + "," + b + ")";
        }

        var code = drawPic();
        random = code
        document.getElementById("changeImg").onclick = function (e) {
            e.preventDefault();
            code = drawPic();
            random = code;
        }

        /**绘制验证码图片**/
        function drawPic() {
            var canvas = document.getElementById("canvas");
            var width = canvas.width;
            var height = canvas.height;
            //获取该canvas的2D绘图环境
            var ctx = canvas.getContext('2d');
            ctx.textBaseline = 'bottom';
            /**绘制背景色**/
            ctx.fillStyle = randomColor(180, 240);
            //颜色若太深可能导致看不清
            ctx.fillRect(0, 0, width, height);
            /**绘制文字**/
            var str = 'ABCEFGHJKLMNPQRSTWXY123456789';
            var code = "";
            //生成四个验证码
            for (var i = 1; i <= 4; i++) {
                var txt = str[randomNum(0, str.length)];
                code = code + txt;
                ctx.fillStyle = randomColor(50, 160);
                //随机生成字体颜色
                ctx.font = randomNum(15, 40) + 'px SimHei';
                //随机生成字体大小
                var x = 10 + i * 25;
                var y = randomNum(25, 35);
                var deg = randomNum(-45, 45);
                //修改坐标原点和旋转角度
                ctx.translate(x, y);
                ctx.rotate(deg * Math.PI / 180);
                ctx.fillText(txt, 0, 0);
                //恢复坐标原点和旋转角度
                ctx.rotate(-deg * Math.PI / 180);
                ctx.translate(-x, -y);
            }

            /**绘制干扰线**/
            for (var i = 0; i < 3; i++) {
                ctx.strokeStyle = randomColor(40, 180);
                ctx.beginPath();
                ctx.moveTo(randomNum(0, width / 2), randomNum(0, height / 2));
                ctx.lineTo(randomNum(0, width / 2), randomNum(0, height));
                ctx.stroke();
            }
            /**绘制干扰点**/
            for (var i = 0; i < 50; i++) {
                ctx.fillStyle = randomColor(255);
                ctx.beginPath();
                ctx.arc(randomNum(0, width), randomNum(0, height), 1, 0, 2 * Math.PI);
                ctx.fill();
            }
            return code;
        }

        $("#btn_login").click(() => {
            let username = $("#login_username").val();
            if (!username) {
                layer.msg("用户名不能为空", {icon: 2, time: 1000});
                return;
            }
            let password = $("#login_password").val();
            if (!password) {
                layer.msg("密码不能为空", {icon: 2, time: 1000});
                return;
            }
            $.ajax({
                type: "post",
                url: "queryByUsernamePwd",
                data: {"username": username, "password": password},
                dataType: "json",
                success: function (data) {
                    console.log(data);
                    if (data !=null) {
                        layer.msg("登录成功", {icon: 1, time: 1000});
                        location.href = "sy_index.html";
                    } else {
                        layer.msg("用户名或密码错误", {icon: 2, time: 1000});
                    }
                }
            })
        })
        $("#btn_reg").click(() => {
            let username = $("#name").val();
            if (!username) {
                layer.msg("用户名不能为空", {icon: 2, time: 1000});
                return;
            }
            let password = $("#pwd").val();
            if (!password) {
                layer.msg("密码不能为空", {icon: 2, time: 1000});
                return;
            }
            let password2 = $("#pwd2").val();
            if (!password2) {
                layer.msg("确认密码不能为空", {icon: 2, time: 1000});
                return;
            }
            let code = $("#code").val();
            if (!code) {
                layer.msg("验证码不能为空", {icon: 2, time: 1000});
                return;
            }
            let phone = $("#phone").val();
            if (!phone) {
                layer.msg("手机号码不能为空", {icon: 2, time: 1000});
                return;
            }
            if (code != random) {
                layer.msg("验证码错误", {icon: 2, time: 1000});
                return;
            }
            if (password != password2) {
                layer.msg("两次密码不一致", {icon: 2, time: 1000});
                return;
            }
            if (phone.length != 11) {
                layer.msg("手机号码不正确", {icon: 2, time: 1000});
                return;
            }
            var agreement = $("#agreement").prop("checked");
            console.log(agreement);
            if (!agreement) {
                layer.msg("请同意并接受用户服务与隐私协议", {icon: 2, time: 1000});
                return;
            }
            $.ajax({
                type: "post",
                url: "regUser",
                data: {"username": username, "password": password, "phone": phone},
                dataType: "json",
                success: function (data) {
                    console.log(data)
                    if (data == 1) {
                        layer.msg("注册成功", {icon: 1, time: 1000});
                        $("#login").show(1000);
                        $("#reg").hide(1000);
                        $("#forget").hide()
                    }else{
                        layer.msg("已有该用户", {icon: 2, time: 1000});
                    }
                }
            })
        })
    })
    setInterval(loopImg, 3000);

    function loopImg() {
        i++;
        $("#img" + i).show()
        if (i == 1) {
            $("#img2").hide()
            $("#img3").hide()
            $("#img4").hide()
        } else if (i == 2) {
            $("#img1").hide()
            $("#img3").hide()
            $("#img4").hide()
        } else if (i == 3) {
            $("#img1").hide()
            $("#img2").hide()
            $("#img4").hide()
        } else if (i == 4) {
            $("#img1").hide()
            $("#img2").hide()
            $("#img3").hide()
        }
        if (i >= 4) {
            i = 0;
        }
    }

    /*点击登录出现模态框登录*/
    function islogin() {
        var modalHeight = ($(window).height() / 2 - $('#loginReg .modal-dialog').height() / 2) - 30;
        console.log(modalHeight)
        $("#loginReg").css("margin-top", "100px");
        $("#loginReg").css("display", "none");
        $("#login").show(1000);
        $("#reg").hide(1000);
        $("#forget").hide(1000);
    }

    function isreg() {
        var modalHeight = ($(window).height() / 2 - $('#loginReg .modal-dialog').height() / 2) - 30;
        console.log(modalHeight)
        $("#loginReg").css("margin-top", "100px");
        $("#loginReg").css("display", "none");
        $("#login").hide(1000);
        $("#forget").hide(1000);
        $("#reg").show(1000);
    }

    function login() {
        $("#login").show(1000);
        $("#reg").hide(1000);
        $("#forget").hide(1000);
        $("#updPwd").hide(1000);
    }

    function reg() {
        $("#login").hide(1000);
        $("#forget").hide(1000);
        $("#reg").show(1000);
        $("#updPwd").hide(1000);
    }

    //点击事件div的触发
    $("#myModalLabel ul div").click(
        function () {
            $(this).css("border-bottom", "2px solid black").siblings().css("border-bottom", "2px solid white");
            $(this).css("font-weight", "600").siblings().css("font-weight", "200");
        });

    /*同意阅读用户协议与隐私*/
    function lookAgreement() {
        location.href = "agreement.html";
    }

    /*忘记密码*/
    function forgetPwd() {
        $("#forget").show(1000);
        $("#login").hide(1000);
        $("#reg").hide(1000);
    }

    /*获取验证码*/
    function acquire() {
        let username=$("#nameid").val();
        if (!username) {
            layer.msg("用户名不能为空", {icon: 2, time: 1000});
            return;
        }
        let phone=$("#mobile").val();
        if (!phone) {
            layer.msg("手机号码不能为空", {icon: 2, time: 1000});
            return;
        }
        if (phone.length != 11) {
            layer.msg("手机号码不正确", {icon: 2, time: 1000});
            return;
        }
        $.ajax({
            type:"post",
            url:"getCode ",
            data:{"username":username,"phone":phone},
            dataType:"json",
            success:(data)=>{
                console.log(data);
                alert("验证码是："+data);
            }
        })
    }
    /*提交验证码*/
    function submitCode() {
        let username=$("#nameid").val();
        if (!username) {
            layer.msg("用户名不能为空", {icon: 2, time: 1000});
            return;
        }
        let phone=$("#mobile").val();
        if (!phone) {
            layer.msg("手机号码不能为空", {icon: 2, time: 1000});
            return;
        }
        let code=$("#inputCode").val();
        if (!code) {
            layer.msg("验证码不能为空", {icon: 2, time: 1000});
            return;
        }
        if (phone.length != 11) {
            layer.msg("手机号码不正确", {icon: 2, time: 1000});
            return;
        }
        $.ajax({
            type:"post",
            url:"submitCode",
            data:{"username":username,"phone":phone,"code":code},
            dataType:"json",
            success:(data)=>{
                console.log(data)
                if (data.flag!="1"){
                    layer.msg(data.flag, {icon: 2, time: 1000});
                }else {
                    $("#forget").hide(1000);
                    $("#updPwd").show(1000);
                }
            }
        })
    }
</script>
</body>
</html>